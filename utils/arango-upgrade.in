#!/bin/bash

# Placeholders starting with @ will be replaced by make

ARANGOD="@SBINDIR@/arangod"
DATABASE="@DATABASEDIR@"
MODULESPATH="@PKGDATADIR@/js/server/modules;@PKGDATADIR@/js/common/modules"
SCRIPT="@PKGDATADIR@/js/server/arango-upgrade.js"

while [ "$#" -gt 1 ];  do
  case "$1" in
    --database|--database.directory)
      DATABASE="$2"
      shift
      ;;

    --relative)
      ARANGOD="./bin/arangod"
      MODULESPATH="./js/server/modules;./js/common/modules"
      SCRIPT="./js/server/arango-upgrade.js"
      ;;
  esac

  shift
done

if test ! -d "$DATABASE";  then
  echo "$0: database directory '$DATABASE' does not exist"
  exit 1
fi

$ARANGOD \
    -c none \
    --database.directory "$DATABASE" \
    --javascript.script "$SCRIPT" \
    --javascript.modules-path "$MODULESPATH" 

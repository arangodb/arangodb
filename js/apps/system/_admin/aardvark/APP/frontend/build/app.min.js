!function(){"use strict";var i=null;window.isCoordinator=function(t){null===i?$.ajax("cluster/amICoordinator",{async:!0,success:function(e){t(!1,i=e)},error:function(e){t(!0,i=e)}}):t(!1,i)},window.versionHelper={fromString:function(e){var t=e.replace(/-[a-zA-Z0-9_-]*$/g,"").split(".");return{major:parseInt(t[0],10)||0,minor:parseInt(t[1],10)||0,patch:parseInt(t[2],10)||0,toString:function(){return this.major+"."+this.minor+"."+this.patch}}},toString:function(e){return e.major+"."+e.minor+"."+e.patch}},window.arangoHelper={alphabetColors:{a:"rgb(0,0,180)",b:"rgb(175,13,102)",c:"rgb(146,248,70)",d:"rgb(255,200,47)",e:"rgb(255,118,0)",f:"rgb(185,185,185)",g:"rgb(235,235,222)",h:"rgb(100,100,100)",i:"rgb(255,255,0)",j:"rgb(55,19,112)",k:"rgb(255,255,150)",l:"rgb(202,62,94)",m:"rgb(205,145,63)",n:"rgb(12,75,100)",o:"rgb(255,0,0)",p:"rgb(175,155,50)",q:"rgb(0,0,0)",r:"rgb(37,70,25)",s:"rgb(121,33,135)",t:"rgb(83,140,208)",u:"rgb(0,154,37)",v:"rgb(178,220,205)",w:"rgb(255,152,213)",x:"rgb(0,0,74)",y:"rgb(175,200,74)",z:"rgb(63,25,12)"},statusColors:{fatal:"#ad5148",info:"rgb(88, 214, 141)",error:"rgb(236, 112, 99)",warning:"#ffb075",debug:"rgb(64, 74, 83)"},getCurrentJwt:function(){return sessionStorage.getItem("jwt")},getCurrentJwtUsername:function(){return sessionStorage.getItem("jwtUser")},setCurrentJwt:function(e,t){sessionStorage.setItem("jwt",e),sessionStorage.setItem("jwtUser",t)},checkJwt:function(){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/version"),contentType:"application/json",processData:!1,async:!0,error:function(e){401===e.status&&window.App.navigate("login",{trigger:!0})}})},getCoordinatorShortName:function(i){var n;return window.clusterHealth&&_.each(window.clusterHealth,function(e,t){i===t&&(n=e.ShortName)}),n},getDatabaseShortName:function(e){return this.getCoordinatorShortName(e)},getDatabaseServerId:function(i){var n;return window.clusterHealth&&_.each(window.clusterHealth,function(e,t){i===e.ShortName&&(n=t)}),n},lastNotificationMessage:null,CollectionTypes:{},systemAttributes:function(){return{_id:!0,_rev:!0,_key:!0,_bidirectional:!0,_vertices:!0,_from:!0,_to:!0,$id:!0}},getCurrentSub:function(){return window.App.naviView.activeSubMenu},parseError:function(e,t){var i;try{i=JSON.parse(t.responseText).errorMessage}catch(e){i=e}this.arangoError(e,i)},setCheckboxStatus:function(e){_.each($(e).find("ul").find("li"),function(e){$(e).hasClass("nav-header")||($(e).find("input").attr("checked")?$(e).find("i").hasClass("css-round-label")?($(e).find("i").removeClass("fa-circle-o"),$(e).find("i").addClass("fa-dot-circle-o")):($(e).find("i").removeClass("fa-square-o"),$(e).find("i").addClass("fa-check-square-o")):$(e).find("i").hasClass("css-round-label")?($(e).find("i").removeClass("fa-dot-circle-o"),$(e).find("i").addClass("fa-circle-o")):($(e).find("i").removeClass("fa-check-square-o"),$(e).find("i").addClass("fa-square-o")))})},parseInput:function(e){var t,i=$(e).val();try{t=JSON.parse(i)}catch(e){t=i}return t},calculateCenterDivHeight:function(){var e=$(".navbar").height(),t=$(".footer").height();return $(window).height()-t-e-110},createTooltips:function(e,t){var i=this,n={arrow:!0,animation:"fade",animateFill:!1,multiple:!1,hideDuration:1};if(t&&(n.position=t),e||(e=".tippy"),"object"==typeof e)_.each(e,function(e){i.lastTooltips=new Tippy(e,n)});else{if(-1<e.indexOf(",")){var o=e.split(",");_.each(o,function(e){i.lastTooltips=new Tippy(e,n)})}this.lastTooltips=new Tippy(e,n)}},fixTooltips:function(e,t){arangoHelper.createTooltips(e,t)},currentDatabase:function(e){return frontendConfig.db?e(!1,frontendConfig.db):e(!0,void 0),frontendConfig.db},allHotkeys:{jsoneditor:{name:"AQL editor",content:[{label:"Execute Query",letter:"Ctrl/Cmd + Return"},{label:"Execute Selected Query",letter:"Ctrl/Cmd + Alt + Return"},{label:"Explain Query",letter:"Ctrl/Cmd + Shift + Return"},{label:"Save Query",letter:"Ctrl/Cmd + Shift + S"},{label:"Open search",letter:"Ctrl + Space"},{label:"Toggle comments",letter:"Ctrl/Cmd + Shift + C"},{label:"Undo",letter:"Ctrl/Cmd + Z"},{label:"Redo",letter:"Ctrl/Cmd + Shift + Z"},{label:"Increase Font Size",letter:"Shift + Alt + Up"},{label:"Decrease Font Size",letter:"Shift + Alt + Down"}]},doceditor:{name:"Document editor",content:[{label:"Insert",letter:"Ctrl + Insert"},{label:"Save",letter:"Ctrl + Return, Cmd + Return"},{label:"Append",letter:"Ctrl + Shift + Insert"},{label:"Duplicate",letter:"Ctrl + D"},{label:"Remove",letter:"Ctrl + Delete"}]},modals:{name:"Modal",content:[{label:"Submit",letter:"Return"},{label:"Close",letter:"Esc"},{label:"Navigate buttons",letter:"Arrow keys"},{label:"Navigate content",letter:"Tab"}]}},hotkeysFunctions:{scrollDown:function(){window.scrollBy(0,180)},scrollUp:function(){window.scrollBy(0,-180)},showHotkeysModal:function(){var e=window.arangoHelper.allHotkeys;window.modalView.show("modalHotkeys.ejs","Keyboard Shortcuts",[],e)}},buildSubNavBar:function(e){var i;$("#subNavigationBar .bottom").html(""),_.each(e,function(e,t){i="",e.active&&(i+=" active"),e.disabled&&(i+=" disabled"),$("#subNavigationBar .bottom").append('<li class="subMenuEntry '+i+'"><a>'+t+"</a></li>"),e.disabled||$("#subNavigationBar .bottom").children().last().bind("click",function(){window.App.navigate(e.route,{trigger:!0})})})},buildUserSubNav:function(e,t){var i={General:{route:"#user/"+encodeURIComponent(e)},Permissions:{route:"#user/"+encodeURIComponent(e)+"/permission"}};i[t].active=!0,this.buildSubNavBar(i)},buildGraphSubNav:function(e,t){var i={Content:{route:"#graph/"+encodeURIComponent(e)},Settings:{route:"#graph/"+encodeURIComponent(e)+"/settings"}};i[t].active=!0,this.buildSubNavBar(i)},buildNodeSubNav:function(e,t,i){var n={Dashboard:{route:"#node/"+encodeURIComponent(e)}};n[t].active=!0,n[i].disabled=!0,this.buildSubNavBar(n)},buildNodesSubNav:function(e,t){var i={Overview:{route:"#nodes"},Shards:{route:"#shards"}};i[e].active=!0,t&&(i[t].disabled=!0),this.buildSubNavBar(i)},buildServicesSubNav:function(e,t){var i={Store:{route:"#services/install"},Upload:{route:"#services/install/upload"},New:{route:"#services/install/new"},GitHub:{route:"#services/install/github"},Remote:{route:"#services/install/remote"}};i[e].active=!0,t&&(i[t].disabled=!0),this.buildSubNavBar(i)},scaleability:void 0,buildCollectionSubNav:function(e,t){var i={Content:{route:"#collection/"+encodeURIComponent(e)+"/documents/1"},Indexes:{route:"#cIndices/"+encodeURIComponent(e)},Info:{route:"#cInfo/"+encodeURIComponent(e)},Settings:{route:"#cSettings/"+encodeURIComponent(e)}};i[t].active=!0,this.buildSubNavBar(i)},enableKeyboardHotkeys:function(e){var t=window.arangoHelper.hotkeysFunctions;!0===e&&($(document).on("keydown",null,"j",t.scrollDown),$(document).on("keydown",null,"k",t.scrollUp))},databaseAllowed:function(i){var e=function(e,t){e?arangoHelper.arangoError("",""):$.ajax({type:"GET",cache:!1,url:this.databaseUrl("/_api/database/",t),contentType:"application/json",processData:!1,success:function(){i(!1,!0)},error:function(){i(!0,!1)}})}.bind(this);this.currentDatabase(e)},arangoNotification:function(e,t,i){window.App.notificationList.add({title:e,content:t,info:i,type:"success"})},arangoError:function(e,t,i){$("#offlinePlaceholder").is(":visible")||window.App.notificationList.add({title:e,content:t,info:i,type:"error"})},arangoWarning:function(e,t,i){window.App.notificationList.add({title:e,content:t,info:i,type:"warning"})},arangoMessage:function(e,t,i){window.App.notificationList.add({title:e,content:t,info:i,type:"message"})},hideArangoNotifications:function(){$.noty.clearQueue(),$.noty.closeAll()},openDocEditor:function(e,t,i){var n=e.split("/"),o=this,a=new window.DocumentView({collection:window.App.arangoDocumentStore});a.breadcrumb=function(){},a.colid=n[0],a.docid=n[1],a.el=".arangoFrame .innerDiv",a.render(),a.setType(t),$(".arangoFrame .headerBar").remove(),$(".arangoFrame .outerDiv").prepend('<i class="fa fa-times"></i>'),$(".arangoFrame .outerDiv").click(function(){o.closeDocEditor()}),$(".arangoFrame .innerDiv").click(function(e){e.stopPropagation()}),$(".fa-times").click(function(){o.closeDocEditor()}),$(".arangoFrame").show(),a.customView=!0,a.customDeleteFunction=function(){window.modalView.hide(),$(".arangoFrame").hide()},a.customSaveFunction=function(e){o.closeDocEditor(),i&&i(e)},$(".arangoFrame #deleteDocumentButton").click(function(){a.deleteDocumentModal()}),$(".arangoFrame #saveDocumentButton").click(function(){a.saveDocument()}),$(".arangoFrame #deleteDocumentButton").css("display","none")},closeDocEditor:function(){$(".arangoFrame .outerDiv .fa-times").remove(),$(".arangoFrame").hide()},addAardvarkJob:function(e,t){$.ajax({cache:!1,type:"POST",url:this.databaseUrl("/_admin/aardvark/job"),data:JSON.stringify(e),contentType:"application/json",processData:!1,success:function(e){t&&t(!1,e)},error:function(e){t&&t(!0,e)}})},deleteAardvarkJob:function(e,t){$.ajax({cache:!1,type:"DELETE",url:this.databaseUrl("/_admin/aardvark/job/"+encodeURIComponent(e)),contentType:"application/json",processData:!1,success:function(e){t&&t(!1,e)},error:function(e){t&&t(!0,e)}})},deleteAllAardvarkJobs:function(t){$.ajax({cache:!1,type:"DELETE",url:this.databaseUrl("/_admin/aardvark/job"),contentType:"application/json",processData:!1,success:function(e){t&&t(!1,e)},error:function(e){t&&t(!0,e)}})},getAardvarkJobs:function(t){$.ajax({cache:!1,type:"GET",url:this.databaseUrl("/_admin/aardvark/job"),contentType:"application/json",processData:!1,success:function(e){t&&t(!1,e)},error:function(e){t&&t(!0,e)}})},getPendingJobs:function(t){$.ajax({cache:!1,type:"GET",url:this.databaseUrl("/_api/job/pending"),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})},syncAndReturnUninishedAardvarkJobs:function(a,r){var e=function(e,t){if(e)r(!0);else{var i=function(e,n){if(e)arangoHelper.arangoError("","");else{var o=[];0<n.length?_.each(t,function(t){if(t.type===a||void 0===t.type){var i=!1;_.each(n,function(e){t.id===e&&(i=!0)}),i?o.push({collection:t.collection,id:t.id,type:t.type,desc:t.desc}):window.arangoHelper.deleteAardvarkJob(t.id)}}):0<t.length&&this.deleteAllAardvarkJobs(),r(!1,o)}}.bind(this);this.getPendingJobs(i)}}.bind(this);this.getAardvarkJobs(e)},getRandomToken:function(){return Math.round((new Date).getTime())},isSystemAttribute:function(e){return this.systemAttributes()[e]},isSystemCollection:function(e){return"_"===e.name.substr(0,1)},setDocumentStore:function(e){this.arangoDocumentStore=e},collectionApiType:function(n,e,t){if(e||void 0===this.CollectionTypes[n]){var i=function(e,t,i){e?(arangoHelper.arangoError("Error","Could not detect collection type"),i&&i(e)):(this.CollectionTypes[n]=t.type,3===this.CollectionTypes[n]?i(!1,"edge",t):i(!1,"document",t))}.bind(this);this.arangoDocumentStore.getCollectionInfo(n,i,t)}else 3===this.CollectionTypes[n]?t(!1,"edge"):t(!1,"document")},collectionType:function(e){return e&&""!==e.name?(t=2===e.type?"document":3===e.type?"edge":"unknown",this.isSystemCollection(e)&&(t+=" (system)"),t):"-";var t},formatDT:function(e){var t=function(e){return e<10?"0"+e:e};return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+" "+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())},escapeHtml:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},backendUrl:function(e){return frontendConfig.basePath+e},databaseUrl:function(e,t){if("/_db/"===e.substr(0,5))throw new Error("Calling databaseUrl with a databased url ("+e+") doesn't make any sense");return t||(t="_system",frontendConfig.db&&(t=frontendConfig.db)),this.backendUrl("/_db/"+encodeURIComponent(t)+e)},showAuthDialog:function(){var e=!0;return"false"===localStorage.getItem("authenticationNotification")&&(e=!1),e},doNotShowAgain:function(){localStorage.setItem("authenticationNotification",!1)},renderEmpty:function(e,t){t?$("#content").html('<div class="noContent"><p>'+e+'<i class="'+t+'"></i></p></div>'):$("#content").html('<div class="noContent"><p>'+e+"</p></div>")},initSigma:function(){try{sigma.classes.graph.addMethod("neighbors",function(e){var t,i={},n=this.allNeighborsIndex[e]||{};for(t in n)i[t]=this.nodesIndex[t];return i}),sigma.classes.graph.addMethod("getNodeEdges",function(t){var e=this.edges(),i=[];return _.each(e,function(e){e.source!==t&&e.target!==t||i.push(e.id)}),i}),sigma.classes.graph.addMethod("getNodeEdgesCount",function(e){return this.allNeighborsCount[e]}),sigma.classes.graph.addMethod("getNodesCount",function(){return this.nodesArray.length})}catch(e){}},downloadLocalBlob:function(e,t){var i;if("csv"===t&&(i="text/csv; charset=utf-8"),"json"===t&&(i="application/json; charset=utf-8"),i){var n=new Blob([e],{type:i}),o=window.URL.createObjectURL(n),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=o,a.download="results-"+window.frontendConfig.db+"."+t,a.click(),window.setTimeout(function(){window.URL.revokeObjectURL(o),document.body.removeChild(a)},500)}},download:function(e,r){$.ajax(e).success(function(e,t,i){if(r)r(e);else{var n=new Blob([JSON.stringify(e)],{type:i.getResponseHeader("Content-Type")||"application/octet-stream"}),o=window.URL.createObjectURL(n),a=document.createElement("a");document.body.appendChild(a),a.style="display: none",a.href=o,a.download=i.getResponseHeader("Content-Disposition").replace(/.* filename="([^")]*)"/,"$1"),a.click(),window.setTimeout(function(){window.URL.revokeObjectURL(o),document.body.removeChild(a)},500)}})},downloadPost:function(e,t,i,n){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4===this.readyState&&200===this.status){i&&i();var e=document.createElement("a");e.download=this.getResponseHeader("Content-Disposition").replace(/.* filename="([^")]*)"/,"$1"),document.body.appendChild(e);var t=window.URL.createObjectURL(this.response);e.href=t,e.click(),window.setTimeout(function(){window.URL.revokeObjectURL(t),document.body.removeChild(e)},500)}else 4===this.readyState&&void 0!==n&&n(this.status,this.statusText)},o.open("POST",e),window.arangoHelper.getCurrentJwt()&&o.setRequestHeader("Authorization","bearer "+window.arangoHelper.getCurrentJwt()),o.responseType="blob",o.send(t)},checkCollectionPermissions:function(e,t){var i=arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(window.App.userCollection.activeUser)+"/database/"+encodeURIComponent(frontendConfig.db)+"/"+encodeURIComponent(e));$.ajax({type:"GET",url:i,contentType:"application/json",success:function(e){"ro"===e.result&&t()},error:function(e){arangoHelper.arangoError("User","Could not fetch collection permissions.")}})},checkDatabasePermissions:function(t,i){var e=arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(window.App.userCollection.activeUser)+"/database/"+encodeURIComponent(frontendConfig.db));$.ajax({type:"GET",url:e,contentType:"application/json",success:function(e){"ro"===e.result?t&&t(!0):"rw"===e.result?i&&i(!1):"none"===e.result&&(frontendConfig.authenticationEnabled||i&&i(!1))},error:function(e){arangoHelper.arangoError("User","Could not fetch collection permissions.")}})},getFoxxFlag:function(){var e;return $("#new-app-replace").prop("checked")?e=!0:$("#new-app-teardown").prop("checked")&&(e=!1),e},createMountPointModal:function(e,t,i){var n,o=[],a=[];window.App.replaceApp&&(n=(n=window.App.replaceAppData.mount).substr(1,n.length)),a.push(window.modalView.createTextEntry("new-app-mount","Mount point",n,"The path the app will be mounted. Is not allowed to start with _","mountpoint",!1,[{rule:Joi.string().required(),msg:""}])),a.push(window.modalView.createCheckboxEntry("new-app-teardown","Run setup?",!0,"Should this app's setup script be executed after installing the app?",!0)),window.App.replaceApp?(a.push(window.modalView.createCheckboxEntry("new-app-replace","Keep configuration and dependency files?",!0,"Should this app's configuration be saved before replacing the app?",!1)),o.push(window.modalView.createSuccessButton("Replace",e))):o.push(window.modalView.createSuccessButton("Install",e));var r="Create Foxx Service";window.App.replaceApp&&(r="Replace Foxx Service ("+window.App.replaceAppData.mount+")"),window.modalView.show("modalTable.ejs",r,o,a),window.App.replaceApp?($("#new-app-mount").attr("disabled","true"),$("#new-app-replace").attr("checked",!1),$("#new-app-replace").on("click",function(){$("#new-app-replace").prop("checked")?$("#new-app-teardown").attr("disabled",!0):$("#new-app-teardown").attr("disabled",!1)})):window.modalView.modalBindValidation({id:"new-app-mount",validateInput:function(){return[{rule:Joi.string().regex(/^((APP[^/]+|(?!APP)[a-zA-Z0-9_\-%]+))+$/i),msg:"May not contain /APP"},{rule:Joi.string().regex(/^([a-zA-Z0-9_\-%]+)+$/),msg:"Can only contain [a-zA-Z0-9_-%]"},{rule:Joi.string().regex(/([^_]|_open\/)/),msg:"Mountpoints with _ are reserved for internal use"},{rule:Joi.string().regex(/[^/]$/),msg:"May not end with /"},{rule:Joi.string().required().min(1),msg:"Has to be non-empty"}]}})}}}(),function(){"use strict";if(!window.hasOwnProperty("TEST_BUILD")){window.templateEngine=new function(){var e={createTemplate:function(e){var i=$("#"+e.replace(".","\\.")).html();return{render:function(e){var t=_.template(i);return t=t(e)}}}};return e}}}(),function(){"use strict";window.dygraphConfig={defaultFrame:12e5,zeropad:function(e){return e<10?"0"+e:e},xAxisFormat:function(e){if(-1===e)return"";var t=new Date(e);return this.zeropad(t.getHours())+":"+this.zeropad(t.getMinutes())+":"+this.zeropad(t.getSeconds())},mergeObjects:function(n,o,e){e||(e=[]);var t,a={};return e.forEach(function(e){var t=n[e],i=o[e];void 0===t&&(t={}),void 0===i&&(i={}),a[e]=_.extend(t,i)}),t=_.extend(n,o),Object.keys(a).forEach(function(e){t[e]=a[e]}),t},mapStatToFigure:{pageFaults:["times","majorPageFaultsPerSecond","minorPageFaultsPerSecond"],systemUserTime:["times","systemTimePerSecond","userTimePerSecond"],totalTime:["times","avgQueueTime","avgRequestTime","avgIoTime"],dataTransfer:["times","bytesSentPerSecond","bytesReceivedPerSecond"],requests:["times","getsPerSecond","putsPerSecond","postsPerSecond","deletesPerSecond","patchesPerSecond","headsPerSecond","optionsPerSecond","othersPerSecond"]},colors:["rgb(95, 194, 135)","rgb(238, 190, 77)","#81ccd8","#7ca530","#3c3c3c","#aa90bd","#e1811d","#c7d4b2","#d0b2d4"],figureDependedOptions:{clusterRequestsPerSecond:{showLabelsOnHighlight:!0,title:"",header:"Cluster Requests per Second",stackedGraph:!0,div:"lineGraphLegend",labelsKMG2:!1,axes:{y:{valueFormatter:function(e){return parseFloat(e.toPrecision(3))},axisLabelFormatter:function(e){return 0===e?0:parseFloat(e.toPrecision(3))}}}},pageFaults:{header:"Page Faults",visibility:[!0,!1],labels:["datetime","Major Page","Minor Page"],div:"pageFaultsChart",labelsKMG2:!1,axes:{y:{valueFormatter:function(e){return parseFloat(e.toPrecision(3))},axisLabelFormatter:function(e){return 0===e?0:parseFloat(e.toPrecision(3))}}}},systemUserTime:{div:"systemUserTimeChart",header:"System and User Time",labels:["datetime","System Time","User Time"],stackedGraph:!0,labelsKMG2:!1,axes:{y:{valueFormatter:function(e){return parseFloat(e.toPrecision(3))},axisLabelFormatter:function(e){return 0===e?0:parseFloat(e.toPrecision(3))}}}},totalTime:{div:"totalTimeChart",header:"Total Time",labels:["datetime","Queue","Computation","I/O"],labelsKMG2:!1,axes:{y:{valueFormatter:function(e){return parseFloat(e.toPrecision(3))},axisLabelFormatter:function(e){return 0===e?0:parseFloat(e.toPrecision(3))}}},stackedGraph:!0},dataTransfer:{header:"Data Transfer",labels:["datetime","Bytes sent","Bytes received"],stackedGraph:!0,div:"dataTransferChart"},requests:{header:"Requests",labels:["datetime","Reads","Writes"],stackedGraph:!0,div:"requestsChart",axes:{y:{valueFormatter:function(e){return parseFloat(e.toPrecision(3))},axisLabelFormatter:function(e){return 0===e?0:parseFloat(e.toPrecision(3))}}}}},getDashBoardFigures:function(t){var i=[],n=this;return Object.keys(this.figureDependedOptions).forEach(function(e){"clusterRequestsPerSecond"!==e&&(n.figureDependedOptions[e].div||t)&&i.push(e)}),i},getDefaultConfig:function(e){var t=this,i={digitsAfterDecimal:1,drawGapPoints:!0,fillGraph:!0,fillAlpha:.85,showLabelsOnHighlight:!1,strokeWidth:0,lineWidth:0,strokeBorderWidth:0,includeZero:!0,highlightCircleSize:2.5,labelsSeparateLines:!0,strokeBorderColor:"rgba(0,0,0,0)",interactionModel:{},maxNumberWidth:10,colors:[this.colors[0]],xAxisLabelWidth:"50",rightGap:15,showRangeSelector:!1,rangeSelectorHeight:50,rangeSelectorPlotStrokeColor:"#365300",rangeSelectorPlotFillColor:"",pixelsPerLabel:50,labelsKMG2:!0,dateWindow:[(new Date).getTime()-this.defaultFrame,(new Date).getTime()],axes:{x:{valueFormatter:function(e){return t.xAxisFormat(e)}},y:{ticker:Dygraph.numericLinearTicks}}};return this.figureDependedOptions[e]&&(i=this.mergeObjects(i,this.figureDependedOptions[e],["axes"])).div&&i.labels&&(i.colors=this.getColors(i.labels),i.labelsDiv=document.getElementById(i.div+"Legend"),i.legend="always",i.showLabelsOnHighlight=!0),i},getDetailChartConfig:function(e){var t=_.extend(this.getDefaultConfig(e),{showRangeSelector:!0,interactionModel:null,showLabelsOnHighlight:!0,highlightCircleSize:2.5,legend:"always",labelsDiv:"div#detailLegend.dashboard-legend-inner"});return"pageFaults"===e&&(t.visibility=[!0,!0]),t.labels||(t.labels=["datetime",t.header],t.colors=this.getColors(t.labels)),t},getColors:function(e){return this.colors.concat([]).slice(0,e.length-1)}}}(),function(){"use strict";window.arangoCollectionModel=Backbone.Model.extend({idAttribute:"name",urlRoot:arangoHelper.databaseUrl("/_api/collection"),defaults:{id:"",name:"",status:"",type:"",isSystem:!1,picture:"",locked:!1,desc:void 0},getProperties:function(t){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/collection/"+encodeURIComponent(this.get("id"))+"/properties"),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})},getFigures:function(t){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/figures"),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(){t(!0)}})},getRevision:function(t,i){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/revision"),contentType:"application/json",processData:!1,success:function(e){t(!1,e,i)},error:function(){t(!0)}})},getIndex:function(t){var i=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/index/?collection="+this.get("id")),contentType:"application/json",processData:!1,success:function(e){t(!1,e,i.get("id"))},error:function(e){t(!0,e,i.get("id"))}})},createIndex:function(e,n){var o=this;$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/index?collection="+o.get("id")),headers:{"x-arango-async":"store"},data:JSON.stringify(e),contentType:"application/json",processData:!1,success:function(e,t,i){i.getResponseHeader("x-arango-async-id")?(window.arangoHelper.addAardvarkJob({id:i.getResponseHeader("x-arango-async-id"),type:"index",desc:"Creating Index",collection:o.get("id")}),n(!1,e)):n(!0,e)},error:function(e){n(!0,e)}})},deleteIndex:function(e,n){var o=this;$.ajax({cache:!1,type:"DELETE",url:arangoHelper.databaseUrl("/_api/index/"+this.get("name")+"/"+encodeURIComponent(e)),headers:{"x-arango-async":"store"},success:function(e,t,i){i.getResponseHeader("x-arango-async-id")?(window.arangoHelper.addAardvarkJob({id:i.getResponseHeader("x-arango-async-id"),type:"index",desc:"Removing Index",collection:o.get("id")}),n(!1,e)):n(!0,e)},error:function(e){n(!0,e)}}),n()},truncateCollection:function(){var e=this;$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/truncate"),success:function(){arangoHelper.arangoNotification("Collection truncated."),$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_admin/wal/flush?waitForSync=true&waitForCollector=true"),success:function(){$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+e.get("id")+"/rotate"),success:function(){},error:function(){}})},error:function(){}})},error:function(e){arangoHelper.arangoError("Collection error: "+e.responseJSON.errorMessage)}})},warmupCollection:function(){$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/loadIndexesIntoMemory"),success:function(){arangoHelper.arangoNotification("Loading indexes into memory.")},error:function(e){arangoHelper.arangoError("Collection error: "+e.responseJSON.errorMessage)}})},loadCollection:function(e){$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/load"),success:function(){e(!1)},error:function(){e(!0)}}),e()},unloadCollection:function(e){$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/unload?flush=true"),success:function(){e(!1)},error:function(){e(!0)}}),e()},renameCollection:function(e,t){var i=this;$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/rename"),data:JSON.stringify({name:e}),contentType:"application/json",processData:!1,success:function(){i.set("name",e),t(!1)},error:function(e){t(!0,e)}})},changeCollection:function(e,t,i,n,o){"true"===e?e=!0:"false"===e&&(e=!1);var a={waitForSync:e,journalSize:parseInt(t,10),indexBuckets:parseInt(i,10)};return n&&(a.replicationFactor=parseInt(n,10)),$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/collection/"+this.get("id")+"/properties"),data:JSON.stringify(a),contentType:"application/json",processData:!1,success:function(){o(!1)},error:function(e){o(!0,e)}}),!1}})}(),window.DatabaseModel=Backbone.Model.extend({idAttribute:"name",initialize:function(){},isNew:function(){"use strict";return!1},sync:function(e,t,i){"use strict";return"update"===e&&(e="create"),Backbone.sync(e,t,i)},url:arangoHelper.databaseUrl("/_api/database"),defaults:{}}),window.arangoDocumentModel=Backbone.Model.extend({initialize:function(){},urlRoot:arangoHelper.databaseUrl("/_api/document"),defaults:{_id:"",_rev:"",_key:""},getSorted:function(){"use strict";var t=this,e=Object.keys(t.attributes).sort(function(e,t){var i=arangoHelper.isSystemAttribute(e);return i!==arangoHelper.isSystemAttribute(t)?i?-1:1:e<t?-1:1}),i={};return _.each(e,function(e){i[e]=t.attributes[e]}),i}}),function(){"use strict";window.ArangoQuery=Backbone.Model.extend({urlRoot:arangoHelper.databaseUrl("/_api/user"),defaults:{name:"",type:"custom",value:""}})}(),window.Replication=Backbone.Model.extend({defaults:{state:{},server:{}},initialize:function(){}}),window.Statistics=Backbone.Model.extend({defaults:{},url:function(){"use strict";return"/_admin/statistics"}}),window.StatisticsDescription=Backbone.Model.extend({defaults:{figures:"",groups:""},url:function(){"use strict";return"/_admin/statistics-description"}}),window.Users=Backbone.Model.extend({defaults:{user:"",active:!1,extra:{}},idAttribute:"user",parse:function(e){return this.isNotNew=!0,e},isNew:function(){return!this.isNotNew},url:function(){return this.isNew()?arangoHelper.databaseUrl("/_api/user"):""!==this.get("user")?arangoHelper.databaseUrl("/_api/user/"+this.get("user")):arangoHelper.databaseUrl("/_api/user")},checkPassword:function(e,t){$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/user/"+this.get("user")),data:JSON.stringify({passwd:e}),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})},setPassword:function(e){$.ajax({cache:!1,type:"PATCH",url:arangoHelper.databaseUrl("/_api/user/"+this.get("user")),data:JSON.stringify({passwd:e}),contentType:"application/json",processData:!1})},setExtras:function(e,t,i){$.ajax({cache:!1,type:"PATCH",url:arangoHelper.databaseUrl("/_api/user/"+this.get("user")),data:JSON.stringify({extra:{name:e,img:t}}),contentType:"application/json",processData:!1,success:function(){i(!1)},error:function(){i(!0)}})}}),function(){"use strict";window.ClusterCoordinator=Backbone.Model.extend({defaults:{name:"",id:"",status:"ok",address:"",protocol:""},idAttribute:"name",forList:function(){return{name:this.get("name"),status:this.get("status"),url:this.get("url")}}})}(),function(){"use strict";window.ClusterServer=Backbone.Model.extend({defaults:{name:"",address:"",role:"",status:"ok"},idAttribute:"name",forList:function(){return{name:this.get("name"),address:this.get("address"),status:this.get("status")}}})}(),function(){"use strict";window.Coordinator=Backbone.Model.extend({defaults:{address:"",protocol:"",name:"",status:""}})}(),function(){"use strict";window.CurrentDatabase=Backbone.Model.extend({url:arangoHelper.databaseUrl("/_api/database/current",frontendConfig.db),parse:function(e){return e.result}})}(),function(){"use strict";var o=function(e,t,i,n,o,a){var r={contentType:"application/json",processData:!1,type:i};t=t||function(){},a=_.extend({mount:e.encodedMount()},a);var s=_.reduce(a,function(e,t,i){return e+encodeURIComponent(i)+"="+encodeURIComponent(t)+"&"},"?");r.url=arangoHelper.databaseUrl("/_admin/aardvark/foxxes"+(n?"/"+n:"")+s.slice(0,s.length-1)),void 0!==o&&(r.data=JSON.stringify(o)),$.ajax(r).then(function(e){t(null,e)},function(e){window.xhr=e,t(_.extend(e.status?new Error(e.responseJSON?e.responseJSON.errorMessage:e.responseText):new Error("Network Error"),{statusCode:e.status}))})};window.Foxx=Backbone.Model.extend({idAttribute:"mount",defaults:{author:"Unknown Author",name:"",version:"Unknown Version",description:"No description",license:"Unknown License",contributors:[],scripts:{},config:{},deps:{},git:"",system:!1,development:!1},isNew:function(){return!1},encodedMount:function(){return encodeURIComponent(this.get("mount"))},destroy:function(e,t){o(this,t,"DELETE",void 0,void 0,e)},isBroken:function(){return!1},needsAttention:function(){return this.isBroken()||this.needsConfiguration()||this.hasUnconfiguredDependencies()},needsConfiguration:function(){return _.any(this.get("config"),function(e){return void 0===e.current&&!1!==e.required})},hasUnconfiguredDependencies:function(){return _.any(this.get("deps"),function(e){return void 0===e.current&&!1!==e.definition.required})},getConfiguration:function(i){o(this,function(e,t){e||this.set("config",t),"function"==typeof i&&i(e,t)}.bind(this),"GET","config")},setConfiguration:function(e,t){o(this,t,"PATCH","config",e)},getDependencies:function(i){o(this,function(e,t){e||this.set("deps",t),"function"==typeof i&&i(e,t)}.bind(this),"GET","deps")},setDependencies:function(e,t){o(this,t,"PATCH","deps",e)},toggleDevelopment:function(i,n){o(this,function(e,t){e||this.set("development",i),"function"==typeof n&&n(e,t)}.bind(this),"PATCH","devel",i)},runScript:function(e,t,i){o(this,i,"POST","scripts/"+e,t)},runTests:function(e,i){o(this,function(e,t){"function"==typeof i&&i(e?e.responseJSON:e,t)},"POST","tests",e)},isSystem:function(){return this.get("system")},isDevelopment:function(){return this.get("development")},download:function(){o(this,function(e,t){e?console.error(e.responseJSON):window.location.href=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/download/zip?mount="+this.encodedMount()+"&nonce="+t.nonce)}.bind(this),"POST","download/nonce")},fetchThumbnail:function(e){var t=new XMLHttpRequest;t.responseType="blob",t.onload=function(){this.thumbnailUrl=URL.createObjectURL(t.response),e()}.bind(this),t.onerror=e,t.open("GET","foxxes/thumbnail?mount="+this.encodedMount()),window.arangoHelper.getCurrentJwt()&&t.setRequestHeader("Authorization","bearer "+window.arangoHelper.getCurrentJwt()),t.send()}})}(),function(){"use strict";window.FoxxRepoModel=Backbone.Model.extend({idAttribute:"name",defaults:{name:"",description:"No description",author:"Unknown Author",latestVersion:"Unknown Version",legacy:!1,categories:"No category",defaultThumbnailUrl:"img/ArangoDB-Foxx-logo-bg.png"},httpGetAsync:function(e,t,i){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(i?t(n.responseText,i):t(n.responseText))},n.open("GET",e,!0),n.send(null)},manifest:null,fetchManifest:function(e,n){var o=this;if(this.manifest)e&&e();else{var t="https://raw.githubusercontent.com/"+o.get("location")+"/v"+o.get("latestVersion")+"/manifest.json";this.httpGetAsync(t,function(e,t){try{var i=JSON.parse(e);"object"==typeof i&&o.set("manifest",i),t(),n()}catch(e){t(),n()}},e)}},fetchReadme:function(e){this.httpGetAsync(this.getReadmeUrl(),e)},getReadmeUrl:function(){return"https://raw.githubusercontent.com/"+this.get("location")+"/v"+this.get("latestVersion")+"/README.md"},getThumbnailUrl:function(){return"https://raw.githubusercontent.com/"+this.get("location")+"/v"+this.get("latestVersion")+"/"+this.get("manifest").thumbnail},fetchThumbnail:function(e){var t=this,i=function(e){e&&e(t.manifest.thumbnail)};this.manifest?i(e):this.fetchManifest(i,e)}})}(),function(){"use strict";window.Graph=Backbone.Model.extend({idAttribute:"_key",urlRoot:arangoHelper.databaseUrl("/_api/gharial"),isNew:function(){return!this.get("_id")},parse:function(e){return e.graph||e},addEdgeDefinition:function(e){$.ajax({async:!1,type:"POST",url:this.urlRoot+"/"+this.get("_key")+"/edge",data:JSON.stringify(e),error:function(e){arangoHelper.arangoError(e.responseJSON.errorMessage)}})},deleteEdgeDefinition:function(e){$.ajax({async:!1,type:"DELETE",url:this.urlRoot+"/"+this.get("_key")+"/edge/"+e,error:function(e){arangoHelper.arangoError(e.responseJSON.errorMessage)}})},modifyEdgeDefinition:function(e){$.ajax({async:!1,type:"PUT",url:this.urlRoot+"/"+this.get("_key")+"/edge/"+e.collection,data:JSON.stringify(e),error:function(e){arangoHelper.arangoError(e.responseJSON.errorMessage)}})},addVertexCollection:function(e){$.ajax({async:!1,type:"POST",url:this.urlRoot+"/"+this.get("_key")+"/vertex",data:JSON.stringify({collection:e}),error:function(e){arangoHelper.arangoError(e.responseJSON.errorMessage)}})},deleteVertexCollection:function(e){$.ajax({async:!1,type:"DELETE",url:this.urlRoot+"/"+this.get("_key")+"/vertex/"+e,error:function(e){arangoHelper.arangoError(e.responseJSON.errorMessage)}})},defaults:{name:"",edgeDefinitions:[],orphanCollections:[]}})}(),function(){"use strict";window.newArangoLog=Backbone.Model.extend({defaults:{lid:"",level:"",timestamp:"",text:"",totalAmount:""},getLogStatus:function(){switch(this.get("level")){case 1:return"Error";case 2:return"Warning";case 3:return"Info";case 4:return"Debug";default:return"Unknown"}}})}(),function(){"use strict";window.Notification=Backbone.Model.extend({defaults:{title:"",date:0,content:"",priority:"",tags:"",seen:!1}})}(),function(){"use strict";window.queryManagementModel=Backbone.Model.extend({defaults:{id:"",query:"",bindVars:"",started:"",runTime:""}})}(),window.UserConfig=Backbone.Model.extend({defaults:{graphs:"",queries:[]},ldapEnabled:!1,initialize:function(e){this.ldapEnabled=e.ldapEnabled,this.getUser()},model:window.UserConfigModel,fetch:function(e){e=_.extend({parse:!0},e);var t=this,i=e.success;if(!this.ldapEnabled)return Backbone.Collection.prototype.fetch.call(this,e);this.getLocalConfig(),e.success=void(i&&i.call(e.context,t,void 0,e))},getConfigPath:function(){return frontendConfig.db+"-"+this.username+"-config"},getLocalConfig:function(){var e=sessionStorage.getItem(this.getConfigPath());try{e=JSON.parse(e)}catch(e){}return e?this.set(e):this.set({}),this.toJSON()},saveLocalConfig:function(){sessionStorage.setItem(this.getConfigPath(),JSON.stringify(this.toJSON()))},getLocalItem:function(e,t){return t&&t(this.get(e)),this.get(e)},setLocalItem:function(e,t,i){try{this.set(e,t),this.saveLocalConfig(),i&&i()}catch(e){}},getUser:function(){window.App.currentUser?this.username=window.App.currentUser:this.username="root"},parse:function(e){return e.result},url:function(){return arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(this.username)+"/config")},setItem:function(e,t,i){if(this.ldapEnabled)this.setLocalItem(e,t,i);else{var n=this;$.ajax({type:"PUT",cache:!1,url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(this.username)+"/config/"+encodeURIComponent(e)),contentType:"application/json",processData:!1,data:JSON.stringify({value:t}),async:!0,success:function(){n.set(e,t),i&&i()},error:function(){arangoHelper.arangoError("User configuration","Could not update user configuration for key: "+e)}})}},getItem:function(e,t){this.ldapEnabled?this.getLocalItem(e,t):$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(this.username)+"/config/"+encodeURIComponent(e)),contentType:"application/json",processData:!1,async:!0,success:function(e){t(e)},error:function(){arangoHelper.arangoError("User configuration","Could not fetch user configuration for key: "+e)}})}}),function(){"use strict";window.AutomaticRetryCollection=Backbone.Collection.extend({_retryCount:0,checkRetries:function(){var e=this;return this.updateUrl(),!(10<this._retryCount)||(window.setTimeout(function(){e._retryCount=0},1e4),window.App.clusterUnreachable(),!1)},successFullTry:function(){this._retryCount=0},failureTry:function(e,t,i){401===i.status?window.App.requestAuth():(window.App.clusterPlan.rotateCoordinator(),this._retryCount++,e())}})}(),function(){"use strict";window.PaginatedCollection=Backbone.Collection.extend({page:0,pagesize:10,totalAmount:null,getPage:function(){return this.page+1},setPage:function(e){e>=this.getLastPageNumber()&&null!==this.totalAmount?this.page=this.getLastPageNumber()-1:this.page=e<1?0:e-1},getLastPageNumber:function(){return Math.max(Math.ceil(this.totalAmount/this.pagesize),1)},getOffset:function(){return this.page*this.pagesize},getPageSize:function(){return this.pagesize},setPageSize:function(e){if("all"===e)this.pagesize="all";else try{e=parseInt(e,10),this.pagesize=e}catch(e){}},setToFirst:function(){this.page=0},setToLast:function(){this.setPage(this.getLastPageNumber())},setToPrev:function(){this.setPage(this.getPage()-1)},setToNext:function(){this.setPage(this.getPage()+1)},setTotal:function(e){this.totalAmount=e},getTotal:function(){return this.totalAmount},setTotalMinusOne:function(){this.totalAmount--}})}(),window.ClusterStatisticsCollection=Backbone.Collection.extend({model:window.Statistics,url:"/_admin/statistics",updateUrl:function(){this.url=window.App.getNewRoute(this.host)+this.url},initialize:function(e,t){this.host=t.host,window.App.registerForUpdate(this)}}),function(){"use strict";window.ArangoCollections=Backbone.Collection.extend({url:arangoHelper.databaseUrl("/_api/collection"),model:arangoCollectionModel,searchOptions:{searchPhrase:null,includeSystem:!1,includeDocument:!0,includeEdge:!0,includeLoaded:!0,includeUnloaded:!0,sortBy:"name",sortOrder:1},translateStatus:function(e){switch(e){case 0:return"corrupted";case 1:return"new born collection";case 2:return"unloaded";case 3:return"loaded";case 4:return"unloading";case 5:return"deleted";case 6:return"loading";default:return}},translateTypePicture:function(e){var t="";switch(e){case"document":t+="fa-file-text-o";break;case"edge":t+="fa-share-alt";break;case"unknown":t+="fa-question";break;default:t+="fa-cogs"}return t},parse:function(e){var t=this;return _.each(e.result,function(e){e.isSystem=arangoHelper.isSystemCollection(e),e.type=arangoHelper.collectionType(e),e.status=t.translateStatus(e.status),e.picture=t.translateTypePicture(e.type)}),e.result},getPosition:function(e){var t,i=this.getFiltered(this.searchOptions),n=null,o=null;for(t=0;t<i.length;++t)i[t].get("name")===e&&(0<t&&(n=i[t-1]),t<i.length-1&&(o=i[t+1]));return{prev:n,next:o}},getFiltered:function(o){var n=[],a=[];if(null!==o.searchPhrase){var e=o.searchPhrase.toLowerCase();e=e.replace(/\s+/g," ").replace(/(^\s+|\s+$)/g,""),a=e.split(" ")}return this.models.forEach(function(e){if(0<a.length){var t,i=e.get("name").toLowerCase();for(t=0;t<a.length;++t)if(-1===i.indexOf(a[t]))return}!1===o.includeSystem&&e.get("isSystem")||!1===o.includeEdge&&"edge"===e.get("type")||!1===o.includeDocument&&"document"===e.get("type")||!1===o.includeLoaded&&"loaded"===e.get("status")||!1===o.includeUnloaded&&"unloaded"===e.get("status")||n.push(e)}),n.sort(function(e,t){var i,n;return"type"===o.sortBy?(i=e.get("type")+" "+e.get("name").toLowerCase(),n=t.get("type")+" "+t.get("name").toLowerCase()):(i=e.get("name").toLowerCase(),n=t.get("name").toLowerCase()),i!==n?o.sortOrder*(i<n?-1:1):0}),n},newCollection:function(e,t){var i={};(i.name=e.collName,i.waitForSync=e.wfs,0<e.journalSize&&(i.journalSize=e.journalSize),i.isSystem=e.isSystem,i.type=parseInt(e.collType,10),e.shards&&(i.numberOfShards=e.shards,i.shardKeys=e.shardBy),e.replicationFactor)&&(i.replicationFactor=e.replicationFactor,new RegExp(/^[0-9]+$/).test(e.replicationFactor)&&(i.replicationFactor=JSON.parse(e.replicationFactor)));$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/collection"),data:JSON.stringify(i),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})}})}(),function(){"use strict";window.ArangoDatabase=Backbone.Collection.extend({model:window.DatabaseModel,sortOptions:{desc:!1},url:arangoHelper.databaseUrl("/_api/database/user"),comparator:function(e,t){var i=e.get("name").toLowerCase(),n=t.get("name").toLowerCase();return!0===this.sortOptions.desc?i<n?1:n<i?-1:0:n<i?1:i<n?-1:0},parse:function(e){if(e)return _.map(e.result,function(e){return{name:e}})},initialize:function(){var e=this;this.fetch({cache:!1}).done(function(){e.sort()})},setSortingDesc:function(e){this.sortOptions.desc=e},getDatabases:function(){var e=this;return this.fetch({cache:!1}).done(function(){e.sort()}),this.models},getDatabasesForUser:function(t){$.ajax({type:"GET",cache:!1,url:this.url,contentType:"application/json",processData:!1,success:function(e){t(!1,e.result.sort())},error:function(){t(!0,[])}})},createDatabaseURL:function(e,t,i){var n=window.location,o=window.location.hash;t=t?"SSL"===t||"https:"===t?"https:":"http:":n.protocol,i=i||n.port;var a=t+"//"+window.location.hostname+":"+i+"/_db/"+encodeURIComponent(e)+"/_admin/aardvark/standalone.html";if(o){var r=o.split("/")[0];0===r.indexOf("#collection")&&(r="#collections"),0===r.indexOf("#service")&&(r="#services"),a+=r}return a},getCurrentDatabase:function(t){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/database/current"),contentType:"application/json",processData:!1,success:function(e){200===e.code?t(!1,e.result.name):t(!1,e)},error:function(e){t(!0,e)}})},hasSystemAccess:function(i){this.getDatabasesForUser(function(e,t){e?arangoHelper.arangoError("DB","Could not fetch databases"):i(!1,_.includes(t,"_system"))})}})}(),window.ArangoDocument=Backbone.Collection.extend({url:"/_api/document/",model:arangoDocumentModel,collectionInfo:{},deleteEdge:function(e,t,i){this.deleteDocument(e,t,i)},deleteDocument:function(e,t,i){var n={keys:[t],collection:e};$.ajax({cache:!1,type:"PUT",contentType:"application/json",data:JSON.stringify(n),url:arangoHelper.databaseUrl("/_api/simple/remove-by-keys"),success:function(){i(!1)},error:function(){i(!0)}})},addDocument:function(e,t){this.createTypeDocument(e,t)},createTypeEdge:function(e,t,i,n,o){var a;a=n?JSON.stringify({_key:n,_from:t,_to:i}):JSON.stringify({_from:t,_to:i}),$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/document?collection="+encodeURIComponent(e)),data:a,contentType:"application/json",processData:!1,success:function(e){o(!1,e)},error:function(e){o(!0,e._id,e.responseJSON)}})},createTypeDocument:function(e,t,i,n){var o;o=t?JSON.stringify({_key:t}):JSON.stringify({});var a=arangoHelper.databaseUrl("/_api/document?collection="+encodeURIComponent(e));n&&(a+="?returnNew=true"),$.ajax({cache:!1,type:"POST",url:a,data:o,contentType:"application/json",processData:!1,success:function(e){i(!1,n?e:e._id)},error:function(e){i(!0,e._id,e.responseJSON)}})},getCollectionInfo:function(e,t,i){var n=this;$.ajax({cache:!1,type:"GET",url:arangoHelper.databaseUrl("/_api/collection/"+e+"?"+arangoHelper.getRandomToken()),contentType:"application/json",processData:!1,success:function(e){n.collectionInfo=e,t(!1,e,i)},error:function(e){t(!0,e,i)}})},getEdge:function(e,t,i){this.getDocument(e,t,i)},getDocument:function(t,i,n){var o=this;this.clearDocument();var e={keys:[i],collection:t};$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/simple/lookup-by-keys"),contentType:"application/json",data:JSON.stringify(e),processData:!1,success:function(e){e.documents[0]?(o.add(e.documents[0]),e.documents[0]._from&&e.documents[0]._to?n(!1,e,"edge"):n(!1,e,"document")):(o.add(!0,e),n(!0,e,t+"/"+i))},error:function(e){o.add(!0,e),arangoHelper.arangoError("Error",e.responseJSON.errorMessage+" - error number: "+e.responseJSON.errorNum),n(!0,e,t+"/"+i)}})},saveEdge:function(e,t,i,n,o,a){this.saveDocument(e,t,o,a,i,n)},saveDocument:function(e,t,i,n,o,a){if("string"==typeof i)try{i=JSON.parse(i)}catch(e){arangoHelper.arangoError("Could not parse document: "+i)}i._key=t,i._id=e+"/"+t,o&&a&&(i._from=o,i._to=a),$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/document/"+encodeURIComponent(e)+"?returnNew=true"),data:JSON.stringify([i]),contentType:"application/json",processData:!1,success:function(e){n(!1,e)},error:function(e){n(!0,e)}})},updateLocalDocument:function(e){this.clearDocument(),this.add(e)},clearDocument:function(){this.reset()}}),function(){"use strict";window.ArangoDocuments=window.PaginatedCollection.extend({collectionID:1,filters:[],checkCursorTimer:void 0,MAX_SORT:12e3,lastQuery:{},sortAttribute:"",url:arangoHelper.databaseUrl("/_api/documents"),model:window.arangoDocumentModel,loadTotal:function(t){var i=this;$.ajax({cache:!1,type:"GET",url:arangoHelper.databaseUrl("/_api/collection/"+this.collectionID+"/count"),contentType:"application/json",processData:!1,success:function(e){i.setTotal(e.count),t(!1)},error:function(){t(!0)}})},setCollection:function(e,t){this.resetFilter(),this.collectionID=e,t?this.setPage(t):this.setPage(1),this.loadTotal(function(e){e&&arangoHelper.arangoError("Documents","Could not fetch documents count")})},setSort:function(e){this.sortAttribute=e},getSort:function(){return this.sortAttribute},addFilter:function(e,t,i){this.filters.push({attr:e,op:t,val:i})},setFiltersForQuery:function(n){return 0===this.filters.length?"":" FILTER "+_.map(this.filters,function(e,t){var i="x.@attr"+t+" "+e.op+" @param"+t;return"LIKE"===e.op?n["param"+t]="%"+e.val+"%":"IN"===e.op||"NOT IN "===e.op?-1!==e.val.indexOf(",")?n["param"+t]=e.val.split(",").map(function(e){return e.replace(/(^ +| +$)/g,"")}):n["param"+t]=[e.val]:n["param"+t]=e.val,-1!==e.attr.indexOf(".")?n["attr"+t]=e.attr.split("."):n["attr"+t]=e.attr,i}).join(" && ")},setPagesize:function(e){this.setPageSize(e)},resetFilter:function(){this.filters=[]},moveDocument:function(e,t,i,n){var o,a,r,s={"@collection":t,filterid:e};o="FOR x IN @@collection",o+=" FILTER x._key == @filterid",o+=" INSERT x IN ",a={query:o+=i,bindVars:s},r={query:"FOR x in @@collection FILTER x._key == @filterid REMOVE x IN @@collection",bindVars:s},window.progressView.show(),$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/cursor"),data:JSON.stringify(a),contentType:"application/json",success:function(){$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/cursor"),data:JSON.stringify(r),contentType:"application/json",success:function(){n&&n(!1),window.progressView.hide()},error:function(){n&&n(!0),window.progressView.hide(),arangoHelper.arangoError("Document error","Documents inserted, but could not be removed.")}})},error:function(){window.progressView.hide(),arangoHelper.arangoError("Document error","Could not move selected documents.")}})},getDocuments:function(o){var e,t,a,r=this,i=this.getPageSize();"all"===i&&(i=this.MAX_SORT+38e3),t={"@collection":this.collectionID,offset:this.getOffset(),count:i},e='FOR x IN @@collection LET att = APPEND(SLICE(ATTRIBUTES(x), 0, 25), "_key", true)',e+=this.setFiltersForQuery(t),this.getTotal()<this.MAX_SORT&&("_key"===this.getSort()?e+=" SORT TO_NUMBER(x."+this.getSort()+") == 0 ? x."+this.getSort()+" : TO_NUMBER(x."+this.getSort()+")":""!==this.getSort()&&(e+=" SORT x."+this.getSort())),"all"!==t.count?e+=" LIMIT @offset, @count RETURN KEEP(x, att)":(t={"@collection":this.collectionID},e+=" RETURN KEEP(x, att)"),a={query:e,bindVars:t,batchSize:i},0<this.filters.length&&(a.options={fullCount:!0});var s=function(n){$.ajax({cache:!1,type:"PUT",url:arangoHelper.databaseUrl("/_api/job/"+encodeURIComponent(n)),contentType:"application/json",success:function(e,t,i){201===i.status?(window.progressView.toShow=!1,r.clearDocuments(),e.extra&&e.extra.stats&&void 0!==e.extra.stats.fullCount&&r.setTotal(e.extra.stats.fullCount),0!==r.getTotal()&&_.each(e.result,function(e){r.add({id:e._id,rev:e._rev,key:e._key,content:e})}),r.lastQuery=a,o(!1,e)):204===i.status&&(r.checkCursorTimer=window.setTimeout(function(){s(n)},500))},error:function(e){o(!1,e)}})};$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/cursor"),data:JSON.stringify(a),headers:{"x-arango-async":"store"},contentType:"application/json",success:function(e,t,i){if(i.getResponseHeader("x-arango-async-id")){var n=i.getResponseHeader("x-arango-async-id");window.progressView.showWithDelay(1e3,"Fetching documents...",function(){$.ajax({url:arangoHelper.databaseUrl("/_api/job/"+encodeURIComponent(n)+"/cancel"),type:"PUT",success:function(){window.clearTimeout(r.checkCursorTimer),arangoHelper.arangoNotification("Documents","Canceled operation."),$(".dataTables_empty").text("Canceled."),window.progressView.hide()}})}),s(n)}else o(!0,e)},error:function(e){o(!1,e)}})},clearDocuments:function(){this.reset()},buildDownloadDocumentQuery:function(){var e,t;return t={"@collection":this.collectionID},e="FOR x in @@collection",e+=this.setFiltersForQuery(t),this.getTotal()<this.MAX_SORT&&0<this.getSort().length&&(e+=" SORT x."+this.getSort()),{query:e+=" RETURN x",bindVars:t}},uploadDocuments:function(e,t){$.ajax({type:"POST",url:arangoHelper.databaseUrl("/_api/import?type=auto&collection="+encodeURIComponent(this.collectionID)+"&createCollection=false"),data:e,processData:!1,contentType:"json",dataType:"json",complete:function(e){if(4===e.readyState&&201===e.status)t(!1);else try{if(0<JSON.parse(e.responseText).errors){t(!1,"At least one error occurred during upload")}}catch(e){console.log(e)}},error:function(e){t(!0,e.responseJSON.errorMessage)}})}})}(),function(){"use strict";window.ArangoLogs=window.PaginatedCollection.extend({upto:!1,loglevel:0,totalPages:0,parse:function(i){var n=[];return _.each(i.lid,function(e,t){n.push({level:i.level[t],lid:e,topic:i.topic[t],text:i.text[t],timestamp:i.timestamp[t],totalAmount:i.totalAmount})}),this.totalAmount=i.totalAmount,this.totalPages=Math.ceil(this.totalAmount/this.pagesize),n},initialize:function(e){!0===e.upto&&(this.upto=!0),this.loglevel=e.loglevel},model:window.newArangoLog,url:function(){var e,t,i=this.totalAmount-(this.page+1)*this.pagesize;return i<0&&this.page===this.totalPages-1?(i=0,t=this.totalAmount%this.pagesize):t=this.pagesize,0===this.totalAmount&&(t=1),e="/_admin/log?"+(this.upto?"upto":"level")+"="+this.loglevel+"&size="+t+"&offset="+i,this.lastInverseOffset=i,arangoHelper.databaseUrl(e)}})}(),function(){"use strict";window.ArangoQueries=Backbone.Collection.extend({getQueryPath:function(){return frontendConfig.db+"-"+this.username+"-queries"},initialize:function(e,t){var i=this;$.ajax("whoAmI?_="+Date.now(),{async:!0}).done(function(e){!1===this.activeUser||null===this.activeUser?i.activeUser="root":i.activeUser=e.user})},fetch:function(e){e=_.extend({parse:!0},e);var t=this,i=e.success;if(!frontendConfig.ldapEnabled)return frontendConfig.authenticationEnabled&&window.App.currentUser?this.url=arangoHelper.databaseUrl(frontendConfig.basePath+"/_api/user/"+encodeURIComponent(window.App.currentUser)):this.url=arangoHelper.databaseUrl(frontendConfig.basePath+"/_api/user/"),Backbone.Collection.prototype.fetch.call(this,e);this.fetchLocalQueries(),e.success=void(i&&i.call(e.context,t,void 0,e))},fetchLocalQueries:function(){this.reset();var i=this,e=sessionStorage.getItem(this.getQueryPath());try{e=JSON.parse(e),_.each(e,function(e,t){i.add(e)})}catch(e){}},url:arangoHelper.databaseUrl("/_api/user/"),model:ArangoQuery,activeUser:null,parse:function(e){var t,i=this;if(!1!==this.activeUser&&null!==this.activeUser||(this.activeUser="root"),e.user===i.activeUser)try{e.extra.queries&&(t=e.extra.queries)}catch(e){}else e.result&&e.result instanceof Array&&_.each(e.result,function(e){e.user===i.activeUser&&(t=e.extra.queries)});return t},saveLocalCollectionQueries:function(e,t){sessionStorage.setItem(this.getQueryPath(),JSON.stringify(e)),t&&t(!1,e)},saveCollectionQueries:function(t){var i=[];this.each(function(e){i.push({value:e.attributes.value,parameter:e.attributes.parameter,name:e.attributes.name})}),frontendConfig.ldapEnabled?this.saveLocalCollectionQueries(i,t):(!1!==this.activeUser&&null!==this.activeUser||(this.activeUser="root"),$.ajax({cache:!1,type:"PATCH",url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(this.activeUser)),data:JSON.stringify({extra:{queries:i}}),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(){t(!0)}}))},downloadLocalQueries:function(){arangoHelper.downloadLocalBlob(JSON.stringify(this.toJSON()),"json")},saveImportQueries:function(e,i){var n=this;if(0===this.activeUser)return!1;if(frontendConfig.ldapEnabled){if(e){var t=new FileReader;t.readAsText(e,"UTF-8"),t.onload=function(e){try{var t=JSON.parse(e.target.result);_.each(t,function(e,t){e.name&&e.value&&e.parameter&&n.add(e)}),n.saveCollectionQueries(),i&&i()}catch(e){arangoHelper.arangoError("Query error","Queries could not be imported."),window.modalView.hide()}},t.onerror=function(e){window.modalView.hide(),arangoHelper.arangoError("Query error","Queries could not be imported.")}}}else window.progressView.show("Fetching documents..."),$.ajax({cache:!1,type:"POST",url:"query/upload/"+encodeURIComponent(this.activeUser),data:e,contentType:"application/json",processData:!1,success:function(){window.progressView.hide(),arangoHelper.arangoNotification("Queries successfully imported."),i()},error:function(){window.progressView.hide(),arangoHelper.arangoError("Query error","queries could not be imported")}})}})}(),window.ArangoReplication=Backbone.Collection.extend({model:window.Replication,url:"../api/user",getLogState:function(t){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/replication/logger-state"),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})},getApplyState:function(t){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/replication/applier-state"),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})}}),window.StatisticsCollection=Backbone.Collection.extend({model:window.Statistics,url:"/_admin/statistics"}),window.StatisticsDescriptionCollection=Backbone.Collection.extend({model:window.StatisticsDescription,url:"/_admin/statistics-description",parse:function(e){return e}}),window.ArangoUsers=Backbone.Collection.extend({model:window.Users,activeUser:null,activeUserSettings:{query:{},shell:{},testing:!0},sortOptions:{desc:!1},authOptions:{ro:!1},fetch:function(e){return e.fetchAllUsers?this.url=arangoHelper.databaseUrl(frontendConfig.basePath+"/_api/user/"):frontendConfig.authenticationEnabled&&window.App.currentUser?this.url=arangoHelper.databaseUrl(frontendConfig.basePath+"/_api/user/"+encodeURIComponent(window.App.currentUser)):this.url=arangoHelper.databaseUrl(frontendConfig.basePath+"/_api/user/"),Backbone.Collection.prototype.fetch.call(this,e)},url:frontendConfig.basePath+"/_api/user",comparator:function(e,t){var i=e.get("user").toLowerCase(),n=t.get("user").toLowerCase();return!0===this.sortOptions.desc?i<n?1:n<i?-1:0:n<i?1:i<n?-1:0},login:function(e,t,n){var o=this;$.ajax({url:arangoHelper.databaseUrl("/_open/auth"),method:"POST",data:JSON.stringify({username:e,password:t}),dataType:"json"}).success(function(e){var t=e.jwt.split(".");if(!t[1])throw new Error("Invalid JWT");if(!window.atob)throw new Error("base64 support missing in browser");var i=JSON.parse(atob(t[1]));o.activeUser=i.preferred_username,void 0===o.activeUser?arangoHelper.setCurrentJwt(e.jwt,null):arangoHelper.setCurrentJwt(e.jwt,o.activeUser),n(!1,o.activeUser)}).error(function(){arangoHelper.setCurrentJwt(null,null),o.activeUser=null,n(!0,null)})},setSortingDesc:function(e){this.sortOptions.desc=e},logout:function(){arangoHelper.setCurrentJwt(null),this.activeUser=null,this.reset(),window.App.navigate(""),window.location.reload()},setUserSettings:function(e,t){this.activeUserSettings.identifier=t},loadUserSettings:function(t){var e,i=this;e=frontendConfig.authenticationEnabled?arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(i.activeUser)):arangoHelper.databaseUrl("/_api/user/root"),$.ajax({type:"GET",cache:!1,url:e,contentType:"application/json",processData:!1,success:function(e){i.activeUserSettings=e.extra,t(!1,e)},error:function(e){t(!0,e)}})},saveUserSettings:function(t){$.ajax({cache:!1,type:"PUT",url:frontendConfig.basePath+"/_api/user/"+encodeURIComponent(this.activeUser),data:JSON.stringify({extra:this.activeUserSettings}),contentType:"application/json",processData:!1,success:function(e){t(!1,e)},error:function(e){t(!0,e)}})},parse:function(e){var t=[];return e.result?_.each(e.result,function(e){t.push(e)}):t.push({user:e.user,active:e.active,extra:e.extra,changePassword:e.changePassword}),t},whoAmI:function(t){var i=this;this.activeUser?t(!1,this.activeUser):$.ajax("whoAmI?_="+Date.now()).success(function(e){i.activeUser=e.user,t(!1,e.user)}).error(function(){t(!0,null)})}}),function(){"use strict";window.ClusterCoordinators=window.AutomaticRetryCollection.extend({model:window.ClusterCoordinator,url:arangoHelper.databaseUrl("/_admin/aardvark/cluster/Coordinators"),updateUrl:function(){this.url=window.App.getNewRoute("Coordinators")},initialize:function(){},statusClass:function(e){switch(e){case"ok":return"success";case"warning":return"warning";case"critical":return"danger";case"missing":return"inactive";default:return"danger"}},getStatuses:function(t,e){if(this.checkRetries()){var i=this;this.fetch({beforeSend:window.App.addAuth.bind(window.App),error:i.failureTry.bind(i,i.getStatuses.bind(i,t,e))}).done(function(){i.successFullTry(),i.forEach(function(e){t(i.statusClass(e.get("status")),e.get("address"))}),e()})}},byAddress:function(i,e){if(this.checkRetries()){var t=this;this.fetch({beforeSend:window.App.addAuth.bind(window.App),error:t.failureTry.bind(t,t.byAddress.bind(t,i,e))}).done(function(){t.successFullTry(),i=i||{},t.forEach(function(e){var t=e.get("address");t=t.split(":")[0],i[t]=i[t]||{},i[t].coords=i[t].coords||[],i[t].coords.push(e)}),e(i)})}},checkConnection:function(e){var t=this;this.checkRetries()&&this.fetch({beforeSend:window.App.addAuth.bind(window.App),error:t.failureTry.bind(t,t.checkConnection.bind(t,e))}).done(function(){t.successFullTry(),e()})}})}(),function(){"use strict";window.ClusterServers=window.AutomaticRetryCollection.extend({model:window.ClusterServer,host:"",url:arangoHelper.databaseUrl("/_admin/aardvark/cluster/DBServers"),updateUrl:function(){this.url=window.App.getNewRoute(this.host)+this.url},initialize:function(e,t){this.host=t.host},statusClass:function(e){switch(e){case"ok":return"success";case"warning":return"warning";case"critical":return"danger";case"missing":return"inactive";default:return"danger"}},getStatuses:function(t){if(this.checkRetries()){var i=this;this.fetch({beforeSend:window.App.addAuth.bind(window.App),error:i.failureTry.bind(i,i.getStatuses.bind(i,t))}).done(function(){i.successFullTry(),i._retryCount=0,i.forEach(function(e){t(i.statusClass(e.get("status")),e.get("address"))})})}},byAddress:function(i,e){if(this.checkRetries()){var t=this;this.fetch({beforeSend:window.App.addAuth.bind(window.App),error:t.failureTry.bind(t,t.byAddress.bind(t,i,e))}).done(function(){t.successFullTry(),i=i||{},t.forEach(function(e){var t=e.get("address");t=t.split(":")[0],i[t]=i[t]||{},i[t].dbs=i[t].dbs||[],i[t].dbs.push(e)}),e(i)}).error(function(e){console.log("error"),console.log(e)})}},getList:function(){throw new Error("Do not use")},getOverview:function(){throw new Error("Do not use DbServer.getOverview")}})}(),function(){"use strict";window.CoordinatorCollection=Backbone.Collection.extend({model:window.Coordinator,url:arangoHelper.databaseUrl("/_admin/aardvark/cluster/Coordinators")})}(),function(){"use strict";window.FoxxCollection=Backbone.Collection.extend({model:window.Foxx,sortOptions:{desc:!1},url:arangoHelper.databaseUrl("/_admin/aardvark/foxxes"),comparator:function(e,t){var i,n;return!0===this.sortOptions.desc?(i=e.get("mount"))<(n=t.get("mount"))?1:n<i?-1:0:(i=e.get("mount"),(n=t.get("mount"))<i?1:i<n?-1:0)},setSortingDesc:function(e){this.sortOptions.desc=e},installFromGithub:function(e,t,i,n,o){var a=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/git?mount="+encodeURIComponent(t));n&&(a+="&legacy=true"),void 0!==o&&(a+=o?"&replace=true":"&upgrade=true"),$.ajax({cache:!1,type:"PUT",url:a,data:JSON.stringify(e),contentType:"application/json",processData:!1,success:function(e){i(e)},error:function(e){i(e)}})},installFromUrl:function(e,t,i,n,o){var a=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/url?mount="+encodeURIComponent(t));n&&(a+="&legacy=true"),void 0!==o&&(a+=o?"&replace=true":"&upgrade=true"),$.ajax({cache:!1,type:"PUT",url:a,data:JSON.stringify(e),contentType:"application/json",processData:!1,success:function(e){i(e)},error:function(e){i(e)}})},installFromStore:function(e,t,i,n){var o=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/store?mount="+encodeURIComponent(t));void 0!==n&&(o+=n?"&replace=true":"&upgrade=true"),$.ajax({cache:!1,type:"PUT",url:o,data:JSON.stringify(e),contentType:"application/json",processData:!1,success:function(e){i(e)},error:function(e){i(e)}})},installFromZip:function(e,t,i,n,o){var a=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/zip?mount="+encodeURIComponent(t));n&&(a+="&legacy=true"),void 0!==o&&(a+=o?"&replace=true":"&upgrade=true"),$.ajax({cache:!1,type:"PUT",url:a,data:JSON.stringify({zipFile:e}),contentType:"application/json",processData:!1,success:function(e){i(e)},error:function(e){i(e)}})},generate:function(e,t,i,n){var o=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/generate?mount="+encodeURIComponent(t));void 0!==n&&(o+=n?"&replace=true":"&upgrade=true"),$.ajax({cache:!1,type:"PUT",url:o,data:JSON.stringify(e),contentType:"application/json",processData:!1,success:function(e){i(e)},error:function(e){i(e)}})}})}(),function(){"use strict";window.FoxxRepository=Backbone.Collection.extend({model:window.FoxxRepoModel,sortOptions:{desc:!1},url:"foxxes/fishbowl",parse:function(e){var t=[];return _.each(e,function(e){e.legacy||t.push(e)}),t},comparator:function(e,t){var i,n;return!0===this.sortOptions.desc?(i=e.get("mount"))<(n=t.get("mount"))?1:n<i?-1:0:(i=e.get("mount"),(n=t.get("mount"))<i?1:i<n?-1:0)},setSortingDesc:function(e){this.sortOptions.desc=e}})}(),function(){"use strict";window.GraphCollection=Backbone.Collection.extend({model:window.Graph,sortOptions:{desc:!1},url:arangoHelper.databaseUrl("/_api/gharial"),dropAndDeleteGraph:function(e,t){$.ajax({type:"DELETE",url:arangoHelper.databaseUrl("/_api/gharial/")+encodeURIComponent(e)+"?dropCollections=true",contentType:"application/json",processData:!0,success:function(){t(!0)},error:function(){t(!1)}})},createNode:function(e,t,i,n){$.ajax({type:"POST",url:arangoHelper.databaseUrl("/_api/gharial/")+encodeURIComponent(e)+"/vertex/"+encodeURIComponent(t),contentType:"application/json",data:JSON.stringify(i),processData:!0,success:function(e){n(!1,e.vertex._id)},error:function(e){n(!0,null,e.responseJSON.errorMessage)}})},createEdge:function(e,t,i,n){$.ajax({cache:!1,type:"POST",url:arangoHelper.databaseUrl("/_api/gharial/")+encodeURIComponent(e)+"/edge/"+encodeURIComponent(t),data:JSON.stringify(i),contentType:"application/json",processData:!1,success:function(e){n(!1,e.edge._id)},error:function(e){n(!0,null,e.responseJSON.errorMessage)}})},comparator:function(e,t){var i=e.get("_key")||"",n=t.get("_key")||"";return i=i.toLowerCase(),n=n.toLowerCase(),!0===this.sortOptions.desc?i<n?1:n<i?-1:0:n<i?1:i<n?-1:0},setSortingDesc:function(e){this.sortOptions.desc=e},parse:function(e){if(!e.error)return e.graphs}})}(),function(){"use strict";window.NotificationCollection=Backbone.Collection.extend({model:window.Notification,url:""})}(),function(){"use strict";window.QueryManagementActive=Backbone.Collection.extend({model:window.queryManagementModel,url:function(){var e=frontendConfig.basePath+"/_api/query/current";return"_system"!==window.frontendConfig.db&&(e=arangoHelper.databaseUrl("/_api/query/current")),e},killRunningQuery:function(e,t){var i=frontendConfig.basePath+"/_api/query/"+encodeURIComponent(e);"_system"!==window.frontendConfig.db&&(i=arangoHelper.databaseUrl("/_api/query/"+encodeURIComponent(e))),$.ajax({url:i,type:"DELETE",success:function(e){t()}})}})}(),function(){"use strict";window.QueryManagementSlow=Backbone.Collection.extend({model:window.queryManagementModel,url:function(){var e=frontendConfig.basePath+"/_api/query/slow";return"_system"!==window.frontendConfig.db&&(e=arangoHelper.databaseUrl("/_api/query/slow")),e},deleteSlowQueryHistory:function(t){var e=frontendConfig.basePath+"/_api/query/slow";"_system"!==window.frontendConfig.db&&(e=arangoHelper.databaseUrl("/_api/query/slow")),$.ajax({url:e,type:"DELETE",success:function(e){t()}})}})}(),function(){"use strict";window.PaginationView=Backbone.View.extend({collection:null,paginationDiv:"",idPrefix:"",rerender:function(){},jumpTo:function(e){this.collection.setPage(e),this.rerender()},firstPage:function(){this.jumpTo(1)},lastPage:function(){this.jumpTo(this.collection.getLastPageNumber())},firstDocuments:function(){this.jumpTo(1)},lastDocuments:function(){this.jumpTo(this.collection.getLastPageNumber())},prevDocuments:function(){this.jumpTo(this.collection.getPage()-1)},nextDocuments:function(){this.jumpTo(this.collection.getPage()+1)},renderPagination:function(){$(this.paginationDiv).html("");var i=this,e=this.collection.getPage(),t=this.collection.getLastPageNumber(),n=$(this.paginationDiv),o={page:e,lastPage:t,click:function(e){var t=window.location.hash.split("/");"documents"===t[2]?(o.page=e,window.location.hash=t[0]+"/"+t[1]+"/"+t[2]+"/"+e):(i.jumpTo(e),o.page=e)}};n.html(""),n.pagination(o),$(this.paginationDiv).prepend('<ul class="pre-pagi"><li><a id="'+this.idPrefix+'_first" class="pagination-button"><span><i class="fa fa-angle-double-left"/></span></a></li></ul>'),$(this.paginationDiv).append('<ul class="las-pagi"><li><a id="'+this.idPrefix+'_last" class="pagination-button"><span><i class="fa fa-angle-double-right"/></span></a></li></ul>')}})}(),function(){"use strict";window.ApplicationDetailView=Backbone.View.extend({el:"#content",divs:["#readme","#swagger","#app-info","#sideinformation","#information","#settings"],navs:["#service-info","#service-api","#service-readme","#service-settings"],template:templateEngine.createTemplate("serviceDetailView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click .open":"openApp","click .delete":"deleteApp","click #app-deps":"showDepsDialog","click #app-switch-mode":"toggleDevelopment","click #app-scripts [data-script]":"runScript","click #app-tests":"runTests","click #app-replace":"replaceApp","click #download-app":"downloadApp","click .subMenuEntries li":"changeSubview","click #jsonLink":"toggleSwagger","mouseenter #app-scripts":"showDropdown","mouseleave #app-scripts":"hideDropdown"},resize:function(e){e?$(".innerContent").css("height","auto"):($(".innerContent").height($(".centralRow").height()-150),$("#swagger iframe").height($(".centralRow").height()-150),$("#swagger #swaggerJsonContent").height($(".centralRow").height()-150))},toggleSwagger:function(){var e=function(e){$("#jsonLink").html("JSON"),this.jsonEditor.setValue(JSON.stringify(e,null,"\t"),1),$("#swaggerJsonContent").show(),$("#swagger iframe").hide()}.bind(this);if("Swagger"===$("#jsonLink").html()){var t=arangoHelper.databaseUrl("/_admin/aardvark/foxxes/docs/swagger.json?mount="+encodeURIComponent(this.model.get("mount")));arangoHelper.download(t,e)}else $("#swaggerJsonContent").hide(),$("#swagger iframe").show(),$("#jsonLink").html("Swagger")},changeSubview:function(e){if(_.each(this.navs,function(e){$(e).removeClass("active")}),$(e.currentTarget).addClass("active"),_.each(this.divs,function(e){$(".headerButtonBar").hide(),$(e).hide()}),"service-readme"===e.currentTarget.id)this.resize(!0),$("#readme").show();else if("service-api"===e.currentTarget.id){this.resize(),$("#swagger").show(),$("#swaggerIframe").remove();var t=window.location.pathname.split("/"),i=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/"+t[1]+"/"+t[2]+"/_admin/aardvark/foxxes/docs/index.html?mount="+this.model.get("mount"),n=$("<iframe/>",{id:"swaggerIframe",src:i,load:function(){$("#swagger").height($(".centralRow").height()-150)}});$("#swagger").append(n)}else"service-info"===e.currentTarget.id?(this.resize(!0),this.render(),$("#information").show(),$("#sideinformation").show()):"service-settings"===e.currentTarget.id&&(this.resize(!0),this.showConfigDialog(),$(".headerButtonBar").show(),$("#settings").show())},downloadApp:function(){this.model.isSystem()||this.model.download()},replaceApp:function(){window.App.replaceApp=!0,window.App.replaceAppData={model:this.model,mount:this.model.get("mount")},window.App.navigate("services/install",{trigger:!0})},updateConfig:function(){this.model.getConfiguration(function(){$("#app-warning")[this.model.needsAttention()?"show":"hide"](),$("#app-warning-config")[this.model.needsConfiguration()?"show":"hide"](),this.model.needsConfiguration()?$("#app-config").addClass("error"):$("#app-config").removeClass("error")}.bind(this))},updateDeps:function(){this.model.getDependencies(function(){$("#app-warning")[this.model.needsAttention()?"show":"hide"](),$("#app-warning-deps")[this.model.hasUnconfiguredDependencies()?"show":"hide"](),this.model.hasUnconfiguredDependencies()?$("#app-deps").addClass("error"):$("#app-deps").removeClass("error")}.bind(this))},toggleDevelopment:function(){this.model.toggleDevelopment(!this.model.isDevelopment(),function(){this.model.isDevelopment()?($(".app-switch-mode").text("Set Production"),$("#app-development-indicator").css("display","inline"),$("#app-development-path").css("display","inline")):($(".app-switch-mode").text("Set Development"),$("#app-development-indicator").css("display","none"),$("#app-development-path").css("display","none"))}.bind(this))},runScript:function(e){e.preventDefault();var n=$(e.currentTarget).attr("data-script"),t=[window.modalView.createBlobEntry("app_script_arguments","Script arguments","",null,"optional",!1,[{rule:function(e){return e&&JSON.parse(e)},msg:"Must be well-formed JSON or empty"}])],i=[window.modalView.createSuccessButton("Run script",function(){var e=$("#app_script_arguments").val();e=e&&JSON.parse(e),window.modalView.hide(),this.model.runScript(n,e,function(e,t){var i;i=e?"<p>The script failed with an error"+(e.statusCode?" (HTTP "+e.statusCode+")":"")+":</p><pre>"+e.message+"</pre>":t?"<p>Script results:</p><pre>"+JSON.stringify(t,null,2)+"</pre>":"<p>The script ran successfully.</p>",window.modalView.show("modalTable.ejs",'Result of script "'+n+'"',void 0,void 0,void 0,i)})}.bind(this))];window.modalView.show("modalTable.ejs",'Run script "'+n+'" on "'+this.model.get("mount")+'"',i,t)},showSwagger:function(e){e.preventDefault(),this.render("swagger")},showReadme:function(e){e.preventDefault(),this.render("readme")},runTests:function(e){e.preventDefault();var t="<p><strong>WARNING:</strong> Running tests may result in destructive side-effects including data loss. Please make sure not to run tests on a production database.</p>";this.model.isDevelopment()&&(t+="<p><strong>WARNING:</strong> This app is running in <strong>development mode</strong>. If any of the tests access the app's HTTP API they may become non-deterministic.</p>");var i=[window.modalView.createSuccessButton("Run tests",function(){window.modalView.hide(),this.model.runTests({reporter:"suite"},function(e,t){window.modalView.show("modalTestResults.ejs","Test results",void 0,void 0,void 0,e||t)})}.bind(this))];window.modalView.show("modalTable.ejs",'Run tests for app "'+this.model.get("mount")+'"',i,void 0,void 0,t)},render:function(n){return this.resize(),this.model.fetchThumbnail(function(){var e=function(e,t){var i=this;e?arangoHelper.arangoError("DB","Could not get current database"):($(this.el).html(this.template.render({app:this.model,baseUrl:arangoHelper.databaseUrl("",t),mode:n,installed:!0})),i.jsonEditor=ace.edit("swaggerJsonEditor"),i.jsonEditor.setReadOnly(!0),i.jsonEditor.getSession().setMode("ace/mode/json"),$.ajax({url:this.appUrl(t),headers:{accept:"text/html,*/*;q=0.9"}}).success(function(){$(".open",this.el).prop("disabled",!1)}.bind(this)),this.updateConfig(),this.updateDeps(),"swagger"===n&&$.get("./foxxes/docs/swagger.json?mount="+encodeURIComponent(this.model.get("mount")),function(e){Object.keys(e.paths).length<1&&(i.render("readme"),$("#app-show-swagger").attr("disabled","true"))})),this.breadcrumb()}.bind(this);arangoHelper.currentDatabase(e),_.isEmpty(this.model.get("config"))&&$("#service-settings").attr("disabled",!0)}.bind(this)),$(this.el)},breadcrumb:function(){var e="Service: "+this.model.get("name")+'<i class="fa fa-ellipsis-v" aria-hidden="true"></i>',t='<p class="mount"><span>Contributors:</span>';this.model.get("contributors")&&0<this.model.get("contributors").length?_.each(this.model.get("contributors"),function(e){e.email?t+='<a href="mailto:'+e.email+'">'+(e.name||e.email)+"</a>":e.name&&(t+="<a>contributor.name</a>")}):t+="No contributors",t+="</p>",$(".information").append(t),this.model.get("author")&&$(".information").append('<p class="mount"><span>Author:</span>'+this.model.get("author")+"</p>"),this.model.get("mount")&&$(".information").append('<p class="mount"><span>Mount:</span>'+this.model.get("mount")+"</p>"),this.model.get("development")&&this.model.get("path")&&$(".information").append('<p class="path"><span>Path:</span>'+this.model.get("path")+"</p>"),$("#subNavigationBar .breadcrumb").html(e)},openApp:function(){var e=function(e,t){e?arangoHelper.arangoError("DB","Could not get current database"):window.open(this.appUrl(t),this.model.get("title")).focus()}.bind(this);arangoHelper.currentDatabase(e)},deleteApp:function(){var e=[window.modalView.createDeleteButton("Delete",function(){var e={teardown:$("#app_delete_run_teardown").is(":checked")};this.model.destroy(e,function(e,t){e||!1!==t.error||(window.modalView.hide(),window.App.navigate("services",{trigger:!0}))})}.bind(this))],t=[window.modalView.createCheckboxEntry("app_delete_run_teardown","Run teardown?",!0,"Should this app's teardown script be executed before removing the app?",!0)];window.modalView.show("modalTable.ejs",'Delete Foxx App mounted at "'+this.model.get("mount")+'"',e,t,void 0,"<p>Are you sure? There is no way back...</p>",!0)},appUrl:function(e){return arangoHelper.databaseUrl(this.model.get("mount"),e)},applyConfig:function(){var o={};_.each(this.model.get("config"),function(e,t){var i=$("#app_config_"+CryptoJS.MD5(t).toString()),n=i.val();if("boolean"!==e.type&&"bool"!==e.type){if(""===n&&e.hasOwnProperty("default"))return o[t]=e.default,void("json"===e.type&&(o[t]=JSON.stringify(e.default)));if("number"===e.type)o[t]=parseFloat(n);else if("integer"===e.type||"int"===e.type)o[t]=parseInt(n,10);else{if("json"!==e.type)return void(o[t]=n);o[t]=n&&JSON.stringify(JSON.parse(n))}}else o[t]=i.is(":checked")}),this.model.setConfiguration(o,function(){this.updateConfig(),arangoHelper.arangoNotification(this.model.get("name"),"Settings applied.")}.bind(this))},showConfigDialog:function(){if(_.isEmpty(this.model.get("config")))$("#settings .buttons").html($("#hidden_buttons").html());else{var e=_.map(this.model.get("config"),function(e,t){var i=void 0===e.default?"":String(e.default),n=void 0===e.current?"":String(e.current),o="createTextEntry",a=!1,r=[];return"boolean"===e.type||"bool"===e.type?(o="createCheckboxEntry",e.default=e.default||!1,i=e.default||!1,n=e.current||!1):"json"===e.type?(o="createBlobEntry",i=void 0===e.default?"":JSON.stringify(e.default),n=void 0===e.current?"":JSON.stringify(e.current),r.push({rule:function(e){return e&&JSON.parse(e)},msg:"Must be well-formed JSON or empty."})):"integer"===e.type||"int"===e.type?r.push({rule:Joi.number().integer().optional().allow(""),msg:"Has to be an integer."}):"number"===e.type?r.push({rule:Joi.number().optional().allow(""),msg:"Has to be a number."}):("password"===e.type&&(o="createPasswordEntry"),r.push({rule:Joi.string().optional().allow(""),msg:"Has to be a string."})),void 0===e.default&&!1!==e.required&&(a=!0,r.unshift({rule:Joi.any().required(),msg:"This field is required."})),window.modalView[o]("app_config_"+CryptoJS.MD5(t).toString(),t,n,e.description,i,a,r)}),t=[window.modalView.createSuccessButton("Apply",this.applyConfig.bind(this))];window.modalView.show("modalTable.ejs","Configuration",t,e,null,null,null,null,null,"settings"),$(".modal-footer").prepend($("#hidden_buttons").html())}},applyDeps:function(){var n={};_.each(this.model.get("deps"),function(e,t){var i=$("#app_deps_"+t);n[t]=window.arangoHelper.escapeHtml(i.val())}),this.model.setDependencies(n,function(){window.modalView.hide(),this.updateDeps()}.bind(this))},showDepsDialog:function(){if(!_.isEmpty(this.model.get("deps"))){var e=_.map(this.model.get("deps"),function(e,t){var i=void 0===e.current?"":String(e.current),n=e.definition.name;"*"!==e.definition.version&&(n+="@"+e.definition.version);var o=[{rule:Joi.string().optional().allow(""),msg:"Has to be a string."}];return e.definition.required&&o.push({rule:Joi.string().required(),msg:"This value is required."}),window.modalView.createTextEntry("app_deps_"+t,e.title,i,n,"",e.definition.required,o)}),t=[window.modalView.createSuccessButton("Apply",this.applyDeps.bind(this))];window.modalView.show("modalTable.ejs","Dependencies",t,e)}},showDropdown:function(){_.isEmpty(this.model.get("scripts"))||$("#scripts_dropdown").show(200)},hideDropdown:function(){$("#scripts_dropdown").hide()}})}(),function(){"use strict";window.ApplicationsView=Backbone.View.extend({el:"#content",readOnly:!1,template:templateEngine.createTemplate("applicationsView.ejs"),events:{"click #addApp":"createInstallModal","click #foxxToggle":"slideToggle","click #checkDevel":"toggleDevel","click #checkProduction":"toggleProduction","click #checkSystem":"toggleSystem"},fixCheckboxes:function(){this._showDevel?$("#checkDevel").attr("checked","checked"):$("#checkDevel").removeAttr("checked"),this._showSystem?$("#checkSystem").attr("checked","checked"):$("#checkSystem").removeAttr("checked"),this._showProd?$("#checkProduction").attr("checked","checked"):$("#checkProduction").removeAttr("checked"),$("#checkDevel").next().removeClass("fa fa-check-square-o fa-square-o").addClass("fa"),$("#checkSystem").next().removeClass("fa fa-check-square-o fa-square-o").addClass("fa"),$("#checkProduction").next().removeClass("fa fa-check-square-o fa-square-o").addClass("fa"),arangoHelper.setCheckboxStatus("#foxxDropdown")},toggleDevel:function(){var t=this;this._showDevel=!this._showDevel,_.each(this._installedSubViews,function(e){e.toggle("devel",t._showDevel)}),this.fixCheckboxes()},toggleProduction:function(){var t=this;this._showProd=!this._showProd,_.each(this._installedSubViews,function(e){e.toggle("production",t._showProd)}),this.fixCheckboxes()},toggleSystem:function(){this._showSystem=!this._showSystem;var t=this;_.each(this._installedSubViews,function(e){e.toggle("system",t._showSystem)}),this.fixCheckboxes()},reload:function(){var e=this;_.each(this._installedSubViews,function(e){e.undelegateEvents()}),this.collection.fetch({success:function(){e.createSubViews(),e.render()}})},createSubViews:function(){var i=this;this._installedSubViews={},i.collection.each(function(e){var t=new window.FoxxActiveView({model:e,appsView:i});i._installedSubViews[e.get("mount")]=t})},initialize:function(){this._installedSubViews={},this._showDevel=!0,this._showProd=!0,this._showSystem=!1},slideToggle:function(){$("#foxxToggle").toggleClass("activated"),$("#foxxDropdownOut").slideToggle(200)},createInstallModal:function(e){this.readOnly||(e.preventDefault(),window.App.navigate("services/install",{trigger:!0}))},setReadOnly:function(){this.readOnly=!0,$("#addApp").parent().parent().addClass("disabled"),$("#addApp").addClass("disabled")},render:function(){this.collection.sort(),$(this.el).html(this.template.render({})),_.each(this._installedSubViews,function(e){$("#installedList").append(e.render())}),this.delegateEvents(),$("#checkDevel").attr("checked",this._showDevel),$("#checkProduction").attr("checked",this._showProd),$("#checkSystem").attr("checked",this._showSystem),arangoHelper.setCheckboxStatus("#foxxDropdown");var t=this;return _.each(this._installedSubViews,function(e){e.toggle("devel",t._showDevel),e.toggle("system",t._showSystem)}),arangoHelper.fixTooltips("icon_arangodb","left"),arangoHelper.checkDatabasePermissions(this.setReadOnly.bind(this)),this},installCallback:function(e){var t=this;if(!1===e.error)this.collection.fetch({success:function(){window.modalView.hide(),t.reload(),arangoHelper.arangoNotification("Services","Service "+e.name+" installed.")}});else{var i=e;switch(e.hasOwnProperty("responseJSON")&&(i=e.responseJSON),i.errorNum){case 1752:arangoHelper.arangoError("Services","Unable to download application from the given repository.");break;default:arangoHelper.arangoError("Services",i.errorNum+". "+i.errorMessage)}}}})}(),function(){"use strict";window.ApplierView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("applierView.ejs"),endpoint:null,events:{},render:function(){this.getMode()},breadcrumb:function(e){var t=this;if(window.App.naviView){var i="Database";e&&(i=i+": "+e),$("#subNavigationBar .breadcrumb").html(i)}else window.setTimeout(function(){t.breadcrumb()},100)},continueRender:function(){this.$el.html(this.template.render({}))},getApplierState:function(e,t){var i,n=this;i="_system"===this.database||t?this.endpoint+"/_api/replication/applier-state":this.endpoint+"/_db/"+this.database+"/_api/replication/applier-state",t?(i+="?global=true",n.breadcrumb("All databases")):n.breadcrumb(n.database),$.ajax({type:"GET",cache:!1,url:i,contentType:"application/json",success:function(e){n.$el.html(n.template.render({data:e}))},error:function(){arangoHelper.arangoError("Replication","Could not fetch the applier state of: "+e)}})},getMode:function(e){var t=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/aardvark/replication/mode"),contentType:"application/json",success:function(e){3===e.mode||2===e.mode?t.getApplierState(this.endpoint,!0):t.getApplierState(this.endpoint,!1)},error:function(){arangoHelper.arangoError("Replication","Could not fetch the replication state.")}})}})}(),function(){"use strict";window.ClusterView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("clusterView.ejs"),events:{},coordshortSuccess:void 0,statsEnabled:!1,historyInit:!1,initDone:!1,interval:1e4,maxValues:100,knownServers:[],chartData:{},charts:{},nvcharts:[],startHistory:{},startHistoryAccumulated:{},initialize:function(e){var t=this;window.App.isCluster&&(this.dbServers=e.dbServers,this.coordinators=e.coordinators,this.updateServerTime(),window.setInterval(function(){if("#cluster"===window.location.hash||""===window.location.hash||"#"===window.location.hash){t.getCoordStatHistory(function(e){t.rerenderValues(e),t.rerenderGraphs(e)})}else{t.getCoordStatHistory(function(e){t.rerenderGraphs(e,!0)})}},this.interval))},render:function(){var t=this;this.$el.html(this.template.render({})),this.initDone||(void 0!==this.coordinators.first()?this.getServerStatistics():this.waitForCoordinators(),this.initDone=!0),this.initGraphs();this.getCoordStatHistory(function(e){t.rerenderValues(e)})},waitForCoordinators:function(){var e=this;window.setTimeout(function(){e.coordinators?e.getServerStatistics():e.waitForCoordinators()},500)},updateServerTime:function(){this.serverTime=(new Date).getTime()},getServerStatistics:function(){var i=this;this.data=void 0;var n=this.coordinators.first();this.statCollectCoord=new window.ClusterStatisticsCollection([],{host:n.get("address")}),this.statCollectDBS=new window.ClusterStatisticsCollection([],{host:n.get("address")});var t=[];_.each(this.dbServers,function(e){e.each(function(e){t.push(e)})}),_.each(t,function(e){if("ok"===e.get("status")){-1===i.knownServers.indexOf(e.id)&&i.knownServers.push(e.id);var t=new window.Statistics({name:e.id});t.url=n.get("protocol")+"://"+n.get("address")+"/_admin/clusterStatistics?DBserver="+e.get("name"),i.statCollectDBS.add(t)}}),this.coordinators.forEach(function(e){if("ok"===e.get("status")){-1===i.knownServers.indexOf(e.id)&&i.knownServers.push(e.id);var t=new window.Statistics({name:e.id});t.url=e.get("protocol")+"://"+e.get("address")+"/_admin/statistics",i.statCollectCoord.add(t)}});i.getCoordStatHistory(function(e){i.rerenderValues(e),i.rerenderGraphs(e)}),i.renderNodes()},rerenderValues:function(e){this.renderNodes(),this.renderValue("#clusterConnections",Math.round(e.clientConnectionsCurrent)),this.renderValue("#clusterConnectionsAvg",Math.round(e.clientConnections15M));var t=e.physicalMemory,i=e.residentSizeCurrent;this.renderValue("#clusterRam",[i,t])},renderValue:function(e,t,i,n){if("number"==typeof t)$(e).html(t);else if($.isArray(t)){var o=t[0],a=1/(t[1]/o)*100;90<a?i=!0:70<a&&a<90&&(n=!0),$(e).html(a.toFixed(1)+" %")}else"string"==typeof t&&$(e).html(t);i?($(e).addClass("negative"),$(e).removeClass("warning"),$(e).removeClass("positive")):n?($(e).addClass("warning"),$(e).removeClass("positive"),$(e).removeClass("negative")):($(e).addClass("positive"),$(e).removeClass("negative"),$(e).removeClass("warning"))},renderNodes:function(){var e=this,t=function(e){var t=0,i=0,n=0,o=0;_.each(e,function(e){"Coordinator"===e.Role?(t++,"GOOD"!==e.Status&&i++):"DBServer"===e.Role&&(n++,"GOOD"!==e.Status&&o++)}),0<i?this.renderValue("#clusterCoordinators",t-i+"/"+t,!0):this.renderValue("#clusterCoordinators",t),0<o?this.renderValue("#clusterDBServers",n-o+"/"+n,!0):this.renderValue("#clusterDBServers",n)}.bind(this);$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/health"),contentType:"application/json",processData:!1,async:!0,success:function(e){t(e.Health)},error:function(){e.renderValue("#clusterCoordinators","N/A",!0),e.renderValue("#clusterDBServers","N/A",!0)}})},initValues:function(){_.each(["#clusterNodes","#clusterRam","#clusterConnections","#clusterConnectionsAvg"],function(e){$(e).html('<i class="fa fa-spin fa-circle-o-notch" style="color: rgba(0, 0, 0, 0.64);"></i>')})},graphData:{data:{sent:[],received:[]},http:[],average:[]},checkArraySizes:function(){var n=this;_.each(n.chartsOptions,function(e,i){_.each(e.options,function(e,t){e.values.length>n.maxValues-1&&n.chartsOptions[i].options[t].values.shift()})})},formatDataForGraph:function(i){var n=this;n.historyInit?(n.checkArraySizes(),n.chartsOptions[0].options[0].values.push({x:i.times[i.times.length-1],y:i.bytesSentPerSecond[i.bytesSentPerSecond.length-1]}),n.chartsOptions[0].options[1].values.push({x:i.times[i.times.length-1],y:i.bytesReceivedPerSecond[i.bytesReceivedPerSecond.length-1]}),n.chartsOptions[1].options[0].values.push({x:i.times[i.times.length-1],y:n.calcTotalHttp(i.http,i.bytesSentPerSecond.length-1)}),n.chartsOptions[2].options[0].values.push({x:i.times[i.times.length-1],y:i.avgRequestTime[i.bytesSentPerSecond.length-1]/n.coordinators.length})):(_.each(i.times,function(e,t){n.chartsOptions[0].options[0].values.push({x:e,y:i.bytesSentPerSecond[t]}),n.chartsOptions[0].options[1].values.push({x:e,y:i.bytesReceivedPerSecond[t]}),n.chartsOptions[1].options[0].values.push({x:e,y:n.calcTotalHttp(i.http,t)}),n.chartsOptions[2].options[0].values.push({x:e,y:i.avgRequestTime[t]/n.coordinators.length})}),n.historyInit=!0)},chartsOptions:[{id:"#clusterData",type:"bytes",count:2,options:[{area:!0,values:[],key:"Bytes out",color:"rgb(23,190,207)",strokeWidth:2,fillOpacity:.1},{area:!0,values:[],key:"Bytes in",color:"rgb(188, 189, 34)",strokeWidth:2,fillOpacity:.1}]},{id:"#clusterHttp",type:"number",options:[{area:!0,values:[],key:"Requests per second",color:"rgb(0, 166, 90)",fillOpacity:.1}]},{id:"#clusterAverage",data:[],type:"seconds",options:[{area:!0,values:[],key:"Seconds",color:"rgb(243, 156, 18)",fillOpacity:.1}]}],initGraphs:function(){var n=this;_.each(n.chartsOptions,function(i){nv.addGraph(function(){var e;n.charts[i.id]=nv.models.stackedAreaChart().options({useInteractiveGuideline:!0,showControls:!1,noData:"No data...",duration:0}),n.charts[i.id].xAxis.axisLabel("").tickFormat(function(e){var t=new Date(1e3*e);return(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}).staggerLabels(!1),n.charts[i.id].yAxis.axisLabel("").tickFormat(function(e){var t;return"bytes"===i.type?null===e?"N/A":(t=parseFloat(d3.format(".2f")(e)),prettyBytes(t)):"seconds"===i.type?null===e?"N/A":t=parseFloat(d3.format(".3f")(e)):"number"===i.type?null===e?"N/A":t=parseFloat(d3.format(".2f")(e)):void 0});var t=n.returnGraphOptions(i.id);return 0<t.length?_.each(t,function(e,t){i.options[t].values=e}):i.options[0].values=[],e=i.options,n.chartData[i.id]=d3.select(i.id).append("svg").datum(e).transition().duration(300).call(n.charts[i.id]).each("start",function(){window.setTimeout(function(){d3.selectAll(i.id+" *").each(function(){this.__transition__&&(this.__transition__.duration=0)})},0)}),nv.utils.windowResize(n.charts[i.id].update),n.nvcharts.push(n.charts[i.id]),n.charts[i.id]})})},returnGraphOptions:function(e){return"#clusterData"===e?[this.chartsOptions[0].options[0].values,this.chartsOptions[0].options[1].values]:"#clusterHttp"===e?[this.chartsOptions[1].options[0].values]:"#clusterAverage"===e?[this.chartsOptions[2].options[0].values]:[]},rerenderGraphs:function(e,t){if(this.statsEnabled){var n,o,a=this;this.formatDataForGraph(e),_.each(a.chartsOptions,function(i){0<(o=a.returnGraphOptions(i.id)).length?_.each(o,function(e,t){i.options[t].values=e}):i.options[0].values=[],n=i.options,void 0!==t&&!1!==t||0<n[0].values.length&&a.historyInit&&a.charts[i.id]&&a.charts[i.id].update()})}},calcTotalHttp:function(e,t){var i=0;return _.each(e,function(e){i+=e[t]}),i},getCoordStatHistory:function(t){(this.coordshortSuccess||void 0===this.coordshortSuccess||60<(Date.now()-this.coordshortTimestamp)/1e3)&&(this.coordshortSuccess=!1,$.ajax({url:"statistics/coordshort",json:!0}).success(function(e){this.coordshortTimestamp=Date.now(),this.coordshortSuccess=!0,this.statsEnabled=e.enabled,t(e.data)}.bind(this)).error(function(e){this.coordshortTimestamp=Date.now(),this.coordshortSuccess=!1}.bind(this)))}})}(),function(){"use strict";window.CollectionListItemView=Backbone.View.extend({tagName:"div",className:"tile pure-u-1-1 pure-u-sm-1-2 pure-u-md-1-3 pure-u-lg-1-4 pure-u-xl-1-6",template:templateEngine.createTemplate("collectionsItemView.ejs"),initialize:function(e){this.collectionsView=e.collectionsView},events:{"click .iconSet.icon_arangodb_settings2":"createEditPropertiesModal","click .pull-left":"noop","click .icon_arangodb_settings2":"editProperties","click .spanInfo":"showProperties",click:"selectCollection"},render:function(){return this.model.get("locked")||"corrupted"===this.model.get("status")?($(this.el).addClass("locked"),$(this.el).addClass(this.model.get("lockType"))):$(this.el).removeClass("locked"),"loading"!==this.model.get("status")&&"unloading"!==this.model.get("status")||$(this.el).addClass("locked"),$(this.el).html(this.template.render({model:this.model})),$(this.el).attr("id","collection_"+this.model.get("name")),this},editProperties:function(e){if(this.model.get("locked"))return 0;e.stopPropagation(),this.createEditPropertiesModal()},showProperties:function(e){if(this.model.get("locked"))return 0;e.stopPropagation(),this.createInfoModal()},selectCollection:function(e){return $(e.target).hasClass("disabled")?0:this.model.get("locked")?0:"loading"===this.model.get("status")?0:"corrupted"===this.model.get("status")?0:void("unloaded"===this.model.get("status")?this.loadCollection():window.App.navigate("collection/"+encodeURIComponent(this.model.get("name"))+"/documents/1",{trigger:!0}))},noop:function(e){e.stopPropagation()},unloadCollection:function(){var e=function(e){e?arangoHelper.arangoError("Collection error",this.model.get("name")+" could not be unloaded."):void 0===e?(this.model.set("status","unloading"),this.render()):"#collections"===window.location.hash?(this.model.set("status","unloaded"),this.render()):arangoHelper.arangoNotification("Collection "+this.model.get("name")+" unloaded.")}.bind(this);this.model.unloadCollection(e),window.modalView.hide()},loadCollection:function(){var e=function(e){e?arangoHelper.arangoError("Collection error",this.model.get("name")+" could not be loaded."):void 0===e?(this.model.set("status","loading"),this.render()):"#collections"===window.location.hash?(this.model.set("status","loaded"),this.render()):arangoHelper.arangoNotification("Collection "+this.model.get("name")+" loaded.")}.bind(this);this.model.loadCollection(e),window.modalView.hide()},truncateCollection:function(){this.model.truncateCollection(),window.modalView.hide()},warumupCollection:function(){this.model.warumupCollection(),window.modalView.hide()},deleteCollection:function(){this.model.destroy({error:function(){arangoHelper.arangoError("Could not delete collection.")},success:function(){window.modalView.hide()}}),this.collectionsView.render()},saveModifiedCollection:function(){var e=function(e,t){if(e)arangoHelper.arangoError("Error","Could not get coordinator info");else{var i;i=t?this.model.get("name"):$("#change-collection-name").val();var n=this.model.get("status");if("loaded"===n){var o,a;try{o=JSON.parse(1024*$("#change-collection-size").val()*1024)}catch(e){return arangoHelper.arangoError("Please enter a valid number"),0}try{if((a=JSON.parse($("#change-index-buckets").val()))<1||parseInt(a,10)!==Math.pow(2,Math.log2(a)))throw new Error("invalid indexBuckets value")}catch(e){return arangoHelper.arangoError("Please enter a valid number of index buckets"),0}var r=function(e){e?arangoHelper.arangoError("Collection error: "+e.responseText):(this.collectionsView.render(),window.modalView.hide())}.bind(this),s=function(e){if(e)arangoHelper.arangoError("Collection error: "+e.responseText);else{var t,i=$("#change-collection-sync").val();frontendConfig.isCluster&&(t=$("#change-replication-factor").val()),this.model.changeCollection(i,o,a,t,r)}}.bind(this);!1===frontendConfig.isCluster?this.model.renameCollection(i,s):s()}else if("unloaded"===n)if(this.model.get("name")!==i){var l=function(e,t){e?arangoHelper.arangoError("Collection error: "+t.responseText):(this.collectionsView.render(),window.modalView.hide())}.bind(this);!1===frontendConfig.isCluster?this.model.renameCollection(i,l):l()}else window.modalView.hide()}}.bind(this);window.isCoordinator(e)},createEditPropertiesModal:function(){var e=function(e,t){if(e)arangoHelper.arangoError("Error","Could not get coordinator info");else{var i=!1;"loaded"===this.model.get("status")&&(i=!0);var n=[],a=[];t||a.push(window.modalView.createTextEntry("change-collection-name","Name",this.model.get("name"),!1,"",!0,[{rule:Joi.string().regex(/^[a-zA-Z]/),msg:"Collection name must always start with a letter."},{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only Symbols "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No collection name given."}]));var r=function(){a.push(window.modalView.createReadOnlyEntry("change-collection-id","ID",this.model.get("id"),"")),a.push(window.modalView.createReadOnlyEntry("change-collection-type","Type",this.model.get("type"),"")),a.push(window.modalView.createReadOnlyEntry("change-collection-status","Status",this.model.get("status"),"")),n.push(window.modalView.createDeleteButton("Delete",this.deleteCollection.bind(this))),n.push(window.modalView.createDeleteButton("Truncate",this.truncateCollection.bind(this))),"rocksdb"===frontendConfig.engine&&n.push(window.modalView.createDeleteButton("Load Indexes into Memory",this.warumupCollection.bind(this))),i?n.push(window.modalView.createNotificationButton("Unload",this.unloadCollection.bind(this))):n.push(window.modalView.createNotificationButton("Load",this.loadCollection.bind(this))),n.push(window.modalView.createSuccessButton("Save",this.saveModifiedCollection.bind(this)));window.modalView.show(["modalTable.ejs","indicesView.ejs"],"Modify Collection",n,a,null,null,this.events,null,["General","Indexes"]),"loaded"===this.model.get("status")?this.getIndex():$($("#infoTab").children()[1]).remove()}.bind(this);if(i){this.model.getProperties(function(e,t){if(e)arangoHelper.arangoError("Collection","Could not fetch properties");else{var i=t.journalSize/1048576,n=t.indexBuckets,o=t.waitForSync;a.push(window.modalView.createTextEntry("change-collection-size","Journal size",i,"The maximal size of a journal or datafile (in MB). Must be at least 1.","",!0,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}])),a.push(window.modalView.createTextEntry("change-index-buckets","Index buckets",n,"The number of index buckets for this collection. Must be at least 1 and a power of 2.","",!0,[{rule:Joi.string().allow("").optional().regex(/^[1-9][0-9]*$/),msg:"Must be a number greater than 1 and a power of 2."}])),a.push(window.modalView.createSelectEntry("change-collection-sync","Wait for sync",o,"Synchronize to disk before returning from a create or update of a document.",[{value:!1,label:"No"},{value:!0,label:"Yes"}]))}r()})}else r()}}.bind(this);window.isCoordinator(e)},bindIndexEvents:function(){this.unbindIndexEvents();var t=this;$("#indexEditView #addIndex").bind("click",function(){t.toggleNewIndexView(),$("#cancelIndex").unbind("click"),$("#cancelIndex").bind("click",function(){t.toggleNewIndexView()}),$("#createIndex").unbind("click"),$("#createIndex").bind("click",function(){t.createIndex()})}),$("#newIndexType").bind("change",function(){t.selectIndexType()}),$(".deleteIndex").bind("click",function(e){t.prepDeleteIndex(e)}),$("#infoTab a").bind("click",function(e){if($("#indexDeleteModal").remove(),"Indexes"!==$(e.currentTarget).html()||$(e.currentTarget).parent().hasClass("active")||($("#newIndexView").hide(),$("#indexEditView").show(),$("#modal-dialog .modal-footer .button-danger").hide(),$("#modal-dialog .modal-footer .button-success").hide(),$("#modal-dialog .modal-footer .button-notification").hide()),"General"===$(e.currentTarget).html()&&!$(e.currentTarget).parent().hasClass("active")){$("#modal-dialog .modal-footer .button-danger").show(),$("#modal-dialog .modal-footer .button-success").show(),$("#modal-dialog .modal-footer .button-notification").show();var t=$(".index-button-bar2")[0];$("#cancelIndex").is(":visible")&&($("#cancelIndex").detach().appendTo(t),$("#createIndex").detach().appendTo(t))}})},unbindIndexEvents:function(){$("#indexEditView #addIndex").unbind("click"),$("#newIndexType").unbind("change"),$("#infoTab a").unbind("click"),$(".deleteIndex").unbind("click")},createInfoModal:function(){var n=function(e,t,i){if(e)arangoHelper.arangoError("Figures","Could not get revision.");else{var n={figures:i,revision:t,model:this.model};window.modalView.show("modalCollectionInfo.ejs","Collection: "+this.model.get("name"),[],n)}}.bind(this),e=function(e,t){if(e)arangoHelper.arangoError("Figures","Could not get figures.");else{var i=t;this.model.getRevision(n,i)}}.bind(this);this.model.getFigures(e)},resetIndexForms:function(){$("#indexHeader input").val("").prop("checked",!1),$("#newIndexType").val("Geo").prop("selected",!0),this.selectIndexType()},createIndex:function(){var e,t,i,n=this,o={};switch($("#newIndexType").val()){case"Geo":e=$("#newGeoFields").val();var a=n.checkboxToValue("#newGeoJson"),r=n.checkboxToValue("#newGeoConstraint"),s=n.checkboxToValue("#newGeoIgnoreNull");o={type:"geo",fields:n.stringToArray(e),geoJson:a,constraint:r,ignoreNull:s};break;case"Hash":e=$("#newHashFields").val(),t=n.checkboxToValue("#newHashUnique"),i=n.checkboxToValue("#newHashSparse"),o={type:"hash",fields:n.stringToArray(e),unique:t,sparse:i};break;case"Fulltext":e=$("#newFulltextFields").val();var l=parseInt($("#newFulltextMinLength").val(),10)||0;o={type:"fulltext",fields:n.stringToArray(e),minLength:l};break;case"Skiplist":e=$("#newSkiplistFields").val(),t=n.checkboxToValue("#newSkiplistUnique"),i=n.checkboxToValue("#newSkiplistSparse"),o={type:"skiplist",fields:n.stringToArray(e),unique:t,sparse:i}}window.modalView.hide(),n.model.createIndex(o,function(e,t){if(e)if(t){var i=JSON.parse(t.responseText);arangoHelper.arangoError("Document error",i.errorMessage)}else arangoHelper.arangoError("Document error","Could not create index.");n.refreshCollectionsView()})},lastTarget:null,prepDeleteIndex:function(e){var t=this;this.lastTarget=e,this.lastId=$(this.lastTarget.currentTarget).parent().parent().first().children().first().text(),$("#modal-dialog .modal-footer").after('<div id="indexDeleteModal" style="display:block;" class="alert alert-error modal-delete-confirmation"><strong>Really delete?</strong><button id="indexConfirmDelete" class="button-danger pull-right modal-confirm-delete">Yes</button><button id="indexAbortDelete" class="button-neutral pull-right">No</button></div>'),$("#indexConfirmDelete").unbind("click"),$("#indexConfirmDelete").bind("click",function(){$("#indexDeleteModal").remove(),t.deleteIndex()}),$("#indexAbortDelete").unbind("click"),$("#indexAbortDelete").bind("click",function(){$("#indexDeleteModal").remove()})},refreshCollectionsView:function(){window.App.arangoCollectionsStore.fetch({success:function(){window.App.collectionsView.render()}})},deleteIndex:function(){var e=function(e){e?(arangoHelper.arangoError("Could not delete index"),$("tr th:contains('"+this.lastId+"')").parent().children().last().html('<span class="deleteIndex icon_arangodb_roundminus" data-original-title="Delete index" title="Delete index"></span>'),this.model.set("locked",!1),this.refreshCollectionsView()):e||void 0===e||($("tr th:contains('"+this.lastId+"')").parent().remove(),this.model.set("locked",!1),this.refreshCollectionsView()),this.refreshCollectionsView()}.bind(this);this.model.set("locked",!0),this.model.deleteIndex(this.lastId,e),$("tr th:contains('"+this.lastId+"')").parent().children().last().html('<i class="fa fa-circle-o-notch fa-spin"></i>')},selectIndexType:function(){$(".newIndexClass").hide();var e=$("#newIndexType").val();$("#newIndexType"+e).show()},getIndex:function(){var e=function(e,t){e?window.arangoHelper.arangoError("Index",t.errorMessage):this.renderIndex(t)}.bind(this);this.model.getIndex(e)},renderIndex:function(e){this.index=e;var a="collectionInfoTh modal-text";if(this.index){var r="",s="";_.each(this.index.indexes,function(e){s="primary"===e.type||"edge"===e.type?'<span class="icon_arangodb_locked" data-original-title="No action"></span>':'<span class="deleteIndex icon_arangodb_roundminus" data-original-title="Delete index" title="Delete index"></span>',void 0!==e.fields&&(r=e.fields.join(", "));var t=e.id.indexOf("/"),i=e.id.substr(t+1,e.id.length),n=e.hasOwnProperty("selectivityEstimate")?(100*e.selectivityEstimate).toFixed(2)+"%":"n/a",o=e.hasOwnProperty("sparse")?e.sparse:"n/a";$("#collectionEditIndexTable").append("<tr><th class="+JSON.stringify(a)+">"+i+"</th><th class="+JSON.stringify(a)+">"+e.type+"</th><th class="+JSON.stringify(a)+">"+e.unique+"</th><th class="+JSON.stringify(a)+">"+o+"</th><th class="+JSON.stringify(a)+">"+n+"</th><th class="+JSON.stringify(a)+">"+r+"</th><th class="+JSON.stringify(a)+">"+s+"</th></tr>")})}this.bindIndexEvents()},toggleNewIndexView:function(){var e=$(".index-button-bar2")[0];$("#indexEditView").is(":visible")?($("#indexEditView").hide(),$("#newIndexView").show(),$("#cancelIndex").detach().appendTo("#modal-dialog .modal-footer"),$("#createIndex").detach().appendTo("#modal-dialog .modal-footer")):($("#indexEditView").show(),$("#newIndexView").hide(),$("#cancelIndex").detach().appendTo(e),$("#createIndex").detach().appendTo(e)),arangoHelper.fixTooltips(".icon_arangodb, .arangoicon","right"),this.resetIndexForms()},stringToArray:function(e){var t=[];return e.split(",").forEach(function(e){""!==(e=e.replace(/(^\s+|\s+$)/g,""))&&t.push(e)}),t},checkboxToValue:function(e){return $(e).prop("checked")}})}(),function(){"use strict";window.CollectionsView=Backbone.View.extend({el:"#content",el2:"#collectionsThumbnailsIn",readOnly:!1,searchTimeout:null,refreshRate:1e4,template:templateEngine.createTemplate("collectionsView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},refetchCollections:function(){var e=this;this.collection.fetch({cache:!1,success:function(){e.checkLockedCollections()}})},checkLockedCollections:function(){var e=function(e,t){var i=this;e?console.log("Could not check locked collections"):(this.collection.each(function(e){e.set("locked",!1)}),_.each(t,function(e){var t=i.collection.findWhere({id:e.collection});t.set("locked",!0),t.set("lockType",e.type),t.set("desc",e.desc)}),this.collection.each(function(e){e.get("locked")||($("#collection_"+e.get("name")).find(".corneredBadge").removeClass("loaded unloaded"),$("#collection_"+e.get("name")+" .corneredBadge").text(e.get("status")),$("#collection_"+e.get("name")+" .corneredBadge").addClass(e.get("status"))),e.get("locked")||"loading"===e.get("status")?($("#collection_"+e.get("name")).addClass("locked"),e.get("locked")?($("#collection_"+e.get("name")).find(".corneredBadge").removeClass("loaded unloaded"),$("#collection_"+e.get("name")).find(".corneredBadge").addClass("inProgress"),$("#collection_"+e.get("name")+" .corneredBadge").text(e.get("desc"))):$("#collection_"+e.get("name")+" .corneredBadge").text(e.get("status"))):($("#collection_"+e.get("name")).removeClass("locked"),$("#collection_"+e.get("name")+" .corneredBadge").text(e.get("status")),$("#collection_"+e.get("name")+" .corneredBadge").hasClass("inProgress")&&($("#collection_"+e.get("name")+" .corneredBadge").text(e.get("status")),$("#collection_"+e.get("name")+" .corneredBadge").removeClass("inProgress"),$("#collection_"+e.get("name")+" .corneredBadge").addClass("loaded")),"unloaded"===e.get("status")&&$("#collection_"+e.get("name")+" .icon_arangodb_info").addClass("disabled"))}))}.bind(this);frontendConfig.ldapEnabled||window.arangoHelper.syncAndReturnUninishedAardvarkJobs("index",e)},initialize:function(){var e=this;window.setInterval(function(){"#collections"===window.location.hash&&window.VISIBLE&&e.refetchCollections()},e.refreshRate)},render:function(){this.checkLockedCollections();var e=!1;$("#collectionsDropdown").is(":visible")&&(e=!0),$(this.el).html(this.template.render({})),this.setFilterValues(),!0===e&&$("#collectionsDropdown2").show();var t,i=this.collection.searchOptions;this.collection.getFiltered(i).forEach(function(e){$("#collectionsThumbnailsIn",this.el).append(new window.CollectionListItemView({model:e,collectionsView:this}).render().el)},this),"none"===$("#collectionsDropdown2").css("display")?$("#collectionsToggle").removeClass("activated"):$("#collectionsToggle").addClass("activated"),arangoHelper.setCheckboxStatus("#collectionsDropdown");try{t=i.searchPhrase.length}catch(e){}return $("#searchInput").val(i.searchPhrase),$("#searchInput").focus(),$("#searchInput")[0].setSelectionRange(t,t),arangoHelper.fixTooltips(".icon_arangodb, .arangoicon","left"),arangoHelper.checkDatabasePermissions(this.setReadOnly.bind(this)),this},setReadOnly:function(){this.readOnly=!0,$("#createCollection").parent().parent().addClass("disabled")},events:{"click #createCollection":"createCollection","keydown #searchInput":"restrictToSearchPhraseKey","change #searchInput":"restrictToSearchPhrase","click #searchSubmit":"restrictToSearchPhrase","click .checkSystemCollections":"checkSystem","click #checkLoaded":"checkLoaded","click #checkUnloaded":"checkUnloaded","click #checkDocument":"checkDocument","click #checkEdge":"checkEdge","click #sortName":"sortName","click #sortType":"sortType","click #sortOrder":"sortOrder","click #collectionsToggle":"toggleView","click .css-label":"checkBoxes"},updateCollectionsView:function(){var e=this;this.collection.fetch({cache:!1,success:function(){e.render()}})},toggleView:function(){$("#collectionsToggle").toggleClass("activated"),$("#collectionsDropdown2").slideToggle(200)},checkBoxes:function(e){var t=e.currentTarget.id;$("#"+t).click()},checkSystem:function(){var e=this.collection.searchOptions,t=e.includeSystem;e.includeSystem=!0===$(".checkSystemCollections").is(":checked"),t!==e.includeSystem&&this.render()},checkEdge:function(){var e=this.collection.searchOptions,t=e.includeEdge;e.includeEdge=!0===$("#checkEdge").is(":checked"),t!==e.includeEdge&&this.render()},checkDocument:function(){var e=this.collection.searchOptions,t=e.includeDocument;e.includeDocument=!0===$("#checkDocument").is(":checked"),t!==e.includeDocument&&this.render()},checkLoaded:function(){var e=this.collection.searchOptions,t=e.includeLoaded;e.includeLoaded=!0===$("#checkLoaded").is(":checked"),t!==e.includeLoaded&&this.render()},checkUnloaded:function(){var e=this.collection.searchOptions,t=e.includeUnloaded;e.includeUnloaded=!0===$("#checkUnloaded").is(":checked"),t!==e.includeUnloaded&&this.render()},sortName:function(){var e=this.collection.searchOptions,t=e.sortBy;e.sortBy=!0===$("#sortName").is(":checked")?"name":"type",t!==e.sortBy&&this.render()},sortType:function(){var e=this.collection.searchOptions,t=e.sortBy;e.sortBy=!0===$("#sortType").is(":checked")?"type":"name",t!==e.sortBy&&this.render()},sortOrder:function(){var e=this.collection.searchOptions,t=e.sortOrder;e.sortOrder=!0===$("#sortOrder").is(":checked")?-1:1,t!==e.sortOrder&&this.render()},setFilterValues:function(){var e=this.collection.searchOptions;$("#checkLoaded").attr("checked",e.includeLoaded),$("#checkUnloaded").attr("checked",e.includeUnloaded),$(".checkSystemCollections").attr("checked",e.includeSystem),$("#checkEdge").attr("checked",e.includeEdge),$("#checkDocument").attr("checked",e.includeDocument),$("#sortName").attr("checked","type"!==e.sortBy),$("#sortType").attr("checked","type"===e.sortBy),$("#sortOrder").attr("checked",1!==e.sortOrder)},search:function(){var e=this.collection.searchOptions,t=$("#searchInput").val();t!==e.searchPhrase&&(e.searchPhrase=t,this.render())},resetSearch:function(){this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),this.collection.searchOptions.searchPhrase=null},restrictToSearchPhraseKey:function(){var e=this;this.resetSearch(),e.searchTimeout=setTimeout(function(){e.search()},200)},restrictToSearchPhrase:function(){this.resetSearch(),this.search()},createCollection:function(e){if(!this.readOnly){e.preventDefault();var t=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/engine"),contentType:"application/json",processData:!1,success:function(e){t.engine=e,t.createNewCollectionModal(e)},error:function(){arangoHelper.arangoError("Engine","Could not fetch ArangoDB Engine details.")}})}},submitCreateCollection:function(){var h=this,e=function(e,t){if(e)arangoHelper.arangoError("DB","Could not check coordinator state");else{var i=$("#new-collection-name").val(),n=$("#new-collection-size").val(),o=$("#new-replication-factor").val(),a=$("#new-collection-type").val(),r=$("#new-collection-sync").val(),s=1,l=[];if(""===o&&(o=1),"true"===$("#is-satellite-collection").val()&&(o="satellite"),t){if(""===(s=$("#new-collection-shards").val())&&(s=1),(s=parseInt(s,10))<1)return arangoHelper.arangoError("Number of shards has to be an integer value greater or equal 1"),0;0===(l=_.pluck($("#new-collection-shardBy").select2("data"),"text")).length&&l.push("_key")}if("_"===i.substr(0,1))return arangoHelper.arangoError('No "_" allowed as first character!'),0;var c="true"===r;if(0<n)try{n=1024*JSON.parse(n)*1024}catch(e){return arangoHelper.arangoError("Please enter a valid number"),0}if(""===i)return arangoHelper.arangoError("No collection name entered!"),0;var d=function(e,t){if(e)try{t=JSON.parse(t.responseText),arangoHelper.arangoError("Error",t.errorMessage)}catch(e){}else"#collections"===window.location.hash&&this.updateCollectionsView(),arangoHelper.arangoNotification("Collection",'Collection "'+t.name+'" successfully created.')}.bind(this),u={collName:i,wfs:c,isSystem:!1,replicationFactor:o,collType:a,shards:s,shardBy:l};"rocksdb"!==h.engine.name&&(u.journalSize=n),this.collection.newCollection(u,d),window.modalView.hide(),arangoHelper.arangoNotification("Collection",'Collection "'+i+'" will be created.')}}.bind(this);window.isCoordinator(e)},createNewCollectionModal:function(){var r=this,e=function(e,t){if(e)arangoHelper.arangoError("DB","Could not check coordinator state");else{var i=[],n=[],o={},a=[];n.push(window.modalView.createTextEntry("new-collection-name","Name","",!1,"",!0,[{rule:Joi.string().regex(/^[a-zA-Z]/),msg:"Collection name must always start with a letter."},{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only symbols, "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No collection name given."}])),n.push(window.modalView.createSelectEntry("new-collection-type","Type","","The type of the collection to create.",[{value:2,label:"Document"},{value:3,label:"Edge"}])),t&&(n.push(window.modalView.createTextEntry("new-collection-shards","Shards","","The number of shards to create. You cannot change this afterwards. Recommended: DBServers squared","",!0)),n.push(window.modalView.createSelect2Entry("new-collection-shardBy","shardBy","","The keys used to distribute documents on shards. Type the key and press return to add it.","_key",!1))),i.push(window.modalView.createSuccessButton("Save",this.submitCreateCollection.bind(this))),window.App.isCluster&&(frontendConfig.isEnterprise&&a.push(window.modalView.createSelectEntry("is-satellite-collection","Satellite collection","","Create satellite collection? This will disable replication factor.",[{value:!1,label:"No"},{value:!0,label:"Yes"}])),a.push(window.modalView.createTextEntry("new-replication-factor","Replication factor","","Numeric value. Must be at least 1. Total number of copies of the data in the cluster","",!1,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}]))),"rocksdb"!==r.engine.name&&a.push(window.modalView.createTextEntry("new-collection-size","Journal size","","The maximal size of a journal or datafile (in MB). Must be at least 1.","",!1,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}])),a.push(window.modalView.createSelectEntry("new-collection-sync","Wait for sync","","Synchronize to disk before returning from a create or update of a document.",[{value:!1,label:"No"},{value:!0,label:"Yes"}])),o.header="Advanced",o.content=a,window.modalView.show("modalTable.ejs","New Collection",i,n,o),$("#s2id_new-collection-shardBy .select2-search-field input").on("focusout",function(e){$(".select2-drop").is(":visible")&&($("#select2-search-field input").is(":focus")||window.setTimeout(function(){$(e.currentTarget).parent().parent().parent().select2("close")},200))}),window.App.isCluster&&frontendConfig.isEnterprise&&$("#is-satellite-collection").on("change",function(e){"true"===$("#is-satellite-collection").val()?$("#new-replication-factor").prop("disabled",!0):$("#new-replication-factor").prop("disabled",!1),$("#new-replication-factor").val("").focus().focusout()})}}.bind(this);window.isCoordinator(e)}})}(),function(){"use strict";function l(e,t){return null==e&&(e=0),e.toFixed(t)}window.DashboardView=Backbone.View.extend({el:"#content",interval:1e4,defaultTimeFrame:12e5,defaultDetailFrame:1728e5,reRender:!0,reRenderDistribution:!0,isVisible:!0,distributionCharts:{totalTimeDistribution:null,dataTransferDistribution:null},residentChart:null,history:{},graphs:{},events:{"click .subViewNavbar .subMenuEntry":"toggleViews"},tendencies:{asyncPerSecondCurrent:["asyncPerSecondCurrent","asyncPerSecondPercentChange"],syncPerSecondCurrent:["syncPerSecondCurrent","syncPerSecondPercentChange"],clientConnectionsCurrent:["clientConnectionsCurrent","clientConnectionsPercentChange"],clientConnectionsAverage:["clientConnections15M","clientConnections15MPercentChange"],numberOfThreadsCurrent:["numberOfThreadsCurrent","numberOfThreadsPercentChange"],numberOfThreadsAverage:["numberOfThreads15M","numberOfThreads15MPercentChange"],virtualSizeCurrent:["virtualSizeCurrent","virtualSizePercentChange"],virtualSizeAverage:["virtualSize15M","virtualSize15MPercentChange"]},barCharts:{totalTimeDistribution:["queueTimeDistributionPercent","requestTimeDistributionPercent"],dataTransferDistribution:["bytesSentDistributionPercent","bytesReceivedDistributionPercent"]},barChartsElementNames:{queueTimeDistributionPercent:"Queue",requestTimeDistributionPercent:"Computation",bytesSentDistributionPercent:"Bytes sent",bytesReceivedDistributionPercent:"Bytes received"},getDetailFigure:function(e){return $(e.currentTarget).attr("id").replace(/ChartButton/g,"")},showDetail:function(e){var t,i=this,n=this.getDetailFigure(e);t=this.dygraphConfig.getDetailChartConfig(n),this.getHistoryStatistics(n),this.detailGraphFigure=n,window.modalView.hideFooter=!0,window.modalView.hide(),window.modalView.show("modalGraph.ejs",t.header,void 0,void 0,void 0,void 0,this.events),window.modalView.hideFooter=!1,$("#modal-dialog").on("hidden",function(){i.hidden()}),$("#modal-dialog").toggleClass("modal-chart-detail",!0),t.height=.7*$(window).height(),t.width=$(".modal-inner-detail").width(),t.labelsDiv=$(t.labelsDiv)[0],this.detailGraph=new Dygraph(document.getElementById("lineChartDetail"),this.history[this.server][n],t)},hidden:function(){this.detailGraph.destroy(),delete this.detailGraph,delete this.detailGraphFigure},getCurrentSize:function(e){return"#"!==e.substr(0,1)&&(e="#"+e),$(e).attr("style",""),{height:$(e).height(),width:$(e).width()}},prepareDygraphs:function(){var i,n=this;this.dygraphConfig.getDashBoardFigures().forEach(function(e){i=n.dygraphConfig.getDefaultConfig(e);var t=n.getCurrentSize(i.div);i.height=t.height,i.width=t.width,n.graphs[e]=new Dygraph(document.getElementById(i.div),n.history[n.server][e]||[],i)})},initialize:function(e){this.options=e,this.dygraphConfig=e.dygraphConfig,this.d3NotInitialized=!0,this.events["click .dashboard-sub-bar-menu-sign"]=this.showDetail.bind(this),this.events["mousedown .dygraph-rangesel-zoomhandle"]=this.stopUpdating.bind(this),this.events["mouseup .dygraph-rangesel-zoomhandle"]=this.startUpdating.bind(this),void 0===e.serverToShow&&(e.serverToShow={}),void 0===e.serverToShow.target&&0===window.location.hash.indexOf("#node/")&&(e.serverToShow.target=window.location.hash.split("/")[1]),this.serverInfo=e.serverToShow,this.serverInfo?this.server=this.serverInfo.target:this.server="-local-",this.history[this.server]={}},toggleViews:function(e){var t=e.currentTarget.id.split("-")[0],i=this;_.each(["requests","system"],function(e){t!==e?$("#"+e).hide():($("#"+e).show(),i.resize(),$(window).resize())}),$(".subMenuEntries").children().removeClass("active"),$("#"+t+"-statistics").addClass("active"),window.setTimeout(function(){i.resize(),$(window).resize()},200)},updateCharts:function(){var t=this;this.detailGraph?this.updateLineChart(this.detailGraphFigure,!0):(this.prepareD3Charts(this.isUpdating),this.prepareResidentSize(this.isUpdating),this.updateTendencies(),Object.keys(this.graphs).forEach(function(e){t.updateLineChart(e,!1)}))},updateTendencies:function(){var n=this,e=this.tendencies,o="";Object.keys(e).forEach(function(e){var t="",i=0;n.history.hasOwnProperty(n.server)&&n.history[n.server].hasOwnProperty(e)&&(i=n.history[n.server][e][1]),i<0?o="#d05448":(o="#77DB99",t="+"),n.history.hasOwnProperty(n.server)&&n.history[n.server].hasOwnProperty(e)?$("#"+e).html(n.history[n.server][e][0]+'<br/><span class="dashboard-figurePer" style="color: '+o+';">'+t+i+"%</span>"):$("#"+e).html('<br/><span class="dashboard-figurePer" style="color: #000;"><p class="dataNotReadyYet">data not ready yet</p></span>')})},updateDateWindow:function(e,t){var i=(new Date).getTime();return t&&e.dateWindow_?[e.dateWindow_[0],0<i-e.dateWindow_[1]-5*this.interval?e.dateWindow_[1]:i]:[i-this.defaultTimeFrame,i]},updateLineChart:function(t,e){var i=e?this.detailGraph:this.graphs[t],n={file:this.history[this.server][t],dateWindow:this.updateDateWindow(i,e)},o=0,a=[];_.each(n.file,function(e){var t=e[0].getSeconds()-e[0].getSeconds()%10;n.file[o][0].setSeconds(t),a.push(n.file[o][0]),o++});for(var r=new Date(Math.max.apply(null,a)),s=new Date(Math.min.apply(null,a)),l=new Date(s.getTime()),c=[],d=[];l<r;)l=new Date(l.setSeconds(l.getSeconds()+10)),d.push(l);_.each(d,function(t){var i=!1;_.each(n.file,function(e){Math.floor(t.getTime()/1e3)===Math.floor(e[0].getTime()/1e3)&&(i=!0)}),!1===i&&t<new Date&&c.push(t)}),_.each(c,function(e){"systemUserTime"!==t&&"requests"!==t&&"pageFaults"!==t&&"dataTransfer"!==t||n.file.push([e,0,0]),"totalTime"===t&&n.file.push([e,0,0,0])}),void 0===n.file?($("#loadingScreen span").text("Statistics not ready yet. Waiting."),"#dashboard"!==window.location.hash&&""!==window.location.hash&&"#"!==window.location.hash||($("#loadingScreen").show(),$("#content").hide())):($("#content").show(),$("#loadingScreen").hide(),n.file.sort(function(e,t){return new Date(t[0])-new Date(e[0])}),i.updateOptions(n)),$(window).trigger("resize"),this.resize()},mergeDygraphHistory:function(n,o){var a,r=this;this.dygraphConfig.getDashBoardFigures(!0).forEach(function(e){if(r.dygraphConfig.mapStatToFigure[e]&&(r.history[r.server][e]||(r.history[r.server][e]=[]),a=[],r.dygraphConfig.mapStatToFigure[e].forEach(function(e){n[e]&&("times"===e?a.push(new Date(1e3*n[e][o])):a.push(n[e][o]))}),1<a.length)){var t=0,i=0;9===a.length&&(t+=a[1],t+=a[6],t+=a[7],t+=a[8],i+=a[2],i+=a[3],i+=a[4],i+=a[5],a=[a[0],t,i]),r.history[r.server][e].unshift(a)}})},cutOffHistory:function(e,t){for(var i=this.history[this.server][e];0!==i.length&&!(i[i.length-1][0]>=t);)i.pop()},cutOffDygraphHistory:function(e){var t=this,i=new Date(e);this.dygraphConfig.getDashBoardFigures(!0).forEach(function(e){t.dygraphConfig.mapStatToFigure[e]&&t.history[t.server][e]&&t.cutOffHistory(e,i)})},mergeHistory:function(i){var e,n=this;for(e=0;e<i.times.length;++e)this.mergeDygraphHistory(i,e);this.cutOffDygraphHistory((new Date).getTime()-this.defaultTimeFrame),Object.keys(this.tendencies).forEach(function(e){var t=1;"virtualSizeCurrent"===e||"virtualSizeAverage"===e?(i[n.tendencies[e][0]]/=1073741824,t=2):"clientConnectionsCurrent"===e?t=0:"numberOfThreadsCurrent"===e&&(t=0),n.history[n.server][e]=[l(i[n.tendencies[e][0]],t),l(100*i[n.tendencies[e][1]],1)]}),Object.keys(this.barCharts).forEach(function(e){n.history[n.server][e]=n.mergeBarChartData(n.barCharts[e],i)}),n.history[n.server].physicalMemory=i.physicalMemory,n.history[n.server].residentSizeCurrent=i.residentSizeCurrent,n.history[n.server].residentSizePercent=i.residentSizePercent,n.history[n.server].residentSizeChart=[{key:"",color:this.dygraphConfig.colors[1],values:[{label:"used",value:100*i.residentSizePercent}]},{key:"",color:this.dygraphConfig.colors[2],values:[{label:"used",value:100-100*i.residentSizePercent}]}],this.nextStart=i.nextStart},mergeBarChartData:function(e,t){var i,n={key:this.barChartsElementNames[e[0]],color:this.dygraphConfig.colors[1],values:[]},o={key:this.barChartsElementNames[e[1]],color:this.dygraphConfig.colors[2],values:[]};for(i=t[e[0]].values.length-1;0<=i;--i)n.values.push({label:this.getLabel(t[e[0]].cuts,i),value:t[e[0]].values[i]}),o.values.push({label:this.getLabel(t[e[1]].cuts,i),value:t[e[1]].values[i]});return[n,o]},getLabel:function(e,t){return e[t]?0===t?"0 - "+e[t]:e[t-1]+" - "+e[t]:">"+e[t-1]},checkState:function(){var e=this;"#dashboard"===window.location.hash||"#node"===window.location.hash.substr(0,5)?e.isVisible=!0:(e.residentChart=null,e.isVisible=!1,e.reRender=!0,e.reRenderDistribution=!1)},renderStatisticBox:function(e,t,i,n){if($("#node-info #nodeattribute-"+e).length)$("#node-info #nodeattribute-"+e).html(t);else{var o="";o+=6===n?'<div class="pure-u-1-2 pure-u-md-1-3 pure-u-lg-1-6" style="background-color: #fff">':'<div class="pure-u-1-2 pure-u-md-1-4" style="background-color: #fff">',o+='<div class="valueWrapper">',o+=i?'<div id="nodeattribute-'+e+'" class="value tippy" title="'+t+'">'+t+"</div>":'<div id="nodeattribute-'+e+'" class="value">'+t+"</div>",o+='<div class="graphLabel">'+e+"</div>",o+="</div>",o+="</div>",$("#node-info").append(o)}},getNodeInfo:function(){var t=this;frontendConfig.isCluster?(this.serverInfo.isDBServer?this.renderStatisticBox("Role","DBServer",void 0,6):this.renderStatisticBox("Role","Coordinator",void 0,6),this.renderStatisticBox("Host",this.serverInfo.raw,this.serverInfo.raw,6),$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/clusterNodeVersion?ServerID="+this.serverInfo.target),contentType:"application/json",processData:!1,success:function(e){t.renderStatisticBox("Version",frontendConfig.version.version,void 0,6),t.renderStatisticBox("Edition",frontendConfig.version.license,void 0,6)},error:function(e){t.renderStatisticBox("Version","Error"),t.renderStatisticBox("Edition","Error")}}),$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/clusterNodeEngine?ServerID="+this.serverInfo.target),contentType:"application/json",processData:!1,success:function(e){t.renderStatisticBox("Engine",e.name,void 0,6)},error:function(e){t.renderStatisticBox("Engine","Error",void 0,6)}}),$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/clusterNodeStats?ServerID="+this.serverInfo.target),contentType:"application/json",processData:!1,success:function(e){t.renderStatisticBox("Uptime",moment.duration(e.server.uptime,"seconds").humanize(),void 0,6)},error:function(e){t.renderStatisticBox("Uptime","Error",void 0,6)}})):(this.renderStatisticBox("Version",frontendConfig.version.version),this.renderStatisticBox("Edition",frontendConfig.version.license),this.renderStatisticBox("Engine",frontendConfig.engine),$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/statistics"),contentType:"application/json",processData:!1,success:function(e){t.renderStatisticBox("Uptime",moment.duration(e.server.uptime,"seconds").humanize())},error:function(){t.renderStatisticBox("Uptime","Error")}})),arangoHelper.createTooltips()},getStatistics:function(t,i){var n=this;n.checkState();var e=arangoHelper.databaseUrl("/_admin/aardvark/statistics/short","_system"),o="?start=";n.nextStart?o+=n.nextStart:o+=((new Date).getTime()-n.defaultTimeFrame)/1e3,"-local-"!==n.server&&(o+="&type=short",n.serverInfo.target&&(o+="&DBserver="+n.serverInfo.target),n.history.hasOwnProperty(n.server)||(n.history[n.server]={})),$.ajax(e+o,{async:!0,xhrFields:{withCredentials:!0},crossDomain:!0}).done(function(e){0<e.times.length&&(n.isUpdating=!0,n.mergeHistory(e)),!1!==n.isUpdating&&(t&&t(e.enabled,i),n.updateCharts())}).error(function(e){console.log("stat fetch req error:"+e)})},getHistoryStatistics:function(i){var n=this,e="statistics/long",t="?filter="+this.dygraphConfig.mapStatToFigure[i].join();"-local-"!==n.server&&(e=n.server.endpoint+arangoHelper.databaseUrl("/_admin/aardvark/statistics/cluster"),t+="&type=long&DBserver="+n.server.target,n.history.hasOwnProperty(n.server)||(n.history[n.server]={}));var o=window.location.href.split("/"),a=o[0]+"//"+o[2]+"/"+o[3]+"/_system/"+o[5]+"/"+o[6]+"/";$.ajax(a+e+t,{async:!0}).done(function(e){var t;for(n.history[n.server][i]=[],t=0;t<e.times.length;++t)n.mergeDygraphHistory(e,t,!0)})},addEmptyDataLabels:function(){0===$(".dataNotReadyYet").length&&($("#dataTransferDistribution").prepend('<p class="dataNotReadyYet"> data not ready yet </p>'),$("#totalTimeDistribution").prepend('<p class="dataNotReadyYet"> data not ready yet </p>'),$(".dashboard-bar-chart-title").append('<p class="dataNotReadyYet"> data not ready yet </p>'))},removeEmptyDataLabels:function(){$(".dataNotReadyYet").remove()},prepareResidentSize:function(e){var t=this,i=this.getCurrentSize("#residentSizeChartContainer"),n=t.history[t.server].residentSizeCurrent/1024/1024,o="";o=n<1025?l(n,2)+" MB":l(n/1024,2)+" GB";var a,r=l(100*t.history[t.server].residentSizePercent,2);t.history[t.server].physicalMemory?(this.removeEmptyDataLabels(),a=[prettyBytes(t.history[t.server].physicalMemory)],void 0!==t.history[t.server].residentSizeChart?(this.removeEmptyDataLabels(),t.reRender&&t.isVisible?(nv.addGraph(function(){return t.residentChart=nv.models.multiBarHorizontalChart().x(function(e){return e.label}).y(function(e){return e.value}).width(i.width).height(i.height).margin({top:($("residentSizeChartContainer").outerHeight()-$("residentSizeChartContainer").height())/2,right:1,bottom:($("residentSizeChartContainer").outerHeight()-$("residentSizeChartContainer").height())/2,left:1}).showValues(!1).showYAxis(!1).showXAxis(!1).showLegend(!1).showControls(!1).stacked(!0),t.residentChart.yAxis.tickFormat(function(e){return e+"%"}).showMaxMin(!1),t.residentChart.xAxis.showMaxMin(!1),d3.select("#residentSizeChart svg").datum(t.history[t.server].residentSizeChart).call(t.residentChart),d3.select("#residentSizeChart svg").select(".nv-zeroLine").remove(),e&&(d3.select("#residentSizeChart svg").select("#total").remove(),d3.select("#residentSizeChart svg").select("#percentage").remove()),d3.select(".dashboard-bar-chart-title .percentage").html(o+" ("+r+" %)"),d3.select(".dashboard-bar-chart-title .absolut").html(a[0]),nv.utils.windowResize(t.residentChart.update),t.residentChart},function(){d3.selectAll("#residentSizeChart .nv-bar").on("click",function(){})}),t.reRender=!1):t.residentChart&&t.isVisible&&(t.residentChart.width(i.width),t.residentChart.height(i.height),d3.select(".dashboard-bar-chart-title .percentage").html(o+" ("+r+" %)"),d3.select(".dashboard-bar-chart-title .absolut").html(a[0]),d3.select("#residentSizeChart svg").datum(t.history[t.server].residentSizeChart).call(t.residentChart),nv.utils.windowResize(t.residentChart.update))):this.addEmptyDataLabels()):this.addEmptyDataLabels()},prepareD3Charts:function(e){var s=this;this.d3NotInitialized&&(!1,this.d3NotInitialized=!1),_.each(Object.keys({totalTimeDistribution:["queueTimeDistributionPercent","requestTimeDistributionPercent"],dataTransferDistribution:["bytesSentDistributionPercent","bytesReceivedDistributionPercent"]}),function(o){var a=s.getCurrentSize("#"+o+"Container .dashboard-interior-chart"),r="#"+o+"Container svg";void 0===s.history[s.server].residentSizeChart?s.addEmptyDataLabels():s.removeEmptyDataLabels(),s.reRenderDistribution&&s.isVisible?($("#"+o+"Container").append('<div class="dashboard-legend-inner"><span style="color: rgb(238, 190, 77);"><div style="display: inline-block; position: relative; bottom: .5ex; padding-left: 1em; height: 1px; border-bottom: 2px solid rgb(238, 190, 77);"></div> Bytes sent</span><span style="color: rgb(142, 209, 220);"><div style="display: inline-block; position: relative; bottom: .5ex; padding-left: 1em; height: 1px; border-bottom: 2px solid rgb(142, 209, 220);"></div> Bytes received</span></div>'),nv.addGraph(function(){var e=[0,.25,.5,.75,1],t=75,i=23,n=6;return a.width<219?(e=[0,.5,1],t=72,i=21,n=5):a.width<299?(e=[0,.3334,.6667,1],t=77):a.width<379?t=87:a.width<459?t=95:a.width<539?t=100:a.width<619&&(t=105),s.distributionCharts[o]=nv.models.multiBarHorizontalChart().x(function(e){return e.label}).y(function(e){return e.value}).width(a.width).height(a.height).margin({top:5,right:20,bottom:i,left:t}).showValues(!1).showYAxis(!0).showXAxis(!0).showLegend(!1).showControls(!1).forceY([0,1]),s.distributionCharts[o].yAxis.showMaxMin(!1),d3.select(".nv-y.nv-axis").selectAll("text").attr("transform","translate (0, "+n+")"),s.distributionCharts[o].yAxis.tickValues(e).tickFormat(function(e){return l(100*e*100/100,0)+"%"}),s.history[s.server][o]?d3.select(r).datum(s.history[s.server][o]).call(s.distributionCharts[o]):d3.select(r).datum([]).call(s.distributionCharts[o]),nv.utils.windowResize(s.distributionCharts[o].update),s.distributionCharts[o]},function(){d3.selectAll(r+" .nv-bar").on("click",function(){})})):s.distributionCharts[o]&&s.isVisible&&(s.distributionCharts[o].width(a.width),s.distributionCharts[o].height(a.height),s.history[s.server][o]?d3.select(r).datum(s.history[s.server][o]).call(s.distributionCharts[o]):d3.select(r).datum([]).call(s.distributionCharts[o]),nv.utils.windowResize(s.distributionCharts[o].update))}),s.reRenderDistribution&&s.isVisible&&(s.reRenderDistribution=!1)},stopUpdating:function(){this.isUpdating=!1},startUpdating:function(){var e=this;e.timer||(e.timer=window.setInterval(function(){window.App.isCluster?-1<window.location.hash.indexOf(e.serverInfo.target)&&e.getStatistics():e.getStatistics()},e.interval))},resize:function(){if(this.isUpdating){var t,i=this;_.each(this.graphs,function(e){t=i.getCurrentSize(e.maindiv_.id),e.resize(t.width,t.height)}),this.detailGraph&&(t=this.getCurrentSize(this.detailGraph.maindiv_.id),this.detailGraph.resize(t.width,t.height)),this.prepareD3Charts(!0),this.prepareResidentSize(!0)}},template:templateEngine.createTemplate("dashboardView.ejs"),render:function(i){if(void 0===this.serverInfo&&(this.serverInfo={isDBServer:!1}),!0!==this.serverInfo.isDBServer){this.delegateEvents(this.events);var n=function(e,t){if(t||($(this.el).html(this.template.render({hideStatistics:!1})),this.getNodeInfo()),!e||"_system"!==frontendConfig.db)return $(this.el).html(""),void(this.server?$(this.el).append('<div style="color: red">Server statistics ('+this.server+") are disabled.</div>"):$(this.el).append('<div style="color: red">Server statistics are disabled.</div>'));this.prepareDygraphs(),this.isUpdating&&(this.prepareD3Charts(),this.prepareResidentSize(),this.updateTendencies(),$(window).trigger("resize")),this.startUpdating(),$(window).resize()}.bind(this),o=function(){$(this.el).html(""),$(".contentDiv").remove(),$(".headerBar").remove(),$(".dashboard-headerbar").remove(),$(".dashboard-row").remove(),$(this.el).append('<div style="color: red">You do not have permission to view this page.</div>'),$(this.el).append("<div style=\"color: red\">You can switch to '_system' to see the dashboard.</div>")}.bind(this);if("_system"!==frontendConfig.db)return void o();var e=function(e,t){e||(t?this.getStatistics(n,i):o())}.bind(this);void 0===window.App.currentDB.get("name")?window.setTimeout(function(){"_system"===window.App.currentDB.get("name")?this.options.database.hasSystemAccess(e):o()}.bind(this),300):this.options.database.hasSystemAccess(e)}else $(this.el).html(this.template.render({hideStatistics:!0})),frontendConfig.isCluster||$("#subNavigationBar .breadcrumb").html(""),this.getNodeInfo()}})}(),function(){"use strict";window.DatabaseView=Backbone.View.extend({users:null,el:"#content",readOnly:!1,template:templateEngine.createTemplate("databaseView.ejs"),dropdownVisible:!1,currentDB:"",events:{"click #createDatabase":"createDatabase","click #submitCreateDatabase":"submitCreateDatabase","click .editDatabase":"editDatabase","click #userManagementView .icon":"editDatabase","click #selectDatabase":"updateDatabase","click #submitDeleteDatabase":"submitDeleteDatabase","click .contentRowInactive a":"changeDatabase","keyup #databaseSearchInput":"search","click #databaseSearchSubmit":"search","click #databaseToggle":"toggleSettingsDropdown","click .css-label":"checkBoxes","click #dbSortDesc":"sorting"},sorting:function(){$("#dbSortDesc").is(":checked")?this.collection.setSortingDesc(!0):this.collection.setSortingDesc(!1),this.checkVisibility(),this.render()},initialize:function(){this.collection.fetch({async:!0,cache:!1})},checkBoxes:function(e){var t=e.currentTarget.id;$("#"+t).click()},setReadOnly:function(){$("#createDatabase").parent().parent().addClass("disabled")},render:function(){arangoHelper.checkDatabasePermissions(this.continueRender.bind(this),this.continueRender.bind(this))},continueRender:function(i){var n=this;i&&(this.readOnly=i);return this.collection.getCurrentDatabase(function(e,t){e?arangoHelper.arangoError("DB","Could not get current db properties"):(n.currentDB=t,n.collection.fetch({cache:!1,success:function(){n.collection.sort(),$(n.el).html(n.template.render({collection:n.collection,searchString:"",currentDB:n.currentDB,readOnly:i})),i&&n.setReadOnly(),!0===n.dropdownVisible&&($("#dbSortDesc").attr("checked",n.collection.sortOptions.desc),$("#databaseToggle").addClass("activated"),$("#databaseDropdown2").show()),arangoHelper.setCheckboxStatus("#databaseDropdown"),n.replaceSVGs()}}))}),this},checkVisibility:function(){$("#databaseDropdown").is(":visible")?this.dropdownVisible=!0:this.dropdownVisible=!1,arangoHelper.setCheckboxStatus("#databaseDropdown")},toggleSettingsDropdown:function(){var e=this;$("#dbSortDesc").attr("checked",this.collection.sortOptions.desc),$("#databaseToggle").toggleClass("activated"),$("#databaseDropdown2").slideToggle(200,function(){e.checkVisibility()})},selectedDatabase:function(){return $("#selectDatabases").val()},handleError:function(e,t,i){409!==e?400!==e?403!==e||arangoHelper.arangoError("DB","Insufficent rights. Execute this from _system database"):arangoHelper.arangoError("DB","Invalid Parameters"):arangoHelper.arangoError("DB","Database "+i+" already exists.")},validateDatabaseInfo:function(e,t){return""===t?(arangoHelper.arangoError("DB","You have to define an owner for the new database"),!1):""===e?(arangoHelper.arangoError("DB","You have to define a name for the new database"),!1):0===e.indexOf("_")?(arangoHelper.arangoError("DB ","Databasename should not start with _"),!1):!!e.match(/^[a-zA-Z][a-zA-Z0-9_-]*$/)||(arangoHelper.arangoError("DB","Databasename may only contain numbers, letters, _ and -"),!1)},createDatabase:function(e){e.preventDefault(),$("#createDatabase").parent().parent().hasClass("disabled")||this.createAddDatabaseModal()},switchDatabase:function(e){if(!$(e.target).parent().hasClass("iconSet")){var t=$(e.currentTarget).find("h5").text();if(""!==t){var i=this.collection.createDatabaseURL(t);window.location.replace(i)}}},submitCreateDatabase:function(){var i=this,n=$("#newDatabaseName").val(),e=$("#newUser").val(),t={name:n,users:[{username:e}]};this.collection.create(t,{error:function(e,t){i.handleError(t.status,t.statusText,n)},success:function(e){"#databases"===window.location.hash&&i.updateDatabases(),arangoHelper.arangoNotification("Database "+e.get("name")+" created.")}}),arangoHelper.arangoNotification("Database creation in progress."),window.modalView.hide()},submitDeleteDatabase:function(e){this.collection.where({name:e})[0].destroy({wait:!0,url:arangoHelper.databaseUrl("/_api/database/"+e)}),this.updateDatabases(),window.App.naviView.dbSelectionView.render($("#dbSelect")),window.modalView.hide()},changeDatabase:function(e){var t=$(e.currentTarget).attr("id"),i=this.collection.createDatabaseURL(t);window.location.replace(i)},updateDatabases:function(){var e=this;this.collection.fetch({cache:!1,success:function(){e.render(),window.App.handleSelectDatabase()}})},editDatabase:function(e){var t=this.evaluateDatabaseName($(e.currentTarget).attr("id"),"_edit-database"),i=!0;t===this.currentDB&&(i=!1),this.createEditDatabaseModal(t,i)},search:function(){var e,t,i,n;e=$("#databaseSearchInput"),t=$("#databaseSearchInput").val(),n=this.collection.filter(function(e){return-1!==e.get("name").indexOf(t)}),$(this.el).html(this.template.render({collection:n,searchString:t,currentDB:this.currentDB,readOnly:this.readOnly})),this.replaceSVGs(),i=(e=$("#databaseSearchInput")).val().length,e.focus(),e[0].setSelectionRange(i,i)},replaceSVGs:function(){$(".svgToReplace").each(function(){var i=$(this),n=i.attr("id"),e=i.attr("src");$.get(e,function(e){var t=$(e).find("svg");t.attr("id",n).attr("class","tile-icon-svg").removeAttr("xmlns:a"),i.replaceWith(t)},"xml")})},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},evaluateDatabaseName:function(e,t){var i=e.lastIndexOf(t);return e.substring(0,i)},createEditDatabaseModal:function(e,t){var i=[],n=[];n.push(window.modalView.createReadOnlyEntry("id_name","Name",e,"")),t?i.push(window.modalView.createDeleteButton("Delete",this.submitDeleteDatabase.bind(this,e))):i.push(window.modalView.createDisabledButton("Delete")),window.modalView.show("modalTable.ejs","Delete database",i,n)},createAddDatabaseModal:function(){var e=[],t=[];t.push(window.modalView.createTextEntry("newDatabaseName","Name","",!1,"Database Name",!0,[{rule:Joi.string().regex(/^[a-zA-Z]/),msg:"Database name must start with a letter."},{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only Symbols "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No database name given."}]));var i=[];window.App.userCollection.each(function(e){i.push({value:e.get("user"),label:e.get("user")})}),t.push(window.modalView.createSelectEntry("newUser","Username",null!==this.users?this.users.whoAmI():"root","Please define the owner of this database. This will be the only user having initial access to this database if authentication is turned on. Please note that if you specify a username different to your account you will not be able to access the database with your account after having creating it. Specifying a username is mandatory even with authentication turned off. If there is a failure you will be informed.",i)),e.push(window.modalView.createSuccessButton("Create",this.submitCreateDatabase.bind(this))),window.modalView.show("modalTable.ejs","Create Database",e,t),$("#useDefaultPassword").change(function(){"true"===$("#useDefaultPassword").val()?$("#row_newPassword").hide():$("#row_newPassword").show()}),$("#row_newPassword").hide()}})}(),function(){"use strict";window.DBSelectionView=Backbone.View.extend({template:templateEngine.createTemplate("dbSelectionView.ejs"),events:{"click .dbSelectionLink":"changeDatabase"},initialize:function(e){this.current=e.current},changeDatabase:function(e){var t=$(e.currentTarget).closest(".dbSelectionLink.tab").attr("id"),i=this.collection.createDatabaseURL(t);window.location.replace(i)},render:function(i){var e=function(e,t){e?arangoHelper.arangoError("DB","Could not fetch databases"):(this.$el=i,this.$el.html(this.template.render({list:t,current:this.current.get("name")})),this.delegateEvents())}.bind(this);return this.collection.getDatabasesForUser(e),this.el}})}(),function(){"use strict";window.DocumentsView=window.PaginationView.extend({filters:{0:!0},filterId:0,paginationDiv:"#documentsToolbarF",idPrefix:"documents",addDocumentSwitch:!0,activeFilter:!1,lastCollectionName:void 0,restoredFilters:[],editMode:!1,allowUpload:!1,el:"#content",table:"#documentsTableID",template:templateEngine.createTemplate("documentsView.ejs"),collectionContext:{prev:null,next:null},unbindEvents:function(){this.$el.empty().off(),this.stopListening(),this.unbind()},editButtons:["#deleteSelected","#moveSelected"],initialize:function(e){this.documentStore=e.documentStore,this.collectionsStore=e.collectionsStore,this.tableView=new window.TableView({el:this.table,collection:this.collection}),this.tableView.setRowClick(this.clicked.bind(this)),this.tableView.setRemoveClick(this.remove.bind(this))},resize:function(){var t=!1;_.each($(".documentsDropdown").first().children(),function(e){$(e).is(":visible")&&(t=!0)}),t?$("#docPureTable").height($(".centralRow").height()-210-57):$("#docPureTable").height($(".centralRow").height()-210),$("#docPureTable .pure-table-body").css("max-height",$("#docPureTable").height()-47)},setCollectionId:function(n,e){var o=this;this.collection.setCollection(n,e),this.collection.setPage(e),this.page=e;var t=function(e,t,i){e?o.renderNotFound(this.collection.collectionID):(this.type=t,this.collectionName=i?i.name:n,0===o.restoredFilters.length&&(this.collection.getDocuments(this.getDocsCallback.bind(this)),this.collectionModel=this.collectionsStore.get(n),this.renderPaginationElements()),this.breadcrumb())}.bind(this);arangoHelper.collectionApiType(n,null,t)},getDocsCallback:function(e){$("#documents_last").css("visibility","hidden"),$("#documents_first").css("visibility","hidden"),e?(window.progressView.hide(),arangoHelper.arangoError("Document error","Could not fetch requested documents.")):e&&void 0===e||(window.progressView.hide(),this.drawTable(),this.renderPaginationElements(),arangoHelper.checkCollectionPermissions(this.collection.collectionID,this.changeViewToReadOnly))},renderNotFound:function(e){$(".headerButton").remove(),$("#documentSize").hide(),$("#docPureTable").html('<div class="infoBox errorBox"><h4>Error</h4><p>Collection not found. Requested name was: "'+e+'".</p></div>'),$("#subNavigationBar .breadcrumb").html()},events:{"click #collectionPrev":"prevCollection","click #collectionNext":"nextCollection","click #filterCollection":"filterCollection","click #markDocuments":"editDocuments","click #importCollection":"importCollection","click #exportCollection":"exportCollection","click #filterSend":"sendFilter","click #addFilterItem":"addFilterItem","click .removeFilterItem":"removeFilterItem","click #deleteSelected":"deleteSelectedDocs","click #moveSelected":"moveSelectedDocs","click #addDocumentButton":"addDocumentModal","click #documents_first":"firstDocuments","click #documents_last":"lastDocuments","click #documents_prev":"prevDocuments","click #documents_next":"nextDocuments","click #confirmDeleteBtn":"confirmDelete","click .key":"nop",keyup:"returnPressedHandler","keydown .queryline input":"filterValueKeydown","click #importModal":"showImportModal","click #resetView":"resetView","click #confirmDocImport":"startUpload","click #exportDocuments":"startDownload","change #documentSize":"setPagesize","change #docsSort":"setSorting"},showSpinner:function(){$(".upload-indicator").show()},hideSpinner:function(){$(".upload-indicator").hide()},showImportModal:function(){$("#docImportModal").modal("show")},hideImportModal:function(){$("#docImportModal").modal("hide")},setPagesize:function(){var e=$("#documentSize").find(":selected").val();this.collection.setPagesize(e),this.collection.getDocuments(this.getDocsCallback.bind(this))},setSorting:function(){var e=$("#docsSort").val();""!==e&&null!=e||(e="_key"),this.collection.setSort(e)},returnPressedHandler:function(e){13===e.keyCode&&$(e.target).is($("#docsSort"))&&this.collection.getDocuments(this.getDocsCallback.bind(this)),13===e.keyCode&&!1===$("#confirmDeleteBtn").attr("disabled")&&this.confirmDelete()},nop:function(e){e.stopPropagation()},resetView:function(){$("input").val(""),$("select").val("=="),this.removeAllFilterItems(),$("#documentSize").val(this.collection.getPageSize()),$("#documents_last").css("visibility","visible"),$("#documents_first").css("visibility","visible"),this.addDocumentSwitch=!0,this.collection.resetFilter(),this.collection.loadTotal(function(e){e&&arangoHelper.arangoError("Document","Could not fetch documents count")}),this.restoredFilters=[],this.allowUpload=!1,this.files=void 0,this.file=void 0,$("#confirmDocImport").attr("disabled",!0),this.markFilterToggle(),this.collection.getDocuments(this.getDocsCallback.bind(this))},startDownload:function(){var e=this.collection.buildDownloadDocumentQuery();if(""!==e||void 0!==e||null!==e){var t="query/result/download/"+btoa(JSON.stringify(e));arangoHelper.download(t)}else arangoHelper.arangoError("Document error","could not download documents")},startUpload:function(){var e=function(e,t){e?arangoHelper.arangoError("Upload",t):(this.hideImportModal(),this.resetView()),this.hideSpinner()}.bind(this);!0===this.allowUpload&&(this.showSpinner(),this.collection.uploadDocuments(this.file,e))},uploadSetup:function(){var t=this;$("#importDocuments").change(function(e){t.files=e.target.files||e.dataTransfer.files,t.file=t.files[0],$("#confirmDocImport").attr("disabled",!1),t.allowUpload=!0})},buildCollectionLink:function(e){return"collection/"+encodeURIComponent(e.get("name"))+"/documents/1"},markFilterToggle:function(){0<this.restoredFilters.length?$("#filterCollection").addClass("activated"):$("#filterCollection").removeClass("activated")},editDocuments:function(e){if(!$(e.currentTarget).hasClass("disabled")){$("#importCollection").removeClass("activated"),$("#exportCollection").removeClass("activated"),this.markFilterToggle(),$("#markDocuments").toggleClass("activated"),this.changeEditMode(),$("#filterHeader").hide(),$("#importHeader").hide(),$("#editHeader").slideToggle(1),$("#exportHeader").hide();var t=this;window.setTimeout(function(){t.resize()},50)}},filterCollection:function(){$("#importCollection").removeClass("activated"),$("#exportCollection").removeClass("activated"),$("#markDocuments").removeClass("activated"),this.changeEditMode(!1),this.markFilterToggle(),this.activeFilter=!0,$("#importHeader").hide(),$("#editHeader").hide(),$("#exportHeader").hide(),$("#filterHeader").slideToggle(1);var e,t=this;for(e in window.setTimeout(function(){t.resize()},50),this.filters)if(this.filters.hasOwnProperty(e))return void $("#attribute_name"+e).focus()},exportCollection:function(){$("#importCollection").removeClass("activated"),$("#filterHeader").removeClass("activated"),$("#markDocuments").removeClass("activated"),this.changeEditMode(!1),$("#exportCollection").toggleClass("activated"),this.markFilterToggle(),$("#exportHeader").slideToggle(1),$("#importHeader").hide(),$("#filterHeader").hide(),$("#editHeader").hide();var e=this;window.setTimeout(function(){e.resize()},50)},importCollection:function(e){if(!$(e.currentTarget).hasClass("disabled")){this.markFilterToggle(),$("#markDocuments").removeClass("activated"),this.changeEditMode(!1),$("#importCollection").toggleClass("activated"),$("#exportCollection").removeClass("activated"),$("#importHeader").slideToggle(1),$("#filterHeader").hide(),$("#editHeader").hide(),$("#exportHeader").hide();var t=this;window.setTimeout(function(){t.resize()},50)}},changeEditMode:function(e){!1===e||!0===this.editMode?($("#docPureTable .pure-table-body .pure-table-row").css("cursor","default"),$(".deleteButton").fadeIn(),$(".addButton").fadeIn(),$(".selected-row").removeClass("selected-row"),this.editMode=!1,this.tableView.setRowClick(this.clicked.bind(this))):($("#docPureTable .pure-table-body .pure-table-row").css("cursor","copy"),$(".deleteButton").fadeOut(),$(".addButton").fadeOut(),$(".selectedCount").text(0),this.editMode=!0,this.tableView.setRowClick(this.editModeClick.bind(this)))},getFilterContent:function(){var e,t,i=[];for(e in this.filters)if(this.filters.hasOwnProperty(e)){t=$("#attribute_value"+e).val();try{t=JSON.parse(t)}catch(e){t=String(t)}""!==$("#attribute_name"+e).val()&&void 0!==$("#operator"+e).val()&&i.push({attribute:$("#attribute_name"+e).val(),operator:$("#operator"+e).val(),value:t})}return i},sendFilter:function(){this.restoredFilters=this.getFilterContent();var t=this;this.collection.resetFilter(),this.addDocumentSwitch=!1,_.each(this.restoredFilters,function(e){void 0!==e.operator&&t.collection.addFilter(e.attribute,e.operator,e.value)}),this.collection.setToFirst(),this.collection.getDocuments(this.getDocsCallback.bind(this)),this.markFilterToggle()},restoreFilter:function(){var t=this,i=0;this.filterId=0,$("#docsSort").val(this.collection.getSort()),_.each(this.restoredFilters,function(e){0!==i&&t.addFilterItem(),void 0!==e.operator&&($("#attribute_name"+i).val(e.attribute),$("#operator"+i).val(e.operator),$("#attribute_value"+i).val(e.value)),i++,t.collection.addFilter(e.attribute,e.operator,e.value)}),t.rerender()},addFilterItem:function(){var e=++this.filterId;$("#filterHeader").append(' <div class="queryline querylineAdd"><input id="attribute_name'+e+'" type="text" placeholder="Attribute name"><select name="operator" id="operator'+e+'" class="filterSelect">    <option value="==">==</option>    <option value="!=">!=</option>    <option value="&lt;">&lt;</option>    <option value="&lt;=">&lt;=</option>    <option value="&gt;">&gt;</option>    <option value="&gt;=">&gt;=</option>    <option value="LIKE">LIKE</option>    <option value="IN">IN</option>    <option value="=~">NOT IN</option>    <option value="REGEX">REGEX</option></select><input id="attribute_value'+e+'" type="text" placeholder="Attribute value" class="filterValue"> <a class="removeFilterItem" id="removeFilter'+e+'"><i class="fa fa-minus-circle"></i></a></div>'),this.filters[e]=!0,this.checkFilterState()},filterValueKeydown:function(e){13===e.keyCode&&this.sendFilter()},checkFilterState:function(){if(1===$("#filterHeader .queryline").length)$("#filterHeader .removeFilterItem").remove();else if(0===$("#filterHeader .queryline").first().find(".removeFilterItem").length){var e=$("#filterHeader .queryline").first().children().first().attr("id"),t=e.substr(14,e.length);$("#filterHeader .queryline").first().find(".add-filter-item").after(' <a class="removeFilterItem" id="removeFilter'+t+'"><i class="fa fa-minus-circle"></i></a>')}0===$("#filterHeader .queryline").first().find(".add-filter-item").length&&$("#filterHeader .queryline").first().find(".filterValue").after('<a id="addFilterItem" class="add-filter-item"><i style="margin-left: 4px;" class="fa fa-plus-circle"></i></a>')},removeFilterItem:function(e){var t=e.currentTarget,i=t.id.replace(/^removeFilter/,"");delete this.filters[i],delete this.restoredFilters[i],$(t.parentElement).remove(),this.checkFilterState()},removeAllFilterItems:function(){var e,t=$("#filterHeader").children().length;for(e=1;e<=t;e++)$("#removeFilter"+e).parent().remove();this.filters={0:!0},this.filterId=0},addDocumentModal:function(e){if(!$(e.currentTarget).hasClass("disabled")){var t=window.location.hash.split("/")[1],i=[],n=[],o=function(e,t){e?arangoHelper.arangoError("Error","Could not fetch collection type"):"edge"===t?(n.push(window.modalView.createTextEntry("new-edge-from-attr","_from","","document _id: document handle of the linked vertex (incoming relation)",void 0,!1,[{rule:Joi.string().required(),msg:"No _from attribute given."}])),n.push(window.modalView.createTextEntry("new-edge-to","_to","","document _id: document handle of the linked vertex (outgoing relation)",void 0,!1,[{rule:Joi.string().required(),msg:"No _to attribute given."}])),n.push(window.modalView.createTextEntry("new-edge-key-attr","_key",void 0,"the edges unique key(optional attribute, leave empty for autogenerated key","is optional: leave empty for autogenerated key",!1,[{rule:Joi.string().allow("").optional(),msg:""}])),i.push(window.modalView.createSuccessButton("Create",this.addEdge.bind(this))),window.modalView.show("modalTable.ejs","Create edge",i,n)):(n.push(window.modalView.createTextEntry("new-document-key-attr","_key",void 0,"the documents unique key(optional attribute, leave empty for autogenerated key","is optional: leave empty for autogenerated key",!1,[{rule:Joi.string().allow("").optional(),msg:""}])),i.push(window.modalView.createSuccessButton("Create",this.addDocument.bind(this))),window.modalView.show("modalTable.ejs","Create document",i,n))}.bind(this);arangoHelper.collectionApiType(t,!0,o)}},addEdge:function(){var n,e=window.location.hash.split("/")[1],t=$(".modal-body #new-edge-from-attr").last().val(),i=$(".modal-body #new-edge-to").last().val(),o=$(".modal-body #new-edge-key-attr").last().val(),a=function(e,t,i){if(e)arangoHelper.arangoError("Error",i.errorMessage);else{window.modalView.hide(),t=t._id.split("/");try{n="collection/"+t[0]+"/"+t[1],decodeURI(n)}catch(e){n="collection/"+t[0]+"/"+encodeURIComponent(t[1])}window.location.hash=n}};""!==o||void 0!==o?this.documentStore.createTypeEdge(e,t,i,o,a):this.documentStore.createTypeEdge(e,t,i,null,a)},addDocument:function(){var n,e=window.location.hash.split("/")[1],t=$(".modal-body #new-document-key-attr").last().val(),i=function(e,t,i){if(e)arangoHelper.arangoError("Error",i.errorMessage);else{window.modalView.hide(),t=t.split("/");try{n="collection/"+t[0]+"/"+t[1],decodeURI(n)}catch(e){n="collection/"+t[0]+"/"+encodeURIComponent(t[1])}window.location.hash=n}};""!==t||void 0!==t?this.documentStore.createTypeDocument(e,t,i):this.documentStore.createTypeDocument(e,null,i)},moveSelectedDocs:function(){var e=[],t=[];0!==this.getSelectedDocs().length?(t.push(window.modalView.createTextEntry("move-documents-to","Move to","",!1,"collection-name",!0,[{rule:Joi.string().regex(/^[a-zA-Z]/),msg:"Collection name must always start with a letter."},{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only Symbols "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No collection name given."}])),e.push(window.modalView.createSuccessButton("Move",this.confirmMoveSelectedDocs.bind(this))),window.modalView.show("modalTable.ejs","Move documents",e,t)):arangoHelper.arangoMessage("Move documents","No documents selected!")},confirmMoveSelectedDocs:function(){var e=this.getSelectedDocs(),t=this,i=$("#move-documents-to").val(),n=function(e){e?arangoHelper.arangoError("Error","Could not move document."):(t.collection.setTotalMinusOne(),this.collection.getDocuments(this.getDocsCallback.bind(this)),$("#markDocuments").click(),window.modalView.hide())}.bind(this);_.each(e,function(e){t.collection.moveDocument(e,t.collection.collectionID,i,n)})},deleteSelectedDocs:function(){var e=[],t=[],i=this.getSelectedDocs();0!==i.length?(t.push(window.modalView.createReadOnlyEntry(void 0,i.length+" documents selected","Do you want to delete all selected documents?",void 0,void 0,!1,void 0)),e.push(window.modalView.createDeleteButton("Delete",this.confirmDeleteSelectedDocs.bind(this))),window.modalView.show("modalTable.ejs","Delete documents",e,t)):arangoHelper.arangoMessage("Delete documents","No documents selected!")},confirmDeleteSelectedDocs:function(){var e=this.getSelectedDocs(),n=[],o=this;_.each(e,function(e){if("document"===o.type){var t=function(e){e?(n.push(!1),arangoHelper.arangoError("Document error","Could not delete document.")):(n.push(!0),o.collection.setTotalMinusOne(),o.collection.getDocuments(this.getDocsCallback.bind(this)),$("#markDocuments").click(),window.modalView.hide())}.bind(o);o.documentStore.deleteDocument(o.collection.collectionID,e,t)}else if("edge"===o.type){var i=function(e){e?(n.push(!1),arangoHelper.arangoError("Edge error","Could not delete edge")):(o.collection.setTotalMinusOne(),n.push(!0),o.collection.getDocuments(this.getDocsCallback.bind(this)),$("#markDocuments").click(),window.modalView.hide())}.bind(o);o.documentStore.deleteEdge(o.collection.collectionID,e,i)}})},getSelectedDocs:function(){var t=[];return _.each($("#docPureTable .pure-table-body .pure-table-row"),function(e){$(e).hasClass("selected-row")&&t.push($($(e).children()[1]).find(".key").text())}),t},remove:function(e){$(e.currentTarget).hasClass("disabled")||(this.docid=$(e.currentTarget).parent().parent().prev().find(".key").text(),$("#confirmDeleteBtn").attr("disabled",!1),$("#docDeleteModal").modal("show"))},confirmDelete:function(){$("#confirmDeleteBtn").attr("disabled",!0),"source"!==window.location.hash.split("/")[3]&&this.reallyDelete()},reallyDelete:function(){if("document"===this.type){var e=function(e){e?arangoHelper.arangoError("Error","Could not delete document"):(this.collection.setTotalMinusOne(),this.collection.getDocuments(this.getDocsCallback.bind(this)),$("#docDeleteModal").modal("hide"))}.bind(this);this.documentStore.deleteDocument(this.collection.collectionID,this.docid,e)}else if("edge"===this.type){var t=function(e){e?arangoHelper.arangoError("Edge error","Could not delete edge"):(this.collection.setTotalMinusOne(),this.collection.getDocuments(this.getDocsCallback.bind(this)),$("#docDeleteModal").modal("hide"))}.bind(this);this.documentStore.deleteEdge(this.collection.collectionID,this.docid,t)}},editModeClick:function(e){var t=$(e.currentTarget);t.hasClass("selected-row")?t.removeClass("selected-row"):t.addClass("selected-row");var i=this.getSelectedDocs();$(".selectedCount").text(i.length),_.each(this.editButtons,function(e){0<i.length?($(e).prop("disabled",!1),$(e).removeClass("button-neutral"),$(e).removeClass("disabled"),"#moveSelected"===e?$(e).addClass("button-success"):$(e).addClass("button-danger")):($(e).prop("disabled",!0),$(e).addClass("disabled"),$(e).addClass("button-neutral"),"#moveSelected"===e?$(e).removeClass("button-success"):$(e).removeClass("button-danger"))})},clicked:function(e){var t,i=e.currentTarget,n=$(i).attr("id").substr(4);try{t="collection/"+this.collection.collectionID+"/"+n,decodeURI(n)}catch(e){t="collection/"+this.collection.collectionID+"/"+encodeURIComponent(n)}window.location.hash=t},drawTable:function(){this.tableView.setElement($("#docPureTable")).render(),arangoHelper.fixTooltips(".icon_arangodb, .arangoicon","top"),$(".prettify").snippet("javascript",{style:"nedit",menu:!1,startText:!1,transparent:!0,showNum:!1}),this.resize()},checkCollectionState:function(){this.lastCollectionName===this.collectionName?this.activeFilter&&(this.filterCollection(),this.restoreFilter()):void 0!==this.lastCollectionName&&(this.collection.resetFilter(),this.collection.setSort(""),this.restoredFilters=[],this.activeFilter=!1)},render:function(){return this.collectionName=window.location.hash.split("/")[1],$(this.el).html(this.template.render({})),2===this.type?this.type="document":3===this.type&&(this.type="edge"),this.tableView.setElement($(this.table)).drawLoading(),this.collectionContext=this.collectionsStore.getPosition(this.collection.collectionID),this.checkCollectionState(),this.lastCollectionName=this.collectionName,this.uploadSetup(),arangoHelper.fixTooltips([".icon_arangodb",".arangoicon","top","[data-toggle=tooltip]",".upload-info"]),this.selectActivePagesize(),this.markFilterToggle(),this.resize(),this},changeViewToReadOnly:function(){$(".breadcrumb").html($(".breadcrumb").html()+" (read-only)"),$("#importCollection").addClass("disabled"),$("#markDocuments").addClass("disabled"),$("#addDocumentButton").addClass("disabled"),$("#addDocumentButton .fa-plus-circle").css("color","#d3d3d3"),$("#addDocumentButton .fa-plus-circle").css("cursor","not-allowed"),$(".deleteButton").addClass("disabled"),$(".deleteButton .fa-minus-circle").css("color","#d3d3d3"),$(".deleteButton .fa-minus-circle").css("cursor","not-allowed")},rerender:function(){this.collection.getDocuments(this.getDocsCallback.bind(this)),this.resize()},selectActivePagesize:function(){$("#documentSize").val(this.collection.getPageSize())},renderPaginationElements:function(){this.renderPagination();var e=$("#totalDocuments");0===e.length&&($("#documentsToolbarFL").append('<a id="totalDocuments" class="totalDocuments"></a>'),e=$("#totalDocuments")),"document"===this.type&&e.html(numeral(this.collection.getTotal()).format("0,0")+" doc(s)"),"edge"===this.type&&e.html(numeral(this.collection.getTotal()).format("0,0")+" edge(s)"),this.collection.getTotal()>this.collection.MAX_SORT?($("#docsSort").attr("disabled",!0),$("#docsSort").attr("placeholder","Sort limit reached (docs count)")):($("#docsSort").attr("disabled",!1),$("#docsSort").attr("placeholder","Sort by attribute"))},breadcrumb:function(){var e=this;window.App.naviView&&void 0!==$("#subNavigationBar .breadcrumb").html()?($("#subNavigationBar .breadcrumb").html("Collection: "+this.collectionName),window.arangoHelper.buildCollectionSubNav(this.collectionName,"Content")):window.setTimeout(function(){e.breadcrumb()},100)}})}(),function(){"use strict";var l=function(e){var t=e.split("/");return"collection/"+encodeURIComponent(t[0])+"/"+encodeURIComponent(t[1])};window.DocumentView=Backbone.View.extend({el:"#content",readOnly:!1,colid:0,docid:0,customView:!1,defaultMode:"tree",template:templateEngine.createTemplate("documentView.ejs"),events:{"click #saveDocumentButton":"saveDocument","click #deleteDocumentButton":"deleteDocumentModal","click #confirmDeleteDocument":"deleteDocument","click #document-from":"navigateToDocument","click #document-to":"navigateToDocument","keydown #documentEditor .ace_editor":"keyPress","keyup .jsoneditor .search input":"checkSearchBox","click #addDocument":"addDocument"},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},checkSearchBox:function(e){""===$(e.currentTarget).val()&&this.editor.expandAll()},initialize:function(){var e=localStorage.getItem("JSONEditorMode");e&&(this.defaultMode=e)},addDocument:function(e){this.readOnly||window.App.documentsView.addDocumentModal(e)},storeMode:function(e){localStorage.setItem("JSONEditorMode",e),this.defaultMode=e,this.editor.setMode(this.defaultMode)},keyPress:function(e){e.ctrlKey&&13===e.keyCode?(e.preventDefault(),this.saveDocument()):e.metaKey&&13===e.keyCode&&(e.preventDefault(),this.saveDocument())},editor:0,setType:function(){var n=this,e=function(e,t,i){e?(arangoHelper.arangoError("Error","Document not found."),n.renderNotFound(i)):(this.type=i,this.breadcrumb(),this.fillInfo(),this.fillEditor(),arangoHelper.checkCollectionPermissions(this.colid,this.changeViewToReadOnly.bind(this)))}.bind(this);this.collection.getDocument(this.colid,this.docid,e)},renderNotFound:function(e){$(".document-info-div").remove(),$(".headerButton").remove(),$(".document-content-div").html('<div class="infoBox errorBox"><h4>Error</h4><p>Document not found. Requested ID was: "'+e+'".</p></div>')},deleteDocumentModal:function(){if(!this.readOnly){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry("doc-delete-button","Confirm delete, document id is",this.type._id||this.docid,void 0,void 0,!1,/[<>&'"]/)),e.push(window.modalView.createDeleteButton("Delete",this.deleteDocument.bind(this))),window.modalView.show("modalTable.ejs","Delete Document",e,t)}},deleteDocument:function(){var t=function(){if(this.customView)this.customDeleteFunction&&this.customDeleteFunction();else{var e="collection/"+encodeURIComponent(this.colid)+"/documents/1";window.modalView.hide(),window.App.navigate(e,{trigger:!0})}}.bind(this);if(this.type._from&&this.type._to){this.collection.deleteEdge(this.colid,this.docid,function(e){e?arangoHelper.arangoError("Edge error","Could not delete edge"):t()})}else{this.collection.deleteDocument(this.colid,this.docid,function(e){e?arangoHelper.arangoError("Error","Could not delete document"):t()})}},navigateToDocument:function(e){var t=$(e.target).attr("documentLink"),i=(t.split("%").length-1)%3;decodeURIComponent(t)!==t&&0!==i&&(t=decodeURIComponent(t)),t&&window.App.navigate(t,{trigger:!0})},fillInfo:function(){var e=this.collection.first(),t=e.get("_id"),i=e.get("_key"),n=e.get("_rev"),o=e.get("_from"),a=e.get("_to");if($("#document-type").css("margin-left","10px"),$("#document-type").text("_id:"),$("#document-id").css("margin-left","0"),$("#document-id").text(t),$("#document-key").text(i),$("#document-rev").text(n),o&&a){var r=l(o),s=l(a);$("#document-from").text(o),$("#document-from").attr("documentLink",r),$("#document-to").text(a),$("#document-to").attr("documentLink",s)}else $(".edge-info-container").hide()},fillEditor:function(){var e=this.removeReadonlyKeys(this.collection.first().attributes);$(".disabledBread").last().text(this.collection.first().get("_key")),this.editor.set(e),$(".ace_content").attr("font-size","11pt")},jsonContentChanged:function(){this.enableSaveButton()},resize:function(){$("#documentEditor").height($(".centralRow").height()-300)},render:function(){$(this.el).html(this.template.render({})),$("#documentEditor").height($(".centralRow").height()-300),this.disableSaveButton();var t=this,e=document.getElementById("documentEditor"),i={onChange:function(){t.jsonContentChanged()},onModeChange:function(e){t.storeMode(e)},search:!0,mode:"tree",modes:["tree","code"],ace:window.ace};this.editor=new JSONEditor(e,i);var n=localStorage.getItem("JSONEditorMode");return"code"!==n&&"tree"!==n||(this.defaultMode=n),this.defaultMode&&this.editor.setMode(this.defaultMode),this},changeViewToReadOnly:function(){this.readOnly=!0,$(".breadcrumb").find("a").html($(".breadcrumb").find("a").html()+" (read-only)"),this.editor.setMode("view"),$(".jsoneditor-modes").hide(),$(".bottomButtonBar button").addClass("disabled"),$(".bottomButtonBar button").unbind("click"),$("#addDocument").addClass("disabled")},cleanupEditor:function(){this.editor&&this.editor.destroy()},removeReadonlyKeys:function(e){return _.omit(e,["_key","_id","_from","_to","_rev"])},saveDocument:function(){if(void 0===$("#saveDocumentButton").attr("disabled"))if("_"===this.collection.first().attributes._id.substr(0,1)){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry("doc-save-system-button","Caution","You are modifying a system collection. Really continue?",void 0,void 0,!1,/[<>&'"]/)),e.push(window.modalView.createSuccessButton("Save",this.confirmSaveDocument.bind(this))),window.modalView.show("modalTable.ejs","Modify System Collection",e,t)}else this.confirmSaveDocument()},confirmSaveDocument:function(){var e,i=this;window.modalView.hide();try{e=this.editor.get()}catch(e){return this.errorConfirmation(e),void this.disableSaveButton()}if(e=JSON.stringify(e),"edge"===this.type||this.type._from){var t=function(e,t){e?arangoHelper.arangoError("Error",t.responseJSON.errorMessage):(this.successConfirmation(),this.disableSaveButton(),i.customView&&i.customSaveFunction&&i.customSaveFunction(t))}.bind(this);this.collection.saveEdge(this.colid,this.docid,$("#document-from").html(),$("#document-to").html(),e,t)}else{var n=function(e,t){e||t[0]&&t[0].error?t[0]&&t[0].error?arangoHelper.arangoError("Error",t[0].errorMessage):arangoHelper.arangoError("Error",t.responseJSON.errorMessage):(this.successConfirmation(),this.disableSaveButton(),i.customView&&i.customSaveFunction&&i.customSaveFunction(t))}.bind(this);this.collection.saveDocument(this.colid,this.docid,e,n)}},successConfirmation:function(){arangoHelper.arangoNotification("Document saved.")},errorConfirmation:function(e){arangoHelper.arangoError("Document editor: ",e)},enableSaveButton:function(){$("#saveDocumentButton").prop("disabled",!1),$("#saveDocumentButton").addClass("button-success"),$("#saveDocumentButton").removeClass("button-close")},disableSaveButton:function(){$("#saveDocumentButton").prop("disabled",!0),$("#saveDocumentButton").addClass("button-close"),$("#saveDocumentButton").removeClass("button-success")},breadcrumb:function(){var e=window.location.hash.split("/");$("#subNavigationBar .breadcrumb").html('<a href="#collection/'+e[1]+'/documents/1">Collection: '+e[1]+'</a><i class="fa fa-chevron-right"></i>'+this.type.charAt(0).toUpperCase()+this.type.slice(1)+": "+e[2])},escaped:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}})}(),function(){"use strict";window.FilterSelectView=Backbone.View.extend({el:"#filterSelectDiv",filterOptionsEl:".filterOptions",initialize:function(e){this.name=e.name,this.options=e.options,this.position=e.position,this.callback=e.callback,this.multiple=e.multiple},template:templateEngine.createTemplate("filterSelect.ejs"),events:{"click .filterOptions .inactive":"changeState","click .filterOptions .active":"changeState","click #showAll":"showAll","click #closeFilter":"hide","keyup .filterInput input":"filter"},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},changeState:function(e){var t=$(e.currentTarget).attr("name");$(e.currentTarget).hasClass("active")?(this.options[t].active=!1,$(e.currentTarget).removeClass("active").addClass("inactive"),$(e.currentTarget).find(".marked").css("visibility","hidden")):(this.options[t].active=!0,$(e.currentTarget).removeClass("inactive").addClass("active"),$(e.currentTarget).find(".marked").css("visibility","visible")),this.callback&&this.callback(this.options)},filter:function(){var t=$("#"+this.name+"-filter").val();_.each(this.options,function(e){-1<e.name.search(t)?$("#"+e.name+"-option").css("display","block"):$("#"+e.name+"-option").css("display","none")})},clearFilter:function(){$("#"+this.name+"-filter").val(""),this.filter()},showAll:function(){this.clearFilter(),_.each(this.options,function(e){e.active=!1,$("#"+e.name+"-option").removeClass("active").addClass("inactive"),$("#"+e.name+"-option").find(".marked").css("visibility","hidden")}),this.callback(this.options)},render:function(){var t=this;$("#filterSelectDiv").on("click",function(e){"filterSelectDiv"===e.target.id&&t.hide()}),_.each(t.options,function(e){e.color||(e.color=arangoHelper.alphabetColors[e.name.charAt(0).toLowerCase()])}),this.$el.html(this.template.render({name:t.name,options:t.options})),$("#filterSelectDiv > div").css("right",this.position.right+"px"),$("#filterSelectDiv > div").css("top",this.position.top+30),this.show(),$("#"+this.name+"-filter").focus()},show:function(){$(this.el).show()},hide:function(){$("#filterSelectDiv").unbind("click"),$(this.el).hide(),this.remove()}})}(),function(){"use strict";window.FooterView=Backbone.View.extend({el:"#footerBar",system:{},isOffline:!0,isOfflineCounter:0,firstLogin:!0,timer:15e3,lap:0,timerFunction:null,events:{"click .footer-center p":"showShortcutModal"},initialize:function(){var e=this;window.setInterval(function(){e.getVersion()},e.timer),e.getVersion(),window.VISIBLE=!0,document.addEventListener("visibilitychange",function(){window.VISIBLE=!window.VISIBLE}),$("#offlinePlaceholder button").on("click",function(){e.getVersion()}),window.setTimeout(function(){!0===window.frontendConfig.isCluster&&($(".health-state").css("cursor","pointer"),$(".health-state").on("click",function(){window.App.navigate("#nodes",{trigger:!0})}))},1e3)},template:templateEngine.createTemplate("footerView.ejs"),showServerStatus:function(e){window.App.isCluster?this.renderClusterState(e):!0===e?($("#healthStatus").removeClass("negative"),$("#healthStatus").addClass("positive"),$(".health-state").html("GOOD"),$(".health-icon").html('<i class="fa fa-check-circle"></i>'),$("#offlinePlaceholder").hide()):($("#healthStatus").removeClass("positive"),$("#healthStatus").addClass("negative"),$(".health-state").html("UNKNOWN"),$(".health-icon").html('<i class="fa fa-exclamation-circle"></i>'),window.modalView.hide(),$("#offlinePlaceholder").show(),$.noty.clearQueue(),$.noty.closeAll(),this.reconnectAnimation(0))},reconnectAnimation:function(e){var t=this;0===e&&(t.lap=e,$("#offlineSeconds").text(t.timer/1e3),clearTimeout(t.timerFunction)),t.lap<this.timer/1e3&&(t.lap++,$("#offlineSeconds").text(t.timer/1e3-t.lap),t.timerFunction=window.setTimeout(function(){t.timer/1e3-t.lap==0?t.getVersion():t.reconnectAnimation(t.lap)},1e3))},renderClusterState:function(e){if(e){$("#offlinePlaceholder").hide();$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/health"),contentType:"application/json",processData:!1,async:!0,success:function(e){!function(e){window.clusterHealth=e.Health;var t=0;0!==Object.keys(window.clusterHealth).length?(_.each(window.clusterHealth,function(e){"DBServer"!==e.Role&&"Coordinator"!==e.Role||"GOOD"!==e.Status&&t++}),0<t?($("#healthStatus").removeClass("positive"),$("#healthStatus").addClass("negative"),1===t?$(".health-state").html(t+" NODE ERROR"):$(".health-state").html(t+" NODES ERROR"),$(".health-icon").html('<i class="fa fa-exclamation-circle"></i>')):($("#healthStatus").removeClass("negative"),$("#healthStatus").addClass("positive"),$(".health-state").html("NODES OK"),$(".health-icon").html('<i class="fa fa-check-circle"></i>'))):($(".health-state").html("HEALTH ERROR"),$("#healthStatus").removeClass("positive"),$("#healthStatus").addClass("negative"),$(".health-icon").html('<i class="fa fa-exclamation-circle"></i>'))}(e)}})}else $("#healthStatus").removeClass("positive"),$("#healthStatus").addClass("negative"),$(".health-state").html(window.location.host+" OFFLINE"),$(".health-icon").html('<i class="fa fa-exclamation-circle"></i>'),$("#offlinePlaceholder").show(),this.reconnectAnimation(0)},showShortcutModal:function(){window.arangoHelper.hotkeysFunctions.showHotkeysModal()},getVersion:function(){var n=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/version"),contentType:"application/json",processData:!1,async:!0,success:function(e){frontendConfig.version=e,n.showServerStatus(!0),!0===n.isOffline&&(n.isOffline=!1,n.isOfflineCounter=0,n.firstLogin?n.firstLogin=!1:window.setTimeout(function(){n.showServerStatus(!0)},1e3),n.system.name=e.server,n.system.version=e.version,n.render())},error:function(e){401===e.status?(n.showServerStatus(!0),window.App.navigate("login",{trigger:!0})):(n.isOffline=!0,n.isOfflineCounter++,1<=n.isOfflineCounter&&n.showServerStatus(!1))}}),n.system.hasOwnProperty("database")||$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/database/current"),contentType:"application/json",processData:!1,async:!0,success:function(e){var t=e.result.name;n.system.database=t;var i=window.setInterval(function(){$("#databaseNavi")&&(window.clearTimeout(i),i=null,n.render())},50)}})},renderVersion:function(){this.system.hasOwnProperty("database")&&this.system.hasOwnProperty("name")&&$(this.el).html(this.template.render({name:this.system.name,version:this.system.version,database:this.system.database}))},render:function(){return this.system.version||this.getVersion(),$(this.el).html(this.template.render({name:this.system.name,version:this.system.version})),this}})}(),function(){"use strict";window.FoxxActiveView=Backbone.View.extend({tagName:"div",className:"foxxTile tile pure-u-1-1 pure-u-sm-1-2 pure-u-md-1-3 pure-u-lg-1-4 pure-u-xl-1-5",template:templateEngine.createTemplate("foxxActiveView.ejs"),_show:!0,events:{click:"openAppDetailView"},openAppDetailView:function(){window.App.navigate("service/"+encodeURIComponent(this.model.get("mount")),{trigger:!0})},toggle:function(e,t){switch(e){case"devel":this.model.isDevelopment()&&(this._show=t);break;case"production":this.model.isDevelopment()||this.model.isSystem()||(this._show=t);break;case"system":this.model.isSystem()&&(this._show=t)}this._show?$(this.el).show():$(this.el).hide()},render:function(){return this.model.fetchThumbnail(function(){$(this.el).html(this.template.render({model:this.model}));var e=function(){this.model.needsConfiguration()&&(0<$(this.el).find(".warning-icons").length?$(this.el).find(".warning-icons").append('<span class="fa fa-cog" title="Needs configuration"></span>'):$(this.el).find("img").after('<span class="warning-icons"><span class="fa fa-cog" title="Needs configuration"></span></span>'))}.bind(this),t=function(){this.model.hasUnconfiguredDependencies()&&(0<$(this.el).find(".warning-icons").length?$(this.el).find(".warning-icons").append('<span class="fa fa-cubes" title="Unconfigured dependencies"></span>'):$(this.el).find("img").after('<span class="warning-icons"><span class="fa fa-cubes" title="Unconfigured dependencies"></span></span>'))}.bind(this);this.model.getConfiguration(e),this.model.getDependencies(t)}.bind(this)),$(this.el)}})}(),function(){"use strict";var n={code:1752,message:"service download failed"},a=templateEngine.createTemplate("applicationListView.ejs"),e=function(e){this.collection=e.collection},r=function(e){var t=this;if(!1===e.error)this.collection.fetch({success:function(){window.modalView.hide(),t.reload(),arangoHelper.arangoNotification("Services","Service "+e.name+" installed.")}});else{var i=e;switch(e.hasOwnProperty("responseJSON")&&(i=e.responseJSON),i.errorNum){case n.code:arangoHelper.arangoError("Services","Unable to download application from the given repository.");break;default:arangoHelper.arangoError("Services",i.errorNum+". "+i.errorMessage)}}},i=function(){window.modalView.modalBindValidation({id:"new-app-mount",validateInput:function(){return[{rule:Joi.string().regex(/^(\/(APP[^/]+|(?!APP)[a-zA-Z0-9_\-%]+))+$/i),msg:"May not contain /APP"},{rule:Joi.string().regex(/^(\/[a-zA-Z0-9_\-%]+)+$/),msg:"Can only contain [a-zA-Z0-9_-%]"},{rule:Joi.string().regex(/^\/([^_]|_open\/)/),msg:"Mountpoints with _ are reserved for internal use"},{rule:Joi.string().regex(/[^/]$/),msg:"May not end with /"},{rule:Joi.string().regex(/^\//),msg:"Has to start with /"},{rule:Joi.string().required().min(2),msg:"Has to be non-empty"}]}})},o=function(){window.modalView.modalBindValidation({id:"new-app-author",validateInput:function(){return[{rule:Joi.string().required().min(1),msg:"Has to be non empty."}]}}),window.modalView.modalBindValidation({id:"new-app-name",validateInput:function(){return[{rule:Joi.string().required().regex(/^[a-zA-Z\-_][a-zA-Z0-9\-_]*$/),msg:"Can only contain a to z, A to Z, 0-9, '-' and '_'. Cannot start with a number."}]}}),window.modalView.modalBindValidation({id:"new-app-description",validateInput:function(){return[{rule:Joi.string().required().min(1),msg:"Has to be non empty."}]}}),window.modalView.modalBindValidation({id:"new-app-license",validateInput:function(){return[{rule:Joi.string().required().regex(/^[a-zA-Z0-9 .,;-]+$/),msg:"Can only contain a to z, A to Z, 0-9, '-', '.', ',' and ';'."}]}}),window.modalView.modalTestAll()},s=function(e){window.modalView.clearValidators();var t=$("#modalButton1");switch(this._upgrade||i(),e){case"newApp":t.html("Generate"),t.prop("disabled",!1),o();break;case"appstore":t.html("Install"),t.prop("disabled",!0);break;case"github":window.modalView.modalBindValidation({id:"repository",validateInput:function(){return[{rule:Joi.string().required().regex(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+$/),msg:"No valid Github account and repository."}]}}),t.html("Install"),t.prop("disabled",!1);break;case"zip":t.html("Install"),t.prop("disabled",!1)}t.prop("disabled")||window.modalView.modalTestAll()||t.prop("disabled",!0)},l=function(e,t){var i,n,o;(void 0===t?t=this._uploadData:this._uploadData=t,t&&window.modalView.modalTestAll())&&(this._upgrade?(i=this.mount,n=Boolean($("#new-app-teardown").prop("checked"))):i=window.arangoHelper.escapeHtml($("#new-app-mount").val()),o=Boolean($("#zip-app-islegacy").prop("checked")),this.collection.installFromZip(t.filename,i,r.bind(this),o,n))},c=function(){switch($(".modal-body .tab-pane.active").attr("id")){case"newApp":(function(){if(window.modalView.modalTestAll()){var e,t;this._upgrade?(e=this.mount,t=$("#new-app-teardown").prop("checked")):e=window.arangoHelper.escapeHtml($("#new-app-mount").val());var i={name:window.arangoHelper.escapeHtml($("#new-app-name").val()),documentCollections:_.map($("#new-app-document-collections").select2("data"),function(e){return window.arangoHelper.escapeHtml(e.text)}),edgeCollections:_.map($("#new-app-edge-collections").select2("data"),function(e){return window.arangoHelper.escapeHtml(e.text)}),author:window.arangoHelper.escapeHtml($("#new-app-author").val()),license:window.arangoHelper.escapeHtml($("#new-app-license").val()),description:window.arangoHelper.escapeHtml($("#new-app-description").val())};this.collection.generate(i,e,r.bind(this),t)}}).apply(this);break;case"github":(function(){if(window.modalView.modalTestAll()){var e,t,i,n;this._upgrade?(t=this.mount,i=$("#new-app-teardown").prop("checked")):t=window.arangoHelper.escapeHtml($("#new-app-mount").val()),e=window.arangoHelper.escapeHtml($("#repository").val()),window.arangoHelper.escapeHtml($("#tag").val());var o={url:window.arangoHelper.escapeHtml($("#repository").val()),version:window.arangoHelper.escapeHtml($("#tag").val())};try{Joi.assert(e,Joi.string().regex(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+$/))}catch(e){return}n=Boolean($("#github-app-islegacy").prop("checked")),this.collection.installFromGithub(o,t,r.bind(this),n,i)}}).apply(this);break;case"zip":l.apply(this)}},d=function(e,t){var i=[],n={"click #infoTab a":function(e){var t=$(e.currentTarget).attr("href").substr(1);s.call(this,t)}.bind(e),"click .install-app":function(e){if(s.call(this,"appstore"),window.modalView.modalTestAll()){var t,i;this._upgrade?(t=this.mount,i=$("#new-app-teardown").prop("checked")):t=window.arangoHelper.escapeHtml($("#new-app-mount").val());var n=$(e.currentTarget).attr("appId"),o=$(e.currentTarget).attr("appVersion");void 0!==i?this.collection.installFromStore({name:n,version:o},t,r.bind(this),i):this.collection.installFromStore({name:n,version:o},t,r.bind(this)),window.modalView.hide(),arangoHelper.arangoNotification("Services","Installing "+n+".")}}.bind(e)};i.push(window.modalView.createSuccessButton("Generate",c.bind(e))),window.modalView.show("modalApplicationMount.ejs","Install Service",i,t,void 0,void 0,n),$("#new-app-document-collections").select2({tags:[],showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"}),$("#new-app-edge-collections").select2({tags:[],showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"});var o=function(){var e=$("#modalButton1");e.prop("disabled")||window.modalView.modalTestAll()?e.prop("disabled",!1):e.prop("disabled",!0)};$(".select2-search-field input").focusout(function(){o(),window.setTimeout(function(){$(".select2-drop").is(":visible")&&($("#select2-search-field input").is(":focus")||($("#s2id_new-app-document-collections").select2("close"),$("#s2id_new-app-edge-collections").select2("close"),o()))},200)}),$(".select2-search-field input").focusin(function(){$(".select2-drop").is(":visible")&&$("#modalButton1").prop("disabled",!0)}),$("#upload-foxx-zip").uploadFile({url:arangoHelper.databaseUrl("/_api/upload?multipart=true"),allowedTypes:"zip,js",multiple:!1,onSuccess:l.bind(e)}),$.get("foxxes/fishbowl",function(e){var t=$("#appstore-content");t.html(""),_.each(_.sortBy(e,"name"),function(e){t.append(a.render(e))})}).fail(function(){$("#appstore-content").append("<tr><td>Store is not available. ArangoDB is not able to connect to github.com</td></tr>")})};e.prototype.install=function(e){this.reload=e,this._upgrade=!1,this._uploadData=void 0,delete this.mount,d(this,!1),window.modalView.clearValidators(),i(),o()},e.prototype.upgrade=function(e,t){this.reload=t,this._upgrade=!0,this._uploadData=void 0,this.mount=e,d(this,!0),window.modalView.clearValidators(),o()},window.FoxxInstallView=e}(),function(){"use strict";window.FoxxRepoView=Backbone.View.extend({tagName:"div",className:"foxxTile tile pure-u-1-1 pure-u-sm-1-2 pure-u-md-1-3 pure-u-lg-1-4 pure-u-xl-1-5",template:templateEngine.createTemplate("foxxRepoView.ejs"),_show:!0,categories:[],events:{"click .installFoxx":"installStoreService","click .borderBox":"goToServiceDetail","click img":"goToServiceDetail","click .foxxDesc":"goToServiceDetail"},initialize:function(e){this.categories=[],this.fetchCategories(),e.functionsCollection&&(this.functionsCollection=e.functionsCollection),e.upgrade&&(this._upgrade=e.upgrade)},openAppDetailView:function(){window.App.navigate("service/detail/"+encodeURIComponent(this.model.get("name")),{trigger:!0})},render:function(){return this.model.fetchThumbnail(function(){var e=this.model.get("defaultThumbnailUrl");if(this.model.get("manifest"))try{this.model.get("manifest").thumbnail&&(e=this.model.getThumbnailUrl())}catch(e){}$(this.el).html(this.template.render({model:this.model.toJSON(),thumbnail:e,upgrade:this._upgrade}))}.bind(this)),$(this.el).attr("category",this.model.get("categories")),$(this.el)},goToServiceDetail:function(e){window.App.navigate("store/"+encodeURIComponent(this.model.get("name")),{trigger:!0})},installStoreService:function(e){this.toInstall=$(e.currentTarget).attr("appId"),this.version=$(e.currentTarget).attr("appVersion"),arangoHelper.createMountPointModal(this.installFoxxFromStore.bind(this))},categoriesCallbackFunction:function(e){this.categoryOptions=e,this.applyFilter()},onlyUnique:function(e,t,i){return i.indexOf(e)===t},fetchCategories:function(){var t=[];_.each(window.App.foxxRepo.models,function(e){_.each(e.get("categories"),function(e){t.push(e)})}),this.categories=t.filter(this.onlyUnique)},renderCategories:function(e){var i,n=this;this.categoryOptions||(this.categoryOptions={}),_.each(this.categories,function(e,t){n.categoryOptions[t]&&(i=n.categoryOptions[t].active),n.categoryOptions[e]={name:e,active:i||!1}});var t=$(e.currentTarget).position();t.right="30",this.categoryView=new window.FilterSelectView({name:"Category",options:n.categoryOptions,position:t,callback:n.categoriesCallbackFunction.bind(this),multiple:!1}),this.categoryView.render()},resetFilters:function(){_.each(this.categoryOptions,function(e){e.active=!1}),this.applyFilter()},isFilterActive:function(e){var t=!1;return _.each(e,function(e){e.active&&(t=!0)}),t},applyFilter:function(){var n=this;this.isFilterActive(this.categoryOptions)?(_.each($("#availableFoxxes").children(),function(e){var t=$(e).attr("category").split(","),i=!1;_.each(t,function(e){!0===n.categoryOptions[e].active&&(i=!0)}),i?($(e).show(),$(e).attr("shown","true")):($(e).hide(),$(e).attr("shown","false"))}),this.changeButton("category")):(_.each($("#availableFoxxes").children(),function(e){$(e).show(),$(e).attr("shown","true")}),this.changeButton());var t=0;_.each($("#logEntries").children(),function(e){"block"===$(e).css("display")&&t++}),1===t?($(".logBorder").css("visibility","hidden"),$("#noLogEntries").hide()):0===t?$("#noLogEntries").show():($(".logBorder").css("visibility","visible"),$("#noLogEntries").hide())},changeButton:function(e){e?($("#categorySelection").addClass("button-success").removeClass("button-default"),$("#filterDesc").html(e),$("#foxxFilters").show()):($("#categorySelection").addClass("button-default").removeClass("button-success"),$("#foxxFilters").hide(),$("#filterDesc").html(""))},installFoxxFromStore:function(e){var t,i;window.modalView.modalTestAll()&&(this._upgrade?(t=window.App.replaceAppData.mount,i=arangoHelper.getFoxxFlag()):"/"!==(t=window.arangoHelper.escapeHtml($("#new-app-mount").val())).charAt(0)&&(t="/"+t),void 0!==i?this.collection.installFromStore({name:this.toInstall,version:this.version},t,this.installCallback.bind(this),i):this.collection.installFromStore({name:this.toInstall,version:this.version},t,this.installCallback.bind(this)),window.modalView.hide(),this._upgrade?arangoHelper.arangoNotification("Services","Upgrading "+this.toInstall+"."):arangoHelper.arangoNotification("Services","Installing "+this.toInstall+"."),this.toInstall=null,this.version=null)},installCallback:function(e){window.App.navigate("#services",{trigger:!0}),window.App.applicationsView.installCallback(e)}})}(),function(){"use strict";window.GraphManagementView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("graphManagementView.ejs"),edgeDefintionTemplate:templateEngine.createTemplate("edgeDefinitionTable.ejs"),eCollList:[],removedECollList:[],readOnly:!1,dropdownVisible:!1,initialize:function(e){this.options=e},events:{"click #deleteGraph":"deleteGraph","click .icon_arangodb_settings2.editGraph":"editGraph","click #createGraph":"addNewGraph","keyup #graphManagementSearchInput":"search","click #graphManagementSearchSubmit":"search","click .tile-graph":"redirectToGraphViewer","click #graphManagementToggle":"toggleGraphDropdown","click .css-label":"checkBoxes","change #graphSortDesc":"sorting"},toggleTab:function(e){var t=e.currentTarget.id;t=t.replace("tab-",""),$("#tab-content-create-graph .tab-pane").removeClass("active"),$("#tab-content-create-graph #"+t).addClass("active"),"exampleGraphs"===t?$("#modal-dialog .modal-footer .button-success").css("display","none"):$("#modal-dialog .modal-footer .button-success").css("display","initial"),"smartGraph"===t?(this.toggleSmartGraph(),$("#createGraph").addClass("active"),this.showSmartGraphOptions()):(this.toggleSmartGraph(),this.hideSmartGraphOptions())},hideSmartGraphOptions:function(){$("#row_general-numberOfShards").show(),$("#row_general-replicationFactor").show(),$("#smartGraphInfo").hide(),$("#row_new-numberOfShards").hide(),$("#row_new-replicationFactor").hide(),$("#row_new-smartGraphAttribute").hide()},showSmartGraphOptions:function(){$("#row_general-numberOfShards").hide(),$("#row_general-replicationFactor").hide(),$("#smartGraphInfo").show(),$("#row_new-numberOfShards").show(),$("#row_new-replicationFactor").show(),$("#row_new-smartGraphAttribute").show()},redirectToGraphViewer:function(e){var t=$(e.currentTarget).attr("id");t=t.substr(0,t.length-5),window.location.hash=window.location.hash.substr(0,window.location.hash.length-1)+"/"+encodeURIComponent(t)},loadGraphViewer:function(a,e){var t=function(e){if(e)arangoHelper.arangoError("","");else{var t=this.collection.get(a).get("edgeDefinitions");if(!t||0===t.length)return;var i={type:"gharial",graphName:a,baseUrl:arangoHelper.databaseUrl("/")},n=$("#content").width()-75;$("#content").html("");var o=arangoHelper.calculateCenterDivHeight();this.ui=new GraphViewerUI($("#content")[0],i,n,$(".centralRow").height()-135,{nodeShaper:{label:"_key",color:{type:"attribute",key:"_key"}}},!0),$(".contentDiv").height(o)}}.bind(this);e?this.collection.fetch({cache:!1,success:function(){t()}}):t()},handleResize:function(e){this.width&&this.width===e||(this.width=e,this.ui&&this.ui.changeWidth(e))},addNewGraph:function(e){e.preventDefault(),this.readOnly||(frontendConfig.isCluster&&frontendConfig.isEnterprise?this.createEditGraphModal():(this.createEditGraphModal(),$("#tab-smartGraph").parent().remove()))},deleteGraph:function(){var t=this,i=$("#editGraphName")[0].value;if($("#dropGraphCollections").is(":checked")){this.collection.dropAndDeleteGraph(i,function(e){e?(t.collection.remove(t.collection.get(i)),t.updateGraphManagementView(),window.modalView.hide()):(window.modalView.hide(),arangoHelper.arangoError("Graph","Could not delete Graph."))})}else this.collection.get(i).destroy({success:function(){t.updateGraphManagementView(),window.modalView.hide()},error:function(e,t){var i=JSON.parse(t.responseText).errorMessage;arangoHelper.arangoError(i),window.modalView.hide()}})},checkBoxes:function(e){var t=e.currentTarget.id;$("#"+t).click()},checkVisibility:function(){$("#graphManagementDropdown").is(":visible")?this.dropdownVisible=!0:this.dropdownVisible=!1,arangoHelper.setCheckboxStatus("#graphManagementDropdown")},toggleGraphDropdown:function(){var e=this;$("#graphSortDesc").attr("checked",this.collection.sortOptions.desc),$("#graphManagementToggle").toggleClass("activated"),$("#graphManagementDropdown2").slideToggle(200,function(){e.checkVisibility()})},sorting:function(){$("#graphSortDesc").is(":checked")?this.collection.setSortingDesc(!0):this.collection.setSortingDesc(!1),this.checkVisibility(),this.render()},createExampleGraphs:function(e){var i=$(e.currentTarget).attr("graph-id"),t=this;$.ajax({type:"POST",url:arangoHelper.databaseUrl("/_admin/aardvark/graph-examples/create/"+encodeURIComponent(i)),success:function(){window.modalView.hide(),t.updateGraphManagementView(),arangoHelper.arangoNotification("Example Graphs","Graph: "+i+" created.")},error:function(e){if(window.modalView.hide(),e.responseText)try{var t=JSON.parse(e.responseText);arangoHelper.arangoError("Example Graphs",t.errorMessage)}catch(e){arangoHelper.arangoError("Example Graphs","Could not create example graph: "+i)}else arangoHelper.arangoError("Example Graphs","Could not create example graph: "+i)}})},toggleSmartGraph:function(){var e,t=this;if($("#tab-smartGraph").parent().hasClass("active")){var i=[];for(this.options.collectionCollection.models.forEach(function(e){e.get("isSystem")||i.push(e.id)}),e=0;e<this.counter;e++)$("#newEdgeDefinitions"+e).select2({tags:this.eCollList}),$("#newEdgeDefinitions"+e).select2("data",t.cachedNewEdgeDefinitions),$("#newEdgeDefinitions"+e).attr("disabled",t.cachedNewEdgeDefinitionsState),$("#fromCollections"+e).select2({tags:i}),$("#fromCollections"+e).select2("data",t.cachedFromCollections),$("#fromCollections"+e).attr("disabled",t.cachedFromCollectionsState),$("#toCollections"+e).select2({tags:i}),$("#toCollections"+e).select2("data",t.cachedToCollections),$("#toCollections"+e).attr("disabled",t.cachedToCollectionsState);$("#newVertexCollections").select2({tags:i}),$("#newVertexCollections").select2("data",t.cachedNewVertexCollections),$("#newVertexCollections").attr("disabled",t.cachedNewVertexCollectionsState)}else{for(e=0;e<this.counter;e++)$("#newEdgeDefinitions"+e).select2({tags:[]}),t.cachedNewEdgeDefinitions=$("#newEdgeDefinitions"+e).select2("data"),t.cachedNewEdgeDefinitionsState=$("#newEdgeDefinitions"+e).attr("disabled"),$("#newEdgeDefinitions"+e).select2("data",""),$("#newEdgeDefinitions"+e).attr("disabled",!1),$("#newEdgeDefinitions"+e).change(),$("#fromCollections"+e).select2({tags:[]}),t.cachedFromCollections=$("#fromCollections"+e).select2("data"),t.cachedFromCollectionsState=$("#fromCollections"+e).attr("disabled"),$("#fromCollections"+e).select2("data",""),$("#fromCollections"+e).attr("disabled",!1),$("#fromCollections"+e).change(),$("#toCollections"+e).select2({tags:[]}),t.cachedToCollections=$("#toCollections"+e).select2("data"),t.cachedToCollectionsState=$("#toCollections"+e).attr("disabled"),$("#toCollections"+e).select2("data",""),$("#toCollections"+e).attr("disabled",!1),$("#toCollections"+e).change();$("#newVertexCollections").select2({tags:[]}),t.cachedNewVertexCollections=$("#newVertexCollections").select2("data"),t.cachedNewVertexCollectionsState=$("#newVertexCollections").attr("disabled"),$("#newVertexCollections").select2("data",""),$("#newVertexCollections").attr("disabled",!1),$("#newVertexCollections").change()}},render:function(e,t){var i=this;return this.collection.fetch({cache:!1,success:function(){i.collection.sort(),$(i.el).html(i.template.render({graphs:i.collection,searchString:""})),!0===i.dropdownVisible&&($("#graphManagementDropdown2").show(),$("#graphSortDesc").attr("checked",i.collection.sortOptions.desc),$("#graphManagementToggle").toggleClass("activated"),$("#graphManagementDropdown").show()),i.events['change tr[id*="newEdgeDefinitions"]']=i.setFromAndTo.bind(i),i.events["click .graphViewer-icon-button"]=i.addRemoveDefinition.bind(i),i.events["click #graphTab a"]=i.toggleTab.bind(i),i.events["click .createExampleGraphs"]=i.createExampleGraphs.bind(i),i.events["focusout .select2-search-field input"]=function(e){$(".select2-drop").is(":visible")&&($("#select2-search-field input").is(":focus")||window.setTimeout(function(){$(e.currentTarget).parent().parent().parent().select2("close")},200))},arangoHelper.setCheckboxStatus("#graphManagementDropdown"),arangoHelper.checkDatabasePermissions(i.setReadOnly.bind(i))}}),e&&this.loadGraphViewer(e,t),this},setReadOnly:function(){this.readOnly=!0,$("#createGraph").parent().parent().addClass("disabled"),$("#createGraph").addClass("disabled")},setFromAndTo:function(e){e.stopPropagation();var t,i=this.calculateEdgeDefinitionMap();if($("#tab-smartGraph").parent().hasClass("active")){if(e.added){if(-1===this.eCollList.indexOf(e.added.id)&&-1!==this.removedECollList.indexOf(e.added.id))return t=e.currentTarget.id.split("row_newEdgeDefinitions")[1],$('input[id*="newEdgeDefinitions'+t+'"]').select2("val",null),void $('input[id*="newEdgeDefinitions'+t+'"]').attr("placeholder","The collection "+e.added.id+" is already used.");this.removedECollList.push(e.added.id),this.eCollList.splice(this.eCollList.indexOf(e.added.id),1)}else e.removed&&(this.eCollList.push(e.removed.id),this.removedECollList.splice(this.removedECollList.indexOf(e.removed.id),1));i[e.val]?(t=e.currentTarget.id.split("row_newEdgeDefinitions")[1],$("#s2id_fromCollections"+t).select2("val",i[e.val].from),$("#fromCollections"+t).attr("disabled",!0),$("#s2id_toCollections"+t).select2("val",i[e.val].to),$("#toCollections"+t).attr("disabled",!0)):(t=e.currentTarget.id.split("row_newEdgeDefinitions")[1],$("#s2id_fromCollections"+t).select2("val",null),$("#fromCollections"+t).attr("disabled",!1),$("#s2id_toCollections"+t).select2("val",null),$("#toCollections"+t).attr("disabled",!1))}},editGraph:function(e){e.stopPropagation(),this.collection.fetch({cache:!1}),this.graphToEdit=this.evaluateGraphName($(e.currentTarget).attr("id"),"_settings");var t=this.collection.findWhere({_key:this.graphToEdit});t.get("isSmart")?this.createEditGraphModal(t,!0):this.createEditGraphModal(t)},saveEditedGraph:function(){var i,n,o,a,e=$("#editGraphName")[0].value,t=_.pluck($("#newVertexCollections").select2("data"),"text"),r=[],s={};if($("[id^=s2id_newEdgeDefinitions]").toArray().forEach(function(e){if(a=(a=$(e).attr("id")).replace("s2id_newEdgeDefinitions",""),(i=_.pluck($("#s2id_newEdgeDefinitions"+a).select2("data"),"text")[0])&&""!==i&&(n=_.pluck($("#s2id_fromCollections"+a).select2("data"),"text"),o=_.pluck($("#s2id_toCollections"+a).select2("data"),"text"),0!==n.length&&0!==o.length)){var t={collection:i,from:n,to:o};r.push(t),s[i]=t}}),0===r.length)return $("#s2id_newEdgeDefinitions0 .select2-choices").css("border-color","red"),$("#s2id_newEdgeDefinitions0").parent().parent().next().find(".select2-choices").css("border-color","red"),void $("#s2id_newEdgeDefinitions0").parent().parent().next().next().find(".select2-choices").css("border-color","red");var l=this.collection.findWhere({_key:e}),c=l.get("edgeDefinitions"),d=l.get("orphanCollections"),u=[];d.forEach(function(e){-1===t.indexOf(e)&&l.deleteVertexCollection(e)}),t.forEach(function(e){-1===d.indexOf(e)&&l.addVertexCollection(e)});var h=[],p=[],g=[];c.forEach(function(e){var t=e.collection;u.push(t);var i=s[t];void 0===i?g.push(t):JSON.stringify(i)!==JSON.stringify(e)&&p.push(t)}),r.forEach(function(e){var t=e.collection;-1===u.indexOf(t)&&h.push(t)}),h.forEach(function(e){l.addEdgeDefinition(s[e])}),p.forEach(function(e){l.modifyEdgeDefinition(s[e])}),g.forEach(function(e){l.deleteEdgeDefinition(e)}),this.updateGraphManagementView(),window.modalView.hide()},evaluateGraphName:function(e,t){var i=e.lastIndexOf(t);return e.substring(0,i)},search:function(){var e,t,i,n;e=$("#graphManagementSearchInput"),t=$("#graphManagementSearchInput").val(),n=this.collection.filter(function(e){return-1!==e.get("_key").indexOf(t)}),$(this.el).html(this.template.render({graphs:n,searchString:t})),i=(e=$("#graphManagementSearchInput")).val().length,e.focus(),e[0].setSelectionRange(i,i)},updateGraphManagementView:function(){var e=this;this.collection.fetch({cache:!1,success:function(){e.render()}})},createNewGraph:function(){var t,i,n,o,e=$("#createNewGraphName").val(),a=_.pluck($("#newVertexCollections").select2("data"),"text"),r=[],s=this;if(!e)return arangoHelper.arangoError("A name for the graph has to be provided."),0;if(this.collection.findWhere({_key:e}))return arangoHelper.arangoError("The graph '"+e+"' already exists."),0;if($("[id^=s2id_newEdgeDefinitions]").toArray().forEach(function(e){o=(o=$(e).attr("id")).replace("s2id_newEdgeDefinitions",""),(t=_.pluck($("#s2id_newEdgeDefinitions"+o).select2("data"),"text")[0])&&""!==t&&(i=_.pluck($("#s2id_fromCollections"+o).select2("data"),"text"),n=_.pluck($("#s2id_toCollections"+o).select2("data"),"text"),1!==i&&1!==n&&r.push({collection:t,from:i,to:n}))}),0===r.length)return $("#s2id_newEdgeDefinitions0 .select2-choices").css("border-color","red"),$("#s2id_newEdgeDefinitions0").parent().parent().next().find(".select2-choices").css("border-color","red"),void $("#s2id_newEdgeDefinitions0").parent().parent().next().next().find(".select2-choices").css("border-color","red");var l={name:e,edgeDefinitions:r,orphanCollections:a};if($("#tab-smartGraph").parent().hasClass("active")){if(""===$("#new-numberOfShards").val()||""===$("#new-smartGraphAttribute").val())return void arangoHelper.arangoError("Smart Graph creation","numberOfShards and/or smartGraphAttribute not set!");l.isSmart=!0,l.options={numberOfShards:parseInt($("#new-numberOfShards").val()),smartGraphAttribute:$("#new-smartGraphAttribute").val(),replicationFactor:parseInt($("#new-replicationFactor").val())}}else frontendConfig.isCluster&&(0<$("#general-numberOfShards").val().length&&(l.options={numberOfShards:parseInt($("#general-numberOfShards").val())}),0<$("#general-replicationFactor").val().length&&(l.options?l.options.replicationFactor=parseInt($("#general-replicationFactor").val()):l.options={replicationFactor:parseInt($("#general-replicationFactor").val())}));this.collection.create(l,{success:function(){s.updateGraphManagementView(),window.modalView.hide()},error:function(e,t){var i=JSON.parse(t.responseText).errorMessage;i=(i=i.replace("<","")).replace(">",""),arangoHelper.arangoError(i)}})},createEditGraphModal:function(t,e){var i,n=[],o=[],a=[],r=this.options.collectionCollection.models,s=this,l="",c=[{collection:"",from:"",to:""}],d="",u=function(e,t){return(e=e.toLowerCase())<(t=t.toLowerCase())?-1:t<e?1:0};if(this.eCollList=[],this.removedECollList=[],r.forEach(function(e){e.get("isSystem")||("edge"===e.get("type")?s.eCollList.push(e.id):o.push(e.id))}),window.modalView.enableHotKeys=!1,this.counter=0,t?(i=e?"Edit Smart Graph":"Edit Graph",l=t.get("_key"),(c=t.get("edgeDefinitions"))&&0!==c.length||(c=[{collection:"",from:"",to:""}]),d=t.get("orphanCollections"),a.push(window.modalView.createReadOnlyEntry("editGraphName","Name",l,"The name to identify the graph. Has to be unique")),e&&a.push(window.modalView.createReadOnlyEntry("smartGraphAttribute","Smart Graph Attribute",t.get("smartGraphAttribute"),"The attribute name that is used to smartly shard the vertices of a graph. \nEvery vertex in this Graph has to have this attribute. \n")),t.get("numberOfShards")&&a.push(window.modalView.createReadOnlyEntry("numberOfShards","Shards",t.get("numberOfShards"),"Number of shards the graph is using.")),t.get("replicationFactor")&&a.push(window.modalView.createReadOnlyEntry("replicationFactor","Replication factor",t.get("replicationFactor"),"Total number of copies of the data in the cluster.")),n.push(window.modalView.createDeleteButton("Delete",this.deleteGraph.bind(this))),n.push(window.modalView.createNotificationButton("Reset display settings",this.resetDisplaySettings.bind(this))),n.push(window.modalView.createSuccessButton("Save",this.saveEditedGraph.bind(this)))):(i="Create Graph",a.push(window.modalView.createTextEntry("createNewGraphName","Name","","The name to identify the graph. Has to be unique.","graphName",!0)),n.push(window.modalView.createSuccessButton("Create",this.createNewGraph.bind(this)))),c.forEach(function(e){!0===frontendConfig.isEnterprise&&frontendConfig.isCluster&&(a.push(window.modalView.createTextEntry("new-numberOfShards","Shards*","","Number of shards the smart graph is using.","",!1,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}])),a.push(window.modalView.createTextEntry("new-replicationFactor","Replication factor","","Numeric value. Must be at least 1. Total number of copies of the data in the cluster.","",!1,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}])),a.push(window.modalView.createTextEntry("new-smartGraphAttribute","Smart Graph Attribute*","","The attribute name that is used to smartly shard the vertices of a graph. \nEvery vertex in this Graph has to have this attribute. \nCannot be modified later.","",!1,[{rule:Joi.string().allow("").optional(),msg:"Must be a string."}]))),frontendConfig.isCluster&&!t&&(a.push(window.modalView.createTextEntry("general-numberOfShards","Shards","","Number of shards the graph is using.","",!1,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}])),a.push(window.modalView.createTextEntry("general-replicationFactor","Replication factor","","Numeric value. Must be at least 1. Total number of copies of the data in the cluster.","",!1,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}]))),0===s.counter?(e.collection&&(s.removedECollList.push(e.collection),s.eCollList.splice(s.eCollList.indexOf(e.collection),1)),a.push(window.modalView.createSelect2Entry("newEdgeDefinitions"+s.counter,"Edge definitions",e.collection,"An edge definition defines a relation of the graph","Edge definitions",!0,!1,!0,1,s.eCollList.sort(u)))):a.push(window.modalView.createSelect2Entry("newEdgeDefinitions"+s.counter,"Edge definitions",e.collection,"An edge definition defines a relation of the graph","Edge definitions",!1,!0,!1,1,s.eCollList.sort(u))),a.push(window.modalView.createSelect2Entry("fromCollections"+s.counter,"fromCollections",e.from,"The collections that contain the start vertices of the relation.","fromCollections",!0,!1,!1,null,o.sort(u))),a.push(window.modalView.createSelect2Entry("toCollections"+s.counter,"toCollections",e.to,"The collections that contain the end vertices of the relation.","toCollections",!0,!1,!1,null,o.sort(u))),s.counter++}),a.push(window.modalView.createSelect2Entry("newVertexCollections","Vertex collections",d,"Collections that are part of a graph but not used in an edge definition","Vertex Collections",!1,!1,!1,null,o.sort(u))),window.modalView.show("modalGraphTable.ejs",i,n,a,void 0,void 0,this.events),$("#tab-createGraph").parent().hasClass("active")&&s.hideSmartGraphOptions(),t){var h;for($(".modal-body table").css("border-collapse","separate"),$(".modal-body .spacer").remove(),h=0;h<=this.counter;h++)$("#row_fromCollections"+h).show(),$("#row_toCollections"+h).show(),$("#row_newEdgeDefinitions"+h).addClass("first"),$("#row_fromCollections"+h).addClass("middle"),$("#row_toCollections"+h).addClass("last"),$("#row_toCollections"+h).after('<tr id="spacer'+h+'" class="spacer"></tr>');$("#graphTab").hide(),$("#modal-dialog .modal-delete-confirmation").append('<fieldset><input type="checkbox" id="dropGraphCollections" name="" value=""><label for="dropGraphCollections">also drop collections?</label></fieldset>')}},resetDisplaySettings:function(){var e=$("#editGraphName").val(),t=new window.GraphSettingsView({name:e,userConfig:window.App.userConfig});t.setDefaults(!0,!0),t.remove(),window.modalView.hide(),arangoHelper.arangoNotification("Graph","Reset successful.")},addRemoveDefinition:function(e){var t=[];this.options.collectionCollection.models.forEach(function(e){e.get("isSystem")||"edge"!==e.get("type")&&t.push(e.id)}),e.stopPropagation();var i,n,o=$(e.currentTarget).attr("id");if(-1===o.indexOf("addAfter_newEdgeDefinitions"))-1!==o.indexOf("remove_newEdgeDefinitions")&&(i=o.split("remove_newEdgeDefinitions")[1],$("#row_newEdgeDefinitions"+i).remove(),$("#row_fromCollections"+i).remove(),$("#row_toCollections"+i).remove(),$("#spacer"+i).remove());else for(this.counter++,$("#row_newVertexCollections").before(this.edgeDefintionTemplate.render({number:this.counter})),$("#newEdgeDefinitions"+this.counter).select2({tags:this.eCollList,showSearchBox:!1,minimumResultsForSearch:-1,width:"336px",maximumSelectionSize:1}),$("#fromCollections"+this.counter).select2({tags:t,showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"}),$("#toCollections"+this.counter).select2({tags:t,showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"}),window.modalView.undelegateEvents(),window.modalView.delegateEvents(this.events),arangoHelper.fixTooltips(".icon_arangodb, .arangoicon","right"),$(".modal-body .spacer").remove(),n=0;n<=this.counter;n++)$("#row_fromCollections"+n).show(),$("#row_toCollections"+n).show(),$("#row_newEdgeDefinitions"+n).addClass("first"),$("#row_fromCollections"+n).addClass("middle"),$("#row_toCollections"+n).addClass("last"),$("#row_toCollections"+n).after('<tr id="spacer'+n+'" class="spacer"></tr>')},calculateEdgeDefinitionMap:function(){var t={};return this.collection.models.forEach(function(e){e.get("edgeDefinitions").forEach(function(e){t[e.collection]={from:e.from,to:e.to}})}),t}})}(),function(){"use strict";window.GraphSettingsView=Backbone.View.extend({el:"#graphSettingsContent",remove:function(){return this.$el.empty().off(),this.stopListening(),this},general:{graph:{type:"divider",name:"Graph"},nodeStart:{type:"string",name:"Startnode",desc:"A valid node id or space seperated list of id's. If empty, a random node will be chosen.",value:2},layout:{type:"select",name:"Layout",desc:"Different graph algorithms. No overlap is very fast (more than 5000 nodes), force is slower (less than 5000 nodes) and fruchtermann is the slowest (less than 500 nodes).",noverlap:{name:"No overlap",val:"noverlap"},force:{name:"Force",val:"force"},fruchtermann:{name:"Fruchtermann",val:"fruchtermann"}},renderer:{type:"select",name:"Renderer",desc:"Canvas enables editing, WebGL is only for displaying a graph but much faster.",canvas:{name:"Canvas",val:"canvas"},webgl:{name:"WebGL (experimental)",val:"webgl"}},depth:{desc:"Search depth, starting from your start node.",type:"number",name:"Search Depth",value:2},limit:{desc:"Limit nodes count. If empty or zero, no limit is set.",type:"number",name:"Limit",value:250}},specific:{nodes:{type:"divider",name:"Nodes"},nodeLabel:{type:"string",name:"Label",desc:"Node label. Please choose a valid and available node attribute.",default:"_key"},nodeLabelByCollection:{type:"select",name:"Add Collection Name",desc:"Append collection name to the label?",yes:{name:"Yes",val:"true"},no:{name:"No",val:"false"}},nodeColorByCollection:{type:"select",name:"Color By Collections",no:{name:"No",val:"false"},yes:{name:"Yes",val:"true"},desc:"Should nodes be colorized by their collection? If enabled, node color and node color attribute will be ignored."},nodeColor:{type:"color",name:"Color",desc:"Default node color. RGB or HEX value.",default:"#2ecc71"},nodeColorAttribute:{type:"string",name:"Color Attribute",desc:"If an attribute is given, nodes will then be colorized by the attribute. This setting ignores default node color if set."},nodeSizeByEdges:{type:"select",name:"Size By Connections",yes:{name:"Yes",val:"true"},no:{name:"No",val:"false"},desc:"Should nodes be sized by their edges count? If enabled, node sizing attribute will be ignored."},nodeSize:{type:"string",name:"Sizing Attribute",desc:"Default node size. Numeric value > 0."},edges:{type:"divider",name:"Edges"},edgeLabel:{type:"string",name:"Label",desc:"Default edge label."},edgeLabelByCollection:{type:"select",name:"Add Collection Name",desc:"Set label text by collection. If activated edge label attribute will be ignored.",yes:{name:"Yes",val:"true"},no:{name:"No",val:"false"}},edgeColorByCollection:{type:"select",name:"Color By Collections",no:{name:"No",val:"false"},yes:{name:"Yes",val:"true"},desc:"Should edges be colorized by their collection? If enabled, edge color and edge color attribute will be ignored."},edgeColor:{type:"color",name:"Color",desc:"Default edge color. RGB or HEX value.",default:"#cccccc"},edgeColorAttribute:{type:"string",name:"Color Attribute",desc:"If an attribute is given, edges will then be colorized by the attribute. This setting ignores default edge color if set."},edgeEditable:{type:"select",hide:"true",name:"Editable",yes:{name:"Yes",val:"true"},no:{name:"No",val:"false"},desc:"Should edges be editable?"},edgeType:{type:"select",name:"Type",desc:"The type of the edge",line:{name:"Line",val:"line"},arrow:{name:"Arrow",val:"arrow"},curve:{name:"Curve",val:"curve"},dotted:{name:"Dotted",val:"dotted"},dashed:{name:"Dashed",val:"dashed"},tapered:{name:"Tapered",val:"tapered"}}},template:templateEngine.createTemplate("graphSettingsView.ejs"),initialize:function(e){this.name=e.name,this.userConfig=e.userConfig,this.saveCallback=e.saveCallback,e.noDefinedGraph&&(this.noDefinedGraph=e.noDefinedGraph)},events:{"click #saveGraphSettings":"saveGraphSettings","click #restoreGraphSettings":"setDefaults","keyup #graphSettingsView input":"checkEnterKey","keyup #graphSettingsView select":"checkEnterKey",'change input[type="range"]':"saveGraphSettings",'change input[type="color"]':"checkColor","change select":"saveGraphSettings","focus #graphSettingsView input":"lastFocus","focus #graphSettingsView select":"lastFocus",'focusout #graphSettingsView input[type="text"]':"checkinput"},lastFocus:function(e){this.lastFocussed=e.currentTarget.id,this.lastFocussedValue=$(e.currentTarget).val()},checkinput:function(e){500<new Date-this.lastSaved&&e.currentTarget.id===this.lastFocussed&&this.lastFocussedValue!==$(e.currentTarget).val()&&this.saveGraphSettings()},checkEnterKey:function(e){13===e.keyCode&&this.saveGraphSettings(e)},getGraphSettings:function(t){var i=this,n=frontendConfig.db+"_"+this.name;this.userConfig.fetch({success:function(e){i.graphConfig=e.toJSON().graphs[n],t&&i.continueRender()}})},checkColor:function(){this.lastConfigChange?750<new Date-this.lastConfigChange&&this.saveGraphSettings(null,!0):this.saveGraphSettings(null,!0)},saveGraphSettings:function(e,t,i,n,o,a){var r=this,s=function(){var e=!$("#g_nodeColor").is(":disabled"),t=!$("#g_edgeColor").is(":disabled");window.App.graphViewer.updateColors(e,t,$("#g_nodeColor").val(),$("#g_edgeColor").val())};if(this.noDefinedGraph){t?s():"g_layout"===e.currentTarget.id?window.App.graphViewer.rerenderAQL($("#g_layout").val(),null):"g_nodeColorByCollection"===e.currentTarget.id?"true"===$("#g_nodeColorByCollection").val()?window.App.graphViewer.switchNodeColorByCollection(!0):window.App.graphViewer.switchNodeColorByCollection(!1):"g_edgeColorByCollection"===e.currentTarget.id?"true"===$("#g_edgeColorByCollection").val()?window.App.graphViewer.switchEdgeColorByCollection(!0):window.App.graphViewer.switchEdgeColorByCollection(!1):"g_nodeSizeByEdges"===e.currentTarget.id?"true"===$("#g_nodeSizeByEdges").val()?window.App.graphViewer.switchNodeSizeByCollection(!0):window.App.graphViewer.switchNodeSizeByCollection(!1):"g_edgeType"===e.currentTarget.id&&window.App.graphViewer.switchEdgeType($("#g_edgeType").val())}else{r.lastSaved=new Date;var l=frontendConfig.db+"_"+this.name,c={};if(n)c[l]=n;else{var d,u={};$("#graphSettingsView select").each(function(e,t){d=t.id,u[d.substr(2,t.id.length)]=$(t).val()}),$("#graphSettingsView input").each(function(e,t){d=t.id,u[d.substr(2,t.id.length)]=$(t).val()}),c[l]=u}i&&(c[l].nodeStart=i);var h=function(){if(r.lastConfigChange=new Date,window.App.graphViewer){if(e){if("g_layout"===e.currentTarget.id)return void window.App.graphViewer.switchLayout($("#g_layout").val());if("g_nodeColorByCollection"===e.currentTarget.id)return void("true"===$("#g_nodeColorByCollection").val()?window.App.graphViewer.switchNodeColorByCollection(!0):$("#g_nodeColorAttribute").is(":disabled")?window.App.graphViewer.switchNodeColorByCollection(!1):window.App.graphViewer.switchNodeColorByCollection(!1,!0));if("g_edgeColorByCollection"===e.currentTarget.id)return void("true"===$("#g_edgeColorByCollection").val()?window.App.graphViewer.switchEdgeColorByCollection(!0):$("#g_nodeColorAttribute").is(":disabled")?window.App.graphViewer.switchEdgeColorByCollection(!1):window.App.graphViewer.switchEdgeColorByCollection(!1,!0))}""!==t&&void 0!==t?s():window.App.graphViewer.render(r.lastFocussed)}else o||arangoHelper.arangoNotification("Graph "+this.name,"Configuration saved.");a&&a()}.bind(this);this.userConfig.setItem("graphs",c,h)}this.handleDependencies()},setDefaults:function(e,t,i){var n={layout:"force",renderer:"canvas",depth:"2",limit:"250",nodeColor:"#2ecc71",nodeColorAttribute:"",nodeColorByCollection:"true",edgeColor:"#cccccc",edgeColorAttribute:"",edgeColorByCollection:"false",nodeLabel:"_key",edgeLabel:"",edgeType:"arrow",nodeSize:"",nodeSizeByEdges:"true",edgeEditable:"true",nodeLabelByCollection:"false",edgeLabelByCollection:"false",nodeStart:"",barnesHutOptimize:!0};!0===e?t?this.saveGraphSettings(null,null,null,n,t,i):this.saveGraphSettings(null,null,null,n):(this.saveGraphSettings(null,null,null,n,null),this.render(),window.App.graphViewer.render(this.lastFocussed))},toggle:function(){$(this.el).is(":visible")?this.hide():this.show()},show:function(){$(this.el).show("slide",{direction:"right"},250)},hide:function(){$(this.el).hide("slide",{direction:"right"},250)},render:function(){this.noDefinedGraph?this.continueRender():(this.getGraphSettings(!0),this.lastSaved=new Date)},handleDependencies:function(){"true"===$("#g_nodeSizeByEdges").val()?$("#g_nodeSize").prop("disabled",!0):$("#g_nodeSize").removeAttr("disabled"),"true"===$("#g_nodeColorByCollection").val()?($("#g_nodeColorAttribute").prop("disabled",!0),$("#g_nodeColor").prop("disabled",!0)):($("#g_nodeColorAttribute").removeAttr("disabled"),$("#g_nodeColor").removeAttr("disabled")),this.noDefinedGraph||""!==$("#g_nodeColorAttribute").val()&&$("#g_nodeColor").prop("disabled",!0),"true"===$("#g_edgeColorByCollection").val()?($("#g_edgeColorAttribute").prop("disabled",!0),$("#g_edgeColor").prop("disabled",!0)):($("#g_edgeColorAttribute").removeAttr("disabled"),$("#g_edgeColor").removeAttr("disabled")),this.noDefinedGraph||""!==$("#g_edgeColorAttribute").val()&&$("#g_edgeColor").prop("disabled",!0)},continueRender:function(){$(this.el).html(this.template.render({general:this.general,specific:this.specific})),arangoHelper.fixTooltips(".gv-tooltips","top"),this.graphConfig?_.each(this.graphConfig,function(e,t){$("#g_"+t).val(e)}):this.noDefinedGraph?this.fitSettingsAQLMode():this.setDefaults(!0),this.handleDependencies()},fitSettingsAQLMode:function(){_.each(["g_nodeStart","g_depth","g_limit","g_renderer","g_nodeLabel","g_nodeLabelByCollection","g_nodeColorAttribute","g_nodeSize","g_edgeLabel","g_edgeColorAttribute","g_edgeLabelByCollection"],function(e){$("#"+e).parent().prev().remove(),$("#"+e).parent().remove()}),$("#saveGraphSettings").remove(),$("#restoreGraphSettings").remove(),$("#g_nodeColorByCollection").val("false"),$("#g_edgeColorByCollection").val("false"),$("#g_nodeSizeByEdges").val("false"),$("#g_edgeType").val("arrow"),$("#g_layout").val("force")}})}(),function(){"use strict";window.GraphViewer=Backbone.View.extend({el:"#content",remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},template:templateEngine.createTemplate("graphViewer2.ejs"),initialize:function(t){var i=this;t.id&&(this.setElement(t.id),this.graphData=t.data,this.aqlMode=!0),t.noDefinedGraph&&(this.noDefinedGraph=t.noDefinedGraph,this.graphData=t.data),this.name=t.name,this.userConfig=t.userConfig,this.documentStore=t.documentStore,void 0!==this.name&&this.collection.fetch({cache:!1,success:function(e){i.model=i.collection.findWhere({_key:t.name}).toJSON()}})},colors:{hotaru:["#364C4A","#497C7F","#92C5C0","#858168","#CCBCA5"],random1:["#292F36","#4ECDC4","#F7FFF7","#DD6363","#FFE66D"],jans:["rgba(166, 109, 161, 1)","rgba(64, 74, 83, 1)","rgba(90, 147, 189, 1)","rgba(153,63,0,1)","rgba(76,0,92,1)","rgba(25,25,25,1)","rgba(0,92,49,1)","rgba(43,206,72,1)","rgba(255,204,153,1)","rgba(128,128,128,1)","rgba(148,255,181,1)","rgba(143,124,0,1)","rgba(157,204,0,1)","rgba(194,0,136,1)","rgba(0,51,128,1)","rgba(255,164,5,1)","rgba(255,168,187,1)","rgba(66,102,0,1)","rgba(255,0,16,1)","rgba(94,241,242,1)","rgba(0,153,143,1)","rgba(224,255,102,1)","rgba(116,10,255,1)","rgba(153,0,0,1)","rgba(255,255,128,1)","rgba(255,255,0,1)","rgba(255,80,5,1)"],gv:["#68BDF6","#6DCE9E","#FF756E","#DE9BF9","#FB95AF","#FFD86E","#A5ABB6"]},activeNodes:[],selectedNodes:{},aqlMode:!1,events:{"click #downloadPNG":"downloadPNG","click #loadFullGraph":"loadFullGraphModal","click #reloadGraph":"reloadGraph","click #settingsMenu":"toggleSettings","click #toggleForce":"toggleLayout","click #selectNodes":"toggleLasso"},cursorX:0,cursorY:0,layouting:!1,model:null,viewStates:{captureMode:!1},graphConfig:null,graphSettings:null,downloadPNG:function(){var e=parseInt($("#graph-container").width(),10);sigma.plugins.image(this.currentGraph,this.currentGraph.renderers[0],{download:!0,size:e,clip:!0,labels:!0,background:"white",zoom:!1})},loadFullGraphModal:function(){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry("load-full-graph-a","Caution","Really load full graph? If no limit is set, your result set could be too big.")),e.push(window.modalView.createSuccessButton("Load full graph",this.loadFullGraph.bind(this))),window.modalView.show("modalTable.ejs","Load full graph",e,t)},loadFullGraph:function(){var t=this,e={};this.graphConfig&&(delete(e=_.clone(this.graphConfig)).layout,delete e.edgeType,delete e.renderer),e.mode="all",$.ajax({type:"GET",url:arangoHelper.databaseUrl("/_admin/aardvark/graph/"+encodeURIComponent(this.name)),contentType:"application/json",data:e,success:function(e){t.killCurrentGraph(),t.renderGraph(e)},error:function(e){console.log(e),arangoHelper.arangoError("Graph","Could not load full graph.")}}),window.modalView.hide()},resize:function(){$("#graph-container").width($(".centralContent").width()),$("#graph-container").height($(".centralRow").height()-155)},toggleSettings:function(){this.graphSettingsView.toggle()},render:function(e){this.$el.html(this.template.render({})),$("#subNavigationBar .breadcrumb").html("Graph: "+this.name),this.resize(),this.fetchGraph(e),this.initFullscreen()},initFullscreen:function(){var t=this;if(!1===window.App.initializedFullscreen||void 0===window.App.initializedFullscreen){window.App.initializedFullscreen=!0,this.isFullscreen=!1;var e=function(e){(document.webkitIsFullScreen||document.mozFullScreen||null!==document.msFullscreenElement)&&(!1===t.isFullscreen?(t.isFullscreen=!0,$("#toggleForce").css("bottom","10px"),$("#toggleForce").css("right","10px"),$("#objectCount").css("bottom","10px"),$("#objectCount").css("left","10px"),$(".nodeInfoDiv").css("top","10px"),$(".nodeInfoDiv").css("left","10px")):(t.isFullscreen=!1,$("#toggleForce").css("bottom","40px"),$("#toggleForce").css("right","40px"),$("#objectCount").css("bottom","50px"),$("#objectCount").css("left","25px"),$(".nodeInfoDiv").css("top",""),$(".nodeInfoDiv").css("left","165px")))};document.addEventListener&&(document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),document.addEventListener("fullscreenchange",e,!1),document.addEventListener("MSFullscreenChange",e,!1))}},renderAQLPreview:function(e){this.$el.html(this.template.render({})),this.$el.find(".headerBar").remove();var t=$(".centralRow").height()-250;this.$el.find("#graph-container").css("height",t),this.graphData.modified=this.parseData(this.graphData.original,this.graphData.graphInfo);var i=!1;try{this.renderGraph(this.graphData.modified,null,!0),i=!0}catch(e){}return i},renderAQL:function(e){this.$el.html(this.template.render({})),$("#subNavigationBar .breadcrumb").html("AQL Graph"),$("#subNavigationBar .bottom").html(""),$(".queries-menu").removeClass("active"),this.resize(),this.graphData.modified=this.parseData(this.graphData.original,this.graphData.graphInfo),this.renderGraph(this.graphData.modified,null,!1),this.initFullscreen(),this.graphSettingsView=new window.GraphSettingsView({name:this.name,userConfig:void 0,saveCallback:void 0,noDefinedGraph:!0}),this.graphSettingsView.render()},killCurrentGraph:function(){if(this.currentGraph&&this.currentGraph.renderers)for(var e in this.currentGraph.renderers)try{this.currentGraph.renderers[e].clear(),this.currentGraph.kill(e)}catch(e){}},rerenderAQL:function(e,t){this.killCurrentGraph(),this.renderGraph(this.graphData.modified,null,!1,e,"canvas"),"true"===$("#g_nodeColorByCollection").val()?this.switchNodeColorByCollection(!0):$("#g_nodeColor").is(":disabled")?this.updateColors(!0,!0,null,null,!0):this.ncolor?this.updateColors(!0,!0,this.ncolor,this.ecolor):this.updateColors(!0,!0,"#2ecc71","#2ecc71"),"true"===$("#g_edgeColorByCollection").val()?this.switchEdgeColorByCollection(!0):$("#g_edgeColor").is(":disabled")?this.updateColors(!0,!0,null,null,!0):this.ecolor?this.updateColors(!0,!0,this.ncolor,this.ecolor):this.updateColors(!0,!0,"#2ecc71","#2ecc71")},buildCollectionColors:function(){var i=this;if(!i.collectionColors){i.collectionColors={};var n=0,t={},o={};_.each(this.currentGraph.graph.nodes(),function(e){t[e.id]=void 0}),_.each(i.currentGraph.graph.edges(),function(e){o[e.id]=void 0}),_.each(t,function(e,t){void 0===i.collectionColors[t.split("/")[0]]&&(i.collectionColors[t.split("/")[0]]={color:i.colors.jans[n]},n++)}),n=0,_.each(o,function(e,t){void 0===i.collectionColors[t.split("/")[0]]&&(i.collectionColors[t.split("/")[0]]={color:i.colors.jans[n]},n++)})}},switchNodeColorByCollection:function(e,t){var i=this;i.buildCollectionColors(),e?(i.currentGraph.graph.nodes().forEach(function(e){e.color=i.collectionColors[e.id.split("/")[0]].color}),i.currentGraph.refresh()):t?this.updateColors(!0,null,null,null,t):this.ncolor?this.updateColors(!0,null,this.ncolor,this.ecolor):this.updateColors(!0,null,"#2ecc71","#2ecc71")},switchEdgeColorByCollection:function(e,t){var i=this;i.buildCollectionColors(),e?(i.currentGraph.graph.edges().forEach(function(e){e.color=i.collectionColors[e.id.split("/")[0]].color}),i.currentGraph.refresh()):t?this.updateColors(!0,null,null,null,t):this.ecolor?this.updateColors(null,!0,this.ncolor,this.ecolor):this.updateColors(null,!0,"#2ecc71","#2ecc71")},buildCollectionSizes:function(){var t=this;if(!t.nodeEdgesCount){t.nodeEdgesCount={};var i={};_.each(this.currentGraph.graph.edges(),function(e){void 0===i[e.id]&&(i[e.id]=!0,void 0===t.nodeEdgesCount[e.source]?t.nodeEdgesCount[e.source]=1:t.nodeEdgesCount[e.source]+=1,void 0===t.nodeEdgesCount[e.target]?t.nodeEdgesCount[e.target]=1:t.nodeEdgesCount[e.target]+=1)})}},switchNodeSizeByCollection:function(e){var t=this;e?(t.buildCollectionSizes(),t.currentGraph.graph.nodes().forEach(function(e){e.size=t.nodeEdgesCount[e.id]})):t.currentGraph.graph.nodes().forEach(function(e){e.size=15}),t.currentGraph.refresh()},switchEdgeType:function(e){var t={nodes:this.currentGraph.graph.nodes(),edges:this.currentGraph.graph.edges(),settings:{}};this.killCurrentGraph(),this.renderGraph(t,null,!1,null,null,e)},switchLayout:function(e){var t={nodes:this.currentGraph.graph.nodes(),edges:this.currentGraph.graph.edges(),settings:{}};this.killCurrentGraph(),this.renderGraph(t,null,!1,e),"true"===$("#g_nodeColorByCollection").val()&&this.switchNodeColorByCollection(!0),"true"===$("#g_edgeColorByCollection").val()?this.switchEdgeColorByCollection(!0):this.switchEdgeColorByCollection(!1)},parseData:function(e,t){var i={},n={},o="#2ecc71",a={nodes:[],edges:[],settings:{}};if(this.ncolor&&(o=this.ncolor),"object"===t){_.each(e,function(e){e.edges&&e.vertices&&(_.each(e.edges,function(e){null!==e&&(n[e._id]={id:e._id,source:e._from,color:"#cccccc",target:e._to})}),_.each(e.vertices,function(e){null!==e&&(i[e._id]={id:e._id,label:e._key,size:.3,color:o,x:Math.random(),y:Math.random()})}))});var r=[];_.each(i,function(e){a.nodes.push(e),r.push(e.id)}),_.each(n,function(e){r.includes(e.source)&&r.includes(e.target)&&a.edges.push(e)})}else"array"===t&&(_.each(e,function(e){i[e._from]=null,i[e._to]=null,a.edges.push({id:e._id,source:e._from,color:"#cccccc",target:e._to})}),_.each(i,function(e,t){a.nodes.push({id:t,label:t,size:.3,color:o,x:Math.random(),y:Math.random()})}));return a},rerender:function(){this.fetchGraph()},fetchGraph:function(t){var n=this;$(this.el).append('<div id="calculatingGraph" style="position: absolute; left: 25px; top: 130px;"><i class="fa fa-circle-o-notch fa-spin" style="margin-right: 10px;"></i><span id="calcText">Fetching graph data. Please wait ... </span></br></br></br><span style="font-weight: 100; opacity: 0.6; font-size: 9pt;">If it`s taking too much time to draw the graph, please navigate to: <a style="font-weight: 500" href="'+window.location.href+'/graphs">Graphs View</a></br>Click the settings icon and reset the display settings.It is possible that the graph is too big to be handled by the browser.</span></div>');var i=function(){var e={};n.graphConfig&&(delete(e=_.clone(n.graphConfig)).layout,delete e.edgeType,delete e.renderer),n.tmpStartNode&&(n.graphConfig?0===n.graphConfig.nodeStart.length&&(e.nodeStart=n.tmpStartNode):e.nodeStart=n.tmpStartNode),n.setupSigma(),n.fetchStarted=new Date,$.ajax({type:"GET",url:arangoHelper.databaseUrl("/_admin/aardvark/graph/"+encodeURIComponent(n.name)),contentType:"application/json",data:e,success:function(e){!0===e.empty?n.renderGraph(e,t):(e.settings&&e.settings.startVertex&&void 0===n.graphConfig.startNode&&void 0===n.tmpStartNode&&(n.tmpStartNode=e.settings.startVertex._id),n.fetchFinished=new Date,n.calcStart=n.fetchFinished,$("#calcText").html("Server response took "+Math.abs(n.fetchFinished.getTime()-n.fetchStarted.getTime())+" ms. Initializing graph engine. Please wait ... "),window.setTimeout(function(){n.renderGraph(e,t)},50))},error:function(e){try{var t;if(e.responseJSON.exception)if(t=e.responseJSON.exception,-1!==e.responseJSON.exception.search("1205")){var i='Starting point: <span style="font-weight: 400">'+n.graphConfig.nodeStart+"</span> is invalid";$("#calculatingGraph").html('<div style="font-weight: 300; font-size: 10.5pt"><span style="font-weight: 400">Stopped. </span></br></br>'+i+'. Please <a style="color: #3498db" href="'+window.location.href+'/settings">choose a different start node.</a></div>')}else $("#calculatingGraph").html("Failed to fetch graph information.");else t=e.responseJSON.errorMessage,$("#calculatingGraph").html("Failed to fetch graph information: "+e.responseJSON.errorMessage);arangoHelper.arangoError("Graph",t)}catch(e){}}})};void 0===n.graphConfig||null===n.graphConfig?n.userConfig.fetch({success:function(e){var t=frontendConfig.db+"_"+n.name;try{n.graphConfig=e.toJSON().graphs[t],n.getGraphSettings(i),void 0===n.graphConfig||null===n.graphConfig?(n.graphSettingsView=new window.GraphSettingsView({name:n.name,userConfig:n.userConfig,saveCallback:n.render}),n.graphSettingsView.setDefaults(!0,!0)):(n.graphSettingsView&&n.graphSettingsView.remove(),n.graphSettingsView=new window.GraphSettingsView({name:n.name,userConfig:n.userConfig,saveCallback:n.render}),n.graphSettingsView.render())}catch(e){n.getGraphSettings(i)}}}):this.getGraphSettings(i)},setupSigma:function(){if(this.graphConfig&&this.graphConfig.edgeLabel){sigma.utils.pkg("sigma.settings");sigma.settings=sigma.utils.extend(sigma.settings||{},{defaultEdgeLabelColor:"#000",defaultEdgeLabelActiveColor:"#000",defaultEdgeLabelSize:12,edgeLabelSize:"fixed",edgeLabelThreshold:1,edgeLabelSizePowRatio:1}),sigma.settings.drawEdgeLabels=!0,sigma.settings.clone=!0}},contextState:{createEdge:!1,_from:!1,_to:!1,fromX:!1,fromY:!1},clearOldContextMenu:function(e){var i=this;$("#nodeContextMenu").remove();$("#graph-container").append('<div id="nodeContextMenu" class="nodeContextMenu animated zoomIn"></div>'),e&&_.each(this.contextState,function(e,t){i.contextState[t]=!1}),document.getElementsByClassName("sigma-mouse")[0].removeEventListener("mousemove",i.drawLine.bind(this),!1)},trackCursorPosition:function(e){this.cursorX=e.x,this.cursorY=e.y},deleteNode:function(e,t){var i,n,o,a=this;n=(i=t||$("#delete-node-attr-id").text()).split("/")[0],o=i.split("/")[1];var r=arangoHelper.databaseUrl("/_api/gharial/"+encodeURIComponent(a.name)+"/vertex/"+encodeURIComponent(i.split("/")[0])+"/"+encodeURIComponent(i.split("/")[1]));if("yes"===$("#delete-node-edges-attr").val())$.ajax({cache:!1,type:"DELETE",contentType:"application/json",url:r,success:function(e){a.currentGraph.graph.dropNode(i),a.currentGraph.refresh()},error:function(){arangoHelper.arangoError("Graph","Could not delete node.")}});else{this.documentStore.deleteDocument(n,o,function(e){e?arangoHelper.arangoError("Graph","Could not delete node."):(a.currentGraph.graph.dropNode(i),a.currentGraph.refresh())})}window.modalView.hide()},deleteNodes:function(){var t=this;try{var e=JSON.parse($("#delete-nodes-arr-id").text());_.each(e,function(e){t.deleteNode(null,e)})}catch(e){}},deleteNodesModal:function(){var t=[];if(_.each(this.selectedNodes,function(e){t.push(e)}),0!==t.length){var e=[],i=[];i.push(window.modalView.createReadOnlyEntry("delete-nodes-arr-id","Really delete nodes",JSON.stringify(t))),e.push(window.modalView.createDeleteButton("Delete",this.deleteNodes.bind(this))),window.modalView.show("modalTable.ejs","Delete nodes",e,i)}else arangoHelper.arangoNotification("Graph","No nodes selected.")},deleteNodeModal:function(e){var t=[],i=[];i.push(window.modalView.createReadOnlyEntry("delete-node-attr-id","Really delete node",e)),this.noDefinedGraph||i.push(window.modalView.createSelectEntry("delete-node-edges-attr","Also delete edges?",void 0,void 0,[{value:"yes",label:"Yes"},{value:"no",label:"No"}])),t.push(window.modalView.createDeleteButton("Delete",this.deleteNode.bind(this))),window.modalView.show("modalTable.ejs","Delete node",t,i)},addNode:function(){var n=this,e=$(".modal-body #new-node-collection-attr").val(),t=$(".modal-body #new-node-key-attr").last().val(),i={};if(""!==t&&void 0!==t&&(i._key=t),this.graphSettings.isSmart){var o=$("#new-smart-key-attr").val();i[this.graphSettings.smartGraphAttribute]=""!==o&&void 0!==o?o:null}this.collection.createNode(n.name,e,i,function(e,t,i){e?arangoHelper.arangoError("Could not create node",i):($("#emptyGraph").remove(),n.currentGraph.graph.addNode({id:t,label:t.split("/")[1]||"",size:n.graphConfig.nodeSize||15,color:n.graphConfig.nodeColor||n.ncolor||"#2ecc71",originalColor:n.graphConfig.nodeColor||n.ncolor||"#2ecc71",x:n.addNodeX+n.currentGraph.camera.x,y:n.addNodeY+n.currentGraph.camera.y}),window.modalView.hide(),n.currentGraph.refresh(),n.cameraToNode(n.currentGraph.graph.nodes(t)))})},deleteEdgeModal:function(e){var t=[],i=[];i.push(window.modalView.createReadOnlyEntry("delete-edge-attr-id","Really delete edge",e)),t.push(window.modalView.createDeleteButton("Delete",this.deleteEdge.bind(this))),window.modalView.show("modalTable.ejs","Delete edge",t,i)},deleteEdge:function(){var t=this,i=$("#delete-edge-attr-id").text(),e=i.split("/")[0],n=i.split("/")[1];this.documentStore.deleteDocument(e,n,function(e){e?arangoHelper.arangoError("Graph","Could not delete edge."):(t.currentGraph.graph.dropEdge(i),t.currentGraph.refresh())}),window.modalView.hide()},addNodeModal:function(){if(0!==this.graphSettings.vertexCollections){var e=[],t=[],i=[];_.each(this.graphSettings.vertexCollections,function(e){i.push({label:e.name,value:e.name})}),t.push(window.modalView.createTextEntry("new-node-key-attr","_key",void 0,"The nodes unique key(optional attribute, leave empty for autogenerated key","is optional: leave empty for autogenerated key",!1,[{rule:Joi.string().allow("").optional(),msg:""}])),this.graphSettings.isSmart&&t.push(window.modalView.createTextEntry("new-smart-key-attr",this.graphSettings.smartGraphAttribute+"*",void 0,"The attribute value that is used to smartly shard the vertices of a graph. \nEvery vertex in this Graph has to have this attribute. \nCannot be modified later.","Cannot be modified later.",!1,[{rule:Joi.string().allow("").optional(),msg:""}])),t.push(window.modalView.createSelectEntry("new-node-collection-attr","Collection",void 0,"Please select the destination for the new node.",i)),e.push(window.modalView.createSuccessButton("Create",this.addNode.bind(this))),window.modalView.show("modalTable.ejs","Create node",e,t)}else arangoHelper.arangoError("Graph","No valid vertex collections found.")},addEdge:function(){var e,o=this,a=o.contextState._from,r=o.contextState._to;e=""===$(".modal-body #new-edge-collection-attr").val()?$(".modal-body #new-edge-collection-attr").text():$(".modal-body #new-edge-collection-attr").val();var t=$(".modal-body #new-edge-key-attr").last().val(),i={_from:a,_to:r};""!==t&&void 0!==t&&(i._key=t),this.collection.createEdge(o.name,e,i,function(e,t,i){if(e)arangoHelper.arangoError("Could not create edge",i);else{var n={source:a,target:r,id:t,color:o.graphConfig.edgeColor||o.ecolor};"true"===o.graphConfig.edgeEditable&&(n.size=1),o.currentGraph.graph.addEdge(n),o.graphConfig&&"curve"===o.graphConfig.edgeType&&sigma.canvas.edges.autoCurve(o.currentGraph),o.currentGraph.refresh()}o.clearOldContextMenu(!0),window.modalView.hide()})},addEdgeModal:function(e){if(0!==e){var t=[],i=[];if(i.push(window.modalView.createTextEntry("new-edge-key-attr","_key",void 0,"The edges unique key(optional attribute, leave empty for autogenerated key","is optional: leave empty for autogenerated key",!1,[{rule:Joi.string().allow("").optional(),msg:""}])),1<e.length){var n=[];_.each(e,function(e){n.push({label:e,value:e})}),i.push(window.modalView.createSelectEntry("new-edge-collection-attr","Edge collection",void 0,"Please select the destination for the new edge.",n))}else i.push(window.modalView.createReadOnlyEntry("new-edge-collection-attr","Edge collection",e[0],"The edge collection to be used."));t.push(window.modalView.createSuccessButton("Create",this.addEdge.bind(this))),window.modalView.show("modalTable.ejs","Create edge",t,i)}else arangoHelper.arangoError("Graph","No valid edge definitions found.")},updateColors:function(t,i,n,o,a){var r=frontendConfig.db+"_"+this.name,s=this;n&&(s.ncolor=n),o&&(s.ecolor=o),this.userConfig.fetch({success:function(e){if(!0===t){s.graphConfig=e.toJSON().graphs[r];try{s.currentGraph.graph.nodes().forEach(function(e){e.color=a?e.sortColor:n})}catch(e){s.graphNotInitialized=!0,s.tmpGraphArray=[t,i,n,o]}}if(!0===i)try{s.currentGraph.graph.edges().forEach(function(e){e.color=a?e.sortColor:o})}catch(e){s.graphNotInitialized=!0,s.tmpGraphArray=[t,i,n,o]}s.currentGraph&&s.currentGraph.refresh()}})},nodesContextMenuCheck:function(e){this.nodesContextEventState=e,this.openNodesDate=new Date},createContextMenu:function(e){var t=this,i=t.cursorX-50,n=t.cursorY-50;this.clearOldContextMenu();var o;$("#nodeContextMenu").css("position","fixed"),$("#nodeContextMenu").css("left",i),$("#nodeContextMenu").css("top",n),$("#nodeContextMenu").width(100),$("#nodeContextMenu").height(100),(o=new wheelnav("nodeContextMenu")).maxPercent=1,o.wheelRadius=50,o.clockwise=!1,o.colors=t.colors.hotaru,o.multiSelect=!0,o.clickModeRotate=!1,o.slicePathFunction=slicePath().DonutSlice,o.createWheel([icon.plus,icon.arrowleft2]),o.navItems[0].selected=!1,o.navItems[0].hovered=!1,o.navItems[0].navigateFunction=function(e){t.clearOldContextMenu(),t.addNodeModal()},o.navItems[1].navigateFunction=function(e){t.clearOldContextMenu()},o.navItems[0].selected=!1,o.navItems[0].hovered=!1},createEdgeContextMenu:function(e,t){var i=this,n=this.cursorX-165,o=this.cursorY-120;this.clearOldContextMenu();var a,r;$("#nodeContextMenu").css("left",n+115),$("#nodeContextMenu").css("top",o+72),$("#nodeContextMenu").width(100),$("#nodeContextMenu").height(100),a=e,(r=new wheelnav("nodeContextMenu")).maxPercent=1,r.wheelRadius=50,r.clockwise=!1,r.colors=["#364C4A","#497C7F","#92C5C0","#858168","#CCBCA5"],r.multiSelect=!0,r.clickModeRotate=!1,r.slicePathFunction=slicePath().DonutSlice,r.createWheel([icon.edit,icon.trash]),r.navItems[0].selected=!1,r.navItems[0].hovered=!1,r.navItems[0].navigateFunction=function(e){i.clearOldContextMenu(),i.editEdge(a)},r.navItems[1].navigateFunction=function(e){i.clearOldContextMenu(),i.deleteEdgeModal(a)},r.navItems[0].selected=!1,r.navItems[0].hovered=!1},createNodeContextMenu:function(e,t){var i,n,o,a=this;_.each(t.data.node,function(e,t){"renderer"===t.substr(0,8)&&"x"===t.charAt(t.length-1)&&(i=e),"renderer"===t.substr(0,8)&&"y"===t.charAt(t.length-1)&&(n=e),"renderer"===t.substr(0,8)&&"e"===t.charAt(t.length-1)&&(o=e)}),void 0===i&&void 0===n&&_.each(t.data.node,function(e,t){"read_cam"===t.substr(0,8)&&"x"===t.charAt(t.length-1)&&(i=e+$("#graph-container").width()/2),"read_cam"===t.substr(0,8)&&"y"===t.charAt(t.length-1)&&(n=e+$("#graph-container").height()/2)});var r=2.5*o;r<75&&(r=75),this.clearOldContextMenu();var s,l,c=$("#graph-container").offset();$("#nodeContextMenu").width(2*r),$("#nodeContextMenu").height(2*r),$("#nodeContextMenu").css("left",i+c.left-r),$("#nodeContextMenu").css("top",n+c.top-r),s=e,(l=new wheelnav("nodeContextMenu")).maxPercent=1,l.wheelRadius=r,l.clockwise=!1,l.colors=["#364C4A","#497C7F","#92C5C0","#858168","#CCBCA5"],l.multiSelect=!1,l.clickModeRotate=!1,l.sliceHoverAttr={stroke:"#fff","stroke-width":2},l.slicePathFunction=slicePath().DonutSlice,a.noDefinedGraph?l.createWheel(["imgsrc:img/gv_edit.png","imgsrc:img/gv_trash.png"]):l.createWheel(["imgsrc:img/gv_edit.png","imgsrc:img/gv_trash.png","imgsrc:img/gv_flag.png","imgsrc:img/gv_link.png","imgsrc:img/gv_expand.png"]),$("#nodeContextMenu").addClass("animated bounceIn"),window.setTimeout(function(){l.navItems[0].navigateFunction=function(e){a.clearOldContextMenu(),a.editNode(s),a.removeHelp()},l.navItems[1].navigateFunction=function(e){a.clearOldContextMenu(),a.deleteNodeModal(s),a.removeHelp()},a.noDefinedGraph||(l.navItems[2].navigateFunction=function(e){a.clearOldContextMenu(),a.setStartNode(s),a.removeHelp()},l.navItems[3].navigateFunction=function(e){a.contextState.createEdge=!0,a.contextState._from=s,a.contextState.fromX=i,a.contextState.fromY=n;var t=document.getElementsByClassName("sigma-mouse")[0];a.drawHelp("Now click destination node, or click background to cancel."),t.addEventListener("mousemove",a.drawLine.bind(this),!1),a.clearOldContextMenu(),a.removeHelp()},l.navItems[4].navigateFunction=function(e){a.clearOldContextMenu(),a.expandNode(s),a.removeHelp()});var e=["Edit the node.","Delete node."];a.noDefinedGraph||(e.push("Set as startnode."),e.push("Draw edge."),e.push("Expand the node.")),_.each(e,function(e,t){l.navItems[t].navTitle.mouseover(function(){a.drawHelp(e)}),l.navItems[t].navTitle.mouseout(function(){a.removeHelp()})}),l.navItems[0].selected=!1,l.navItems[0].hovered=!1},300)},drawHelp:function(e){null===document.getElementById("helpTooltip")?$(this.el).append('<div id="helpTooltip" class="helpTooltip"><span>'+e+"</span></div>"):$("#helpTooltip span").text(e),$("#helpTooltip").show()},removeHelp:function(){$("#helpTooltip").remove()},clearMouseCanvas:function(){var e=document.getElementsByClassName("sigma-mouse")[0];e.getContext("2d").clearRect(0,0,$(e).width(),$(e).height())},expandNode:function(t){var i=this,e={};this.graphConfig&&(delete(e=_.clone(this.graphConfig)).layout,delete e.edgeType,delete e.renderer),e.query='FOR v, e, p IN 1..1 ANY "'+t+'" GRAPH "'+i.name+'" RETURN p',$.ajax({type:"GET",url:arangoHelper.databaseUrl("/_admin/aardvark/graph/"+encodeURIComponent(this.name)),contentType:"application/json",data:e,success:function(e){i.checkExpand(e,t)},error:function(e){arangoHelper.arangoError("Graph","Could not expand node: "+t+".")}}),i.removeHelp()},checkExpand:function(e,i){var n,o=this,t=e.nodes,a=e.edges,r=this.currentGraph.graph.nodes(),s=0,l=0;_.each(t,function(t){n=!1,_.each(r,function(e){!1===n&&(t.id===e.id?(e.id===i&&-1===e.label.indexOf(" (expanded)")&&(e.label=e.label+" (expanded)"),n=!0):n=!1)}),!1===n&&(t.originalColor=t.color,o.currentGraph.graph.addNode(t),s++)}),_.each(a,function(e){void 0===o.currentGraph.graph.edges(e.id)&&(e.originalColor=e.color,o.currentGraph.graph.addEdge(e),l++)}),$("#nodesCount").text(parseInt($("#nodesCount").text(),10)+s),$("#edgesCount").text(parseInt($("#edgesCount").text(),10)+l),(0<s||0<l)&&("force"===o.algorithm?o.startLayout(!0,i):"fruchtermann"===o.algorithm?(sigma.layouts.fruchtermanReingold.start(o.currentGraph),o.currentGraph.refresh(),o.cameraToNode(i,1e3)):"noverlap"===o.algorithm&&o.startLayout(!0,i))},cameraToNode:function(e,t){var i=this;"string"==typeof e&&(e=i.currentGraph.graph.nodes(e));var n=function(e){sigma.misc.animation.camera(i.currentGraph.camera,{x:e.x,y:e.y},{duration:1e3})};t?window.setTimeout(function(){n(e)},t):n(e)},drawLine:function(e){var t=window.App.graphViewer.contextState;if(t.createEdge){var i=t.fromX,n=t.fromY,o=e.offsetX,a=e.offsetY,r=document.getElementsByClassName("sigma-mouse")[0],s=r.getContext("2d");s.clearRect(0,0,$(r).width(),$(r).height()),s.beginPath(),s.moveTo(i,n),s.lineTo(o,a),s.strokeStyle=this.newEdgeColor,s.stroke()}},getGraphSettings:function(n){var o=this;this.userConfig.fetch({success:function(e){var t=frontendConfig.db+"_"+o.name;o.graphConfig=e.toJSON().graphs[t],o.graphSettingsView&&o.graphSettingsView.remove(),o.graphSettingsView=new window.GraphSettingsView({name:o.name,userConfig:o.userConfig,saveCallback:o.render});var i=function(){o.graphSettingsView.render(),n&&n(o.graphConfig)};void 0===o.graphConfig?(o.graphSettingsView.setDefaults(!0,!0),o.userConfig.fetch({success:function(e){o.graphConfig=e.toJSON().graphs[t],i()}})):i()}})},setStartNode:function(e){this.graphConfig.nodeStart=e,this.graphSettingsView.saveGraphSettings(void 0,void 0,e)},editNode:function(e){var t=function(e){this.updateNodeLabel(e)}.bind(this);arangoHelper.openDocEditor(e,"doc",t)},updateNodeLabel:function(e){var t=e[0]._id;if(this.graphConfig.nodeLabel&&this.currentGraph.graph.nodes(t).label!==e[0][this.graphConfig.nodeLabel]){var i=e[0].new[this.graphConfig.nodeLabel];this.currentGraph.graph.nodes(t).label="string"==typeof i?i:JSON.stringify(i),this.currentGraph.refresh({skipIndexation:!0})}},editEdge:function(e){var t=function(e){this.updateEdgeLabel(e)}.bind(this);arangoHelper.openDocEditor(e,"edge",t)},updateEdgeLabel:function(e){var t=e[0]._id;if(this.graphConfig.edgeLabel&&this.currentGraph.graph.edges(t).label!==e[0][this.graphConfig.edgeLabel]){var i=e[0].new[this.graphConfig.edgeLabel];this.currentGraph.graph.edges(t).label="string"==typeof i?i:JSON.stringify(i),this.currentGraph.refresh({skipIndexation:!0})}},reloadGraph:function(){Backbone.history.loadUrl(Backbone.history.fragment)},getEdgeDefinitionCollections:function(i,n){var o=[];return _.each(this.model.edgeDefinitions,function(t){_.each(t.from,function(e){e===i&&_.each(t.to,function(e){e===n&&o.push(t.collection)})})}),o},initializeGraph:function(e,t){e.refresh()},renderGraph:function(e,t,i,n,o,a){var r=this;this.graphSettings=e.settings;var s="#2ecc71";if(r.ncolor&&(s=r.ncolor),e.edges&&e.nodes){0===e.nodes.length&&0===e.edges.length&&e.nodes.push({id:e.settings.startVertex._id,label:e.settings.startVertex._key,size:10,color:s,x:Math.random(),y:Math.random()});this.aqlMode||$("#graph-container").append('<div id="objectCount" style="position: absolute; left: 25px; bottom: 50px; animated fadeIn"><span style="margin-right: 10px" class="arangoState"><span id="nodesCount">'+e.nodes.length+'</span> nodes</span><span class="arangoState"><span id="edgesCount">'+e.edges.length+"</span> edges</span></div>")}this.Sigma=sigma,r.algorithm=n||"force",r.renderer=o||"canvas",this.graphConfig&&(this.graphConfig.layout&&(n||(r.algorithm=this.graphConfig.layout)),this.graphConfig.renderer&&(o||(r.renderer=this.graphConfig.renderer))),"canvas"===r.renderer&&(r.isEditable=!0);var l={scalingMode:"inside",borderSize:3,defaultNodeBorderColor:"#8c8c8c",doubleClickEnabled:!1,minNodeSize:5,labelThreshold:9,maxNodeSize:15,batchEdgesDrawing:!0,minEdgeSize:1,maxEdgeSize:1,enableEdgeHovering:!0,edgeHoverColor:"#8c8c8c",defaultEdgeHoverColor:"#8c8c8c",defaultEdgeType:"arrow",edgeHoverSizeRatio:2.5,edgeHoverExtremities:!0,nodesPowRatio:.5,autoRescale:!0,mouseEnabled:!0,touchEnabled:!0,approximateLabelWidth:!0,font:"Roboto",nodeHaloColor:"rgba(146,197,192, 0.8)",nodeHaloStroke:!1,nodeHaloStrokeColor:"#000",nodeHaloStrokeWidth:0,nodeHaloSize:25,nodeHaloClustering:!1,nodeHaloClusteringMaxRadius:1e3,edgeHaloColor:"#fff",edgeHaloSize:10,drawHalo:!0};"canvas"===r.renderer&&(l.autoCurveSortByDirection=!0),e.nodes&&250<e.nodes.length&&(l.hideEdgesOnMove=!0),this.graphConfig&&this.graphConfig.edgeType&&(l.defaultEdgeType=this.graphConfig.edgeType),a&&(l.defaultEdgeType=a),"arrow"===l.defaultEdgeType&&(l.minArrowSize=7),i&&(r.renderer="canvas",e.nodes.length<500?r.algorithm="fruchtermann":l.scalingMode="outside",l.drawEdgeLabels=!1,l.minNodeSize=2,l.maxNodeSize=8),"webgl"===r.renderer&&(l.enableEdgeHovering=!1);var c=new this.Sigma({graph:e,container:"graph-container",renderer:{container:document.getElementById("graph-container"),type:r.renderer},settings:l});if(this.currentGraph=c,this.aqlMode||sigma.plugins.fullScreen({container:"graph-container",btnId:"graph-fullscreen-btn"}),c.graph.nodes().forEach(function(e){e.originalColor=e.color}),c.graph.edges().forEach(function(e){e.originalColor=e.color}),"noverlap"===r.algorithm)c.configNoverlap({nodeMargin:.1,scaleNodes:1.05,gridSize:75,easing:"quadraticInOut",duration:1500}).bind("start stop interpolate",function(e){e.type,e.type});else if("fruchtermann"===r.algorithm){sigma.layouts.fruchtermanReingold.configure(c,{iterations:100,easing:"quadraticInOut",duration:1500}).bind("start stop interpolate",function(e){})}if(!r.aqlMode){var d=function(e,t){if($(".nodeInfoDiv").remove(),!1===r.contextState.createEdge&&-1<window.location.hash.indexOf("graph")){var i=function(e,t,i){if(e)r.currentGraph.graph.dropNode(i),r.currentGraph.refresh();else{var n="";n+='<span class="title">ID </span> <span class="nodeId">'+t.documents[0]._id+"</span>",3<Object.keys(t.documents[0]).length&&(n+='<span class="title">ATTRIBUTES </span>'),_.each(t.documents[0],function(e,t){"_key"!==t&&"_id"!==t&&"_rev"!==t&&"_from"!==t&&"_to"!==t&&(n+='<span class="nodeAttribute">'+t+"</span>")});var o='<div id="nodeInfoDiv" class="nodeInfoDiv" style="display: none;">'+n+"</div>";$("#graph-container").append(o),r.isFullscreen&&($(".nodeInfoDiv").css("top","10px"),$(".nodeInfoDiv").css("left","10px")),$("#nodeInfoDiv").fadeIn("slow")}};t?r.documentStore.getDocument(e.data.node.id.split("/")[0],e.data.node.id.split("/")[1],i):r.documentStore.getDocument(e.data.edge.id.split("/")[0],e.data.edge.id.split("/")[1],i)}};c.bind("clickNode",function(e){if(!0===r.contextState.createEdge){r.clearMouseCanvas(),r.removeHelp(),r.contextState._to=e.data.node.id;var t=r.contextState._from.split("/")[0],i=r.contextState._to.split("/")[0],n=r.getEdgeDefinitionCollections(t,i);0===n.length?arangoHelper.arangoNotification("Graph","No valid edge definition found."):(r.addEdgeModal(n,r.contextState._from,r.contextState._to),r.clearOldContextMenu(!1))}else r.dragging||(!0===r.contextState.createEdge?r.newEdgeColor="#ff0000":r.newEdgeColor="#000000","canvas"===r.renderer&&r.currentGraph.renderers[0].halo({nodes:r.currentGraph.graph.nodes(),nodeHaloColor:"#DF0101",nodeHaloSize:100}),d(e,!0),r.activeNodes=[e.data.node],"canvas"===r.renderer&&c.renderers[0].halo({nodes:[e.data.node]}),r.createNodeContextMenu(e.data.node.id,e))}),r.noDefinedGraph?c.bind("clickStage",function(e){r.clearOldContextMenu(!0),r.clearMouseCanvas(),r.removeHelp()}):c.bind("clickStage",function(e){e.data.captor.isDragging?(r.clearOldContextMenu(!0),r.clearMouseCanvas()):!0===r.contextState.createEdge?(r.clearOldContextMenu(!0),r.clearMouseCanvas(),r.removeHelp()):($("#nodeContextMenu").is(":visible")?r.clearOldContextMenu(!0):(r.addNodeX=e.data.captor.x,r.addNodeY=e.data.captor.y,r.createContextMenu(e)),r.clearMouseCanvas(),c.renderers[0].halo({nodes:r.activeNodes}))})}if("canvas"===r.renderer){this.graphConfig&&"curve"===this.graphConfig.edgeType&&sigma.canvas.edges.autoCurve(c),c.bind("clickEdge",function(e){d(e,!1)}),c.renderers[0].bind("render",function(e){c.renderers[0].halo({nodes:r.activeNodes})});var u=function(){r.nodeHighlighted=!1,r.activeNodes=[],c.graph.nodes().forEach(function(e){e.color=e.originalColor}),c.graph.edges().forEach(function(e){e.color=e.originalColor}),$(".nodeInfoDiv").remove(),c.refresh({skipIndexation:!0})};c.bind("rightClickStage",function(e){r.nodeHighlighted="undefinedid",u()}),c.bind("rightClickNode",function(e){if(r.nodeHighlighted!==e.data.node.id){var t=e.data.node.id,i=c.graph.neighbors(t);i[t]=e.data.node,c.graph.nodes().forEach(function(e){i[e.id]?e.color=e.originalColor:e.color="#eee"}),c.graph.edges().forEach(function(e){i[e.source]&&i[e.target]?e.color="rgb(64, 74, 83)":e.color="#eee"}),r.nodeHighlighted=!0,c.refresh({skipIndexation:!0})}else u()}),this.graphConfig&&this.graphConfig.edgeEditable&&c.bind("clickEdge",function(e){var t=e.data.edge.id;r.createEdgeContextMenu(t,e)})}if("noverlap"===r.algorithm)c.startNoverlap();else if("force"===r.algorithm){var h="color: rgb(64, 74, 83); cursor: pointer; position: absolute; right: 30px; bottom: 40px; z-index: 9999;";r.aqlMode&&(h="color: rgb(64, 74, 83); cursor: pointer; position: absolute; right: 30px; margin-top: 10px; margin-right: -15px"),$("#graph-container").after('<div id="toggleForce" style="'+h+'"><i style="margin-right: 5px;" class="fa fa-pause"></i><span> Stop layout</span></div>'),r.startLayout();var p=250;e.nodes&&(p=e.nodes.length,i?p<250?p=250:p+=500:(p<=250&&(p=500),p+=500)),e.empty&&arangoHelper.arangoNotification("Graph","Your graph is empty. Click inside the white window to create your first node."),window.setTimeout(function(){r.stopLayout()},p)}else"fruchtermann"===r.algorithm&&sigma.layouts.fruchtermanReingold.start(c);"force"!==r.algorithm&&r.reInitDragListener(),document.getElementsByClassName("sigma-mouse")[0].addEventListener("mousemove",r.trackCursorPosition.bind(this),!1),t&&($("#"+t).focus(),$("#graphSettingsContent").animate({scrollTop:$("#"+t).offset().top},2e3)),$("#calculatingGraph").fadeOut("slow"),i||r.graphConfig&&r.graphConfig.nodeSizeByEdges,r.calcFinished=new Date,!0===e.empty&&$(".sigma-background").before('<span id="emptyGraph" style="position: absolute; margin-left: 10px; margin-top: 10px;">The graph is empty. Please right-click to add a node.<span>'),!0===r.graphNotInitialized&&(r.updateColors(r.tmpGraphArray),r.graphNotInitialized=!1,r.tmpGraphArray=[]),"force"===r.algorithm?$("#toggleForce").fadeIn("fast"):$("#toggleForce").fadeOut("fast")},reInitDragListener:function(){var t=this;void 0!==this.dragListener&&(sigma.plugins.killDragNodes(this.currentGraph),this.dragListener={}),this.dragListener=sigma.plugins.dragNodes(this.currentGraph,this.currentGraph.renderers[0]),this.dragListener.bind("drag",function(e){t.dragging=!0}),this.dragListener.bind("drop",function(e){window.setTimeout(function(){t.dragging=!1},400)})},keyUpFunction:function(e){switch(e.keyCode){case 76:e.altKey&&this.toggleLasso()}},toggleLayout:function(){this.layouting?this.stopLayout():this.startLayout()},startLayout:function(e,t){var i=this;this.currentGraph.settings("drawLabels",!1),this.currentGraph.settings("drawEdgeLabels",!1),sigma.plugins.killDragNodes(this.currentGraph),!0===e&&(this.currentGraph.killForceAtlas2(),window.setTimeout(function(){i.stopLayout(),t&&i.currentGraph.refresh({skipIndexation:!0})},500)),$("#toggleForce .fa").removeClass("fa-play").addClass("fa-pause"),$("#toggleForce span").html("Stop layout"),this.layouting=!0,this.aqlMode,this.currentGraph.startForceAtlas2({worker:!0})},stopLayout:function(){$("#toggleForce .fa").removeClass("fa-pause").addClass("fa-play"),$("#toggleForce span").html("Resume layout"),this.layouting=!1,this.currentGraph.stopForceAtlas2(),this.currentGraph.settings("drawLabels",!0),this.currentGraph.settings("drawEdgeLabels",!0),this.currentGraph.refresh({skipIndexation:!0}),this.reInitDragListener()}})}(),function(){"use strict";window.HelpUsView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("helpUsView.ejs"),render:function(){this.$el.html(this.template.render({}))}})}(),function(){"use strict";window.IndicesView=Backbone.View.extend({el:"#content",initialize:function(e){var t=this;this.collectionName=e.collectionName,this.model=this.collection,t.interval=window.setInterval(function(){-1!==window.location.hash.indexOf("cIndices/"+t.collectionName)&&window.VISIBLE&&$("#collectionEditIndexTable").is(":visible")&&!$("#indexDeleteModal").is(":visible")&&t.rerender()},t.refreshRate)},interval:null,refreshRate:1e4,template:templateEngine.createTemplate("indicesView.ejs"),events:{},remove:function(){return this.interval&&window.clearInterval(this.interval),this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},render:function(){var t=this,i=function(e){$(t.el).html(t.template.render({model:t.model,supported:e.supports.indexes})),t.breadcrumb(),window.arangoHelper.buildCollectionSubNav(t.collectionName,"Indexes"),t.getIndex(),arangoHelper.checkCollectionPermissions(t.collectionName,t.changeViewToReadOnly)};this.engineData?i(this.engineData):$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/engine"),contentType:"application/json",processData:!1,success:function(e){t.engineData=e,i(e)},error:function(){arangoHelper.arangoNotification("Index","Could not fetch index information.")}})},rerender:function(){this.getIndex(!0)},changeViewToReadOnly:function(){$(".breadcrumb").html($(".breadcrumb").html()+" (read-only)"),$("#addIndex").addClass("disabled"),$("#addIndex").css("color","rgba(0,0,0,.5)"),$("#addIndex").css("cursor","not-allowed")},breadcrumb:function(){$("#subNavigationBar .breadcrumb").html("Collection: "+this.collectionName)},getIndex:function(n){var e=function(e,t,i){e?window.arangoHelper.arangoError("Index",t.errorMessage):this.renderIndex(t,i,n)}.bind(this);this.model.getIndex(e)},createIndex:function(){var e,t,i,n,o=this,a={};switch($("#newIndexType").val()){case"Geo":e=$("#newGeoFields").val();var r=o.checkboxToValue("#newGeoJson");a={type:"geo",fields:o.stringToArray(e),geoJson:r};break;case"Persistent":e=$("#newPersistentFields").val(),t=o.checkboxToValue("#newPersistentUnique"),i=o.checkboxToValue("#newPersistentSparse"),n=o.checkboxToValue("#newPersistentDeduplicate"),a={type:"persistent",fields:o.stringToArray(e),unique:t,sparse:i,deduplicate:n};break;case"Hash":e=$("#newHashFields").val(),t=o.checkboxToValue("#newHashUnique"),i=o.checkboxToValue("#newHashSparse"),n=o.checkboxToValue("#newHashDeduplicate"),a={type:"hash",fields:o.stringToArray(e),unique:t,sparse:i,deduplicate:n};break;case"Fulltext":e=$("#newFulltextFields").val();var s=parseInt($("#newFulltextMinLength").val(),10)||0;a={type:"fulltext",fields:o.stringToArray(e),minLength:s};break;case"Skiplist":e=$("#newSkiplistFields").val(),t=o.checkboxToValue("#newSkiplistUnique"),i=o.checkboxToValue("#newSkiplistSparse"),n=o.checkboxToValue("#newSkiplistDeduplicate"),a={type:"skiplist",fields:o.stringToArray(e),unique:t,sparse:i,deduplicate:n}}this.model.createIndex(a,function(e,t){if(e)if(t){var i=JSON.parse(t.responseText);arangoHelper.arangoError("Document error",i.errorMessage)}else arangoHelper.arangoError("Document error","Could not create index.");else arangoHelper.arangoNotification("Index","Creation in progress. This may take a while.");o.toggleNewIndexView(),o.render()})},bindIndexEvents:function(){this.unbindIndexEvents();var t=this;$("#indexEditView #addIndex").bind("click",function(){t.toggleNewIndexView(),$("#cancelIndex").unbind("click"),$("#cancelIndex").bind("click",function(){t.toggleNewIndexView(),t.render()}),$("#createIndex").unbind("click"),$("#createIndex").bind("click",function(){t.createIndex()})}),$("#newIndexType").bind("change",function(){t.selectIndexType()}),$(".deleteIndex").bind("click",function(e){t.prepDeleteIndex(e)}),$("#infoTab a").bind("click",function(e){if($("#indexDeleteModal").remove(),"Indexes"!==$(e.currentTarget).html()||$(e.currentTarget).parent().hasClass("active")||($("#newIndexView").hide(),$("#indexEditView").show(),$("#indexHeaderContent #modal-dialog .modal-footer .button-danger").hide(),$("#indexHeaderContent #modal-dialog .modal-footer .button-success").hide(),$("#indexHeaderContent #modal-dialog .modal-footer .button-notification").hide()),"General"===$(e.currentTarget).html()&&!$(e.currentTarget).parent().hasClass("active")){$("#indexHeaderContent #modal-dialog .modal-footer .button-danger").show(),$("#indexHeaderContent #modal-dialog .modal-footer .button-success").show(),$("#indexHeaderContent #modal-dialog .modal-footer .button-notification").show();var t=$(".index-button-bar2")[0];$("#cancelIndex").is(":visible")&&($("#cancelIndex").detach().appendTo(t),$("#createIndex").detach().appendTo(t))}})},prepDeleteIndex:function(e){var t=this;this.lastTarget=e,this.lastId=$(this.lastTarget.currentTarget).parent().parent().first().children().first().text(),$("#indexDeleteModal").length||($("#content #modal-dialog .modal-footer").after('<div id="indexDeleteModal" style="display:block;" class="alert alert-error modal-delete-confirmation"><strong>Really delete?</strong><button id="indexConfirmDelete" class="button-danger pull-right modal-confirm-delete">Yes</button><button id="indexAbortDelete" class="button-neutral pull-right">No</button></div>'),$("#indexHeaderContent #indexConfirmDelete").unbind("click"),$("#indexHeaderContent #indexConfirmDelete").bind("click",function(){$("#indexHeaderContent #indexDeleteModal").remove(),t.deleteIndex()}),$("#indexHeaderContent #indexAbortDelete").unbind("click"),$("#indexHeaderContent #indexAbortDelete").bind("click",function(){$("#indexHeaderContent #indexDeleteModal").remove()}))},unbindIndexEvents:function(){$("#indexHeaderContent #indexEditView #addIndex").unbind("click"),$("#indexHeaderContent #newIndexType").unbind("change"),$("#indexHeaderContent #infoTab a").unbind("click"),$("#indexHeaderContent .deleteIndex").unbind("click")},deleteIndex:function(){var e=function(e){e?(arangoHelper.arangoError("Could not delete index"),$("tr th:contains('"+this.lastId+"')").parent().children().last().html('<span class="deleteIndex icon_arangodb_roundminus" data-original-title="Delete index" title="Delete index"></span>'),this.model.set("locked",!1)):e||void 0===e||($("tr th:contains('"+this.lastId+"')").parent().remove(),this.model.set("locked",!1))}.bind(this);this.model.set("locked",!0),this.model.deleteIndex(this.lastId,e),$("tr th:contains('"+this.lastId+"')").parent().children().last().html('<i class="fa fa-circle-o-notch fa-spin"></i>')},renderIndex:function(e,i,t){this.index=e;arangoHelper.getAardvarkJobs(function(e,t){if(e)arangoHelper.arangoError("Jobs","Could not read pending jobs.");else{var o=function(e,t,i){e?404===t.responseJSON.code?arangoHelper.deleteAardvarkJob(i):400===t.responseJSON.code?(arangoHelper.arangoError("Index creation failed",t.responseJSON.errorMessage),arangoHelper.deleteAardvarkJob(i)):204===t.responseJSON.code&&arangoHelper.arangoMessage("Index","There is at least one new index in the queue or in the process of being created."):arangoHelper.deleteAardvarkJob(i)};_.each(t,function(n){n.collection===i&&$.ajax({type:"PUT",cache:!1,url:arangoHelper.databaseUrl("/_api/job/"+n.id),contentType:"application/json",success:function(e,t,i){o(!1,e,n.id)},error:function(e){o(!0,e,n.id)}})})}});var r="collectionInfoTh modal-text";if(this.index){var s="",l="";t&&$("#collectionEditIndexTable tbody").empty(),_.each(this.index.indexes,function(e){l="primary"===e.type||"edge"===e.type?'<span class="icon_arangodb_locked" data-original-title="No action"></span>':'<span class="deleteIndex icon_arangodb_roundminus" data-original-title="Delete index" title="Delete index"></span>',void 0!==e.fields&&(s=e.fields.join(", "));var t=e.id.indexOf("/"),i=e.id.substr(t+1,e.id.length),n=e.hasOwnProperty("selectivityEstimate")?(100*e.selectivityEstimate).toFixed(2)+"%":"n/a",o=e.hasOwnProperty("sparse")?e.sparse:"n/a",a=e.hasOwnProperty("deduplicate")?e.deduplicate:"n/a";$("#collectionEditIndexTable").append("<tr><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(i)+"</th><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(e.type)+"</th><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(e.unique)+"</th><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(o)+"</th><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(a)+"</th><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(n)+"</th><th class="+JSON.stringify(r)+">"+arangoHelper.escapeHtml(s)+"</th><th class="+JSON.stringify(r)+">"+l+"</th></tr>")})}this.bindIndexEvents()},selectIndexType:function(){$(".newIndexClass").hide();var e=$("#newIndexType").val();null===e&&(e=$("#newIndexType").children().first().attr("value"),$("#newIndexType").val(arangoHelper.escapeHtml(e))),$("#newIndexType"+e).show()},resetIndexForms:function(){$("#indexHeader input").val("").prop("checked",!1),$("#newIndexType").val("unknown").prop("selected",!0),this.selectIndexType()},toggleNewIndexView:function(){if(!$("#addIndex").hasClass("disabled")){var e=$(".index-button-bar2")[0];$("#indexEditView").is(":visible")?($("#indexEditView").hide(),$("#newIndexView").show(),$("#cancelIndex").detach().appendTo("#indexHeaderContent #modal-dialog .modal-footer"),$("#createIndex").detach().appendTo("#indexHeaderContent #modal-dialog .modal-footer")):($("#indexEditView").show(),$("#newIndexView").hide(),$("#cancelIndex").detach().appendTo(e),$("#createIndex").detach().appendTo(e)),arangoHelper.createTooltips(".index-tooltip"),arangoHelper.fixTooltips(".icon_arangodb, .arangoicon","right"),this.resetIndexForms()}},stringToArray:function(e){var t=[];return e.split(",").forEach(function(e){""!==(e=e.replace(/(^\s+|\s+$)/g,""))&&t.push(e)}),t},checkboxToValue:function(e){return $(e).prop("checked")}})}(),function(){"use strict";window.InfoView=Backbone.View.extend({el:"#content",initialize:function(e){this.collectionName=e.collectionName,this.model=this.collection},events:{},render:function(){this.breadcrumb(),window.arangoHelper.buildCollectionSubNav(this.collectionName,"Info"),this.renderInfoView(),arangoHelper.checkCollectionPermissions(this.collectionName,this.changeViewToReadOnly)},changeViewToReadOnly:function(){$(".breadcrumb").html($(".breadcrumb").html()+" (read-only)")},breadcrumb:function(){$("#subNavigationBar .breadcrumb").html("Collection: "+this.collectionName)},renderInfoView:function(){if(this.model.get("locked"))return 0;var n=function(e,t,i){if(e)arangoHelper.arangoError("Figures","Could not get revision.");else{frontendConfig.isCluster&&0===i.figures.alive.size&&0===i.figures.alive.count&&0===i.figures.datafiles.count&&0===i.figures.datafiles.fileSize&&0===i.figures.journals.count&&0===i.figures.journals.fileSize&&0===i.figures.compactors.count&&0===i.figures.compactors.fileSize&&0===i.figures.dead.size&&0===i.figures.dead.count&&(i.walMessage=" - not ready yet - ");var n={figures:i,revision:t,model:this.model};window.modalView.show("modalCollectionInfo.ejs","Collection: "+this.model.get("name"),[],n,null,null,null,null,null,"content")}}.bind(this),e=function(e,t){if(e)arangoHelper.arangoError("Figures","Could not get figures.");else{var i=t;this.model.getRevision(n,i)}}.bind(this);this.model.getFigures(e)}})}(),function(){"use strict";window.ServiceInstallGitHubView=Backbone.View.extend({el:"#content",readOnly:!1,template:templateEngine.createTemplate("serviceInstallGitHubView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},initialize:function(){window.App.replaceApp&&(this._upgrade=!0)},events:{"click #installGitHubService":"installGitHubService","keydown input":"checkValidators"},checkValidators:function(){1!==window.modalView._validators.length&&(window.modalView.clearValidators(),this.setGithubValidators())},render:function(){return $(this.el).html(this.template.render({services:this.collection,upgrade:this._upgrade})),this.breadcrumb(),this.setGithubValidators(),arangoHelper.createTooltips(".modalTooltips"),this},breadcrumb:function(){var e=this;if(window.App.naviView){var t="New";this._upgrade&&(t="Replace ("+window.App.replaceAppData.mount+")"),$("#subNavigationBar .breadcrumb").html('<a href="#services">Services:</a> '+t),arangoHelper.buildServicesSubNav("GitHub")}else window.setTimeout(function(){e.breadcrumb()},100)},installGitHubService:function(){arangoHelper.createMountPointModal(this.installFoxxFromGithub.bind(this))},installFoxxFromGithub:function(){if(window.modalView.modalTestAll()){var e,t,i,n;this._upgrade?(t=window.App.replaceAppData.mount,i=arangoHelper.getFoxxFlag()):"/"!==(t=window.arangoHelper.escapeHtml($("#new-app-mount").val())).charAt(0)&&(t="/"+t),e=window.arangoHelper.escapeHtml($("#repository").val()),""===window.arangoHelper.escapeHtml($("#tag").val())&&"master";var o={url:window.arangoHelper.escapeHtml($("#repository").val()),version:window.arangoHelper.escapeHtml($("#tag").val())};try{Joi.assert(e,Joi.string().regex(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+$/))}catch(e){return}n=Boolean($("#github-app-islegacy").prop("checked")),this.collection.installFromGithub(o,t,this.installCallback.bind(this),n,i)}},installCallback:function(e){window.App.navigate("#services",{trigger:!0}),window.App.applicationsView.installCallback(e)},setGithubValidators:function(){window.modalView.modalBindValidation({id:"repository",validateInput:function(){return[{rule:Joi.string().required().regex(/^[a-zA-Z0-9_-]+\/[a-zA-Z0-9_-]+$/),msg:"No valid Github account and repository."}]}}),window.modalView.modalTestAll()}})}(),function(){"use strict";window.ServiceInstallNewView=Backbone.View.extend({el:"#content",readOnly:!1,template:templateEngine.createTemplate("serviceInstallNewView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #installNewService":"installNewService","keydown input":"checkValidators"},checkValidators:function(){4!==window.modalView._validators.length&&(window.modalView.clearValidators(),this.setNewAppValidators())},initialize:function(){window.App.replaceApp&&(this._upgrade=!0)},render:function(){return $(this.el).html(this.template.render({services:this.collection,upgrade:this._upgrade})),this.renderSelects(),this.breadcrumb(),this.setNewAppValidators(),arangoHelper.createTooltips(".modalTooltips"),this},installNewService:function(){arangoHelper.createMountPointModal(this.generateNewFoxxApp.bind(this))},generateNewFoxxApp:function(){if(window.modalView.modalTestAll()){var e,t;this._upgrade?(e=window.App.replaceAppData.mount,t=arangoHelper.getFoxxFlag()):"/"!==(e=window.arangoHelper.escapeHtml($("#new-app-mount").val())).charAt(0)&&(e="/"+e);var i={name:window.arangoHelper.escapeHtml($("#new-app-name").val()),documentCollections:_.map($("#new-app-document-collections").select2("data"),function(e){return window.arangoHelper.escapeHtml(e.text)}),edgeCollections:_.map($("#new-app-edge-collections").select2("data"),function(e){return window.arangoHelper.escapeHtml(e.text)}),author:window.arangoHelper.escapeHtml($("#new-app-author").val()),license:window.arangoHelper.escapeHtml($("#new-app-license").val()),description:window.arangoHelper.escapeHtml($("#new-app-description").val())};this.collection.generate(i,e,this.installCallback.bind(this),t)}window.modalView.hide()},checkValidation:function(){window.modalView.modalTestAll()},installCallback:function(e){window.App.navigate("#services",{trigger:!0}),window.App.applicationsView.installCallback(e)},renderSelects:function(){$("#new-app-document-collections").select2({tags:[],showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"}),$("#new-app-edge-collections").select2({tags:[],showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"})},setNewAppValidators:function(){window.modalView.modalBindValidation({id:"new-app-author",validateInput:function(){return[{rule:Joi.string().required().min(1),msg:"Has to be non empty."}]}}),window.modalView.modalBindValidation({id:"new-app-name",validateInput:function(){return[{rule:Joi.string().required().regex(/^[a-zA-Z\-_][a-zA-Z0-9\-_]*$/),msg:"Can only contain a to z, A to Z, 0-9, '-' and '_'. Cannot start with a number."}]}}),window.modalView.modalBindValidation({id:"new-app-description",validateInput:function(){return[{rule:Joi.string().required().min(1),msg:"Has to be non empty."}]}}),window.modalView.modalBindValidation({id:"new-app-license",validateInput:function(){return[{rule:Joi.string().required().regex(/^[a-zA-Z0-9 .,;-]+$/),msg:"Can only contain a to z, A to Z, 0-9, '-', '.', ',' and ';'."}]}}),window.modalView.modalTestAll()},breadcrumb:function(){var e=this;if(window.App.naviView){var t="New";this._upgrade&&(t="Replace ("+window.App.replaceAppData.mount+")"),$("#subNavigationBar .breadcrumb").html('<a href="#services">Services:</a> '+t),arangoHelper.buildServicesSubNav("New")}else window.setTimeout(function(){e.breadcrumb()},100)}})}(),function(){"use strict";window.ServiceInstallView=Backbone.View.extend({el:"#content",readOnly:!1,foxxStoreRetry:0,template:templateEngine.createTemplate("serviceInstallView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #categorySelection":"renderCategories","click #foxxFilters":"resetFilters","keyup #foxxSearch":"search"},initialize:function(e){this.functionsCollection=e.functionsCollection,window.App.replaceApp&&(this._upgrade=!0)},fetchStore:function(){var e=this;this.foxxStoreRetry=1,this.collection.fetch({cache:!1,success:function(){"#services/install"===window.location.hash&&e.render()}})},search:function(){this._installedSubViews[Object.keys(this._installedSubViews)[0]].applyFilter();var t=$("#foxxSearch").val();t?_.each(this._installedSubViews,function(e){e.model.get("name").includes(t)?"true"===$(e.el).attr("shown")&&$(e.el).show():$(e.el).hide()}):this._installedSubViews[Object.keys(this._installedSubViews)[0]].applyFilter()},createSubViews:function(){var i=this;this._installedSubViews={},i.collection.each(function(e){var t=new window.FoxxRepoView({collection:i.functionsCollection,model:e,appsView:i,upgrade:i._upgrade});i._installedSubViews[e.get("name")]=t})},renderCategories:function(e){this._installedSubViews[Object.keys(this._installedSubViews)[0]].renderCategories(e)},resetFilters:function(){$("#foxxSearch").val(""),this._installedSubViews[Object.keys(this._installedSubViews)[0]].resetFilters()},render:function(){if($(this.el).html(this.template.render({services:this.collection})),arangoHelper.buildServicesSubNav("Store"),this.breadcrumb(),0!==this.collection.length||0!==this.foxxStoreRetry)return this.collection.sort(),this.createSubViews(),_.each(this._installedSubViews,function(e){$("#availableFoxxes").append(e.render())}),this;this.fetchStore()},breadcrumb:function(){var e="New";this._upgrade&&(e="Replace ("+window.App.replaceAppData.mount+")"),$("#subNavigationBar .breadcrumb").html('<a href="#services">Services:</a> '+e)}})}(),function(){"use strict";window.ServiceInstallUploadView=Backbone.View.extend({el:"#content",readOnly:!1,template:templateEngine.createTemplate("serviceInstallUploadView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},initialize:function(){window.App.replaceApp&&(this._upgrade=!0)},events:{"click #installUploadService":"installFromUpload"},render:function(){return $(this.el).html(this.template.render({services:this.collection,upgrade:this._upgrade})),this.prepareUpload(),this.breadcrumb(),arangoHelper.createTooltips(".modalTooltips"),this},installFromUpload:function(){arangoHelper.createMountPointModal(this.installFoxxFromZip.bind(this))},testFunction:function(e,t){window.foxxData||(window.foxxData={}),window.foxxData.files=e,window.foxxData.data=t,$("#installUploadService").attr("disabled",!1)},prepareUpload:function(){$("#upload-foxx-zip").uploadFile({url:arangoHelper.databaseUrl("/_api/upload?multipart=true"),allowedTypes:"zip,js",multiple:!1,onSuccess:this.testFunction})},installFoxxFromZip:function(){var e,t,i;(void 0===window.foxxData.data?window.foxxData.data=this._uploadData:this._uploadData=window.foxxData.data,window.foxxData.data&&window.modalView.modalTestAll())&&(this._upgrade?(e=window.App.replaceAppData.mount,t=arangoHelper.getFoxxFlag()):"/"!==(e=window.arangoHelper.escapeHtml($("#new-app-mount").val())).charAt(0)&&(e="/"+e),i=Boolean($("#zip-app-islegacy").prop("checked")),this.collection.installFromZip(window.foxxData.data.filename,e,this.installCallback.bind(this),i,t));window.modalView.hide()},installCallback:function(e){window.App.navigate("#services",{trigger:!0}),window.App.applicationsView.installCallback(e)},breadcrumb:function(){var e=this;if(window.App.naviView){var t="New";this._upgrade&&(t="Replace ("+window.App.replaceAppData.mount+")"),$("#subNavigationBar .breadcrumb").html('<a href="#services">Services:</a> '+t),arangoHelper.buildServicesSubNav("Upload")}else window.setTimeout(function(){e.breadcrumb()},100)}})}(),function(){"use strict";window.ServiceInstallUrlView=Backbone.View.extend({el:"#content",readOnly:!1,template:templateEngine.createTemplate("serviceInstallUrlView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},initialize:function(){window.App.replaceApp&&(this._upgrade=!0)},events:{"click #installUrlService":"installUrlService"},render:function(){return $(this.el).html(this.template.render({services:this.collection,upgrade:this._upgrade})),this.breadcrumb(),this.setUrlValidators(),arangoHelper.createTooltips(".modalTooltips"),this},breadcrumb:function(){var e=this;if(window.App.naviView){var t="New";this._upgrade&&(t="Replace ("+window.App.replaceAppData.mount+")"),$("#subNavigationBar .breadcrumb").html('<a href="#services">Services:</a> '+t),arangoHelper.buildServicesSubNav("Remote")}else window.setTimeout(function(){e.breadcrumb()},100)},installUrlService:function(){arangoHelper.createMountPointModal(this.installFoxxFromUrl.bind(this))},installFoxxFromUrl:function(){if(window.modalView.modalTestAll()){var e,t;this._upgrade?(e=window.App.replaceAppData.mount,t=arangoHelper.getFoxxFlag()):"/"!==(e=window.arangoHelper.escapeHtml($("#new-app-mount").val())).charAt(0)&&(e="/"+e);var i={url:window.arangoHelper.escapeHtml($("#repository").val()),version:"master"};this.collection.installFromUrl(i,e,this.installCallback.bind(this),null,t)}},setUrlValidators:function(){window.modalView.modalBindValidation({id:"repository",validateInput:function(){return[{rule:Joi.string().required().regex(/^(http)|^(https)/),msg:"No valid http or https url."}]}}),window.modalView.modalTestAll()},installCallback:function(e){window.App.navigate("#services",{trigger:!0}),window.App.applicationsView.installCallback(e)}})}(),function(){"use strict";window.LoggerView=Backbone.View.extend({el:"#content",logsel:"#logEntries",id:"#logContent",initDone:!1,pageSize:20,currentPage:0,logTopics:{},logLevels:[],remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},initialize:function(e){var t=this;e&&(this.options=e),this.collection.setPageSize(this.pageSize),this.initDone||$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/log/level"),contentType:"application/json",processData:!1,success:function(e){t.logTopics=e,_.each(["fatal","error","warning","info","debug"],function(e){t.logLevels.push(e)}),t.initDone=!0}})},currentLoglevel:void 0,defaultLoglevel:"info",events:{"click #logLevelSelection":"renderLogLevel","click #logTopicSelection":"renderLogTopic","click #logFilters":"resetFilters","click #loadMoreEntries":"loadMoreEntries"},template:templateEngine.createTemplate("loggerView.ejs"),templateEntries:templateEngine.createTemplate("loggerViewEntries.ejs"),renderLogTopic:function(e){var i,n=this;this.logTopicOptions||(this.logTopicOptions={}),_.each(this.logTopics,function(e,t){n.logTopicOptions[t]&&(i=n.logTopicOptions[t].active),n.logTopicOptions[t]={name:t,active:i||!1}});var t=$(e.currentTarget).position();t.right="30",this.logTopicView=new window.FilterSelectView({name:"Topic",options:n.logTopicOptions,position:t,callback:n.logTopicCallbackFunction.bind(this),multiple:!0}),this.logTopicView.render()},loadMoreEntries:function(){this.convertModelToJSON()},logTopicCallbackFunction:function(e){this.logTopicOptions=e,this.applyFilter()},logLevelCallbackFunction:function(e){this.logLevelOptions=e,this.applyFilter()},resetFilters:function(){_.each(this.logTopicOptions,function(e){e.active=!1}),_.each(this.logLevelOptions,function(e){e.active=!1}),this.applyFilter()},isFilterActive:function(e){var t=!1;return _.each(e,function(e){e.active&&(t=!0)}),t},changeButton:function(e){e?("level"===e?($("#logLevelSelection").addClass("button-success").removeClass("button-default"),$("#logTopicSelection").addClass("button-default").removeClass("button-success"),$("#filterDesc").html(e)):"topic"===e?($("#logTopicSelection").addClass("button-success").removeClass("button-default"),$("#logLevelSelection").addClass("button-default").removeClass("button-success"),$("#filterDesc").html(e)):"both"===e&&($("#logTopicSelection").addClass("button-success").removeClass("button-default"),$("#logLevelSelection").addClass("button-success").removeClass("button-default"),$("#filterDesc").html("level, topic")),$("#logFilters").show()):($("#logTopicSelection").addClass("button-default").removeClass("button-success"),$("#logLevelSelection").addClass("button-default").removeClass("button-success"),$("#logFilters").hide(),$("#filterDesc").html(""))},applyFilter:function(){var t=this,e=this.isFilterActive(this.logLevelOptions),i=this.isFilterActive(this.logTopicOptions);e&&i?(_.each($("#logEntries").children(),function(e){!1===t.logLevelOptions[$(e).attr("level")].active||!1===t.logTopicOptions[$(e).attr("topic")].active?$(e).hide():t.logLevelOptions[$(e).attr("level")].active&&t.logTopicOptions[$(e).attr("topic")].active&&$(e).show()}),this.changeButton("both")):e&&!i?(_.each($("#logEntries").children(),function(e){!1===t.logLevelOptions[$(e).attr("level")].active?$(e).hide():$(e).show()}),this.changeButton("level")):!e&&i?(_.each($("#logEntries").children(),function(e){!1===t.logTopicOptions[$(e).attr("topic")].active?$(e).hide():$(e).show()}),this.changeButton("topic")):e||i||(_.each($("#logEntries").children(),function(e){$(e).show()}),this.changeButton());var n=0;_.each($("#logEntries").children(),function(e){"flex"===$(e).css("display")&&$(e).css("display","block"),"block"===$(e).css("display")&&n++}),1===n?($(".logBorder").css("visibility","hidden"),$("#noLogEntries").hide()):0===n?$("#noLogEntries").show():($(".logBorder").css("visibility","visible"),$("#noLogEntries").hide())},renderLogLevel:function(e){var i,n=this;this.logLevelOptions||(this.logLevelOptions={}),_.each(this.logLevels,function(e){n.logLevelOptions[e]&&(i=n.logLevelOptions[e].active),n.logLevelOptions[e]={name:e,active:i||!1};var t=arangoHelper.statusColors[e];t&&(n.logLevelOptions[e].color=t)});var t=$(e.currentTarget).position();t.right="115",this.logLevelView=new window.FilterSelectView({name:"Level",options:n.logLevelOptions,position:t,callback:n.logLevelCallbackFunction.bind(this),multiple:!1}),this.logLevelView.render()},setActiveLoglevel:function(e){},initTotalAmount:function(){var e=this;this.collection.fetch({data:$.param({test:!0}),success:function(){e.convertModelToJSON()}}),this.fetchedAmount=!0},invertArray:function(e){var t,i=[],n=0;for(t=e.length-1;0<=t;t--)i[n]=e[t],n++;return i},convertModelToJSON:function(){if(this.fetchedAmount){this.collection.page=this.currentPage,this.currentPage++;var t,i=this,n=[];this.collection.fetch({success:function(e){i.collection.each(function(e){t=new Date(1e3*e.get("timestamp")),n.push({status:e.getLogStatus(),date:arangoHelper.formatDT(t),timestamp:e.get("timestamp"),msg:e.get("text"),topic:e.get("topic")})}),i.renderLogs(i.invertArray(n),e.lastInverseOffset)}})}else this.initTotalAmount()},render:function(){var e=this;return this.currentPage=0,this.initDone?($(this.el).html(this.template.render({})),this.convertModelToJSON()):window.setTimeout(function(){e.render()},100),this},renderLogs:function(e,t){_.each(e,function(e){-1<e.msg.indexOf("{"+e.topic+"}")&&(e.msg=e.msg.replace("{"+e.topic+"}",""))}),0===this.currentPage?$(this.logsel).html(this.templateEntries.render({entries:e})):$(this.logsel).append(this.templateEntries.render({entries:e})),t<=0?$("#loadMoreEntries").attr("disabled",!0):$("#loadMoreEntries").attr("disabled",!1),arangoHelper.createTooltips(),this.applyFilter()}})}(),function(){"use strict";window.LoginView=Backbone.View.extend({el:"#content",el2:".header",el3:".footer",loggedIn:!1,loginCounter:0,events:{"keyPress #loginForm input":"keyPress","click #submitLogin":"validate","submit #dbForm":"goTo","click #logout":"logout","change #loginDatabase":"renderDBS","keyup #databaseInputName":"renderDBS"},template:templateEngine.createTemplate("loginView.ejs"),render:function(e){var o=this;$(this.el).html(this.template.render({})),$(this.el2).hide(),$(this.el3).hide();var t=function(e,t,i){var n;n=e?arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(e)+"/database","_system"):arangoHelper.databaseUrl("/_api/database/user"),!1===frontendConfig.authenticationEnabled&&($("#logout").hide(),$(".login-window #databases").css("height","90px")),$("#loginForm").hide(),$(".login-window #databases").show(),$.ajax(n).success(function(e){if($("#loginDatabase").html(""),0<Object.keys(e.result).length){$("#loginDatabase").show(),$(".fa-database").show(),$("#databaseInputName").remove();var t=_.pairs(e.result);t.sort(),t=_.object(t),_.each(t,function(e,t){frontendConfig.authenticationEnabled?$("#loginDatabase").append("<option>"+t+"</option>"):$("#loginDatabase").append("<option>"+e+"</option>")})}else $("#loginDatabase").hide(),$(".fa-database").hide(),$("#loginDatabase").after('<input id="databaseInputName" class="databaseInput login-input" placeholder="_system" value="_system"></input>');o.renderDBS()}).error(function(){t?t():location.reload(!0)})};if(frontendConfig.authenticationEnabled&&!0!==e){var i=arangoHelper.getCurrentJwtUsername();if(null!==i&&"undefined"!==i&&void 0!==i){t(arangoHelper.getCurrentJwtUsername(),function(){o.collection.logout(),window.setTimeout(function(){$("#loginUsername").focus()},300)})}else window.setTimeout(function(){$("#loginUsername").focus()},300)}else frontendConfig.authenticationEnabled&&e?t(arangoHelper.getCurrentJwtUsername(),null):t(null,null);return $(".bodyWrapper").show(),o.checkVersion(),this},checkVersion:function(){var t=this;window.setTimeout(function(){var e=document.getElementById("loginSVG").contentDocument;void 0!==frontendConfig.isEnterprise?(frontendConfig.isEnterprise?e.getElementById("logo-enterprise"):e.getElementById("logo-community")).setAttribute("visibility","visible"):t.checkVersion()},150)},clear:function(){$("#loginForm input").removeClass("form-error"),$(".wrong-credentials").hide()},keyPress:function(e){e.ctrlKey&&13===e.keyCode?(e.preventDefault(),this.validate()):e.metaKey&&13===e.keyCode&&(e.preventDefault(),this.validate())},validate:function(e){e.preventDefault(),this.clear();var t=$("#loginUsername").val(),i=$("#loginPassword").val();t&&this.collection.login(t,i,this.loginCallback.bind(this,t,i))},loginCallback:function(e,t,i){var n=this;if(i){if(0===n.loginCounter)return n.loginCounter++,void n.collection.login(e,t,this.loginCallback.bind(this,e));n.loginCounter=0,$(".wrong-credentials").show(),$("#loginDatabase").html(""),$("#loginDatabase").append("<option>_system</option>")}else n.renderDBSelection(e)},renderDBSelection:function(e){var i=this,t=arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(e)+"/database","_system");!1===frontendConfig.authenticationEnabled&&(t=arangoHelper.databaseUrl("/_api/database/user")),$(".wrong-credentials").hide(),i.loggedIn=!0,$.ajax(t).success(function(e){if($("#loginForm").hide(),$(".login-window #databases").show(),$("#loginDatabase").html(""),0<Object.keys(e.result).length){$("#loginDatabase").show(),$(".fa-database").show(),$("#databaseInputName").remove();var t=_.pairs(e.result);t.sort(),t=_.object(t),_.each(t,function(e,t){frontendConfig.authenticationEnabled?$("#loginDatabase").append("<option>"+t+"</option>"):$("#loginDatabase").append("<option>"+e+"</option>")})}else $("#loginDatabase").hide(),$(".fa-database").hide(),$("#loginDatabase").after('<input id="databaseInputName" class="databaseInput login-input" placeholder="_system" value="_system"></input>');i.renderDBS()}).error(function(){$(".wrong-credentials").show()})},renderDBS:function(){var e="Select DB: ";$("#noAccess").hide(),0===$("#loginDatabase").children().length?$("#loginDatabase").is(":visible")?($("#dbForm").remove(),$(".login-window #databases").prepend('<div class="no-database">You do not have permission to a database.</div>'),e+=$("#loginDatabase").val(),window.setTimeout(function(){$("#goToDatabase").focus()},150)):e+=$("#databaseInputName").val():(e+=$("#loginDatabase").val(),window.setTimeout(function(){$("#goToDatabase").focus()},150)),$("#goToDatabase").html(e)},logout:function(){this.collection.logout()},goTo:function(e){e.preventDefault();var t,i=$("#loginUsername").val();t=$("#databaseInputName").is(":visible")?$("#databaseInputName").val():$("#loginDatabase").val(),window.App.dbSet=t;var n=function(e){e&&arangoHelper.arangoError("User","Could not fetch user settings")},o=window.location.protocol+"//"+window.location.host+frontendConfig.basePath+"/_db/"+t+"/_admin/aardvark/index.html";$.ajax({url:o,success:function(e){!function(){window.location.href=o,$(this.el2).show(),$(this.el3).show(),$(".bodyWrapper").show(),$(".navbar").show(),$("#currentUser").text(i),this.collection.loadUserSettings(n)}()},error:function(e){e.responseJSON&&e.responseJSON.errorMessage?$("#noAccess").html("Error (DB: "+t+"): "+e.responseJSON.errorMessage):$("#noAccess").html("Error (DB: "+t+"): "+e.statusText),$("#noAccess").show()}})}})}(),function(){"use strict";var n=function(e,t,i,n){return{type:e,title:t,callback:i,confirm:n}},u=function(e,t,i,n,o,a,r,s,l,c,d){var u={type:e,label:t};return void 0!==i&&(u.value=i),void 0!==n&&(u.info=n),void 0!==o&&(u.placeholder=o),void 0!==a&&(u.mandatory=a),void 0!==s&&(u.addDelete=s),void 0!==l&&(u.addAdd=l),void 0!==c&&(u.maxEntrySize=c),void 0!==d&&(u.tags=d),r&&(u.validateInput=function(){return r}),u};window.ModalView=Backbone.View.extend({_validators:[],_validateWatchers:[],baseTemplate:templateEngine.createTemplate("modalBase.ejs"),tableTemplate:templateEngine.createTemplate("modalTable.ejs"),el:"#modalPlaceholder",contentEl:"#modalContent",hideFooter:!1,confirm:{list:"#modal-delete-confirmation",yes:"#modal-confirm-delete",no:"#modal-abort-delete"},enabledHotkey:!1,enableHotKeys:!0,buttons:{SUCCESS:"success",NOTIFICATION:"notification",DELETE:"danger",NEUTRAL:"neutral",DISABLED:"disabled",CLOSE:"close"},tables:{READONLY:"readonly",TEXT:"text",BLOB:"blob",PASSWORD:"password",SELECT:"select",SELECT2:"select2",CHECKBOX:"checkbox"},initialize:function(){Object.freeze(this.buttons),Object.freeze(this.tables)},createModalHotkeys:function(){$(this.el).unbind("keydown"),$(this.el).unbind("return"),$("#modal-dialog .modal-body .collectionTh > input").unbind("keydown"),$("#modal-dialog .modal-body .collectionTh > input").unbind("return"),$("#modal-dialog .modal-body .collectionTh > input",$(this.el)).bind("keydown","return",function(){$("#modal-dialog .modal-footer .button-success").is(":disabled")||$("#modal-dialog .modal-footer .button-success").click()}),$("#modal-dialog .modal-body .collectionTh > select").unbind("keydown"),$("#modal-dialog .modal-body .collectionTh > select").unbind("return"),$("#modal-dialog .modal-body .collectionTh > select",$(this.el)).bind("keydown","return",function(){$("#modal-dialog .modal-footer .button-success").is(":disabled")||$("#modal-dialog .modal-footer .button-success").click()})},createInitModalHotkeys:function(){var e=this;$(this.el).bind("keydown","left",function(){e.navigateThroughButtons("left")}),$(this.el).bind("keydown","right",function(){e.navigateThroughButtons("right")})},navigateThroughButtons:function(e){var t=$(".createModalDialog .modal-footer button").is(":focus");!1===t?"left"===e?$(".createModalDialog .modal-footer button").first().focus():"right"===e&&$(".createModalDialog .modal-footer button").last().focus():!0===t&&("left"===e?$(":focus").prev().focus():"right"===e&&$(":focus").next().focus())},createCloseButton:function(e,t){var i=this;return n(this.buttons.CLOSE,e,function(){i.hide(),t&&t()})},createSuccessButton:function(e,t){return n(this.buttons.SUCCESS,e,t)},createNotificationButton:function(e,t){return n(this.buttons.NOTIFICATION,e,t)},createDeleteButton:function(e,t,i){return n(this.buttons.DELETE,e,t,i)},createNeutralButton:function(e,t){return n(this.buttons.NEUTRAL,e,t)},createDisabledButton:function(e){var t=n(this.buttons.DISABLED,e);return t.disabled=!0,t},createReadOnlyEntry:function(e,t,i,n,o,a){var r=u(this.tables.READONLY,t,i,n,void 0,void 0,void 0,o,a);return r.id=e,r},createTextEntry:function(e,t,i,n,o,a,r){var s=u(this.tables.TEXT,t,i,n,o,a,r);return s.id=e,s},createBlobEntry:function(e,t,i,n,o,a,r){var s=u(this.tables.BLOB,t,i,n,o,a,r);return s.id=e,s},createSelect2Entry:function(e,t,i,n,o,a,r,s,l,c){var d=u(this.tables.SELECT2,t,i,n,o,a,void 0,r,s,l,c);return d.id=e,d},createPasswordEntry:function(e,t,i,n,o,a,r){var s=u(this.tables.PASSWORD,t,i,n,o,a,r);return s.id=e,s},createCheckboxEntry:function(e,t,i,n,o){var a=u(this.tables.CHECKBOX,t,i,n);return a.id=e,o&&(a.checked=o),i&&(a.checked=i),a},createSelectEntry:function(e,t,i,n,o){var a=u(this.tables.SELECT,t,null,n);return a.id=e,i&&(a.selected=i),a.options=o,a},createOptionEntry:function(e,t){return{label:e,value:t||e}},show:function(e,t,i,n,o,a,r,s,l,c){var d,u,h,p=this,g=!1;if(i=i||[],s=Boolean(s),this.clearValidators(),0<i.length?(i.forEach(function(e){e.type===p.buttons.CLOSE&&(g=!0),e.type===p.buttons.DELETE&&(u=u||e.confirm)}),g||(d=i.pop(),i.push(p.createCloseButton("Cancel")),i.push(d))):i.push(p.createCloseButton("Close")),c?($("#"+c).html(this.baseTemplate.render({title:t,buttons:i,hideFooter:this.hideFooter,confirm:u,tabBar:l})),$("#"+c+" #modal-dialog").removeClass("fade hide modal"),$("#"+c+" .modal-header").remove(),$("#"+c+" .modal-tabbar").remove(),$("#"+c+" .modal-tabbar").remove(),$("#"+c+" .button-close").remove(),0===$("#"+c+" .modal-footer").children().length&&$("#"+c+" .modal-footer").remove()):$(this.el).html(this.baseTemplate.render({title:t,buttons:i,hideFooter:this.hideFooter,confirm:u,tabBar:l})),_.each(i,function(e,t){if(!e.disabled&&"disabled"!==e.type&&e.callback){if(e.type===p.buttons.DELETE&&!s){var i="#modalButton"+t;return c&&(i="#"+c+" #modalButton"+t),void $(i).bind("click",function(){c?($("#"+c+" "+p.confirm.yes).unbind("click"),$("#"+c+" "+p.confirm.yes).bind("click",e.callback),$("#"+c+" "+p.confirm.list).css("display","block")):($(p.confirm.yes).unbind("click"),$(p.confirm.yes).bind("click",e.callback),$(p.confirm.list).css("display","block"))})}c?$("#"+c+" #modalButton"+t).bind("click",e.callback):$("#modalButton"+t).bind("click",e.callback)}else c?$("#"+c+" #modalButton"+t).attr("disabled",!0):$("#modalButton"+t).attr("disabled",!0)}),c?$("#"+c+" "+this.confirm.no).bind("click",function(){$("#"+c+" "+p.confirm.list).css("display","none")}):$(this.confirm.no).bind("click",function(){$(p.confirm.list).css("display","none")}),"string"==typeof e)h=templateEngine.createTemplate(e),c?$("#"+c+" .createModalDialog .modal-body").html(h.render({content:n,advancedContent:o,info:a})):$("#modalPlaceholder .createModalDialog .modal-body").html(h.render({content:n,advancedContent:o,info:a}));else{var f=0;_.each(e,function(e){h=templateEngine.createTemplate(e),$(".createModalDialog .modal-body .tab-content #"+l[f]).html(h.render({content:n,advancedContent:o,info:a})),f++})}arangoHelper.createTooltips(".createModalDialog .modalTooltips","left");var m,w=n||[];o&&o.content&&(w=w.concat(o.content)),_.each(w,function(e){if(p.modalBindValidation(e),e.type===p.tables.SELECT2){var t={tags:e.tags||[],showSearchBox:!1,minimumResultsForSearch:-1,width:"336px"};e.maxEntrySize&&(t.maximumSelectionSize=e.maxEntrySize),$("#"+e.id).select2(t)}}),r&&(this.events=r,this.delegateEvents()),$("#accordion2")&&($("#accordion2 .accordion-toggle").bind("click",function(){$("#collapseOne").is(":visible")?($("#collapseOne").hide(),setTimeout(function(){$(".accordion-toggle").addClass("collapsed")},100)):($("#collapseOne").show(),setTimeout(function(){$(".accordion-toggle").removeClass("collapsed")},100))}),$("#collapseOne").hide(),setTimeout(function(){$(".accordion-toggle").addClass("collapsed")},100)),c||$("#modal-dialog").modal("show"),!1===this.enabledHotkey&&(this.createInitModalHotkeys(),this.enabledHotkey=!0),this.enableHotKeys&&this.createModalHotkeys(),(m=c?$("#"+c+" #modal-dialog").find("input"):$("#modal-dialog").find("input"))&&setTimeout(function(){0<(m=c?$("#"+c+" #modal-dialog"):$("#modal-dialog")).length&&0<(m=m.find("input")).length&&$(m[0]).focus()},400)},modalBindValidation:function(t){var i=this;if(t.hasOwnProperty("id")&&t.hasOwnProperty("validateInput")){var n=function(){var n=$("#"+t.id),e=t.validateInput(n),o=!1;if(_.each(e,function(t){var e=n.val();if(t.rule||(t={rule:t}),"function"==typeof t.rule)try{t.rule(e)}catch(e){o=t.msg||e.message}else{var i=Joi.validate(e,t.rule);i.error&&(o=t.msg||i.error.message)}if(o)return!1}),o)return o},o=$("#"+t.id);o.on("keyup focusout",function(){var e=n(),t=o.next()[0];e?(o.addClass("invalid-input"),t?$(t).text(e):o.after('<p class="errorMessage">'+e+"</p>"),$("#modal-dialog").is(":visible")?$("#modal-dialog .modal-footer .button-success").prop("disabled",!0).addClass("disabled"):$(".createModalDialog .modal-footer .button-success").prop("disabled",!0).addClass("disabled")):(o.removeClass("invalid-input"),t&&$(t).remove(),i.modalTestAll())}),this._validators.push(n),this._validateWatchers.push(o)}},modalTestAll:function(){var e=_.map(this._validators,function(e){return e()}),t=_.any(e);return t?$("#modal-dialog").is(":visible")?$("#modal-dialog .modal-footer .button-success").prop("disabled",!0).addClass("disabled"):$(".createModalDialog .modal-footer .button-success").prop("disabled",!0).addClass("disabled"):$("#modal-dialog").is(":visible")?$("#modal-dialog .modal-footer .button-success").prop("disabled",!1).removeClass("disabled"):$(".createModalDialog .modal-footer .button-success").prop("disabled",!1).removeClass("disabled"),!t},clearValidators:function(){this._validators=[],_.each(this._validateWatchers,function(e){e.unbind("keyup focusout")}),this._validateWatchers=[]},hide:function(){this.clearValidators(),$("#modal-dialog").modal("hide")}})}(),function(){"use strict";window.NavigationView=Backbone.View.extend({el:"#navigationBar",subEl:"#subNavigationBar",events:{"change #arangoCollectionSelect":"navigateBySelect","click .tab":"navigateByTab","click li":"switchTab","click .arangodbLogo":"selectMenuItem","mouseenter .dropdown > *":"showDropdown","click .shortcut-icons p":"showShortcutModal","mouseleave .dropdown":"hideDropdown"},renderFirst:!0,activeSubMenu:void 0,changeDB:function(){window.location.hash="#login"},initialize:function(e){var t=this;this.userCollection=e.userCollection,this.currentDB=e.currentDB,this.dbSelectionView=new window.DBSelectionView({collection:e.database,current:this.currentDB}),this.userBarView=new window.UserBarView({userCollection:this.userCollection}),this.notificationView=new window.NotificationView({collection:e.notificationCollection}),this.statisticBarView=new window.StatisticBarView({currentDB:this.currentDB}),this.isCluster=e.isCluster,this.handleKeyboardHotkeys(),Backbone.history.on("all",function(){t.selectMenuItem()})},showShortcutModal:function(){arangoHelper.hotkeysFunctions.showHotkeysModal()},handleSelectDatabase:function(){this.dbSelectionView.render($("#dbSelect"))},template:templateEngine.createTemplate("navigationView.ejs"),templateSub:templateEngine.createTemplate("subNavigationView.ejs"),render:function(){arangoHelper.checkDatabasePermissions(this.continueRender.bind(this),this.continueRender.bind(this))},continueRender:function(e){var t=this;$(this.el).html(this.template.render({currentDB:this.currentDB,isCluster:this.isCluster,readOnly:e})),"_system"!==this.currentDB.get("name")&&$("#dashboard").parent().remove(),$(this.subEl).html(this.templateSub.render({currentDB:this.currentDB.toJSON()})),this.dbSelectionView.render($("#dbSelect"));var i=function(e){e||this.userBarView.render()}.bind(this);return this.userCollection.whoAmI(i),this.renderFirst&&(this.renderFirst=!1,this.selectMenuItem(),$(".arangodbLogo").on("click",function(){t.selectMenuItem()}),$("#dbStatus").on("click",function(){t.changeDB()})),t.resize(),!0===window.frontendConfig.isEnterprise?($("#ArangoDBLogo").after('<span id="enterpriseLabel" style="display: none">Enterprise Edition</span>'),$("#enterpriseLabel").fadeIn("slow")):($("#ArangoDBLogo").after('<span id="communityLabel" style="display: none">Community Edition</span>'),$("#communityLabel").fadeIn("slow"),$(".enterprise-menu").show()),this},resize:function(){var e=$(window).height()-$(".subMenuEntries").first().height();$("#navigationBar").css("min-height",e),$("#navigationBar").css("height",e)},navigateBySelect:function(){var e=$("#arangoCollectionSelect").find("option:selected").val();window.App.navigate(e,{trigger:!0})},handleKeyboardHotkeys:function(){arangoHelper.enableKeyboardHotkeys(!0)},navigateByTab:function(e){var t=e.target||e.srcElement,i=t.id,n=!1;"enterprise"!==i&&($(t).hasClass("fa")||(""===i&&(i=$(t).attr("class")),"links"===i?(n=!0,$("#link_dropdown").slideToggle(1),e.preventDefault()):"tools"===i?(n=!0,$("#tools_dropdown").slideToggle(1),e.preventDefault()):"dbselection"===i&&(n=!0,$("#dbs_dropdown").slideToggle(1),e.preventDefault()),n||(window.App.navigate(i,{trigger:!0}),e.preventDefault())))},handleSelectNavigation:function(){var e=this;$("#arangoCollectionSelect").change(function(){e.navigateBySelect()})},subViewConfig:{documents:"collections",collection:"collections"},subMenuConfig:{cluster:[{name:"Dashboard",view:void 0,active:!0}],collections:[{name:"",view:void 0,active:!1}],queries:[{name:"Editor",route:"query",active:!0},{name:"Running Queries",route:"queryManagement",params:{active:!0},active:void 0},{name:"Slow Query History",route:"queryManagement",params:{active:!1},active:void 0}]},renderSubMenu:function(e){var i=this;if(void 0===e&&(e=window.isCluster?"cluster":"dashboard"),this.subMenuConfig[e]){$(this.subEl+" .bottom").html("");var n="";_.each(this.subMenuConfig[e],function(t){n=t.active?"active":"",t.disabled&&(n="disabled"),$(i.subEl+" .bottom").append('<li class="subMenuEntry '+n+'"><a>'+t.name+"</a></li>"),t.disabled||$(i.subEl+" .bottom").children().last().bind("click",function(e){$("#subNavigationBar .breadcrumb").html(""),i.activeSubMenu=t,i.renderSubView(t,e)})})}else $(i.subEl+" .bottom").append('<li class="subMenuEntry</li>')},renderSubView:function(e,t){window.App[e.route]&&(window.App[e.route].resetState&&window.App[e.route].resetState(),window.App[e.route]()),$(this.subEl+" .bottom").children().removeClass("active"),$(t.currentTarget).addClass("active")},switchTab:function(e){var t=$(e.currentTarget).children().first().attr("id");"enterprise"!==t?t&&this.selectMenuItem(t+"-menu"):window.open("https://www.arangodb.com/download-arangodb-enterprise/","_blank")},selectMenuItem:function(t,e){void 0===t&&(t=(t=window.location.hash.split("/")[0]).substr(1,t.length-1)),""===t?t=window.App.isCluster?"cluster":"dashboard":"cNodes"!==t&&"dNodes"!==t||(t="nodes");try{this.renderSubMenu(t.split("-")[0])}catch(e){this.renderSubMenu(t)}$(".navlist li").removeClass("active"),"string"==typeof t&&(e?$("."+this.subViewConfig[t]+"-menu").addClass("active"):t&&($("."+t).addClass("active"),$("."+t+"-menu").addClass("active"))),arangoHelper.hideArangoNotifications()},showSubDropdown:function(e){$(e.currentTarget).find(".subBarDropdown").toggle()},showDropdown:function(e){var t=(e.target||e.srcElement).id;"links"===t||"link_dropdown"===t||"links"===e.currentTarget.id?$("#link_dropdown").fadeIn(1):"tools"===t||"tools_dropdown"===t||"tools"===e.currentTarget.id?$("#tools_dropdown").fadeIn(1):"dbselection"!==t&&"dbs_dropdown"!==t&&"dbselection"!==e.currentTarget.id||$("#dbs_dropdown").fadeIn(1)},hideDropdown:function(e){$("#link_dropdown").fadeOut(1),$("#tools_dropdown").fadeOut(1),$("#dbs_dropdown").fadeOut(1)}})}(),function(){"use strict";window.NodeInfoView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("nodeInfoView.ejs"),initialize:function(e){window.App.isCluster&&(this.nodeId=e.nodeId,this.dbServers=e.dbServers,this.coordinators=e.coordinators)},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},render:function(){this.$el.html(this.template.render({entries:[]}));var e=function(){this.continueRender(),this.breadcrumb(arangoHelper.getCoordinatorShortName(this.nodeId)),$(window).trigger("resize")}.bind(this);this.initCoordDone||this.waitForCoordinators(),this.initDBDone?(this.nodeId=window.location.hash.split("/")[1],this.coordinator=this.coordinators.findWhere({name:this.coordname}),e()):this.waitForDBServers(e)},continueRender:function(){var e,t={};(e=this.coordinator?this.coordinator.toJSON():this.dbServer.toJSON()).name&&(t.Name=e.name),e.address&&(t.Address=e.address),e.status&&(t.Status=e.status),e.protocol&&(t.Protocol=e.protocol),e.role&&(t.Role=e.role),this.$el.html(this.template.render({entries:t}))},breadcrumb:function(e){$("#subNavigationBar .breadcrumb").html("Node: "+e)},waitForCoordinators:function(e){var t=this;window.setTimeout(function(){0===t.coordinators.length?t.waitForCoordinators(e):(t.coordinator=t.coordinators.findWhere({name:t.nodeId}),t.initCoordDone=!0,e&&e())},200)},waitForDBServers:function(e){var t=this;window.setTimeout(function(){0===t.dbServers.length?t.waitForDBServers(e):(t.initDBDone=!0,t.dbServers.each(function(e){e.get("id")===t.nodeId&&(t.dbServer=e)}),e())},200)}})}(),function(){"use strict";window.NodesView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("nodesView.ejs"),interval:1e4,knownServers:[],events:{"click #nodesContent .coords-nodes .pure-table-row":"navigateToNode","click #nodesContent .dbs-nodes .pure-table-row":"navigateToNode","click #nodesContent .coords-nodes .pure-table-row .fa-trash-o":"deleteNode","click #nodesContent .dbs-nodes .pure-table-row .fa-trash-o":"deleteNode","click #addCoord":"addCoord","click #removeCoord":"removeCoord","click #addDBs":"addDBs","click #removeDBs":"removeDBs","click .abortClusterPlan":"abortClusterPlanModal","keyup #plannedCoords":"checkKey","keyup #plannedDBs":"checkKey"},remove:function(){return clearInterval(this.intervalFunction),this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},checkKey:function(e){if(13===e.keyCode){var i=this;this.changePlanModal(function(e){var t;if("plannedCoords"===e.target.id)try{"number"==typeof(t=JSON.parse($("#plannedCoords").val()))?(window.modalView.hide(),i.setCoordSize(t)):arangoHelper.arangoError("Error","Invalid value. Must be a number.")}catch(e){arangoHelper.arangoError("Error","Invalid value. Must be a number.")}else if("plannedDBs"===e.target.id)try{"number"==typeof(t=JSON.parse($("#plannedCoords").val()))?(window.modalView.hide(),i.setDBsSize(t)):arangoHelper.arangoError("Error","Invalid value. Must be a number.")}catch(e){arangoHelper.arangoError("Error","Invalid value. Must be a number.")}}.bind(null,e))}},changePlanModal:function(e,t){var i=[],n=[];n.push(window.modalView.createReadOnlyEntry("plan-confirm-button","Caution","You are changing the cluster plan. Continue?",void 0,void 0,!1,/[<>&'"]/)),i.push(window.modalView.createSuccessButton("Yes",e.bind(this,t))),window.modalView.show("modalTable.ejs","Modify Cluster Size",i,n)},initialize:function(){var e=this;clearInterval(this.intervalFunction),window.App.isCluster&&(this.updateServerTime(),this.intervalFunction=window.setInterval(function(){"#nodes"===window.location.hash&&e.render(!1)},this.interval))},deleteNode:function(e){if(!$(e.currentTarget).hasClass("noHover")){var t=this,i=$(e.currentTarget.parentNode.parentNode).attr("node").slice(0,-5);return window.confirm("Do you want to delete this node?")&&$.ajax({type:"POST",url:arangoHelper.databaseUrl("/_admin/cluster/removeServer"),contentType:"application/json",async:!0,data:JSON.stringify(i),success:function(e){t.render(!1)},error:function(){"#nodes"===window.location.hash&&arangoHelper.arangoError("Cluster","Could not fetch cluster information")}}),!1}},navigateToNode:function(e){var t=$(e.currentTarget).attr("node").slice(0,-5);$(e.currentTarget).hasClass("noHover")||window.App.navigate("#node/"+encodeURIComponent(t),{trigger:!0})},render:function(e){if("#nodes"===window.location.hash){var i=this;$("#content").is(":empty")&&arangoHelper.renderEmpty("Please wait. Requesting cluster information...","fa fa-spin fa-circle-o-notch"),!1!==e&&arangoHelper.buildNodesSubNav("Overview");$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/health"),contentType:"application/json",processData:!1,async:!0,success:function(e){var t;"#nodes"===window.location.hash&&(t=e.Health,$.ajax({type:"GET",url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",success:function(e){"#nodes"===window.location.hash&&i.continueRender(t,e)}}))},error:function(){"#nodes"===window.location.hash&&arangoHelper.arangoError("Cluster","Could not fetch cluster information")}})}},continueRender:function(e,t){var i=[],n=[],o=!1;_.each(e,function(e,t){e.id=t,"Coordinator"===e.Role?i.push(e):"DBServer"===e.Role&&n.push(e)}),i=_.sortBy(i,function(e){return e.ShortName}),n=_.sortBy(n,function(e){return e.ShortName}),null!==t.numberOfDBServers&&null!==t.numberOfCoordinators&&(o=!0);var a=function(e){this.$el.html(this.template.render({coords:i,dbs:n,scaling:o,scaleProperties:e,plannedDBs:t.numberOfDBServers,plannedCoords:t.numberOfCoordinators})),o||($(".title").css("position","relative"),$(".title").css("top","-4px"),$(".sectionHeader .information").css("margin-top","-3px"))}.bind(this);this.renderCounts(o,a)},updatePlanned:function(e){e.numberOfCoordinators&&($("#plannedCoords").val(e.numberOfCoordinators),this.renderCounts(!0)),e.numberOfDBServers&&($("#plannedDBs").val(e.numberOfDBServers),this.renderCounts(!0))},setCoordSize:function(e){var t=this,i={numberOfCoordinators:e};$.ajax({type:"PUT",url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",data:JSON.stringify(i),success:function(){t.updatePlanned(i)},error:function(){arangoHelper.arangoError("Scale","Could not set coordinator size.")}})},setDBsSize:function(e){var t=this,i={numberOfDBServers:e};$.ajax({type:"PUT",url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",data:JSON.stringify(i),success:function(){t.updatePlanned(i)},error:function(){arangoHelper.arangoError("Scale","Could not set coordinator size.")}})},abortClusterPlanModal:function(){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry("plan-abort-button","Caution","You are aborting the planned cluster plan. All pending servers are going to be removed. Continue?",void 0,void 0,!1,/[<>&'"]/)),e.push(window.modalView.createSuccessButton("Yes",this.abortClusterPlan.bind(this))),window.modalView.show("modalTable.ejs","Modify Cluster Size",e,t)},abortClusterPlan:function(){window.modalView.hide();try{var e=JSON.parse($("#infoCoords > .positive > span").text()),t=JSON.parse($("#infoDBs > .positive > span").text());this.setCoordSize(e),this.setDBsSize(t)}catch(e){arangoHelper.arangoError("Plan","Could not abort Cluster Plan")}},renderCounts:function(a,l){var c=this,d=function(e,t,i,n){var o='<span class="positive"><span>'+t+'</span><i class="fa fa-check-circle"></i></span>';i&&!0===a&&(o=o+'<span class="warning"><span>'+i+'</span><i class="fa fa-circle-o-notch fa-spin"></i></span><button class="abortClusterPlan button-navbar button-default">Abort</button>'),n&&(o=o+'<span class="negative"><span>'+n+'</span><i class="fa fa-exclamation-circle"></i></span>'),$(e).html(o),a||($(".title").css("position","relative"),$(".title").css("top","-4px"))};$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/health"),contentType:"application/json",processData:!1,success:function(e){var t,i,n,o,a,r,s;t=e.Health,s=r=a=o=n=i=0,_.each(t,function(e){"Coordinator"===e.Role?"GOOD"===e.Status?n++:i++:"DBServer"===e.Role&&("GOOD"===e.Status?a++:r++)}),$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",processData:!1,success:function(e){o=Math.abs(n+i-e.numberOfCoordinators),s=Math.abs(a+r-e.numberOfDBServers),l?l({coordsPending:o,coordsOk:n,coordsErrors:i,dbsPending:s,dbsOk:a,dbsErrors:r}):(d("#infoDBs",a,s,r),d("#infoCoords",n,o,i)),c.isPlanFinished()||($(".scaleGroup").addClass("no-hover"),$("#plannedCoords").attr("disabled","disabled"),$("#plannedDBs").attr("disabled","disabled"))}})}})},isPlanFinished:function(){return!(0<$("#infoDBs").find(".warning").length)&&!(0<$("#infoCoords").find(".warning").length)},addCoord:function(){this.isPlanFinished()?this.changePlanModal(function(){window.modalView.hide(),this.setCoordSize(this.readNumberFromID("#plannedCoords",!0))}.bind(this)):(arangoHelper.arangoNotification("Cluster Plan","Planned state not yet finished."),$(".noty_buttons .button-danger").remove())},removeCoord:function(){this.isPlanFinished()?this.changePlanModal(function(){window.modalView.hide(),this.setCoordSize(this.readNumberFromID("#plannedCoords",!1,!0))}.bind(this)):(arangoHelper.arangoNotification("Cluster Plan","Planned state not yet finished."),$(".noty_buttons .button-danger").remove())},addDBs:function(){this.isPlanFinished()?this.changePlanModal(function(){window.modalView.hide(),this.setDBsSize(this.readNumberFromID("#plannedDBs",!0))}.bind(this)):(arangoHelper.arangoNotification("Cluster Plan","Planned state not yet finished."),$(".noty_buttons .button-danger").remove())},removeDBs:function(){this.isPlanFinished()?this.changePlanModal(function(){window.modalView.hide(),this.setDBsSize(this.readNumberFromID("#plannedDBs",!1,!0))}.bind(this)):(arangoHelper.arangoNotification("Cluster Plan","Planned state not yet finished."),$(".noty_buttons .button-danger").remove())},readNumberFromID:function(e,t,i){var n=$(e).val(),o=!1;try{o=JSON.parse(n)}catch(e){}return t&&o++,i&&1!==o&&o--,o},updateServerTime:function(){this.serverTime=(new Date).getTime()}})}(),function(){"use strict";window.NodeView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("nodeView.ejs"),interval:5e3,dashboards:[],events:{},initialize:function(e){window.App.isCluster&&(this.coordinators=e.coordinators,this.dbServers=e.dbServers,this.coordid=e.coordid,this.updateServerTime())},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},breadcrumb:function(e){$("#subNavigationBar .breadcrumb").html("Node: "+e)},render:function(){this.$el.html(this.template.render({coords:[]}));var e=function(){this.continueRender(),this.breadcrumb(arangoHelper.getCoordinatorShortName(this.coordid)),$(window).trigger("resize")}.bind(this);this.initCoordDone||this.waitForCoordinators(),this.initDBDone?(this.coordid=window.location.hash.split("/")[1],this.coordinator=this.coordinators.findWhere({id:this.coordid}),e()):this.waitForDBServers(e)},continueRender:function(){var e,t=this;if(this.coordinator)e=this.coordinator.get("name"),this.dashboards[this.coordinator.get("name")]=new window.DashboardView({dygraphConfig:window.dygraphConfig,database:window.App.arangoDatabase,serverToShow:{raw:this.coordinator.get("address"),isDBServer:!1,endpoint:this.coordinator.get("protocol")+"://"+this.coordinator.get("address"),target:this.coordinator.get("id")}});else{var i=this.dbServer.toJSON();e=i.name,this.dashboards[i.name]=new window.DashboardView({dygraphConfig:null,database:window.App.arangoDatabase,serverToShow:{raw:i.address,isDBServer:!0,endpoint:i.endpoint,id:i.id,name:i.name,status:i.status,target:i.id}})}this.dashboards[e].render(),window.setTimeout(function(){t.dashboards[e].resize()},500)},waitForCoordinators:function(e){var t=this;window.setTimeout(function(){0===t.coordinators.length?t.waitForCoordinators(e):(t.coordinator=t.coordinators.findWhere({id:t.coordid}),t.initCoordDone=!0,e&&e())},200)},waitForDBServers:function(e){var i=this;window.setTimeout(function(){0===i.dbServers[0].length?i.waitForDBServers(e):(i.initDBDone=!0,i.dbServer=i.dbServers[0],i.dbServer.each(function(e){var t=e.get("id");t===window.location.hash.split("/")[1]&&(i.dbServer=i.dbServer.findWhere({id:t}))}),e())},200)},updateServerTime:function(){this.serverTime=(new Date).getTime()}})}(),function(){"use strict";window.NotificationView=Backbone.View.extend({events:{"click .navlogo #stat_hd":"toggleNotification","click .notificationItem .fa":"removeNotification","click #removeAllNotifications":"removeAllNotifications"},initialize:function(){this.collection.bind("add",this.renderNotifications.bind(this)),this.collection.bind("remove",this.renderNotifications.bind(this)),this.collection.bind("reset",this.renderNotifications.bind(this)),window.setTimeout(function(){!1===frontendConfig.authenticationEnabled&&!1===frontendConfig.isCluster&&!0===arangoHelper.showAuthDialog()&&window.arangoHelper.arangoWarning("Warning","Authentication is disabled. Do not use this setup in production mode.")},2e3)},notificationItem:templateEngine.createTemplate("notificationItem.ejs"),el:"#notificationBar",template:templateEngine.createTemplate("notificationView.ejs"),toggleNotification:function(){0!==this.collection.length&&$("#notification_menu").toggle()},removeAllNotifications:function(){$.noty.clearQueue(),$.noty.closeAll(),this.collection.reset(),$("#notification_menu").hide()},removeNotification:function(e){var t=e.target.id;this.collection.get(t).destroy()},renderNotifications:function(e,t,i){if(i&&i.add){var n,o=this.collection.at(this.collection.length-1),a=o.get("title"),r=5e3,s=["click"];if(o.get("content")&&(a=a+": "+o.get("content")),"error"===o.get("type")?(r=!1,s=["button"],n=[{addClass:"button-danger",text:"Close",onClick:function(e){e.close()}}]):"warning"===o.get("type")&&(r=15e3,n=[{addClass:"button-warning",text:"Close",onClick:function(e){e.close()}},{addClass:"button-danger",text:"Don't show again.",onClick:function(e){e.close(),window.arangoHelper.doNotShowAgain()}}]),$.noty.clearQueue(),$.noty.closeAll(),noty({theme:"relax",text:a,template:'<div class="noty_message arango_message"><div><i class="fa fa-close"></i></div><span class="noty_text arango_text"></span><div class="noty_close arango_close"></div></div>',maxVisible:1,closeWith:["click"],type:o.get("type"),layout:"bottom",timeout:r,buttons:n,animation:{open:{height:"show"},close:{height:"hide"},easing:"swing",speed:200,closeWith:s}}),"success"===o.get("type"))return void o.destroy()}$("#stat_hd_counter").text(this.collection.length),0===this.collection.length?($("#stat_hd").removeClass("fullNotification"),$("#notification_menu").hide()):$("#stat_hd").addClass("fullNotification"),$(".innerDropdownInnerUL").html(this.notificationItem.render({notifications:this.collection})),$(".notificationInfoIcon").tooltip({position:{my:"left top",at:"right+55 top-1"}})},render:function(){return $(this.el).html(this.template.render({notifications:this.collection})),this.renderNotifications(),this.delegateEvents(),this.el}})}(),function(){"use strict";window.ProgressView=Backbone.View.extend({template:templateEngine.createTemplate("progressBase.ejs"),el:"#progressPlaceholder",el2:"#progressPlaceholderIcon",toShow:!1,lastDelay:0,action:function(){},events:{"click .progress-action button":"performAction"},performAction:function(){"function"==typeof this.action&&this.action(),window.progressView.hide()},initialize:function(){},showWithDelay:function(e,t,i,n){var o=this;o.toShow=!0,o.lastDelay=e,setTimeout(function(){!0===o.toShow&&o.show(t,i,n)},o.lastDelay)},show:function(e,t,i){$(this.el).html(this.template.render({})),$(".progress-text").text(e),i?$(".progress-action").html('<button class="button-danger">'+i+"</button>"):$(".progress-action").html('<button class="button-danger">Cancel</button>'),this.action=t||this.hide(),$(this.el).show()},hide:function(){this.toShow=!1,$(this.el).hide(),this.action=function(){}}})}(),function(){"use strict";window.QueryManagementView=Backbone.View.extend({el:"#content",id:"#queryManagementContent",templateActive:templateEngine.createTemplate("queryManagementViewActive.ejs"),templateSlow:templateEngine.createTemplate("queryManagementViewSlow.ejs"),table:templateEngine.createTemplate("arangoTable.ejs"),active:!0,shouldRender:!0,timer:0,refreshRate:2e3,initialize:function(){var e=this;this.activeCollection=new window.QueryManagementActive,this.slowCollection=new window.QueryManagementSlow,this.convertModelToJSON(!0),e.interval=window.setInterval(function(){"#queries"===window.location.hash&&window.VISIBLE&&e.shouldRender&&"queryManagement"===arangoHelper.getCurrentSub().route&&(e.active?$("#arangoQueryManagementTable").is(":visible")&&e.convertModelToJSON(!0):$("#arangoQueryManagementTable").is(":visible")&&e.convertModelToJSON(!1))},e.refreshRate)},remove:function(){return this.interval&&window.clearInterval(this.interval),this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #deleteSlowQueryHistory":"deleteSlowQueryHistoryModal","click #arangoQueryManagementTable .fa-minus-circle":"deleteRunningQueryModal"},tableDescription:{id:"arangoQueryManagementTable",titles:["ID","Query String","Bind parameter","Runtime","Started",""],rows:[],unescaped:[!1,!1,!1,!1,!1,!0]},deleteRunningQueryModal:function(e){this.killQueryId=$(e.currentTarget).attr("data-id");var t=[],i=[];i.push(window.modalView.createReadOnlyEntry(void 0,"Running Query","Do you want to kill the running query?",void 0,void 0,!1,void 0)),t.push(window.modalView.createDeleteButton("Kill",this.killRunningQuery.bind(this))),window.modalView.show("modalTable.ejs","Kill Running Query",t,i),$(".modal-delete-confirmation strong").html("Really kill?")},killRunningQuery:function(){this.collection.killRunningQuery(this.killQueryId,this.killRunningQueryCallback.bind(this)),window.modalView.hide()},killRunningQueryCallback:function(){this.convertModelToJSON(!0),this.renderActive()},deleteSlowQueryHistoryModal:function(){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry(void 0,"Slow Query Log","Do you want to delete the slow query log entries?",void 0,void 0,!1,void 0)),e.push(window.modalView.createDeleteButton("Delete",this.deleteSlowQueryHistory.bind(this))),window.modalView.show("modalTable.ejs","Delete Slow Query Log",e,t)},deleteSlowQueryHistory:function(){this.collection.deleteSlowQueryHistory(this.slowQueryCallback.bind(this)),window.modalView.hide()},slowQueryCallback:function(){this.convertModelToJSON(!1),this.renderSlow()},render:function(){arangoHelper.getCurrentSub().params.active?(this.active=!0,this.convertModelToJSON(!0)):(this.active=!1,this.convertModelToJSON(!1))},addEvents:function(){var e=this;$("#queryManagementContent tbody").on("mousedown",function(){clearTimeout(e.timer),e.shouldRender=!1}),$("#queryManagementContent tbody").on("mouseup",function(){e.timer=window.setTimeout(function(){e.shouldRender=!0},3e3)})},renderActive:function(){this.$el.html(this.templateActive.render({})),$(this.id).append(this.table.render({content:this.tableDescription,type:{1:"pre",2:"pre"}})),$("#activequeries").addClass("arango-active-tab"),this.addEvents()},renderSlow:function(){this.$el.html(this.templateSlow.render({})),$(this.id).append(this.table.render({content:this.tableDescription,type:{1:"pre",2:"pre"}})),$("#slowqueries").addClass("arango-active-tab"),this.addEvents()},convertModelToJSON:function(i){var t=this,n=[];this.collection=!0===i?this.activeCollection:this.slowCollection,this.collection.fetch({success:function(){t.collection.each(function(e){var t="";i&&(t='<i data-id="'+e.get("id")+'" class="fa fa-minus-circle"></i>'),n.push([e.get("id"),e.get("query"),JSON.stringify(e.get("bindVars"),null,2),e.get("runTime").toFixed(2)+" s",e.get("started"),t])});var e="No running queries.";i||(e="No slow queries."),0===n.length&&n.push([e,"","","",""]),t.tableDescription.rows=n,i?t.renderActive():t.renderSlow()}})}})}(),function(){"use strict";window.QueryView=Backbone.View.extend({el:"#content",bindParamId:"#bindParamEditor",myQueriesId:"#queryTable",template:templateEngine.createTemplate("queryView.ejs"),table:templateEngine.createTemplate("arangoTable.ejs"),outputDiv:"#outputEditors",outputTemplate:templateEngine.createTemplate("queryViewOutput.ejs"),outputCounter:0,maps:{},allowUpload:!1,renderComplete:!1,loadedCachedQuery:!1,customQueries:[],cachedQueries:{},queriesHistory:{},graphViewers:[],queries:[],state:{lastQuery:{query:void 0,bindParam:void 0}},graphs:[],settings:{aqlWidth:void 0},currentQuery:{},initDone:!1,bindParamRegExp:/@(@?\w+\d*)/,bindParamTableObj:{},bindParamMode:"table",bindParamTableDesc:{id:"arangoBindParamTable",titles:["Key","Value"],rows:[]},myQueriesTableDesc:{id:"arangoMyQueriesTable",titles:["Name","Actions"],rows:[]},execPending:!1,aqlEditor:null,queryPreview:null,initialize:function(){this.refreshAQL()},allowParamToggle:!0,events:{"click #executeQuery":"executeQuery","click #explainQuery":"explainQuery","click #profileQuery":"profileQuery","click #debugQuery":"debugDownloadDialog","click #clearQuery":"clearQuery","click .outputEditorWrapper #downloadQueryResult":"downloadQueryResult","click .outputEditorWrapper #downloadCsvResult":"downloadCsvResult","click .outputEditorWrapper .switchAce span":"switchAce","click .outputEditorWrapper .closeResult":"closeResult","click #toggleQueries1":"toggleQueries","click #toggleQueries2":"toggleQueries","click #createNewQuery":"createAQL","click #saveCurrentQuery":"addAQL","click #updateCurrentQuery":"updateAQL","click #exportQuery":"exportCustomQueries","click #importQuery":"openImportDialog","click #removeResults":"removeResults","click #querySpotlight":"showSpotlight","click #deleteQuery":"selectAndDeleteQueryFromTable","click #explQuery":"selectAndExplainQueryFromTable","click .closeProfile":"closeProfile","keydown #arangoBindParamTable input":"updateBindParams","change #arangoBindParamTable input":"updateBindParams","change #querySize":"storeQuerySize","click #arangoMyQueriesTable tbody tr":"showQueryPreview","dblclick #arangoMyQueriesTable tbody tr":"selectQueryFromTable","click #arangoMyQueriesTable #copyQuery":"selectQueryFromTable","click #closeQueryModal":"closeExportDialog","click #confirmQueryImport":"importCustomQueries","click #switchTypes":"toggleBindParams","click #arangoMyQueriesTable #runQuery":"selectAndRunQueryFromTable"},clearQuery:function(){this.aqlEditor.setValue("",1)},closeProfile:function(e){var t=$(e.currentTarget).parent().attr("counter");_.each($(".queryProfile"),function(e){$(e).attr("counter")===t&&$(e).fadeOut("fast").remove()})},storeQuerySize:function(e){"undefined"!=typeof Storage&&sessionStorage.setItem("querySize",$(e.currentTarget).val())},restoreQuerySize:function(){"undefined"!=typeof Storage&&sessionStorage.getItem("querySize")&&$("#querySize").val(sessionStorage.getItem("querySize"))},toggleBindParams:function(){this.allowParamToggle?($("#bindParamEditor").toggle(),$("#bindParamAceEditor").toggle(),"JSON"===$("#switchTypes").text()?(this.bindParamMode="json",$("#switchTypes").text("Table"),this.updateQueryTable(),this.bindParamAceEditor.setValue(JSON.stringify(this.bindParamTableObj,null,"\t"),1),this.deselect(this.bindParamAceEditor)):(this.bindParamMode="table",$("#switchTypes").text("JSON"),this.renderBindParamTable()),this.setCachedQuery(this.aqlEditor.getValue(),JSON.stringify(this.bindParamTableObj))):arangoHelper.arangoError("Bind parameter","Could not parse bind parameter"),this.resize()},openExportDialog:function(){$("#queryImportDialog").modal("show")},closeExportDialog:function(){$("#queryImportDialog").modal("hide")},initQueryImport:function(){var t=this;t.allowUpload=!1,$("#importQueries").change(function(e){t.files=e.target.files||e.dataTransfer.files,t.file=t.files[0],t.allowUpload=!0,$("#confirmQueryImport").removeClass("disabled")})},importCustomQueries:function(){var e=this;if(!0===this.allowUpload){var t=function(){this.collection.fetch({success:function(){e.updateLocalQueries(),e.updateQueryTable(),e.resize(),e.allowUpload=!1,$("#confirmQueryImport").addClass("disabled"),$("#queryImportDialog").modal("hide")},error:function(e){arangoHelper.arangoError("Custom Queries",e.responseText)}})}.bind(this);e.collection.saveImportQueries(e.file,t.bind(this))}},removeResults:function(){var t=this;this.cachedQueries={},this.queriesHistory={},_.each($(".outputEditorWrapper"),function(e){t.closeAceResults(e.id.replace(/^\D+/g,""))})},removeInputEditors:function(){this.closeAceResults(null,$("#aqlEditor")),this.closeAceResults(null,$("#bindParamAceEditor"))},getCustomQueryParameterByName:function(e){return this.collection.findWhere({name:e}).get("parameter")},getCustomQueryValueByName:function(t){var i;return t&&(i=this.collection.findWhere({name:t})),i?i=i.get("value"):_.each(this.queries,function(e){e.name===t&&(i=e.value)}),i},openImportDialog:function(){$("#queryImportDialog").modal("show")},closeImportDialog:function(){$("#queryImportDialog").modal("hide")},exportCustomQueries:function(){var i,n=this;$.ajax("whoAmI?_="+Date.now()).success(function(e){if(null!==(i=e.user)&&!1!==i||(i="root"),frontendConfig.ldapEnabled)n.collection.downloadLocalQueries();else{var t="query/download/"+encodeURIComponent(i);arangoHelper.download(t)}})},toggleQueries:function(e){e?"toggleQueries1"===e.currentTarget.id?(this.updateQueryTable(),$("#bindParamAceEditor").hide(),$("#bindParamEditor").show(),$("#switchTypes").text("JSON"),$(".aqlEditorWrapper").first().width(.33*$(window).width()),this.queryPreview.setValue("No query selected.",1),this.deselect(this.queryPreview)):($("#updateCurrentQuery").hide(),void 0===this.settings.aqlWidth?$(".aqlEditorWrapper").first().width(.33*$(window).width()):$(".aqlEditorWrapper").first().width(this.settings.aqlWidth),"undefined"!==sessionStorage.getItem("lastOpenQuery")&&$("#updateCurrentQuery").show()):void 0===this.settings.aqlWidth?$(".aqlEditorWrapper").first().width(.33*$(window).width()):$(".aqlEditorWrapper").first().width(this.settings.aqlWidth),this.resize();_.each(["aqlEditor","queryTable","previewWrapper","querySpotlight","bindParamEditor","toggleQueries1","toggleQueries2","createNewQuery","saveCurrentQuery","querySize","executeQuery","switchTypes","explainQuery","profileQuery","debugQuery","importQuery","exportQuery"],function(e){$("#"+e).toggle()}),this.resize()},showQueryPreview:function(e){$("#arangoMyQueriesTable tr").removeClass("selected"),$(e.currentTarget).addClass("selected");var t=this.getQueryNameFromTable(e);this.queryPreview.setValue(this.getCustomQueryValueByName(t),1),this.deselect(this.queryPreview)},getQueryNameFromTable:function(e){var t;return $(e.currentTarget).is("tr")?t=$(e.currentTarget).children().first().text():$(e.currentTarget).is("span")&&(t=$(e.currentTarget).parent().parent().prev().text()),t},deleteQueryModal:function(e){var t=[],i=[];i.push(window.modalView.createReadOnlyEntry(void 0,e,"Do you want to delete the query?",void 0,void 0,!1,void 0)),t.push(window.modalView.createDeleteButton("Delete",this.deleteAQL.bind(this,e))),window.modalView.show("modalTable.ejs","Delete Query",t,i)},selectAndDeleteQueryFromTable:function(e){var t=this.getQueryNameFromTable(e);this.deleteQueryModal(t)},selectAndExplainQueryFromTable:function(e){this.selectQueryFromTable(e,!1),this.explainQuery()},selectAndRunQueryFromTable:function(e){this.selectQueryFromTable(e,!1),this.executeQuery()},selectQueryFromTable:function(e,t){var i=this.getQueryNameFromTable(e),n=this;void 0===t&&this.toggleQueries();var o=sessionStorage.getItem("lastOpenQuery");this.state.lastQuery.query=this.aqlEditor.getValue(),this.state.lastQuery.bindParam=this.bindParamTableObj,this.aqlEditor.setValue(this.getCustomQueryValueByName(i),1),this.fillBindParamTable(this.getCustomQueryParameterByName(i)),this.updateBindParams(),this.currentQuery=this.collection.findWhere({name:i}),this.currentQuery&&sessionStorage.setItem("lastOpenQuery",this.currentQuery.get("name")),$("#updateCurrentQuery").show(),$("#lastQuery").remove(),o!==i&&($("#queryContent .arangoToolbarTop .pull-left").append('<span id="lastQuery" class="clickable">Previous Query</span>'),this.breadcrumb(i)),$("#lastQuery").hide().fadeIn(500).on("click",function(){$("#updateCurrentQuery").hide(),n.aqlEditor.setValue(n.state.lastQuery.query,1),n.fillBindParamTable(n.state.lastQuery.bindParam),n.updateBindParams(),n.collection.each(function(e){(e=e.toJSON()).value===n.state.lastQuery.query?n.breadcrumb(e.name):n.breadcrumb()}),$("#lastQuery").fadeOut(500,function(){$(this).remove()})})},deleteAQL:function(e){var t=function(e){e?arangoHelper.arangoError("Query","Could not delete query."):(this.updateLocalQueries(),this.updateQueryTable(),this.resize(),window.modalView.hide())}.bind(this),i=this.collection.findWhere({name:e});this.collection.remove(i),this.collection.saveCollectionQueries(t)},switchAce:function(e){var t=$(e.currentTarget).attr("counter"),i=e.currentTarget;if(!$(i).hasClass("disabled")){_.each($(i).parent().children(),function(e){$(e).removeClass("active")});var n=$(i).attr("val");$(i).addClass("active"),$(i).text(n.charAt(0).toUpperCase()+n.slice(1)),"JSON"===n?($("#outputEditor"+t).show(),$("#outputGraph"+t).hide(),$("#outputTable"+t).hide(),$("#outputGeo"+t).hide()):"Table"===n?($("#outputTable"+t).show(),$("#outputGraph"+t).hide(),$("#outputEditor"+t).hide(),$("#outputGeo"+t).hide()):"Graph"===n?($("#outputGraph"+t).show(),$("#outputTable"+t).hide(),$("#outputEditor"+t).hide(),$("#outputGeo"+t).hide()):"Geo"===n&&($("#outputGeo"+t).show(),$("#outputGraph"+t).hide(),$("#outputTable"+t).hide(),$("#outputEditor"+t).hide()),this.deselect(ace.edit("outputEditor"+t))}},downloadQueryResult:function(e){var t,i=$(e.currentTarget).attr("counter"),n=this.queriesHistory[i].sentQuery;""!==n&&null!=n?(t=0===Object.keys(this.queriesHistory[i].bindParam).length?"query/result/download/"+encodeURIComponent(btoa(JSON.stringify({query:n}))):"query/result/download/"+encodeURIComponent(btoa(JSON.stringify({query:n,bindVars:this.queriesHistory[i].bindParam}))),arangoHelper.download(t)):arangoHelper.arangoError("Query error","Could not download the result.")},profileQuery:function(){this.explainQuery(!0)},explainQuery:function(e){if(e=!0===e,!this.verifyQueryAndParams()){this.lastSentQueryString=this.aqlEditor.getValue();var t="Explain";e&&(t="Profile"),this.$(this.outputDiv).prepend(this.outputTemplate.render({counter:this.outputCounter,type:t}));var i=this.outputCounter,n=ace.edit("outputEditor"+i);n.setReadOnly(!0),n.getSession().setMode("ace/mode/aql"),n.setOption("vScrollBarAlwaysVisible",!0),n.setOption("showPrintMargin",!1),this.setEditorAutoHeight(n),this.queriesHistory[i]={sentQuery:this.aqlEditor.getValue(),bindParam:this.bindParamTableObj},this.fillExplain(n,i,e),this.outputCounter++}},debugDownloadDialog:function(){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry("debug-download-package-disclaimer","Disclaimer","<p>This will generate a package containing a lot of commonly required information about your query and environment that helps the ArangoDB Team to reproduce your issue. This debug package will include:</p><ul><li>collection names</li><li>collection indexes</li><li>attribute names</li><li>bind parameters</li></ul><p>Additionally, samples of your data will be included with all <b>string values obfuscated</b> in a non-reversible way if below checkbox is ticked.</p><p>If disabled, this package will not include any data.</p><p>Please open the package locally and check if it contains anything that you are not allowed/willing to share and obfuscate it before uploading. Including this package in bug reports will lower the amount of questioning back and forth to reproduce the issue on our side and is much appreciated.</p>",void 0,!1,!1)),t.push(window.modalView.createCheckboxEntry("debug-download-package-examples","Include obfuscated examples","includeExamples","Includes an example set of documents, obfuscating all string values inside the data. This helps the ArangoDB Team as many issues are related to the document structure / format and the indexes defined on them.",!0)),e.push(window.modalView.createSuccessButton("Download Package",this.downloadDebugZip.bind(this))),window.modalView.show("modalTable.ejs","Download Query Debug Package",e,t,void 0,void 0)},downloadDebugZip:function(){if(!this.verifyQueryAndParams()){var e=this.aqlEditor.getValue();if(""!==e&&null!=e){var t={query:e,bindVars:this.bindParamTableObj||{},examples:$("#debug-download-package-examples").is(":checked")};arangoHelper.downloadPost("query/debugDump",JSON.stringify(t),function(){window.modalView.hide()},function(e,t){window.arangoHelper.arangoError("Debug Dump",e+": "+t),window.modalView.hide()})}else arangoHelper.arangoError("Query error","Could not create a debug package.")}},fillExplain:function(t,i,n){var e,o=this;if("false"!==(e=n?this.readQueryData(null,null,!0):this.readQueryData())&&($("#outputEditorWrapper"+i+" .queryExecutionTime").text(""),this.execPending=!1,e)){var a,r=function(){$("#outputEditorWrapper"+i+" #spinner").remove(),$("#outputEditor"+i).css("opacity","1"),$("#outputEditorWrapper"+i+" .fa-close").show(),$("#outputEditorWrapper"+i+" .switchAce").show()};a=n?arangoHelper.databaseUrl("/_admin/aardvark/query/profile"):arangoHelper.databaseUrl("/_admin/aardvark/query/explain"),$.ajax({type:"POST",url:a,data:e,contentType:"application/json",processData:!1,success:function(e){e.msg&&e.msg.errorMessage?(o.removeOutputEditor(i),n?arangoHelper.arangoError("Profile",e.msg):arangoHelper.arangoError("Explain",e.msg)):(o.cachedQueries[i]=e,t.setValue(e.msg,1),o.deselect(t),$.noty.clearQueue(),$.noty.closeAll(),o.handleResult(i),$(".centralRow").animate({scrollTop:$("#queryContent").height()},"fast")),r()},error:function(e){try{var t=JSON.parse(e.responseText);n?arangoHelper.arangoError("Profile",t.errorMessage):arangoHelper.arangoError("Explain",t.errorMessage)}catch(e){n?arangoHelper.arangoError("Profile","ERROR"):arangoHelper.arangoError("Explain","ERROR")}o.handleResult(i),o.removeOutputEditor(i),r()}})}},removeOutputEditor:function(e){$("#outputEditorWrapper"+e).hide(),$("#outputEditorWrapper"+e).remove(),0===$(".outputEditorWrapper").length&&$("#removeResults").hide()},getCachedQueryAfterRender:function(){if(!1===this.renderComplete&&this.aqlEditor){var e=this.getCachedQuery(),t=this;if(null!=e&&""!==e&&0<Object.keys(e).length){this.aqlEditor.setValue(e.query,1);var i=sessionStorage.getItem("lastOpenQuery");if(void 0!==i&&"undefined"!==i)try{this.collection.findWhere({name:i}).toJSON().value===e.query&&(t.breadcrumb(i),$("#updateCurrentQuery").show())}catch(e){}if(this.aqlEditor.getSession().setUndoManager(new ace.UndoManager),""!==e.parameter||void 0!==e)try{t.bindParamTableObj=JSON.parse(e.parameter),t.fillBindParamTable(t.bindParamTableObj),t.setCachedQuery(t.aqlEditor.getValue(),JSON.stringify(t.bindParamTableObj))}catch(e){}}this.renderComplete=!0}},getCachedQuery:function(){if("undefined"!==Storage){var e=sessionStorage.getItem("cachedQuery");if(void 0!==e){var t=JSON.parse(e);this.currentQuery=t;try{this.bindParamTableObj=JSON.parse(t.parameter)}catch(e){}return t}}},setCachedQuery:function(e,t){if(""!==e&&"undefined"!==Storage){var i={query:e,parameter:t};this.currentQuery=i,sessionStorage.setItem("cachedQuery",JSON.stringify(i))}},closeAceResults:function(e,t){var i=this;e?ace.edit("outputEditor"+e).destroy():ace.edit($(t).attr("id")).destroy(),$("#outputEditorWrapper"+this.outputCounter).hide();var n=function(e){$(e).hide("fast",function(){$(e).remove(),0===$(".outputEditorWrapper").length&&(i.cachedQueries={},$("#removeResults").hide())})};t?n(t):_.each($("#outputEditors").children(),function(e){n(e)})},closeResult:function(e){var t=$("#"+$(e.currentTarget).attr("element")).parent(),i=$(t).attr("id").replace(/^\D+/g,"");this.closeAceResults(i,t),delete this.cachedQueries[i],delete this.queriesHistory[i]},fillSelectBoxes:function(){var t=$("#querySize");t.empty(),[100,250,500,1e3,2500,5e3,1e4,"all"].forEach(function(e){t.append('<option value="'+_.escape(e)+'"'+(1e3===e?" selected":"")+">"+_.escape(e)+" results</option>")})},render:function(){this.refreshAQL(),this.renderComplete=!1,this.$el.html(this.template.render({})),this.afterRender(),this.initDone||(this.settings.aqlWidth=$(".aqlEditorWrapper").width()),"json"===this.bindParamMode&&this.toggleBindParams(),this.initDone=!0,this.renderBindParamTable(!0),this.restoreCachedQueries(),this.delegateEvents(),this.restoreQuerySize(),this.getCachedQueryAfterRender()},cleanupGraphs:function(){void 0===this.graphViewers&&null===this.graphViewers||(_.each(this.graphViewers,function(e){void 0!==e&&(e.killCurrentGraph(),e.remove())}),$("canvas").remove(),this.graphViewers=null,this.graphViewers=[])},afterRender:function(){var e=this;this.initAce(),this.initTables(),this.fillSelectBoxes(),this.makeResizeable(),this.initQueryImport(),$(".inputEditorWrapper").height($(window).height()/10*5+25),window.setTimeout(function(){e.resize()},10),e.deselect(e.aqlEditor)},restoreCachedQueries:function(){var i=this;0<Object.keys(this.cachedQueries).length&&(_.each(this.cachedQueries,function(e,t){i.renderQueryResultBox(t,null,!0),i.renderQueryResult(e,t,!0),e.sentQuery&&i.bindQueryResultButtons(null,t)}),$("#removeResults").show())},showSpotlight:function(e){var t,i;if(void 0!==e&&"click"!==e.type||(e="aql"),"aql"===e)t=function(e){this.aqlEditor.insert(e),$("#aqlEditor .ace_text-input").focus()}.bind(this),i=function(){$("#aqlEditor .ace_text-input").focus()};else{var n=$(":focus");t=function(e){var t=$(n).val();$(n).val(t+e),$(n).focus()},i=function(){$(n).focus()}}window.spotlightView.show(t,i,e)},resize:function(){this.resizeFunction()},resizeFunction:function(){$("#toggleQueries1").is(":visible")?(this.aqlEditor.resize(),$("#arangoBindParamTable thead").css("width",$("#bindParamEditor").width()),$("#arangoBindParamTable thead th").css("width",$("#bindParamEditor").width()/2),$("#arangoBindParamTable tr").css("width",$("#bindParamEditor").width()),$("#arangoBindParamTable tbody").css("height",$("#aqlEditor").height()-35),$("#arangoBindParamTable tbody").css("width",$("#bindParamEditor").width()),$("#arangoBindParamTable tbody tr").css("width",$("#bindParamEditor").width()),$("#arangoBindParamTable tbody td").css("width",$("#bindParamEditor").width()/2)):(this.queryPreview.resize(),$("#arangoMyQueriesTable thead").css("width",$("#queryTable").width()),$("#arangoMyQueriesTable thead th").css("width",$("#queryTable").width()/2),$("#arangoMyQueriesTable tr").css("width",$("#queryTable").width()),$("#arangoMyQueriesTable tbody").css("height",$("#queryTable").height()-35),$("#arangoMyQueriesTable tbody").css("width",$("#queryTable").width()),$("#arangoMyQueriesTable tbody td").css("width",$("#queryTable").width()/2))},makeResizeable:function(){var e=this;$(".aqlEditorWrapper").resizable({resize:function(){e.resizeFunction(),e.settings.aqlWidth=$(".aqlEditorWrapper").width()},handles:"e"}),$(".inputEditorWrapper").resizable({resize:function(){e.resizeFunction()},handles:"s"}),this.resizeFunction()},initTables:function(){this.$(this.bindParamId).html(this.table.render({content:this.bindParamTableDesc})),this.$(this.myQueriesId).html(this.table.render({content:this.myQueriesTableDesc}))},checkType:function(e){var t="stringtype";try{t=(e=JSON.parse(e))instanceof Array?"arraytype":typeof e+"type"}catch(e){}return t},updateBindParams:function(t){var i,n=this;if(t){i=$(t.currentTarget).attr("name"),this.bindParamTableObj[i]=arangoHelper.parseInput(t.currentTarget);_.each(["arraytype","objecttype","booleantype","numbertype","stringtype"],function(e){$(t.currentTarget).removeClass(e)}),$(t.currentTarget).addClass(n.checkType($(t.currentTarget).val()))}else _.each($("#arangoBindParamTable input"),function(e){i=$(e).attr("name"),n.bindParamTableObj[i]=arangoHelper.parseInput(e)});this.setCachedQuery(this.aqlEditor.getValue(),JSON.stringify(this.bindParamTableObj)),t&&((t.ctrlKey||t.metaKey)&&13===t.keyCode&&(t.preventDefault(),this.executeQuery()),(t.ctrlKey||t.metaKey)&&32===t.keyCode&&(t.preventDefault(),this.showSpotlight("bind")))},parseQuery:function(e){var t,i,n,o,a=this,r=0,s=(e+=" ").length,l=[];for(i=0;i<s;++i)switch(n=e.charAt(i),r){case 0:"@"===n?(r=6,t=i):"'"===n?r=1:'"'===n?r=2:"`"===n?r=3:"´"===n?r=7:"/"===n&&i+1<s&&("/"===e.charAt(i+1)?(r=4,++i):"*"===e.charAt(i+1)&&(r=5,++i));break;case 4:"\r"!==n&&"\n"!==n||(r=0);break;case 5:"*"===n&&i+1<=s&&"/"===e.charAt(i+1)&&(r=0,++i);break;case 1:"\\"===n?++i:"'"===n&&(r=0);break;case 2:"\\"===n?++i:'"'===n&&(r=0);break;case 3:"`"===n&&(r=0);break;case 7:"´"===n&&(r=0);break;case 6:/^[@a-zA-Z0-9_]+$/.test(n)||(l.push(e.substring(t,i)),t=void(r=0))}return _.each(l,function(e,t){(o=e.match(a.bindParamRegExp))&&(l[t]=o[1])}),{query:e,bindParams:l}},checkForNewBindParams:function(){var i=this,e=this.parseQuery(this.aqlEditor.getValue()).bindParams,n={};_.each(e,function(e){i.bindParamTableObj[e]?n[e]=i.bindParamTableObj[e]:n[e]=""}),Object.keys(e).forEach(function(t){Object.keys(i.bindParamTableObj).forEach(function(e){t===e&&(n[t]=i.bindParamTableObj[e])})}),i.bindParamTableObj=n},renderBindParamTable:function(e){$("#arangoBindParamTable tbody").html(""),e&&this.getCachedQuery();var i=0;this.checkForNewBindParams(),_.each(this.bindParamTableObj,function(e,t){$("#arangoBindParamTable tbody").append("<tr><td>"+t+"</td><td><input name="+t+' type="text"></input></td></tr>'),i++}),0===i?$("#arangoBindParamTable tbody").append('<tr class="noBgColor"><td>No bind parameters defined.</td><td></td></tr>'):this.fillBindParamTable(this.bindParamTableObj);var t=sessionStorage.getItem("lastOpenQuery"),n=this.collection.findWhere({name:t});try{n=n.toJSON()}catch(e){}n&&!1===this.loadedCachedQuery&&(this.loadedCachedQuery=!0,this.fillBindParamTable(n.parameter))},fillBindParamTable:function(e){_.each(e,function(i,n){_.each($("#arangoBindParamTable input"),function(e){if($(e).attr("name")===n)if(i instanceof Array)$(e).val(JSON.stringify(i)).addClass("arraytype");else if("object"==typeof i)$(e).val(JSON.stringify(i)).addClass(typeof i+"type");else if("number"==typeof i)$(e).val(i).addClass(typeof i+"type");else{var t=!1;try{"number"==typeof JSON.parse(i)&&(t=!0)}catch(e){}t?$(e).val('"'+i+'"').addClass(typeof i+"type"):$(e).val(i).addClass(typeof i+"type")}})})},initAce:function(){var o=this;this.aqlEditor=ace.edit("aqlEditor"),this.aqlEditor.$blockScrolling=1/0,this.aqlEditor.getSession().setMode("ace/mode/aql"),this.aqlEditor.getSession().setUseWrapMode(!0),this.aqlEditor.setFontSize("10pt"),this.aqlEditor.setShowPrintMargin(!1),this.bindParamAceEditor=ace.edit("bindParamAceEditor"),this.bindParamAceEditor.$blockScrolling=1/0,this.bindParamAceEditor.getSession().setMode("ace/mode/json"),this.bindParamAceEditor.setFontSize("10pt"),this.bindParamAceEditor.setShowPrintMargin(!1),this.bindParamAceEditor.getSession().on("change",function(){try{o.bindParamTableObj=JSON.parse(o.bindParamAceEditor.getValue()),o.allowParamToggle=!0,o.setCachedQuery(o.aqlEditor.getValue(),JSON.stringify(o.bindParamTableObj))}catch(e){""===o.bindParamAceEditor.getValue()?(_.each(o.bindParamTableObj,function(e,t){o.bindParamTableObj[t]=""}),o.allowParamToggle=!0):o.allowParamToggle=!1}}),this.aqlEditor.getSession().on("change",function(){if(o.aqlEditor.getValue().length<1&&0<Object.keys(o.bindParamTableObj).length&&(o.lastCachedBindParameter=o.bindParamTableObj),o.checkForNewBindParams(),o.renderBindParamTable(),0<o.parseQuery(o.aqlEditor.getValue()).bindParams.length){var i=[];if(_.each(o.parseQuery(o.aqlEditor.getValue()).bindParams,function(e){if(void 0!==$("input[name='"+e+"']")&&0<$("input[name='"+e+"']").length&&0===$("input[name='"+e+"']").val().length&&o.lastCachedBindParameter){var t=$("input[name='"+e+"']").val();o.lastCachedBindParameter[e]&&o.lastCachedBindParameter[e]!==t&&i.push(e)}}),0<i.length){var n={};_.each(i,function(e,t){n[e]=o.lastCachedBindParameter[e]}),o.bindParamTableObj=n,o.renderBindParamTable()}}o.initDone&&o.setCachedQuery(o.aqlEditor.getValue(),JSON.stringify(o.bindParamTableObj)),o.bindParamAceEditor.setValue(JSON.stringify(o.bindParamTableObj,null,"\t"),1),$("#aqlEditor .ace_text-input").focus(),o.resize()});var i=function(i){_.each($(".outputEditors"),function(e){var t=$(e).children().first().attr("id");t=t.replace("Wrapper",""),ace.edit(t).setFontSize(i)})},e=[this.aqlEditor,this.bindParamAceEditor];_.each(e,function(e){e.commands.addCommand({name:"togglecomment",bindKey:{win:"Ctrl-Shift-C",linux:"Ctrl-Shift-C",mac:"Command-Shift-C"},exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEach"}),e.commands.addCommand({name:"increaseFontSize",bindKey:{win:"Shift-Alt-Up",linux:"Shift-Alt-Up",mac:"Shift-Alt-Up"},exec:function(e){var t=parseInt(o.aqlEditor.getFontSize().match(/\d+/)[0],10)+1;t+="pt",o.aqlEditor.setFontSize(t),i(t)},multiSelectAction:"forEach"}),e.commands.addCommand({name:"decreaseFontSize",bindKey:{win:"Shift-Alt-Down",linux:"Shift-Alt-Down",mac:"Shift-Alt-Down"},exec:function(e){var t=parseInt(o.aqlEditor.getFontSize().match(/\d+/)[0],10)-1;t+="pt",o.aqlEditor.setFontSize(t),i(t)},multiSelectAction:"forEach"}),e.commands.addCommand({name:"executeQuery",bindKey:{win:"Ctrl-Return",mac:"Command-Return",linux:"Ctrl-Return"},exec:function(){o.executeQuery()}}),e.commands.addCommand({name:"executeSelectedQuery",bindKey:{win:"Ctrl-Alt-Return",mac:"Command-Alt-Return",linux:"Ctrl-Alt-Return"},exec:function(){o.executeQuery(void 0,!0)}}),e.commands.addCommand({name:"saveQuery",bindKey:{win:"Ctrl-Shift-S",mac:"Command-Shift-S",linux:"Ctrl-Shift-S"},exec:function(){o.addAQL()}}),e.commands.addCommand({name:"explainQuery",bindKey:{win:"Ctrl-Shift-Return",mac:"Command-Shift-Return",linux:"Ctrl-Shift-Return"},exec:function(){o.explainQuery()}}),e.commands.addCommand({name:"togglecomment",bindKey:{win:"Ctrl-Shift-C",linux:"Ctrl-Shift-C",mac:"Command-Shift-C"},exec:function(e){e.toggleCommentLines()},multiSelectAction:"forEach"}),e.commands.addCommand({name:"showSpotlight",bindKey:{win:"Ctrl-Space",mac:"Ctrl-Space",linux:"Ctrl-Space"},exec:function(){o.showSpotlight()}})}),this.queryPreview=ace.edit("queryPreview"),this.queryPreview.getSession().setMode("ace/mode/aql"),this.queryPreview.setReadOnly(!0),this.queryPreview.setFontSize("13px"),this.queryPreview.setShowPrintMargin(!1),$("#aqlEditor .ace_text-input").focus()},updateQueryTable:function(){var t=this;this.updateLocalQueries(),this.myQueriesTableDesc.rows=this.customQueries,_.each(this.myQueriesTableDesc.rows,function(e){e.secondRow='<span class="spanWrapper"><span id="copyQuery" title="Copy query"><i class="fa fa-copy"></i></span><span id="explQuery" title="Explain query"><i class="fa fa-comments"></i></i></span><span id="runQuery" title="Run query"><i class="fa fa-play-circle-o"></i></i></span><span id="deleteQuery" title="Delete query"><i class="fa fa-minus-circle"></i></span></span>',e.hasOwnProperty("parameter")&&delete e.parameter,delete e.value}),this.myQueriesTableDesc.rows.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),_.each(this.queries,function(e){e.hasOwnProperty("parameter")&&delete e.parameter,t.myQueriesTableDesc.rows.push({name:e.name,thirdRow:'<span class="spanWrapper"><span id="copyQuery" title="Copy query"><i class="fa fa-copy"></i></span></span>'})}),this.myQueriesTableDesc.unescaped=[!1,!0,!0],this.$(this.myQueriesId).html(this.table.render({content:this.myQueriesTableDesc}))},listenKey:function(e){13===e.keyCode&&"Update"===$("#modalButton1").html()&&this.saveAQL(),this.checkSaveName()},addAQL:function(){this.refreshAQL(!0),this.createCustomQueryModal(),setTimeout(function(){$("#new-query-name").focus()},500)},updateAQL:function(){var e=this.aqlEditor.getValue(),i=$("#lastQueryName").html(),t=this.collection.findWhere({name:i});if(t){t.set("value",e),t.set("parameter",this.bindParamTableObj);var n=function(e){if(e)arangoHelper.arangoError("Query","Could not save query");else{var t=this;arangoHelper.arangoNotification("Saved query",'"'+i+'"'),this.collection.fetch({success:function(){t.updateLocalQueries()}})}}.bind(this);this.collection.saveCollectionQueries(n)}this.refreshAQL(!0)},createAQL:function(){sessionStorage.setItem("lastOpenQuery",void 0),this.aqlEditor.setValue(""),this.refreshAQL(!0),this.breadcrumb(),$("#updateCurrentQuery").hide()},createCustomQueryModal:function(){var e=[],t=[];t.push(window.modalView.createTextEntry("new-query-name","Name","",void 0,void 0,!1,[{rule:Joi.string().required(),msg:"No query name given."}])),e.push(window.modalView.createSuccessButton("Save",this.saveAQL.bind(this))),window.modalView.show("modalTable.ejs","Save Query",e,t,void 0,void 0,{"keyup #new-query-name":this.listenKey.bind(this)})},checkSaveName:function(){var t=$("#new-query-name").val();"Insert Query"!==t?this.customQueries.some(function(e){return e.name===t})?($("#modalButton1").removeClass("button-success"),$("#modalButton1").addClass("button-warning"),$("#modalButton1").text("Update")):($("#modalButton1").removeClass("button-warning"),$("#modalButton1").addClass("button-success"),$("#modalButton1").text("Save")):$("#new-query-name").val("")},saveAQL:function(e){e&&e.stopPropagation(),this.refreshAQL();var i=$("#new-query-name").val(),t=this.bindParamTableObj;if(!$("#new-query-name").hasClass("invalid-input")&&""!==i.trim()){var n=this.aqlEditor.getValue(),o=!1;if(_.each(this.customQueries,function(e){if(e.name===i)return e.value=n,void(o=!0)}),!0===o)this.collection.findWhere({name:i}).set("value",n);else{if(""!==t&&void 0!==t||(t="{}"),"string"==typeof t)try{t=JSON.parse(t)}catch(e){arangoHelper.arangoError("Query","Could not parse bind parameter")}this.collection.add({name:i,parameter:t,value:n})}var a=function(e){if(e)arangoHelper.arangoError("Query","Could not save query");else{var t=this;this.collection.fetch({success:function(){t.updateLocalQueries(),$("#updateCurrentQuery").show(),t.breadcrumb(i)}})}}.bind(this);this.collection.saveCollectionQueries(a),window.modalView.hide()}},breadcrumb:function(e){window.setTimeout(function(){e?$("#subNavigationBar .breadcrumb").html('Query: <span id="lastQueryName">'+e+"</span>"):$("#subNavigationBar .breadcrumb").html("")},50)},verifyQueryAndParams:function(){var t=!1;if(0===this.aqlEditor.getValue().length&&(arangoHelper.arangoError("Query","Your query is empty"),t=!0),$("#bindParamAceEditor").is(":visible"))try{JSON.parse(this.bindParamAceEditor.getValue())}catch(e){arangoHelper.arangoError("Bind Parameter","Could not parse bind parameter"),t=!0}return t},executeQuery:function(e,t){this.verifyQueryAndParams()||($("#outputEditorWrapper"+this.outputCounter).hide(),$("#outputEditorWrapper"+this.outputCounter).show("fast"),this.lastSentQueryString=this.aqlEditor.getValue(),this.renderQueryResultBox(this.outputCounter,t))},renderQueryResultBox:function(e,t,i){this.$(this.outputDiv).prepend(this.outputTemplate.render({counter:e,type:"Query"}));var n=ace.edit("outputEditor"+e);n.setFontSize("13px"),n.$blockScrolling=1/0,n.getSession().setMode("ace/mode/json"),n.setReadOnly(!0),n.setOption("vScrollBarAlwaysVisible",!0),n.setShowPrintMargin(!1),this.setEditorAutoHeight(n),i||(this.queriesHistory[e]={sentQuery:this.aqlEditor.getValue(),bindParam:this.bindParamTableObj},this.fillResult(e,t),this.outputCounter++)},readQueryData:function(e,t,i){var n={};if(i||(n.id="currentFrontendQuery"),n.query=e?this.aqlEditor.getSelectedText():this.aqlEditor.getValue(),0===n.query.length)e?arangoHelper.arangoError("Query","Your query selection is empty!"):arangoHelper.arangoError("Query","Your query is empty!"),n=!1;else{var o={};0<Object.keys(this.bindParamTableObj).length&&(_.each(this.bindParamTableObj,function(e,t){-1<n.query.indexOf(t)&&(o[t]=e)}),n.bindVars=this.bindParamTableObj),0<Object.keys(o).length&&(n.bindVars=o),t&&(n.options={profile:!0})}return JSON.stringify(n)},fillResult:function(n,e){var o=this,t=this.readQueryData(e,!0);"false"!==t&&t&&$.ajax({type:"POST",url:arangoHelper.databaseUrl("/_api/cursor"),headers:{"x-arango-async":"store"},data:t,contentType:"application/json",processData:!1,success:function(e,t,i){i.getResponseHeader("x-arango-async-id")&&o.queryCallbackFunction(i.getResponseHeader("x-arango-async-id"),n),$.noty.clearQueue(),$.noty.closeAll(),o.handleResult(n)},error:function(e){try{var t=JSON.parse(e.responseText);arangoHelper.arangoError("["+t.errorNum+"]",t.errorMessage)}catch(e){arangoHelper.arangoError("Query error","ERROR")}o.handleResult(n)}})},handleResult:function(){var e=this;window.progressView.hide(),$("#removeResults").show(),window.setTimeout(function(){e.aqlEditor.focus()},300)},setEditorAutoHeight:function(e){var t=($(".centralRow").height()-250)/17;e.setOptions({maxLines:t,minLines:10})},deselect:function(e){var t=e.getSelection(),i=t.lead.row,n=t.lead.column;t.setSelectionRange({start:{row:i,column:n},end:{row:i,column:n}}),e.focus()},warningsFunc:function(e,t){var i="";e.extra&&e.extra.warnings&&0<e.extra.warnings.length&&(i+="Warnings:\r\n\r\n",e.extra.warnings.forEach(function(e){i+="["+e.code+"], '"+e.message+"'\r\n"})),""!==i&&(i+="\r\nResult:\r\n\r\n"),t.setValue(i+JSON.stringify(e.result,void 0,2),1),t.getSession().setScrollTop(0)},renderQueryResult:function(i,o,e,t){var n,a=this;if("#queries"===window.location.hash){var r,s,l=ace.edit("outputEditor"+o),c=$(".centralRow").height()-250,d=0;if(!i.msg){if("table"===(n=a.analyseQuery(i.result)).defaultType||"geotable"===n.defaultType?($("#outputEditorWrapper"+o+" .arangoToolbarTop").after('<div id="outputTable'+o+'" class="outputTable"></div>'),$("#outputTable"+o).show(),a.renderOutputTable(n,o),$(".outputEditorWrapper .tableWrapper").css("max-height",c),$("#outputEditor"+o).hide(),r=!0):"graph"===n.defaultType&&($("#outputEditorWrapper"+o+" .arangoToolbarTop").after('<div id="outputGraph'+o+'"></div>'),$("#outputGraph"+o).show(),(r=a.renderOutputGraph(n,o))?($("#outputEditor"+o).hide(),$("#outputEditorWrapper"+o+" #copy2gV").show(),$("#outputEditorWrapper"+o+" #copy2gV").bind("click",function(){a.showResultInGraphViewer(n,o)})):$("#outputGraph"+o).remove()),"geo"===n.defaultType||"geotable"===n.defaultType){$("#outputEditor"+o).hide(),$("#outputEditorWrapper"+o+" .arangoToolbarTop").after('<div class="geoContainer" id="outputGeo'+o+'" style="height: 500px; maxheight: '+c+'px;"></div>'),a.maps[o]=L.map("outputGeo"+o).setView([51.505,-.09],13),a.maps[o].addLayer(new L.StamenTileLayer("terrain",{detectRetina:!0}));var u,h=1,p={color:"#3498db",opacity:1,weight:3},g={radius:8,fillColor:"#2ecc71",color:"white",weight:1,opacity:1,fillOpacity:.64},f=[];_.each(i.result,function(n){var e={};if("Point"===(e=n.hasOwnProperty("geometry")?n.geometry:n).type||"MultiPoint"===e.type)try{u=new L.GeoJSON(e,{onEachFeature:function(e,t,i){t.bindPopup('<pre style="width: 250px; max-height: 250px;">'+JSON.stringify(n,null,2)+"</pre>")},pointToLayer:function(e,t){var i=L.circleMarker(t,g);return f.push(i),i}}).addTo(a.maps[o])}catch(e){d++}else if("Polygon"===e.type||"LineString"===e.type||"MultiLineString"===e.type||"MultiPolygon"===e.type)try{u=new L.GeoJSON(e,{style:p,onEachFeature:function(e,t){t.bindPopup('<pre style="width: 250px;">'+JSON.stringify(e,null,2)+"</pre>")}}).addTo(a.maps[o]),f.push(u)}catch(e){d++}if(h===i.result.length)if(0<f.length)try{var t=new L.FeatureGroup(f);a.maps[o].fitBounds(t.getBounds())}catch(e){}else try{a.maps[o].fitBounds(u.getBounds())}catch(e){}h++})}!1!==r&&("geotable"===n.defaultType||"geo"===n.defaultType?($("#outputTable"+o).hide(),"geotable"===n.defaultType&&$("#table-switch").css("display","inline"),i.result.length===d?($("#outputGeo"+o).remove(),"geotable"===n.defaultType?($("#outputTable"+o).show(),$("#table-switch").addClass("active").css("display","inline")):($("#outputEditor"+o).show(),$("#json-switch").addClass("active").css("display","inline"))):$("#geo-switch").addClass("active").css("display","inline")):$("#"+n.defaultType+"-switch").addClass("active").css("display","inline"),$("#json-switch").css("display","inline"),!n.fallback||"geo"!==n.fallback&&"geotable"!==n.fallback||($("#geo-switch").addClass("disabled").css("display","inline").css("opacity","0.5"),$("#geo-switch").addClass("tippy").attr("title","No internet collection. Map is not available."),arangoHelper.createTooltips()));var m=function(e,t,i){i||(i=""),$("#outputEditorWrapper"+o+" .arangoToolbarTop .pull-left").append('<span class="'+i+'"><i class="fa '+t+'"></i><i class="iconText">'+e+"</i></span>")},w="-";i&&i.extra&&i.extra.stats&&(1<i.extra.stats.executionTime?(w=numeral(i.extra.stats.executionTime).format("0.000"),w+=" s"):(w=numeral(1e3*i.extra.stats.executionTime).format("0.000"),w+=" ms")),m(i.result.length+" elements","fa-calculator"),m(w,"fa-clock-o"),i.extra&&(i.extra.profile&&(m("","fa-caret-down"),a.appendProfileDetails(o,i.extra.profile)),i.extra.stats&&(0<i.extra.stats.writesExecuted||0<i.extra.stats.writesIgnored)&&(m(i.extra.stats.writesExecuted+" writes","fa-check-circle positive"),0===i.extra.stats.writesIgnored?m(i.extra.stats.writesIgnored+" writes ignored","fa-check-circle positive","additional"):m(i.extra.stats.writesIgnored+" writes ignored","fa-exclamation-circle warning","additional")))}$("#outputEditorWrapper"+o+" .pull-left #spinner").remove(),$("#outputEditorWrapper"+o+" #cancelCurrentQuery").remove(),a.warningsFunc(i,l),window.progressView.hide(),$("#outputEditorWrapper"+o+" .switchAce").show(),$("#outputEditorWrapper"+o+" .fa-close").show(),$("#outputEditor"+o).css("opacity","1"),i.msg||($("#outputEditorWrapper"+o+" #downloadQueryResult").show(),$("#outputEditorWrapper"+o+" #copy2aqlEditor").show()),a.setEditorAutoHeight(l),a.deselect(l),t&&i.hasMore?s=arangoHelper.databaseUrl("/_api/cursor/"+encodeURIComponent(t)):i.id&&i.hasMore&&(s=arangoHelper.databaseUrl("/_api/cursor/"+encodeURIComponent(i.id))),s&&$.ajax({url:s,type:"DELETE"}),e||(a.cachedQueries[o]=i,this.cachedQueries[o].sentQuery=a.aqlEditor.getValue()),i.msg&&(i.extra.profile?$("#outputEditorWrapper"+o+" .toolbarType").html("Profile"):$("#outputEditorWrapper"+o+" .toolbarType").html("Explain"),l.setValue(i.msg,1)),"table"!==n.defaultType&&"geotable"!==n.defaultType||a.checkCSV(o)}else a.cachedQueries[o]=i,a.cachedQueries[o].sentQuery=a.lastSentQueryString,arangoHelper.arangoNotification("Query finished","Return to queries view to see the result.")},bindQueryResultButtons:function(e,i){var n=this;if(e)var t=function(e,t){$.ajax({url:arangoHelper.databaseUrl("/_api/job/"+encodeURIComponent(e)+"/cancel"),type:"PUT",success:function(){window.clearTimeout(n.checkQueryTimer),$("#outputEditorWrapper"+t).remove(),arangoHelper.arangoNotification("Query","Query canceled.")}})};$("#outputEditorWrapper"+i+" #cancelCurrentQuery").bind("click",function(){t(e,i)}),$("#outputEditorWrapper"+i+" #copy2aqlEditor").bind("click",function(){$("#toggleQueries1").is(":visible")||n.toggleQueries();var e=n.queriesHistory[i].sentQuery,t=n.queriesHistory[i].bindParam;n.aqlEditor.setValue(e,1),n.deselect(n.aqlEditor),0<Object.keys(t).length&&(n.bindParamTableObj=t,n.setCachedQuery(n.aqlEditor.getValue(),JSON.stringify(n.bindParamTableObj)),$("#bindParamEditor").is(":visible")?n.renderBindParamTable():(n.bindParamAceEditor.setValue(JSON.stringify(t),1),n.deselect(n.bindParamAceEditor))),$(".centralRow").animate({scrollTop:0},"fast"),n.resize()})},queryCallbackFunction:function(o,a){var r,s=this;s.tmpQueryResult=null,this.bindQueryResultButtons(o,a),this.execPending=!1;try{r=parseInt($("#querySize").val())}catch(e){arangoHelper.arangoError("Parse Error","Could not parse defined user limit.")}isNaN(r)&&(r=!0);var l=function(i){null===s.tmpQueryResult&&(s.tmpQueryResult={result:[],complete:!0}),_.each(i,function(e,t){"result"!==t?s.tmpQueryResult[t]=e:_.each(i.result,function(e){s.tmpQueryResult.result.length<=r||!0===r?(s.tmpQueryResult.result.length<r||!0===r)&&s.tmpQueryResult.result.push(e):s.tmpQueryResult.complete=!1})})},c=function(e){var t=arangoHelper.databaseUrl("/_api/job/"+encodeURIComponent(o));e&&(t=arangoHelper.databaseUrl("/_api/cursor/"+encodeURIComponent(e))),$.ajax({type:"PUT",url:t,contentType:"application/json",processData:!1,success:function(e,t,i){var n=!0;s.tmpQueryResult&&s.tmpQueryResult.result&&s.tmpQueryResult.result.length&&(n=s.tmpQueryResult.result.length<r||!0===r),201===i.status||200===i.status?e.hasMore&&n?(l(e),c(e.id)):(l(e),s.renderQueryResult(s.tmpQueryResult,a,!1,o),s.tmpQueryResult=null,$(".centralRow").animate({scrollTop:$("#queryContent").height()},"fast")):204===i.status&&(s.checkQueryTimer=window.setTimeout(function(){c()},500))},error:function(e){var t;try{if("Gone"===e.statusText)return arangoHelper.arangoNotification("Query","Query execution aborted."),void s.removeOutputEditor(a);t=JSON.parse(e.responseText),arangoHelper.arangoError("Query",t.errorMessage),t.errorMessage&&(null!==t.errorMessage.match(/\d+:\d+/g)?s.markPositionError(t.errorMessage.match(/'.*'/g)[0],t.errorMessage.match(/\d+:\d+/g)[0]):s.markPositionError(t.errorMessage.match(/\(\w+\)/g)[0]),s.removeOutputEditor(a))}catch(e){if(s.removeOutputEditor(a),409===t.code)return;400!==t.code&&404!==t.code&&500!==t.code&&403!==t.code&&501!==t.code&&arangoHelper.arangoNotification("Query","Successfully aborted.")}window.progressView.hide()}})};c()},appendProfileDetails:function(t,u){var h="#outputEditorWrapper"+t;$(h+" .fa-caret-down").first().on("click",function(){var e=$(h).find(".queryProfile");if($(e).is(":visible"))$(h).find(".queryProfile").remove();else{$(h).append('<div class="queryProfile" counter="'+t+'"></div>');var i=$(h+" .queryProfile").first();i.hide(),i.css("position","absolute").css("left",215).css("top",55);var n=["A","B","C","D","E","F","G","H"],o=["rgb(48, 125, 153)","rgb(241, 124, 176)","rgb(137, 110, 37)","rgb(93, 165, 218)","rgb(250, 164, 58)","rgb(64, 74, 83)","rgb(96, 189, 104)","rgb(221, 224, 114)"],a=["startup time for query engine","query parsing","abstract syntax tree optimizations","loading collections","instanciation of initial execution plan","execution plan optimization and permutation","query execution","query finalization"];i.append('<i class="fa fa-close closeProfile"></i><span class="profileHeader">Profiling information</span><div class="pure-g pure-table pure-table-body" style="width: auto;"></div><div class="prof-progress"></div><div class="prof-progress-label"></div><div class="clear"></div>');var r=0;_.each(u,function(e,t){"finished"!==t&&(r+=1e3*e)});var s,l=0,c=0,d="";_.each(u,function(e,t){"finished"!==t&&(1<e?(d=numeral(e).format("0.000"),d+=" s"):(d=numeral(1e3*e).format("0.000"),d+=" ms"),i.find(".pure-g").append('<div class="pure-table-row noHover"><div class="pure-u-1-24 left"><p class="bold" style="background:'+o[l]+'">'+n[l]+'</p></div><div class="pure-u-4-24 left">'+d+'</div><div class="pure-u-6-24 left">'+t+'</div><div class="pure-u-13-24 left">'+a[l]+"</div></div>"),0===(s=Math.floor(1e3*e/r*100))&&(s=1,c++),7!==l||0<c&&(s-=c),i.find(".prof-progress").append('<div style="width: '+s+"%; background-color: "+o[l]+'"></div>'),1<s?i.find(".prof-progress-label").append('<div style="width: '+s+'%;">'+n[l]+"</div>"):i.find(".prof-progress-label").append('<div style="width: '+s+'%; font-size: 9px">'+n[l]+"</div>"),l++)}),i.width(590),i.height("auto"),i.fadeIn("fast")}})},analyseQuery:function(i){var e={defaultType:null,original:i,modified:null},t=!1;if(!Array.isArray(i))return e.defaultType="json",e;if(i[0])if(i[0].vertices&&i[0].edges){var n=0,o=0;_.each(i,function(e){e.edges&&_.each(e.edges,function(e){null!==e&&(e._from&&e._to&&n++,o++)})});var a=0;0<o&&(a=n/o*100),95<=a&&(t=!0,e.defaultType="graph",e.graphInfo="object")}else{var r=0,s=i.length;_.each(i,function(e){e&&e._from&&e._to&&e._id&&r++});var l=0;0<s&&(l=r/s*100),95<=l&&(t=!0,e.defaultType="graph",e.graphInfo="array")}var c=0;if(!t){var d=!0,u={};if(i.length<1&&(d=!1),d){_.each(i,function(e){"object"!=typeof e||null===e||Array.isArray(e)||("object"==typeof e&&(e.hasOwnProperty("coordinates")&&e.hasOwnProperty("type")?"Point"!==e.type&&"MultiPoint"!==e.type&&"Polygon"!==e.type&&"MultiPolygon"!==e.type&&"LineString"!==e.type&&"MultiLineString"!==e.type||c++:e.hasOwnProperty("geometry")&&e.geometry.hasOwnProperty("coordinates")&&e.geometry.hasOwnProperty("type")&&("Point"!==e.geometry.type&&"MultiPoint"!==e.geometry.type&&"Polygon"!==e.geometry.type&&"MultiPolygon"!==e.geometry.type&&"LineString"!==e.geometry.type&&"MultiLineString"!==e.geometry.type||c++)),_.each(e,function(e,t){u.hasOwnProperty(t)?++u[t]:u[t]=1}))});var h=0;_.each(u,function(e,t){!1!==d&&(h=e/i.length*100)<=95&&(d=!1)}),h<=95&&(d=!1)}d&&(t=!0,i.length===c?e.defaultType="geotable":e.defaultType="table")}return t||(0!==i.length&&i.length===c?e.defaultType="geo":e.defaultType="json"),"geo"!==e.defaultType&&"geotable"!==e.defaultType||window.activeInternetConnection||(e.fallback=e.defaultType,"geo"===e.defaultType?e.defaultType="json":e.defaultType="table"),e},markPositionError:function(e,t){var i;if(t&&(i=t.split(":")[0],e=e.substr(1,e.length-2)),!this.aqlEditor.find(e)&&t){try{0<(i=parseInt(i))&&(i-=1)}catch(e){}this.aqlEditor.selection.moveCursorToPosition({row:i,column:0}),this.aqlEditor.selection.selectLine()}window.setTimeout(function(){$(".ace_start").first().css("background","rgba(255, 129, 129, 0.7)")},100)},refreshAQL:function(){var t=this,e=function(e){e?arangoHelper.arangoError("Query","Could not reload queries"):(t.updateLocalQueries(),t.updateQueryTable())};this.getAQL(function(){t.getSystemQueries(e)})},getSystemQueries:function(t){var i=this;$.ajax({type:"GET",cache:!1,url:"js/arango/aqltemplates.json",contentType:"application/json",processData:!1,success:function(e){t&&t(!1),i.queries=e},error:function(){t&&t(!0),arangoHelper.arangoNotification("Query","Error while loading system templates")}})},updateLocalQueries:function(){var t=this;this.customQueries=[],this.collection.each(function(e){t.customQueries.push({name:e.get("name"),value:e.get("value"),parameter:e.get("parameter")})})},renderOutputTable:function(e,t){var n={id:"outputTableData"+t,titles:[],rows:[]},o=!0,a={},r=0;_.each(e.original,function(e){!0===o&&(n.titles=Object.keys(e),n.titles.forEach(function(e){a[String(e)]=r++}),o=!1);var i=Array(r);_.each(e,function(e,t){a.hasOwnProperty(t)&&("object"==typeof e&&(e=JSON.stringify(e)),i[a[t]]=e)}),n.rows.push(i)}),$("#outputTable"+t).append(this.table.render({content:n}))},renderOutputGraph:function(e,t){return this.graphViewers[t]=new window.GraphViewer({name:void 0,documentStore:window.App.arangoDocumentStore,collection:new window.GraphCollection,userConfig:window.App.userConfig,id:"#outputGraph"+t,data:e}),this.graphViewers[t].renderAQLPreview()},showResultInGraphViewer:function(e,t){window.location.hash="#aql_graph",window.App.graphViewer&&(window.App.graphViewer.graphSettingsView&&window.App.graphViewer.graphSettingsView.remove(),window.App.graphViewer.remove()),window.App.graphViewer=new window.GraphViewer({name:void 0,documentStore:window.App.arangoDocumentStore,collection:new window.GraphCollection,userConfig:window.App.userConfig,noDefinedGraph:!0,data:e}),window.App.graphViewer.renderAQL()},getAQL:function(i){var n=this;this.collection.fetch({success:function(){n.getCachedQueryAfterRender();var e=sessionStorage.getItem("customQueries");if(e){var t=JSON.parse(e);_.each(t,function(e){n.collection.add({value:e.value,name:e.name})});n.collection.saveCollectionQueries(function(e){e?arangoHelper.arangoError("Custom Queries","Could not import old local storage queries"):sessionStorage.removeItem("customQueries")})}n.updateLocalQueries(),i&&i()},error:function(e,t){arangoHelper.arangoError("User Queries",t.responseText)}})},checkCSV:function(e){var t=ace.edit("outputEditor"+e).getValue(),i=!1;try{t=JSON.parse(t),i=!0,_.each(t,function(e,t){_.each(e,function(e,t){try{"object"==typeof JSON.parse(e)&&(i=!1)}catch(e){}})})}catch(e){}i&&$("#outputEditorWrapper"+e+" #downloadCsvResult").show()},doCSV:function(e){var t=this.arrayFrom(e),i=[];for(var n in t)i[i.length]=this.parse_object(t[n]);return $.csv.fromObjects(i)},downloadCsvResult:function(e){var t,i=$(e.currentTarget).attr("counter"),n=ace.edit("outputEditor"+i).getValue();n=JSON.parse(n),0<(t=$.csv.fromObjects(n,{justArrays:!0})).length?arangoHelper.downloadLocalBlob(t,"csv"):arangoHelper.arangoError("Query error","Could not download the result.")}})}(),function(){"use strict";window.ReplicationView=Backbone.View.extend({el:"#content",mode:null,interval:5e3,keepEntries:100,charts:{},nvchartsInit:!1,loggerGraphsData:[],info:{state:null,mode:null,level:null,role:null,health:"Good",msg:"No issues detected."},nodes:{leader:null,followers:[]},initialize:function(e){var t=this;window.setInterval(function(){t.getStateData()},this.interval)},template:templateEngine.createTemplate("replicationView.ejs"),events:{"click #nodes-followers-id span":"goToApplier","click #repl-follower-table tr":"goToApplierFromTable"},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},render:function(){this.undelegateEvents(),this.mode||0===this.mode?(this.$el.html(this.template.render({mode:this.mode,info:this.info,nodes:this.nodes})),this.getStateData()):this.getMode(this.render.bind(this)),this.delegateEvents()},renderStatisticBox:function(e,t,i,n){if($("#replication-info #nodeattribute-"+e).length)$("#replication-info #nodeattribute-"+e).html(t);else{var o="";o+=6===n?'<div class="pure-u-1-2 pure-u-md-1-3 pure-u-lg-1-6" style="background-color: #fff">':'<div class="pure-u-1-2 pure-u-md-1-4" style="background-color: #fff">',o+='<div class="valueWrapper">',o+=i?'<div id="nodeattribute-'+e+'" class="value tippy" title="'+t+'">'+t+"</div>":'<div id="nodeattribute-'+e+'" class="value">'+t+"</div>",o+='<div class="graphLabel">'+e+"</div>",o+="</div>",o+="</div>",$("#replication-info").append(o)}},goToApplier:function(e){var t=btoa($(e.currentTarget).attr("data"));window.App.navigate("#replication/applier/"+t+"/"+btoa("_system"),{trigger:!0})},goToApplierFromTable:function(e){var t=btoa(window.location.origin),i=btoa($(e.currentTarget).find("#applier-database-id").html()),n=$(e.currentTarget).find("#applier-running-id").html();"true"===n||!0===n?window.App.navigate("#replication/applier/"+t+"/"+i,{trigger:!0}):arangoHelper.arangoMessage("Replication","This applier is not running.")},getActiveFailoverEndpoints:function(){var t=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/cluster/endpoints"),contentType:"application/json",success:function(e){e.endpoints?t.renderEndpoints(e.endpoints):t.renderEndpoints()},error:function(){t.renderEndpoints()}})},getActiveFailoverHealth:function(){},renderEndpoints:function(e){var t=this;if(e){var i=e[0],n=e.slice(1,e.length);$("#nodes-leader-id").html(i.endpoint),$("#nodes-followers-id").html(""),_.each(n,function(e){$("#nodes-followers-id").append('<span data="'+t.parseEndpoint(e.endpoint,!0)+'">'+e.endpoint+"</span>")})}else $("#nodes-leader-id").html("Error"),$("#nodes-followers-id").html("Error")},parseEndpoint:function(e,t){var i;return"[::1]"===e.slice(6,11)?i=window.location.host.split(":")[0]+":"+e.split(":")[4]:"tcp://"===e.slice(0,6)?i="http://"+e.slice(6,e.length):"ssl://"===e.slice(0,6)&&(i="https://"+e.slice(6,e.length)),t&&(i=window.location.protocol+"//"+i),i||e},getLoggerState:function(){var t=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/replication/logger-state"),contentType:"application/json",success:function(e){"#replication"===window.location.hash?(t.updateLoggerGraphsData(e),t.nvchartsInit?t.rerenderLoggerGraphs():t.initLoggerGraphs(),t.renderLoggerState(e.server,e.clients,e.state)):t.updateLoggerGraphsData(e)},error:function(){arangoHelper.arangoError("Replication","Could not fetch the leaders logger state.")}})},getApplierStates:function(t){var e,i=this;e=t?arangoHelper.databaseUrl("/_api/replication/applier-state?global=true"):arangoHelper.databaseUrl("/_api/replication/applier-state-all"),$.ajax({type:"GET",cache:!1,url:e,contentType:"application/json",success:function(e){t?i.renderApplierState(e,!0):i.renderApplierState(e)},error:function(){t?arangoHelper.arangoError("Replication","Could not fetch the followers global applier state."):arangoHelper.arangoError("Replication","Could not fetch the followers applier state.")}})},renderApplierState:function(i,e){var o,a=this;e&&(i.database="All databases",i={"All databases":i});var r,s=0,n=[],l=[];_.each(i,function(e,t){e.state.running?n.push(i[t]):(i[t].database=t,l.push(i[t]))}),n=_.sortBy(n,"database"),l=_.sortBy(l,"database"),i=n.concat(l),$("#repl-follower-table tbody").html(""),_.each(i,function(e,t){var i;o="undefined"!==e.endpoint&&e.endpoint?a.parseEndpoint(e.endpoint):"not available","inactive"!==e.state.phase&&!0!==e.state.running&&s++;var n="active";"inactive"===e.state.phase&&(n="inactive"),0===e.state.lastError.errorNum?i="inactive"!==e.state.phase||e.state.running?'<i class="fa fa-check-circle positive"></i>':"n/a":(i='<i class="fa fa-times-circle negative"></i>',s++),$("#repl-follower-table tbody").append('<tr class="'+n+'"><td id="applier-database-id">'+e.database+'</td><td id="applier-running-id">'+e.state.running+"</td><td>"+e.state.phase+'</td><td id="applier-endpoint-id">'+o+"</td><td>"+e.state.lastAppliedContinuousTick+"</td><td>"+i+"</td></tr>"),r=e.server.serverId}),$("#logger-lastLogTick-id").html(r),0===s?this.renderHealth(!1):this.renderHealth(!0,"Some appliers are not running or do have errors.")},renderHealth:function(e,t){e?($("#info-msg-id").addClass("negative"),$("#info-msg-id").removeClass("positive"),$("#info-msg-id").html('Bad <i class="fa fa-times-circle"></i>'),t&&($("#info-msg-id").attr("title",t),$("#info-msg-id").addClass("modalTooltips"),arangoHelper.createTooltips(".modalTooltips"))):($("#info-msg-id").addClass("positive"),$("#info-msg-id").removeClass("negative"),$("#info-msg-id").removeClass("modalTooltips"),$("#info-msg-id").html('Good <i class="fa fa-check-circle"></i>'))},getStateData:function(e){3===this.mode?(this.getActiveFailoverEndpoints(),this.getLoggerState(),this.getActiveFailoverHealth()):2===this.mode?"leader"===this.info.role?this.getLoggerState():this.getApplierStates(!0):1===this.mode&&("leader"===this.info.role?this.getLoggerState():this.getApplierStates()),e&&e()},updateLoggerGraphsData:function(e){this.loggerGraphsData.length>this.keepEntries&&this.loggerGraphsData.pop(),this.loggerGraphsData.push(e)},parseLoggerData:function(){var e,o=this,t=this.loggerGraphsData;this.colors||(this.colors=randomColor({hue:"blue",count:this.loggerGraphsData.length}));var a={leader:{key:e=3===o.mode?"Leader":"Master",values:[],strokeWidth:2,color:"#2ecc71"}},r={leader:{key:e,values:[],strokeWidth:2,color:"#2ecc71"}};return _.each(t,function(i){a.leader.values.push({x:Date.parse(i.state.time),y:0}),r.leader.values.push({x:Date.parse(i.state.time),y:0});var n=0;_.each(i.clients,function(e){var t;a[e.serverId]||(t=3===o.mode?"Follower ("+e.serverId+")":"Slave ("+e.serverId+")",a[e.serverId]={key:t,color:o.colors[n],strokeWidth:1,values:[]},r[e.serverId]={key:t,color:o.colors[n],strokeWidth:1,values:[]},n++);a[e.serverId].values.push({x:Date.parse(e.time),y:(Date.parse(i.state.time)-Date.parse(e.time))/1e3*-1}),r[e.serverId].values.push({x:Date.parse(e.time),y:-1*(i.state.lastLogTick-e.lastServedTick)})})}),{graphDataTick:_.toArray(r),graphDataTime:_.toArray(a)}},initLoggerGraphs:function(){var t=this;nv.addGraph(function(){t.charts.replicationTimeChart=nv.models.lineChart().options({duration:300,useInteractiveGuideline:!0,forceY:[2,-10]}),t.charts.replicationTimeChart.xAxis.axisLabel("").tickFormat(function(e){var t=new Date(e);return(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}).staggerLabels(!1),t.charts.replicationTimeChart.yAxis.axisLabel("Last call ago (in s)").tickFormat(function(e){return null===e?"N/A":d3.format(",.0f")(e)});var e=t.parseLoggerData().graphDataTime;return d3.select("#replicationTimeChart svg").datum(e).call(t.charts.replicationTimeChart),nv.utils.windowResize(t.charts.replicationTimeChart.update),t.charts.replicationTimeChart}),nv.addGraph(function(){t.charts.replicationTickChart=nv.models.lineChart().options({duration:300,useInteractiveGuideline:!0,forceY:[2,void 0]}),t.charts.replicationTickChart.xAxis.axisLabel("").tickFormat(function(e){var t=new Date(e);return(t.getHours()<10?"0":"")+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()}).staggerLabels(!1),t.charts.replicationTickChart.yAxis.axisLabel("Ticks behind").tickFormat(function(e){return null===e?"N/A":d3.format(",.0f")(e)});var e=t.parseLoggerData().graphDataTick;return d3.select("#replicationTickChart svg").datum(e).call(t.charts.replicationTickChart),nv.utils.windowResize(t.charts.replicationTickChart.update),t.charts.replicationTickChart}),t.nvchartsInit=!0},rerenderLoggerGraphs:function(){d3.select("#replicationTimeChart svg").datum(this.parseLoggerData().graphDataTime).transition().duration(500).call(this.charts.replicationTimeChart),d3.select("#replicationTickChart svg").datum(this.parseLoggerData().graphDataTick).transition().duration(500).call(this.charts.replicationTickChart),_.each(this.charts,function(e){nv.utils.windowResize(e.update)})},renderLoggerState:function(e,t,i){e&&t&&i?($("#logger-running-id").html(i.running),$("#logger-version-id").html(e.version),$("#logger-serverid-id").html(e.serverId),$("#logger-time-id").html(i.time),$("#logger-lastLogTick-id").html(i.lastLogTick),$("#logger-totalEvents-id").html(i.totalEvents),$("#repl-logger-clients tbody").html(""),_.each(t,function(e){$("#repl-logger-clients tbody").append("<tr><td>"+e.serverId+"</td><td>"+e.time+"</td><td>"+e.lastServedTick+"</td></tr>")}),i.running?this.renderHealth(!1):this.renderHealth(!0,"The logger thread is not running")):($("#logger-running-id").html("Error"),$("#logger-endpoint-id").html("Error"),$("#logger-version-id").html("Error"),$("#logger-serverid-id").html("Error"),$("#logger-time-id").html("Error"),this.renderHealth(!0,"Unexpected data from the logger thread."))},getMode:function(t){var i=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/aardvark/replication/mode"),contentType:"application/json",success:function(e){(e.mode||0===e.mode)&&(Number.isInteger(e.mode)?(i.mode=e.mode,0!==e.mode?i.info.state="enabled":i.info.state="disabled"):i.mode="undefined",e.role&&(i.info.role=e.role),3===i.mode?(i.info.mode="Active Failover",i.info.level="Server"):2===i.mode?(i.info.mode="Master/Slave",i.info.level="Server"):1===i.mode&&(i.info.mode="Master/Slave","follower"===i.info.role?i.info.level="Database":i.info.level="Check slaves for details")),t&&t()},error:function(){arangoHelper.arangoError("Replication","Could not fetch the replication state.")}})}})}(),function(){"use strict";window.ScaleView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("scaleView.ejs"),interval:1e4,knownServers:[],events:{"click #addCoord":"addCoord","click #removeCoord":"removeCoord","click #addDBs":"addDBs","click #removeDBs":"removeDBs"},setCoordSize:function(e){var t=this,i={numberOfCoordinators:e};$.ajax({type:"PUT",url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",data:JSON.stringify(i),success:function(){t.updateTable(i)},error:function(){arangoHelper.arangoError("Scale","Could not set coordinator size.")}})},setDBsSize:function(e){var t=this,i={numberOfDBServers:e};$.ajax({type:"PUT",url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",data:JSON.stringify(i),success:function(){t.updateTable(i)},error:function(){arangoHelper.arangoError("Scale","Could not set coordinator size.")}})},addCoord:function(){this.setCoordSize(this.readNumberFromID("#plannedCoords",!0))},removeCoord:function(){this.setCoordSize(this.readNumberFromID("#plannedCoords",!1,!0))},addDBs:function(){this.setDBsSize(this.readNumberFromID("#plannedDBs",!0))},removeDBs:function(){this.setDBsSize(this.readNumberFromID("#plannedDBs",!1,!0))},readNumberFromID:function(e,t,i){var n=$(e).html(),o=!1;try{o=JSON.parse(n)}catch(e){}return t&&o++,i&&1!==o&&o--,o},initialize:function(e){var t=this;clearInterval(this.intervalFunction),window.App.isCluster&&(this.dbServers=e.dbServers,this.coordinators=e.coordinators,this.updateServerTime(),this.intervalFunction=window.setInterval(function(){"#sNodes"===window.location.hash&&t.coordinators.fetch({success:function(){t.dbServers.fetch({success:function(){t.continueRender(!0)}})}})},this.interval))},render:function(){var e=this,t=function(){this.waitForDBServers(function(){e.continueRender()})}.bind(this);this.initDoneCoords?t():this.waitForCoordinators(t),window.arangoHelper.buildNodesSubNav("scale")},continueRender:function(e){var t,i,n=this;t=this.coordinators.toJSON(),i=this.dbServers.toJSON(),this.$el.html(this.template.render({runningCoords:t.length,runningDBs:i.length,plannedCoords:void 0,plannedDBs:void 0,initialized:e})),$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/numberOfServers"),contentType:"application/json",processData:!1,success:function(e){n.updateTable(e)}})},updateTable:function(e){var t='<span class="warning">scaling in progress <i class="fa fa-circle-o-notch fa-spin"></i></span>',i='<span class="positive">no scaling process active</span>';e.numberOfCoordinators&&($("#plannedCoords").html(e.numberOfCoordinators),this.coordinators.toJSON().length===e.numberOfCoordinators?$("#statusCoords").html(i):$("#statusCoords").html(t)),e.numberOfDBServers&&($("#plannedDBs").html(e.numberOfDBServers),this.dbServers.toJSON().length===e.numberOfDBServers?$("#statusDBs").html(i):$("#statusDBs").html(t))},waitForDBServers:function(e){var t=this;0===this.dbServers.length?window.setInterval(function(){t.waitForDBServers(e)},300):e()},waitForCoordinators:function(e){var t=this;window.setTimeout(function(){0===t.coordinators.length?t.waitForCoordinators(e):(t.initDoneCoords=!0,e())},200)},updateServerTime:function(){this.serverTime=(new Date).getTime()}})}(),function(){"use strict";window.SettingsView=Backbone.View.extend({el:"#content",readOnly:!1,initialize:function(e){this.collectionName=e.collectionName,this.model=this.collection},events:{},render:function(){this.breadcrumb(),arangoHelper.buildCollectionSubNav(this.collectionName,"Settings"),this.renderSettings()},breadcrumb:function(){$("#subNavigationBar .breadcrumb").html("Collection: "+this.collectionName)},unloadCollection:function(){if(!this.readOnly){var e=function(e){e?arangoHelper.arangoError("Collection error",this.model.get("name")+" could not be unloaded."):void 0===e?(this.model.set("status","unloading"),this.render()):"#collections"===window.location.hash?(this.model.set("status","unloaded"),this.render()):arangoHelper.arangoNotification("Collection "+this.model.get("name")+" unloaded.")}.bind(this);this.model.unloadCollection(e),window.modalView.hide()}},loadCollection:function(){if(!this.readOnly){var e=function(e){e?arangoHelper.arangoError("Collection error",this.model.get("name")+" could not be loaded."):void 0===e?(this.model.set("status","loading"),this.render()):"#collections"===window.location.hash?(this.model.set("status","loaded"),this.render()):arangoHelper.arangoNotification("Collection "+this.model.get("name")+" loaded.")}.bind(this);this.model.loadCollection(e),window.modalView.hide()}},truncateCollection:function(){this.readOnly||(this.model.truncateCollection(),$(".modal-delete-confirmation").hide(),window.modalView.hide())},warmupCollection:function(){this.readOnly||(this.model.warmupCollection(),$(".modal-delete-confirmation").hide(),window.modalView.hide())},deleteCollection:function(){this.readOnly||this.model.destroy({error:function(){arangoHelper.arangoError("Could not delete collection.")},success:function(){window.App.navigate("#collections",{trigger:!0})}})},saveModifiedCollection:function(){if(!this.readOnly){var e=function(e,t){if(e)arangoHelper.arangoError("Error","Could not get coordinator info");else{var i;i=t?this.model.get("name"):$("#change-collection-name").val();var n=this.model.get("status");if("loaded"===n){var o,a;if("rocksdb"!==frontendConfig.engine)try{o=JSON.parse(1024*$("#change-collection-size").val()*1024)}catch(e){return arangoHelper.arangoError("Please enter a valid journal size number."),0}if("rocksdb"!==frontendConfig.engine)try{if((a=JSON.parse($("#change-index-buckets").val()))<1||parseInt(a,10)!==Math.pow(2,Math.log2(a)))throw new Error("invalid indexBuckets value")}catch(e){return arangoHelper.arangoError("Please enter a valid number of index buckets."),0}var r=this,s=function(e,t){e?(r.render(),arangoHelper.arangoError("Collection error: "+t.responseJSON.errorMessage)):(arangoHelper.arangoNotification("Collection: Successfully changed."),window.App.navigate("#cSettings/"+i,{trigger:!0}))},l=function(e){if(e)arangoHelper.arangoError("Collection error: "+e.responseText);else{var t,i=$("#change-collection-sync").val();frontendConfig.isCluster&&(t=$("#change-replication-factor").val()),this.model.changeCollection(i,o,a,t,s)}}.bind(this);!1===frontendConfig.isCluster?this.model.renameCollection(i,l):l()}else if("unloaded"===n)if(this.model.get("name")!==i){var c=function(e,t){e?arangoHelper.arangoError("Collection"+t.responseText):(arangoHelper.arangoNotification("CollectionSuccessfully changed."),window.App.navigate("#cSettings/"+i,{trigger:!0}))};!1===frontendConfig.isCluster?this.model.renameCollection(i,c):c()}else window.modalView.hide()}}.bind(this);window.isCoordinator(e)}},changeViewToReadOnly:function(){window.App.settingsView.readOnly=!0,$(".breadcrumb").html($(".breadcrumb").html()+" (read-only)"),$(".modal-body input").prop("disabled","true"),$(".modal-body select").prop("disabled","true"),$(".modal-footer button").addClass("disabled"),$(".modal-footer button").unbind("click")},renderSettings:function(){var s=this,e=function(e,t){if(e)arangoHelper.arangoError("Error","Could not get coordinator info");else{var i=!1;"loaded"===this.model.get("status")&&(i=!0);var n=[],a=[];t||("_"===this.model.get("name").substr(0,1)?a.push(window.modalView.createReadOnlyEntry("change-collection-name","Name",this.model.get("name"),!1,"",!0,[{rule:Joi.string().regex(/^[a-zA-Z]/),msg:"Collection name must always start with a letter."},{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only Symbols "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No collection name given."}])):a.push(window.modalView.createTextEntry("change-collection-name","Name",this.model.get("name"),!1,"",!0,[{rule:Joi.string().regex(/^[a-zA-Z]/),msg:"Collection name must always start with a letter."},{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only Symbols "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No collection name given."}])));var r=function(){a.push(window.modalView.createReadOnlyEntry("change-collection-id","ID",this.model.get("id"),"")),a.push(window.modalView.createReadOnlyEntry("change-collection-type","Type",this.model.get("type"),"")),a.push(window.modalView.createReadOnlyEntry("change-collection-status","Status",this.model.get("status"),"")),n.push(window.modalView.createDeleteButton("Delete",this.deleteCollection.bind(this))),n.push(window.modalView.createDeleteButton("Truncate",this.truncateCollection.bind(this))),"rocksdb"===frontendConfig.engine&&n.push(window.modalView.createNotificationButton("Load Indexes into Memory",this.warmupCollection.bind(this))),i?n.push(window.modalView.createNotificationButton("Unload",this.unloadCollection.bind(this))):n.push(window.modalView.createNotificationButton("Load",this.loadCollection.bind(this))),n.push(window.modalView.createSuccessButton("Save",this.saveModifiedCollection.bind(this)));window.modalView.show(["modalTable.ejs","indicesView.ejs"],"Modify Collection",n,a,null,null,this.events,null,["General","Indexes"],"content"),$($("#infoTab").children()[1]).remove()}.bind(this);if(i){this.model.getProperties(function(e,t){if(e)arangoHelper.arangoError("Collection","Could not fetch properties");else{var i=t.waitForSync;if(t.journalSize){var n=t.journalSize/1048576,o=t.indexBuckets;a.push(window.modalView.createTextEntry("change-collection-size","Journal size",n,"The maximal size of a journal or datafile (in MB). Must be at least 1.","",!0,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}]))}o&&a.push(window.modalView.createTextEntry("change-index-buckets","Index buckets",o,"The number of index buckets for this collection. Must be at least 1 and a power of 2.","",!0,[{rule:Joi.string().allow("").optional().regex(/^[1-9][0-9]*$/),msg:"Must be a number greater than 1 and a power of 2."}])),t.replicationFactor&&frontendConfig.isCluster&&("satellite"===t.replicationFactor?a.push(window.modalView.createReadOnlyEntry("change-replication-factor","Replication factor",t.replicationFactor,"This collection is a satellite collection. The replicationFactor is not changeable.","",!0)):a.push(window.modalView.createTextEntry("change-replication-factor","Replication factor",t.replicationFactor,"The replicationFactor parameter is the total number of copies being kept, that is, it is one plus the number of followers. Must be a number.","",!0,[{rule:Joi.string().allow("").optional().regex(/^[0-9]*$/),msg:"Must be a number."}]))),a.push(window.modalView.createSelectEntry("change-collection-sync","Wait for sync",i,"Synchronize to disk before returning from a create or update of a document.",[{value:!1,label:"No"},{value:!0,label:"Yes"}]))}r(),arangoHelper.checkCollectionPermissions(s.collectionName,s.changeViewToReadOnly.bind(this))})}else r(),arangoHelper.checkCollectionPermissions(s.collectionName,s.changeViewToReadOnly.bind(this))}}.bind(this);window.isCoordinator(e)}})}(),function(){"use strict";window.ShardsView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("shardsView.ejs"),interval:1e4,knownServers:[],pending:!1,visibleCollection:null,events:{"click #shardsContent .shardLeader span":"moveShard","click #shardsContent .shardFollowers span":"moveShardFollowers","click #rebalanceShards":"rebalanceShards","click .sectionHeader":"toggleSections"},initialize:function(e){var t=this;t.dbServers=e.dbServers,clearInterval(this.intervalFunction),window.App.isCluster&&(this.updateServerTime(),this.intervalFunction=window.setInterval(function(){"#shards"===window.location.hash&&t.render(!1)},this.interval))},remove:function(){return clearInterval(this.intervalFunction),this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},renderArrows:function(e){$("#shardsContent .fa-arrow-down").removeClass("fa-arrow-down").addClass("fa-arrow-right"),$(e.currentTarget).find(".fa-arrow-right").removeClass("fa-arrow-right").addClass("fa-arrow-down")},toggleSections:function(e){var t=$(e.currentTarget).parent().attr("id");this.visibleCollection=t,$(".sectionShardContent").hide(),$(e.currentTarget).next().show(),this.renderArrows(e),this.getShardDetails(t)},renderShardDetail:function(i,e){var n=0,o=0,a=0;_.each(e.results[i].Plan,function(e,t){if(e.progress)if(0===e.progress.current){$("#"+i+"-"+t+" .shardProgress").html("<span>n/A</span>")}else n=(e.progress.current/e.progress.total*100).toString().match(/^-?\d+(?:\.\d{0,2})?/)[0]+"%",$("#"+i+"-"+t+" .shardProgress").html(n);else $("#"+i+"-"+t+" .shardProgress").html('<i class="fa fa-check-circle">'),o++;a++}),a===o?($("#"+i+" .shardSyncIcons i").addClass("fa-check-circle").removeClass(".fa-times-circle"),$("#"+i+" .notInSync").addClass("inSync").removeClass("notInSync")):$("#"+i+" .shardSyncIcons i").addClass("fa-times-circle").removeClass("fa-check-circle")},checkActiveShardDisplay:function(){var t=this;_.each($(".sectionShard"),function(e){$(e).find(".sectionShardContent").is(":visible")&&t.getShardDetails($(e).attr("id"))})},getShardDetails:function(t){var i=this,e={collection:t};$("#"+t+" .shardProgress").html('<i class="fa fa-circle-o-notch fa-spin fa-fw"></i>'),$.ajax({type:"PUT",cache:!1,data:JSON.stringify(e),url:arangoHelper.databaseUrl("/_admin/cluster/collectionShardDistribution"),contentType:"application/json",processData:!1,async:!0,success:function(e){i.renderShardDetail(t,e)},error:function(e){}})},render:function(e){if("#shards"===window.location.hash&&!1===this.pending){var t=this;t.pending=!0,$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/shardDistribution"),contentType:"application/json",processData:!1,async:!0,success:function(e){var i=t.pending=!1;t.shardDistribution=e.results,_.each(e.results,function(e,t){"error"!==t&&"code"!==t&&("_"!==t.substring(0,1)&&(i=!0),(t.startsWith("_local_")||t.startsWith("_to_")||t.startsWith("_from_"))&&(i=!0))}),i?t.continueRender(e.results):arangoHelper.renderEmpty("No collections and no shards available"),t.checkActiveShardDisplay()},error:function(e){0!==e.readyState&&arangoHelper.arangoError("Cluster","Could not fetch sharding information.")}}),!1!==e&&arangoHelper.buildNodesSubNav("Shards")}},moveShardFollowers:function(e){var t=$(e.currentTarget).html();this.moveShard(e,t)},moveShard:function(e,t){var i,n,o,a,r=this,s=window.App.currentDB.get("name");n=$(e.currentTarget).parent().parent().attr("collection"),o=$(e.currentTarget).parent().parent().attr("shard"),t?(a=$(e.currentTarget).parent().parent().attr("leader"),a=arangoHelper.getDatabaseServerId(a),i=arangoHelper.getDatabaseServerId(t)):(i=$(e.currentTarget).parent().parent().attr("leader"),i=arangoHelper.getDatabaseServerId(i));var l=[],c=[],d={},u=[];r.dbServers[0].fetch({success:function(){r.dbServers[0].each(function(e){e.get("id")!==i&&(d[e.get("name")]={value:e.get("id"),label:e.get("name")})}),_.each(r.shardDistribution[n].Plan[o].followers,function(e){delete d[e]}),t&&delete d[arangoHelper.getDatabaseShortName(a)],_.each(d,function(e){u.push(e)}),0!==(u=u.reverse()).length?(c.push(window.modalView.createSelectEntry("toDBServer","Destination",void 0,"Please select the target database server. The selected database server will be the new leader of the shard.",u)),l.push(window.modalView.createSuccessButton("Move",r.confirmMoveShards.bind(this,s,n,o,i))),window.modalView.show("modalTable.ejs","Move shard: "+o,l,c)):arangoHelper.arangoMessage("Shards","No database server for moving the shard is available.")}})},confirmMoveShards:function(e,t,i,n){var o=$("#toDBServer").val(),a={database:e,collection:t,shard:i,fromServer:n,toServer:o};$.ajax({type:"POST",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/moveShard"),contentType:"application/json",processData:!1,data:JSON.stringify(a),async:!0,success:function(e){e.id&&(arangoHelper.arangoNotification("Shard "+i+" will be moved to "+arangoHelper.getDatabaseShortName(o)+"."),window.setTimeout(function(){window.App.shardsView.render()},3e3))},error:function(){arangoHelper.arangoError("Shard "+i+" could not be moved to "+arangoHelper.getDatabaseShortName(o)+".")}}),window.modalView.hide()},rebalanceShards:function(){var t=this;$.ajax({type:"POST",cache:!1,url:arangoHelper.databaseUrl("/_admin/cluster/rebalanceShards"),contentType:"application/json",processData:!1,data:JSON.stringify({}),async:!0,success:function(e){!0===e&&(window.setTimeout(function(){t.render(!1)},3e3),arangoHelper.arangoNotification("Started rebalance process."))},error:function(){arangoHelper.arangoError("Could not start rebalance process.")}}),window.modalView.hide()},continueRender:function(r){delete r.code,delete r.error,_.each(r,function(e,t){var i={Plan:{},Current:{}};if(t.startsWith("_local_")){var n=t.substr(7,t.length-1),o=["_local_"+n,"_from_"+n,"_to_"+n,n],a=0;_.each(o,function(e,t){_.each(r[o[a]].Current,function(e,t){i.Current[t]=e}),_.each(r[o[a]].Plan,function(e,t){i.Plan[t]=e}),delete r[o[a]],r[n]=i,a++})}});var t={};Object.keys(r).sort().forEach(function(e){t[e]=r[e]}),this.$el.html(this.template.render({collections:t,visible:this.visibleCollection}))},updateServerTime:function(){this.serverTime=(new Date).getTime()}})}(),function(){"use strict";window.ShowClusterView=Backbone.View.extend({detailEl:"#modalPlaceholder",el:"#content",defaultFrame:12e5,template:templateEngine.createTemplate("showCluster.ejs"),modal:templateEngine.createTemplate("waitModal.ejs"),detailTemplate:templateEngine.createTemplate("detailView.ejs"),events:{"change #selectDB":"updateCollections","change #selectCol":"updateShards","click .dbserver.success":"dashboard","click .coordinator.success":"dashboard"},replaceSVGs:function(){$(".svgToReplace").each(function(){var i=$(this),n=i.attr("id"),e=i.attr("src");$.get(e,function(e){var t=$(e).find("svg");t.attr("id",n).attr("class","icon").removeAttr("xmlns:a"),i.replaceWith(t)},"xml")})},updateServerTime:function(){this.serverTime=(new Date).getTime()},setShowAll:function(){this.graphShowAll=!0},resetShowAll:function(){this.graphShowAll=!1,this.renderLineChart()},initialize:function(e){this.options=e,this.interval=1e4,this.isUpdating=!1,this.timer=null,this.knownServers=[],this.graph=void 0,this.graphShowAll=!1,this.updateServerTime(),this.dygraphConfig=this.options.dygraphConfig,this.dbservers=new window.ClusterServers([],{interval:this.interval}),this.coordinators=new window.ClusterCoordinators([],{interval:this.interval}),this.documentStore=new window.ArangoDocuments,this.statisticsDescription=new window.StatisticsDescription,this.statisticsDescription.fetch({async:!1}),this.dbs=new window.ClusterDatabases([],{interval:this.interval}),this.cols=new window.ClusterCollections,this.shards=new window.ClusterShards,this.startUpdating()},listByAddress:function(t){var i=this;this.dbservers.byAddress({},function(e){i.coordinators.byAddress(e,t)})},updateCollections:function(){var i=this,n=$("#selectCol"),e=$("#selectDB").find(":selected").attr("id");if(e){var o=n.find(":selected").attr("id");n.html(""),this.cols.getList(e,function(e){_.each(_.pluck(e,"name"),function(e){n.append('<option id="'+e+'">'+e+"</option>")});var t=$("#"+o,n);1===t.length&&t.prop("selected",!0),i.updateShards()})}},updateShards:function(){var e=$("#selectDB").find(":selected").attr("id"),t=$("#selectCol").find(":selected").attr("id");this.shards.getList(e,t,function(e){$(".shardCounter").html("0"),_.each(e,function(e){$("#"+e.server+"Shards").html(e.shards.length)})})},updateServerStatus:function(e){var t=this,i=function(e,t,i){var n,o,a=i;a=(a=a.replace(/\./g,"-")).replace(/:/g,"_"),(o=$("#id"+a)).length<1||(n=o.attr("class").split(/\s+/)[1],o.attr("class",e+" "+n+" "+t),"coordinator"===e&&("success"===t?$(".button-gui",o.closest(".tile")).toggleClass("button-gui-disabled",!1):$(".button-gui",o.closest(".tile")).toggleClass("button-gui-disabled",!0)))};this.coordinators.getStatuses(i.bind(this,"coordinator"),function(){t.dbservers.getStatuses(i.bind(t,"dbserver")),e()})},updateDBDetailList:function(){var i=this,n=$("#selectDB"),o=n.find(":selected").attr("id");n.html(""),this.dbs.getList(function(e){_.each(_.pluck(e,"name"),function(e){n.append('<option id="'+e+'">'+e+"</option>")});var t=$("#"+o,n);1===t.length&&t.prop("selected",!0),i.updateCollections()})},rerender:function(){var e=this;this.updateServerStatus(function(){e.getServerStatistics(function(){e.updateServerTime(),e.data=e.generatePieData(),e.renderPieChart(e.data),e.renderLineChart(),e.updateDBDetailList()})})},render:function(){this.knownServers=[],delete this.hist;var i=this;this.listByAddress(function(t){1===Object.keys(t).length?i.type="testPlan":i.type="other",i.updateDBDetailList(),i.dbs.getList(function(e){$(i.el).html(i.template.render({dbs:_.pluck(e,"name"),byAddress:t,type:i.type})),$(i.el).append(i.modal.render({})),i.replaceSVGs(),i.getServerStatistics(function(){i.data=i.generatePieData(),i.renderPieChart(i.data),i.renderLineChart(),i.updateDBDetailList(),i.startUpdating()})})})},generatePieData:function(){var t=[],i=this;return this.data.forEach(function(e){t.push({key:e.get("name"),value:e.get("system").virtualSize,time:i.serverTime})}),t},addStatisticsItem:function(e,t,i,n){var o=this;o.hasOwnProperty("hist")||(o.hist={}),o.hist.hasOwnProperty(e)||(o.hist[e]=[]);var a=o.hist[e],r=a.length;if(0===r)a.push({time:t,snap:n,requests:i,requestsPerSecond:0});else{var s=a[r-1].time,l=a[r-1].requests;if(l<i){var c=t-s,d=0;0<c&&(d=(i-l)/c),a.push({time:t,snap:n,requests:i,requestsPerSecond:d})}}},getServerStatistics:function(o){var a=this,r=Math.round(a.serverTime/1e3);this.data=void 0;var i=new window.ClusterStatisticsCollection,n=this.coordinators.first();this.dbservers.forEach(function(e){if("ok"===e.get("status")){-1===a.knownServers.indexOf(e.id)&&a.knownServers.push(e.id);var t=new window.Statistics({name:e.id});t.url=n.get("protocol")+"://"+n.get("address")+"/_admin/clusterStatistics?DBserver="+e.get("name"),i.add(t)}}),this.coordinators.forEach(function(e){if("ok"===e.get("status")){-1===a.knownServers.indexOf(e.id)&&a.knownServers.push(e.id);var t=new window.Statistics({name:e.id});t.url=e.get("protocol")+"://"+e.get("address")+"/_admin/statistics",i.add(t)}});var s=i.size();this.data=[];i.fetch(function(e){s--;var t=e.get("time"),i=e.get("name"),n=e.get("http").requestsTotal;a.addStatisticsItem(i,t,n,r),a.data.push(e),0===s&&o()},function(){0==--s&&o()})},renderPieChart:function(e){var t=$("#clusterGraphs svg").width(),i=$("#clusterGraphs svg").height(),n=Math.min(t,i)/2,o=this.dygraphConfig.colors,a=d3.svg.arc().outerRadius(n-20).innerRadius(0),r=d3.layout.pie().sort(function(e){return e.value}).value(function(e){return e.value});d3.select("#clusterGraphs").select("svg").remove();var s=d3.select("#clusterGraphs").append("svg").attr("class","clusterChart").append("g").attr("transform","translate("+t/2+","+(i/2-10)+")"),l=d3.svg.arc().outerRadius(n-2).innerRadius(n-2),c=s.selectAll(".arc").data(r(e)).enter().append("g").attr("class","slice");c.append("path").attr("d",a).style("fill",function(e,t){return o[t%o.length]}).style("stroke",function(e,t){return o[t%o.length]}),c.append("text").attr("transform",function(e){return"translate("+a.centroid(e)+")"}).style("text-anchor","middle").text(function(e){return(e.data.value/1024/1024/1024).toFixed(2)}),c.append("text").attr("transform",function(e){return"translate("+l.centroid(e)+")"}).style("text-anchor","middle").text(function(e){return e.data.key})},renderLineChart:function(){var e,t,i,n,o,a,r=[],s=[],l=Math.round((new Date).getTime()/1e3)-1200,c=this.knownServers,d=function(){return null};for(i=0;i<c.length;++i)if(t=this.hist[c[i]])for(n=0;n<t.length;++n)(a=t[n].snap)<l||(s.hasOwnProperty(a)?e=s[a]:(o=new Date(1e3*a),e=s[a]=[o].concat(c.map(d))),e[i+1]=t[n].requestsPerSecond);r=[],Object.keys(s).sort().forEach(function(e){r.push(s[e])});var u=this.dygraphConfig.getDefaultConfig("clusterRequestsPerSecond");u.labelsDiv=$("#lineGraphLegend")[0],u.labels=["datetime"].concat(c),this.graph=new Dygraph(document.getElementById("lineGraph"),r,u)},stopUpdating:function(){window.clearTimeout(this.timer),delete this.graph,this.isUpdating=!1},startUpdating:function(){if(!this.isUpdating){this.isUpdating=!0;var e=this;this.timer=window.setInterval(function(){e.rerender()},this.interval)}},dashboard:function(e){this.stopUpdating();var t,i,n=$(e.currentTarget),o={},a=n.attr("id");a=(a=(a=a.replace(/-/g,".")).replace(/_/g,":")).substr(2),o.raw=a,o.isDBServer=n.hasClass("dbserver"),o.isDBServer?(t=this.dbservers.findWhere({address:o.raw}),i=this.coordinators.findWhere({status:"ok"}),o.endpoint=i.get("protocol")+"://"+i.get("address")):(t=this.coordinators.findWhere({address:o.raw}),o.endpoint=t.get("protocol")+"://"+t.get("address")),o.target=encodeURIComponent(t.get("name")),window.App.serverToShow=o,window.App.dashboard()},getCurrentSize:function(e){return"#"!==e.substr(0,1)&&(e="#"+e),$(e).attr("style",""),{height:$(e).height(),width:$(e).width()}},resize:function(){var e;this.graph&&(e=this.getCurrentSize(this.graph.maindiv_.id),this.graph.resize(e.width,e.height))}})}(),function(){"use strict";window.SpotlightView=Backbone.View.extend({template:templateEngine.createTemplate("spotlightView.ejs"),el:"#spotlightPlaceholder",displayLimit:8,typeahead:null,callbackSuccess:null,callbackCancel:null,collections:{system:[],doc:[],edge:[]},events:{"focusout #spotlight .tt-input":"hide","keyup #spotlight .typeahead":"listenKey"},aqlKeywordsArray:[],aqlBuiltinFunctionsArray:[],aqlKeywords:"for|return|filter|search|sort|limit|let|collect|asc|desc|in|into|insert|update|remove|replace|upsert|options|with|and|or|not|distinct|graph|shortest_path|outbound|inbound|any|all|none|aggregate|like|count",hide:function(){this.typeahead=$("#spotlight .typeahead").typeahead("destroy"),$(this.el).hide()},listenKey:function(e){if(27===e.keyCode)this.callbackSuccess&&this.callbackCancel(),this.hide();else if(13===e.keyCode&&this.callbackSuccess){var t=$(this.typeahead).val();this.callbackSuccess(t),this.hide()}},substringMatcher:function(o){return function(e,t){var i,n;i=[],n=new RegExp(e,"i"),_.each(o,function(e){n.test(e)&&i.push(e)}),t(i)}},updateDatasets:function(){var t=this;this.collections={system:[],doc:[],edge:[]},window.App.arangoCollectionsStore.each(function(e){e.get("isSystem")?t.collections.system.push(e.get("name")):"document"===e.get("type")?t.collections.doc.push(e.get("name")):t.collections.edge.push(e.get("name"))})},stringToArray:function(){var t=this;_.each(this.aqlKeywords.split("|"),function(e){t.aqlKeywordsArray.push(e.toUpperCase())}),t.aqlKeywordsArray.push(!0),t.aqlKeywordsArray.push(!1),t.aqlKeywordsArray.push(null)},fetchKeywords:function(t){var i=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/aql-builtin"),contentType:"application/json",success:function(e){i.stringToArray(),i.updateDatasets(),_.each(e.functions,function(e){i.aqlBuiltinFunctionsArray.push(e.name)}),t&&t()},error:function(){t&&t(),arangoHelper.arangoError("AQL","Could not fetch AQL function definition.")}})},show:function(e,t,i){var n=this;this.callbackSuccess=e,this.callbackCancel=t;var o=function(){var e=function(e,t,i){var n='<div class="header-type"><h4>'+e+"</h4>";return t&&(n+='<span><i class="fa '+t+'"></i></span>'),i&&(n+='<span class="type">'+i.toUpperCase()+"</span>"),n+="</div>"};$(this.el).html(this.template.render({})),$(this.el).show(),this.typeahead="aql"===i?$("#spotlight .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"Functions",source:n.substringMatcher(n.aqlBuiltinFunctionsArray),limit:n.displayLimit,templates:{header:e("Functions","fa-code","aql")}},{name:"Keywords",source:n.substringMatcher(n.aqlKeywordsArray),limit:n.displayLimit,templates:{header:e("Keywords","fa-code","aql")}},{name:"Documents",source:n.substringMatcher(n.collections.doc),limit:n.displayLimit,templates:{header:e("Documents","fa-file-text-o","Collection")}},{name:"Edges",source:n.substringMatcher(n.collections.edge),limit:n.displayLimit,templates:{header:e("Edges","fa-share-alt","Collection")}},{name:"System",limit:n.displayLimit,source:n.substringMatcher(n.collections.system),templates:{header:e("System","fa-cogs","Collection")}}):$("#spotlight .typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"Documents",source:n.substringMatcher(n.collections.doc),limit:n.displayLimit,templates:{header:e("Documents","fa-file-text-o","Collection")}},{name:"Edges",source:n.substringMatcher(n.collections.edge),limit:n.displayLimit,templates:{header:e("Edges","fa-share-alt","Collection")}},{name:"System",limit:n.displayLimit,source:n.substringMatcher(n.collections.system),templates:{header:e("System","fa-cogs","Collection")}}),$("#spotlight .typeahead").focus()}.bind(this);0===n.aqlBuiltinFunctionsArray.length?this.fetchKeywords(o):o()}})}(),function(){"use strict";window.StatisticBarView=Backbone.View.extend({el:"#statisticBar",events:{"change #arangoCollectionSelect":"navigateBySelect","click .tab":"navigateByTab"},template:templateEngine.createTemplate("statisticBarView.ejs"),initialize:function(e){this.currentDB=e.currentDB},replaceSVG:function(i){var n=i.attr("id"),o=i.attr("class"),e=i.attr("src");$.get(e,function(e){var t=$(e).find("svg");void 0===n&&(t=t.attr("id",n)),void 0===o&&(t=t.attr("class",o+" replaced-svg")),t=t.removeAttr("xmlns:a"),i.replaceWith(t)},"xml")},render:function(){var e=this;return $(this.el).html(this.template.render({isSystem:this.currentDB.get("isSystem")})),$("img.svg").each(function(){e.replaceSVG($(this))}),this},navigateBySelect:function(){var e=$("#arangoCollectionSelect").find("option:selected").val();window.App.navigate(e,{trigger:!0})},navigateByTab:function(e){var t=(e.target||e.srcElement).id;return"links"===t?$("#link_dropdown").slideToggle(200):"tools"===t?$("#tools_dropdown").slideToggle(200):window.App.navigate(t,{trigger:!0}),void e.preventDefault()},handleSelectNavigation:function(){$("#arangoCollectionSelect").change(function(){var e=$(this).find("option:selected").val();window.App.navigate(e,{trigger:!0})})},selectMenuItem:function(e){$(".navlist li").removeClass("active"),e&&$("."+e).addClass("active")}})}(),function(){"use strict";window.StoreDetailView=Backbone.View.extend({el:"#content",divs:["#readme","#swagger","#app-info","#sideinformation","#information","#settings"],navs:["#service-info","#service-api","#service-readme","#service-settings"],template:templateEngine.createTemplate("storeDetailView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #installService":"installService"},installService:function(){arangoHelper.createMountPointModal(this.installFoxxFromStore.bind(this))},installCallback:function(e){window.App.navigate("#services",{trigger:!0}),window.App.applicationsView.installCallback(e)},installFoxxFromStore:function(e){var t,i;window.modalView.modalTestAll()&&(this._upgrade?(t=this.mount,i=$("#new-app-teardown").prop("checked")):"/"!==(t=window.arangoHelper.escapeHtml($("#new-app-mount").val())).charAt(0)&&(t="/"+t),void 0!==i?this.collection.installFromStore({name:this.model.get("name"),version:this.model.get("latestVersion")},t,this.installCallback.bind(this),i):this.collection.installFromStore({name:this.model.get("name"),version:this.model.get("latestVersion")},t,this.installCallback.bind(this)),window.modalView.hide(),arangoHelper.arangoNotification("Services","Installing "+this.model.get("name")+"."))},resize:function(e){e?$(".innerContent").css("height","auto"):$(".innerContent").height($(".centralRow").height()-150)},render:function(){var n=this;return this.model.fetchThumbnail(function(e){var t=function(e,t){if(e)arangoHelper.arangoError("DB","Could not get current database");else{var i=this.model.get("defaultThumbnailUrl");if(this.model.get("manifest"))try{this.model.get("manifest").thumbnail&&(i=this.model.getThumbnailUrl())}catch(e){}$(this.el).html(this.template.render({app:this.model,baseUrl:arangoHelper.databaseUrl("",t),installed:!0,image:i})),this.model.fetchReadme(n.renderReadme)}this.breadcrumb()}.bind(this);arangoHelper.currentDatabase(t),_.isEmpty(this.model.get("config"))&&$("#service-settings").attr("disabled",!0)}.bind(this)),this.resize(!1),$(this.el)},renderReadme:function(e){var t=marked(e);$("#readme").html(t)},breadcrumb:function(){var e="Service: "+this.model.get("name")+'<i class="fa fa-ellipsis-v" aria-hidden="true"></i>',t='<p class="mount"><span>Contributors:</span>';this.model.get("contributors")&&0<this.model.get("contributors").length?_.each(this.model.get("contributors"),function(e){e.email?t+='<a href="mailto:'+e.email+'">'+(e.name||e.email)+"</a>":e.name&&(t+="<a>contributor.name</a>")}):t+="No contributors",t+="</p>",$(".information").append(t),this.model.get("author")&&$(".information").append('<p class="mount"><span>Author:</span>'+this.model.get("author")+"</p>"),this.model.get("mount")&&$(".information").append('<p class="mount"><span>Mount:</span>'+this.model.get("mount")+"</p>"),this.model.get("development")&&this.model.get("path")&&$(".information").append('<p class="path"><span>Path:</span>'+this.model.get("path")+"</p>"),$("#subNavigationBar .breadcrumb").html(e)},storeUrl:function(e){return arangoHelper.databaseUrl(this.model.get("mount"),e)}})}(),function(){"use strict";window.SupportView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("supportView.ejs"),events:{"click .subViewNavbar .subMenuEntry":"toggleViews"},render:function(){this.$el.html(this.template.render({}))},resize:function(e){e?$(".innerContent").css("height","auto"):$(".innerContent").height($(".centralRow").height()-170)},renderSwagger:function(){var e=window.location.pathname.split("/"),t=window.location.protocol+"//"+window.location.hostname+":"+window.location.port+"/"+e[1]+"/"+e[2]+"/_admin/aardvark/api/index.html";$("#swagger").html(""),$("#swagger").append('<iframe src="'+t+'" style="border:none"></iframe>')},toggleViews:function(e){var t=this,i=e.currentTarget.id.split("-")[0];_.each(["community","documentation","swagger"],function(e){i!==e?$("#"+e).hide():("swagger"===i?(t.renderSwagger(),$("#swagger iframe").css("height","100%"),$("#swagger iframe").css("width","100%"),$("#swagger iframe").css("margin-top","-13px"),t.resize()):t.resize(!0),$("#"+e).show())}),$(".subMenuEntries").children().removeClass("active"),$("#"+i+"-support").addClass("active")}})}(),function(){"use strict";window.TableView=Backbone.View.extend({template:templateEngine.createTemplate("tableView.ejs"),loading:templateEngine.createTemplate("loadingTableView.ejs"),initialize:function(e){this.rowClickCallback=e.rowClick},events:{"click .pure-table-body .pure-table-row":"rowClick","click .deleteButton":"removeClick"},rowClick:function(e){this.hasOwnProperty("rowClickCallback")&&this.rowClickCallback(e)},removeClick:function(e){this.hasOwnProperty("removeClickCallback")&&(this.removeClickCallback(e),e.stopPropagation())},setRowClick:function(e){this.rowClickCallback=e},setRemoveClick:function(e){this.removeClickCallback=e},render:function(){$(this.el).html(this.template.render({docs:this.collection}))},drawLoading:function(){$(this.el).html(this.loading.render({}))}})}(),function(){"use strict";window.UserBarView=Backbone.View.extend({events:{"change #userBarSelect":"navigateBySelect","click .tab":"navigateByTab","mouseenter .dropdown":"showDropdown","mouseleave .dropdown":"hideDropdown","click #userLogoutIcon":"userLogout","click #userLogout":"userLogout"},initialize:function(e){arangoHelper.checkDatabasePermissions(this.setUserCollectionMode.bind(this)),this.userCollection=e.userCollection,this.userCollection.fetch({cache:!1,async:!0}),this.userCollection.bind("change:extra",this.render.bind(this))},setUserCollectionMode:function(e){e&&(this.userCollection.authOptions.ro=!0)},template:templateEngine.createTemplate("userBarView.ejs"),navigateBySelect:function(){var e=$("#arangoCollectionSelect").find("option:selected").val();window.App.navigate(e,{trigger:!0})},navigateByTab:function(e){var t=e.target||e.srcElement,i=(t=$(t).closest("a")).attr("id");if("user"===i)return $("#user_dropdown").slideToggle(200),void e.preventDefault();window.App.navigate(i,{trigger:!0}),e.preventDefault()},toggleUserMenu:function(){$("#userBar .subBarDropdown").toggle()},showDropdown:function(){$("#user_dropdown").fadeIn(1)},hideDropdown:function(){$("#user_dropdown").fadeOut(1)},render:function(){if(!1!==frontendConfig.authenticationEnabled){var s=this;$("#userBar").on("click",function(){s.toggleUserMenu()}),this.userCollection.whoAmI(function(e,t){if(e)arangoHelper.arangoErro("User","Could not fetch user.");else{var i=null,n=null,o=!1,a=null;if(!1!==t){var r=function(){return frontendConfig.ldapEnabled&&s.userCollection.add({name:window.App.currentUser,user:window.App.currentUser,username:window.App.currentUser,active:!0,img:void 0}),(a=s.userCollection.findWhere({user:t})).set({loggedIn:!0}),n=a.get("extra").name,i=a.get("extra").img,o=a.get("active"),i=i?"https://s.gravatar.com/avatar/"+i+"?s=80":"img/default_user.png",n||(n=""),s.$el=$("#userBar"),s.$el.html(s.template.render({img:i,name:n,username:t,active:o})),s.delegateEvents(),s.$el};0===s.userCollection.models.length?s.userCollection.fetch({success:function(){r()}}):r()}}})}},userLogout:function(){var e=function(e){e?arangoHelper.arangoError("User","Logout error"):this.userCollection.logout()}.bind(this);this.userCollection.whoAmI(e)}})}(),function(){"use strict";window.UserManagementView=Backbone.View.extend({el:"#content",el2:"#userManagementThumbnailsIn",template:templateEngine.createTemplate("userManagementView.ejs"),remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #createUser":"createUser","click #submitCreateUser":"submitCreateUser","click #userManagementThumbnailsIn .tile":"editUser","click #submitEditUser":"submitEditUser","click #userManagementToggle":"toggleView","keyup #userManagementSearchInput":"search","click #userManagementSearchSubmit":"search","click #callEditUserPassword":"editUserPassword","click #submitEditUserPassword":"submitEditUserPassword","click #submitEditCurrentUserProfile":"submitEditCurrentUserProfile","click .css-label":"checkBoxes","change #userSortDesc":"sorting"},dropdownVisible:!1,initialize:function(){var e=this,t=function(e,t){!0===frontendConfig.authenticationEnabled&&(e||null===t?arangoHelper.arangoError("User","Could not fetch user data"):this.currentUser=this.collection.findWhere({user:t}))}.bind(this);this.collection.fetch({fetchAllUsers:!0,cache:!1,success:function(){e.collection.whoAmI(t)}})},checkBoxes:function(e){var t=e.currentTarget.id;$("#"+t).click()},sorting:function(){$("#userSortDesc").is(":checked")?this.collection.setSortingDesc(!0):this.collection.setSortingDesc(!1),$("#userManagementDropdown").is(":visible")?this.dropdownVisible=!0:this.dropdownVisible=!1,this.render()},render:function(e){var t=!1;$("#userManagementDropdown").is(":visible")&&(t=!0);var i=function(){this.collection.sort(),$(this.el).html(this.template.render({collection:this.collection,searchString:""})),!0===t&&($("#userManagementDropdown2").show(),$("#userSortDesc").attr("checked",this.collection.sortOptions.desc),$("#userManagementToggle").toggleClass("activated"),$("#userManagementDropdown").show()),e&&this.editCurrentUser(),arangoHelper.setCheckboxStatus("#userManagementDropdown")}.bind(this);return this.collection.fetch({fetchAllUsers:!0,cache:!1,success:function(){i()}}),this},search:function(){var e,t,i,n;e=$("#userManagementSearchInput"),t=$("#userManagementSearchInput").val(),n=this.collection.filter(function(e){return-1!==e.get("user").indexOf(t)}),$(this.el).html(this.template.render({collection:n,searchString:t})),i=(e=$("#userManagementSearchInput")).val().length,e.focus(),e[0].setSelectionRange(i,i)},createUser:function(e){e.preventDefault(),this.createCreateUserModal()},submitCreateUser:function(){var e=this,t=$("#newUsername").val(),i=$("#newName").val(),n=$("#newPassword").val(),o=$("#newStatus").is(":checked");if(this.validateUserInfo(i,t,n,o)){var a={user:t,passwd:n,active:o,extra:{name:i}};frontendConfig.isEnterprise&&$("#newRole").is(":checked")&&(a.user=":role:"+t,delete a.passwd),this.collection.create(a,{wait:!0,error:function(e,t){arangoHelper.parseError("User",t,e)},success:function(){e.updateUserManagement(),window.modalView.hide()}})}},validateUserInfo:function(e,t,i,n){return""!==t||(arangoHelper.arangoError("You have to define an username"),$("#newUsername").closest("th").css("backgroundColor","red"),!1)},updateUserManagement:function(){var e=this;this.collection.fetch({fetchAllUsers:!0,cache:!1,success:function(){e.render()}})},editUser:function(e){if("createUser"!==$(e.currentTarget).find("a").attr("id")){$(e.currentTarget).hasClass("tile")&&(e.currentTarget=$(e.currentTarget).find(".fa")),this.collection.fetch({fetchAllUsers:!0,cache:!1});var t=this.evaluateUserName($(e.currentTarget).attr("id"),"_edit-user");""===t&&(t=$(e.currentTarget).attr("id")),window.App.navigate("user/"+encodeURIComponent(t),{trigger:!0})}},toggleView:function(){$("#userSortDesc").attr("checked",this.collection.sortOptions.desc),$("#userManagementToggle").toggleClass("activated"),$("#userManagementDropdown2").slideToggle(200)},createCreateUserModal:function(){var e=[],t=[];t.push(window.modalView.createTextEntry("newUsername","Username","",!1,"Username",!0,[{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only symbols, "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No username given."}])),t.push(window.modalView.createTextEntry("newName","Name","",!1,"Name",!1)),t.push(window.modalView.createPasswordEntry("newPassword","Password","",!1,"",!1)),frontendConfig.isEnterprise&&t.push(window.modalView.createCheckboxEntry("newRole","Role",!1,!1,!1)),t.push(window.modalView.createCheckboxEntry("newStatus","Active","active",!1,!0)),e.push(window.modalView.createSuccessButton("Create",this.submitCreateUser.bind(this))),window.modalView.show("modalTable.ejs","Create New User",e,t),frontendConfig.isEnterprise&&$("#newRole").on("change",function(){$("#newRole").is(":checked")?$("#newPassword").attr("disabled",!0):$("#newPassword").attr("disabled",!1)})},evaluateUserName:function(e,t){if(e){var i=e.lastIndexOf(t);return e.substring(0,i)}},updateUserProfile:function(){var e=this;this.collection.fetch({fetchAllUsers:!0,cache:!1,success:function(){e.render()}})}})}(),function(){"use strict";window.UserPermissionView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("userPermissionView.ejs"),initialize:function(e){this.username=e.username},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #userPermissionView .dbCheckbox":"setDBPermission","click #userPermissionView .collCheckbox":"setCollPermission","click .db-row":"toggleAccordion"},render:function(e,t){var i=this;this.collection.fetch({fetchAllUsers:!0,success:function(){i.continueRender(e,t)}})},toggleAccordion:function(e){if(!($(e.target).attr("type")||$(e.target).parent().hasClass("noAction")||$(e.target).hasClass("inner")||$(e.target).is("span"))){var t=$(e.currentTarget).find(".collection-row").is(":visible"),i=$(e.currentTarget).attr("id").split("-")[0];$(".collection-row").hide(),$(".db-label").css("font-weight",200),$(".db-label").css("color","#8a969f"),4<$(e.currentTarget).find(".collection-row").children().length?($(".db-row .fa-caret-down").hide(),$(".db-row .fa-caret-right").show(),t?$(e.currentTarget).find(".collection-row").hide():($(e.currentTarget).find(".collection-row").fadeIn("fast"),$(e.currentTarget).find(".db-label").css("font-weight",600),$(e.currentTarget).find(".db-label").css("color","rgba(64, 74, 83, 1)"),$(e.currentTarget).find(".fa-caret-down").show(),$(e.currentTarget).find(".fa-caret-right").hide())):($(".db-row .fa-caret-down").hide(),$(".db-row .fa-caret-right").show(),arangoHelper.arangoNotification("Permissions",'No collections in "'+i+'" available.'))}},setCollPermission:function(e){var t,i=$(e.currentTarget).attr("db"),n=$(e.currentTarget).attr("collection");t=$(e.currentTarget).hasClass("readOnly")?"ro":$(e.currentTarget).hasClass("readWrite")?"rw":$(e.currentTarget).hasClass("noAccess")?"none":"undefined",this.sendCollPermission(this.currentUser.get("user"),i,n,t)},setDBPermission:function(e){var t,i=$(e.currentTarget).attr("name");if(t=$(e.currentTarget).hasClass("readOnly")?"ro":$(e.currentTarget).hasClass("readWrite")?"rw":$(e.currentTarget).hasClass("noAccess")?"none":"undefined","_system"===i){var n=[],o=[];o.push(window.modalView.createReadOnlyEntry("db-system-revoke-button","Caution","You are changing the _system database permission. Really continue?",void 0,void 0,!1)),n.push(window.modalView.createSuccessButton("Ok",this.sendDBPermission.bind(this,this.currentUser.get("user"),i,t))),n.push(window.modalView.createCloseButton("Cancel",this.rollbackInputButton.bind(this,i))),window.modalView.show("modalTable.ejs","Change _system Database Permission",n,o)}else this.sendDBPermission(this.currentUser.get("user"),i,t)},rollbackInputButton:function(e,t){var i;_.each($(".collection-row"),function(e,t){$(e).is(":visible")&&(i=$(e).parent().attr("id"))}),i?this.render(i,t):this.render(),window.modalView.hide()},sendCollPermission:function(e,t,i,n){var o=this;"undefined"===n?this.revokeCollPermission(e,t,i):$.ajax({type:"PUT",url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(e)+"/database/"+encodeURIComponent(t)+"/"+encodeURIComponent(i)),contentType:"application/json",data:JSON.stringify({grant:n})}).success(function(e){o.styleDefaultRadios(null,!0)}).error(function(e){o.rollbackInputButton(null,e)})},revokeCollPermission:function(e,t,i){var n=this;$.ajax({type:"DELETE",url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(e)+"/database/"+encodeURIComponent(t)+"/"+encodeURIComponent(i)),contentType:"application/json"}).success(function(e){n.styleDefaultRadios(null,!0)}).error(function(e){n.rollbackInputButton(null,e)})},sendDBPermission:function(e,t,i){var n=this;"undefined"===i?this.revokeDBPermission(e,t):$.ajax({type:"PUT",url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(e)+"/database/"+encodeURIComponent(t)),contentType:"application/json",data:JSON.stringify({grant:i})}).success(function(e){n.styleDefaultRadios(null,!0)}).error(function(e){n.rollbackInputButton(null,e)})},revokeDBPermission:function(e,t){var i=this;$.ajax({type:"DELETE",url:arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(e)+"/database/"+encodeURIComponent(t)),contentType:"application/json"}).success(function(e){i.styleDefaultRadios(null,!0)}).error(function(e){i.rollbackInputButton(null,e)})},continueRender:function(t,i){var n=this;this.currentUser=this.collection.findWhere({user:this.username}),this.breadcrumb();var e=arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(n.currentUser.get("user"))+"/database?full=true");$.ajax({type:"GET",url:e,contentType:"application/json",success:function(e){n.finishRender(e.result,t,i)},error:function(e){arangoHelper.arangoError("User","Could not fetch user permissions")}})},finishRender:function(e,t,i){var n=_.pairs(e);n.sort(),n=_.object(n),$(this.el).html(this.template.render({permissions:n})),$(".noAction").first().appendTo(".pure-table-body"),$(".pure-table-body").height(window.innerHeight-200),t&&$("#"+t).click(),i&&i.responseJSON&&i.responseJSON.errorMessage&&arangoHelper.arangoError("User",i.responseJSON.errorMessage),this.styleDefaultRadios(e),arangoHelper.createTooltips(),this.checkRoot()},checkRoot:function(){"root"===this.currentUser.get("user")&&$("#_system-db #___-collection input").attr("disabled","true")},styleDefaultRadios:function(e,t){var i=function(e){$(".db-row input").css("box-shadow","none");var o="rgba(0, 0, 0, 0.3) 0px 1px 4px 4px";_.each(e,function(e,i){if(e.collections){var n=e.collections["*"];_.each(e.collections,function(e,t){"_"!==t.charAt(0)&&"*"!==t.charAt(0)&&"undefined"===e&&("rw"===n?$("#"+i+"-db #"+t+"-collection .readWrite").css("box-shadow",o):"ro"===n?$("#"+i+"-db #"+t+"-collection .readOnly").css("box-shadow",o):"none"===n&&$("#"+i+"-db #"+t+"-collection .noAccess").css("box-shadow",o))})}})};if(t){var n=arangoHelper.databaseUrl("/_api/user/"+encodeURIComponent(this.currentUser.get("user"))+"/database?full=true");$.ajax({type:"GET",url:n,contentType:"application/json",success:function(e){i(e.result)},error:function(e){arangoHelper.arangoError("User","Could not fetch user permissions")}})}else i(e);window.modalView.hide()},breadcrumb:function(){var e=this;window.App.naviView?($("#subNavigationBar .breadcrumb").html("User: "+this.currentUser.get("user")),arangoHelper.buildUserSubNav(e.currentUser.get("user"),"Permissions")):window.setTimeout(function(){e.breadcrumb()},100)}})}(),function(){"use strict";window.UserView=Backbone.View.extend({el:"#content",initialize:function(e){this.username=e.username},render:function(){var e=this;this.collection.fetch({fetchAllUsers:!0,success:function(){e.continueRender()}})},editCurrentUser:function(){this.createEditCurrentUserModal(this.currentUser.get("user"),this.currentUser.get("extra").name,this.currentUser.get("extra").img)},continueRender:function(){this.currentUser=this.collection.findWhere({user:this.username}),this.breadcrumb(),this.currentUser.get("loggedIn")?this.editCurrentUser():this.createEditUserModal(this.currentUser.get("user"),this.currentUser.get("extra").name,this.currentUser.get("active"))},createEditUserPasswordModal:function(){var e=[],t=[];t.push(window.modalView.createPasswordEntry("newCurrentPassword","New Password","",!1,"new password",!1)),t.push(window.modalView.createPasswordEntry("confirmCurrentPassword","Confirm New Password","",!1,"confirm new password",!1)),e.push(window.modalView.createSuccessButton("Save",this.submitEditUserPassword.bind(this))),window.modalView.show("modalTable.ejs","Edit User Password",e,t)},createEditCurrentUserModal:function(e,t,i){var n=[],o=[];o.push(window.modalView.createReadOnlyEntry("id_username","Username",e)),o.push(window.modalView.createTextEntry("editCurrentName","Name",t,!1,"Name",!1)),o.push(window.modalView.createTextEntry("editCurrentUserProfileImg","Gravatar account (Mail)",i,"Mailaddress or its md5 representation of your gravatar account.The address will be converted into a md5 string. Only the md5 string will be stored, not the mailaddress.","myAccount(at)gravatar.com")),":role:"===this.username.substring(0,6)?n.push(window.modalView.createDisabledButton("Change Password")):n.push(window.modalView.createNotificationButton("Change Password",this.editUserPassword.bind(this))),n.push(window.modalView.createSuccessButton("Save",this.submitEditCurrentUserProfile.bind(this))),window.modalView.show("modalTable.ejs","Edit User Profile",n,o,null,null,this.events,null,null,"content")},parseImgString:function(e){return-1===e.indexOf("@")?e:CryptoJS.MD5(e).toString()},createEditUserModal:function(e,t,i){var n,o;o=[{type:window.modalView.tables.READONLY,label:"Username",value:_.escape(e)},{type:window.modalView.tables.TEXT,label:"Name",value:t,id:"editName",placeholder:"Name"},{type:window.modalView.tables.CHECKBOX,label:"Active",value:"active",checked:i,id:"editStatus"}],(n=[]).push({title:"Delete",type:window.modalView.buttons.DELETE,callback:this.submitDeleteUser.bind(this,e)}),":role:"===this.username.substring(0,6)?n.push({title:"Change Password",type:window.modalView.buttons.DISABLED,callback:this.createEditUserPasswordModal.bind(this,e)}):n.push({title:"Change Password",type:window.modalView.buttons.NOTIFICATION,callback:this.createEditUserPasswordModal.bind(this,e)}),n.push({title:"Save",type:window.modalView.buttons.SUCCESS,callback:this.submitEditUser.bind(this,e)}),window.modalView.show("modalTable.ejs","Edit User",n,o,null,null,this.events,null,null,"content")},validateStatus:function(e){return""!==e},submitDeleteUser:function(e){this.collection.findWhere({user:e}).destroy({wait:!0}),window.App.navigate("#users",{trigger:!0})},submitEditCurrentUserProfile:function(){var e=$("#editCurrentName").val(),t=$("#editCurrentUserProfileImg").val();t=this.parseImgString(t);var i=function(e){e?arangoHelper.arangoError("User","Could not edit user settings"):(arangoHelper.arangoNotification("User","Changes confirmed."),this.updateUserProfile())}.bind(this);this.currentUser.setExtras(e,t,i),window.modalView.hide()},submitEditUserPassword:function(){var e=$("#newCurrentPassword").val(),t=$("#confirmCurrentPassword").val();$("#newCurrentPassword").val(""),$("#confirmCurrentPassword").val(""),$("#newCurrentPassword").closest("th").css("backgroundColor","white"),$("#confirmCurrentPassword").closest("th").css("backgroundColor","white");var i=!1;e!==t&&(arangoHelper.arangoError("User","New passwords do not match."),i=!0),i||(this.currentUser.setPassword(e),arangoHelper.arangoNotification("User","Password changed."),window.modalView.hide())},editUserPassword:function(){window.modalView.hide(),this.createEditUserPasswordModal()},submitEditUser:function(e){var t=$("#editName").val(),i=$("#editStatus").is(":checked");if(this.validateStatus(i)){var n=this.collection.findWhere({user:e});n.save({extra:{name:t},active:i},{type:"PATCH",success:function(){arangoHelper.arangoNotification("User",n.get("user")+" updated.")},error:function(){arangoHelper.arangoError("User","Could not update "+n.get("user")+".")}})}else $("#editStatus").closest("th").css("backgroundColor","red")},breadcrumb:function(){var e=this;window.App.naviView?($("#subNavigationBar .breadcrumb").html("User: "+this.username),arangoHelper.buildUserSubNav(e.currentUser.get("user"),"General")):window.setTimeout(function(){e.breadcrumb()},100)}})}(),function(){"use strict";window.ViewsView=Backbone.View.extend({el:"#content",readOnly:!1,template:templateEngine.createTemplate("viewsView.ejs"),initialize:function(){},sortOptions:{desc:!1},searchString:"",remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #createView":"createView","click #viewsToggle":"toggleSettingsDropdown","click .tile":"gotoView","keyup #viewsSearchInput":"search","click #viewsSearchSubmit":"search","click #viewsSortDesc":"sorting"},checkVisibility:function(){$("#viewsDropdown").is(":visible")?this.dropdownVisible=!0:this.dropdownVisible=!1,arangoHelper.setCheckboxStatus("#viewsDropdown")},sorting:function(){$("#viewsSortDesc").is(":checked")?this.setSortingDesc(!0):this.setSortingDesc(!1),this.checkVisibility(),this.render()},setSortingDesc:function(e){this.sortOptions.desc=e},search:function(){this.setSearchString($("#viewsSearchInput").val()),this.render()},toggleSettingsDropdown:function(){var e=this;$("#viewsSortDesc").attr("checked",this.sortOptions.desc),$("#viewsToggle").toggleClass("activated"),$("#viewsDropdown2").slideToggle(200,function(){e.checkVisibility()})},render:function(e){e?this.$el.html(this.template.render({views:this.applySorting(e.result),searchString:this.getSearchString()})):(this.getViews(),this.$el.html(this.template.render({views:[],searchString:this.getSearchString()}))),!0===this.dropdownVisible&&($("#viewsSortDesc").attr("checked",this.sortOptions.desc),$("#viewsToggle").addClass("activated"),$("#viewsDropdown2").show()),$("#viewsSortDesc").attr("checked",this.sortOptions.desc),arangoHelper.setCheckboxStatus("#viewsDropdown");var t=$("#viewsSearchInput"),i=t.val().length;t.focus(),t[0].setSelectionRange(i,i),arangoHelper.checkDatabasePermissions(this.setReadOnly.bind(this))},setReadOnly:function(){this.readOnly=!0,$("#createView").parent().parent().addClass("disabled")},setSearchString:function(e){this.searchString=e},getSearchString:function(){return this.searchString.toLowerCase()},applySorting:function(e){var i=this;e=_.sortBy(e,"name"),this.sortOptions.desc&&(e=e.reverse());var n=[];return""===this.getSearchString()?e:(_.each(e,function(e,t){e&&e.name&&-1!==e.name.toLowerCase().indexOf(i.getSearchString())&&n.push(e)}),n)},gotoView:function(e){var t=$(e.currentTarget).attr("id");t&&(window.location.hash=window.location.hash.substr(0,window.location.hash.length-1)+"/"+encodeURIComponent(t))},getViews:function(){var t=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/view"),contentType:"application/json",processData:!1,success:function(e){t.render(e)},error:function(e){console.log(e)}})},createView:function(e){this.readOnly||(e.preventDefault(),this.createViewModal())},createViewModal:function(){var e=[],t=[];t.push(window.modalView.createTextEntry("newName","Name","",!1,"Name",!0,[{rule:Joi.string().regex(/^[a-zA-Z0-9\-_]*$/),msg:'Only symbols, "_" and "-" are allowed.'},{rule:Joi.string().required(),msg:"No view name given."}])),t.push(window.modalView.createReadOnlyEntry(void 0,"Type","arangosearch",void 0,void 0,!1,void 0)),e.push(window.modalView.createSuccessButton("Create",this.submitCreateView.bind(this))),window.modalView.show("modalTable.ejs","Create New View",e,t)},submitCreateView:function(){var t=this,e=$("#newName").val(),i=JSON.stringify({name:e,type:"arangosearch",properties:{}});$.ajax({type:"POST",cache:!1,url:arangoHelper.databaseUrl("/_api/view"),contentType:"application/json",processData:!1,data:i,success:function(e){window.modalView.hide(),t.getViews()},error:function(e){e.responseJSON&&e.responseJSON.errorMessage&&arangoHelper.arangoError("Views",e.responseJSON.errorMessage)}})}})}(),function(){"use strict";window.ViewView=Backbone.View.extend({el:"#content",template:templateEngine.createTemplate("viewView.ejs"),initialize:function(e){this.name=e.name},remove:function(){return this.$el.empty().off(),this.stopListening(),this.unbind(),delete this.el,this},events:{"click #savePropertiesButton":"patchView","click #renameViewButton":"renameView","click #deleteViewButton":"deleteView"},render:function(){this.breadcrumb(),this.$el.html(this.template.render({})),$("#propertiesEditor").height($(".centralRow").height()-300+70),this.initAce(),this.getView()},jsonContentChanged:function(){this.enableSaveButton()},enableSaveButton:function(){$("#savePropertiesButton").prop("disabled",!1),$("#savePropertiesButton").addClass("button-success"),$("#savePropertiesButton").removeClass("button-close")},disableSaveButton:function(){$("#savePropertiesButton").prop("disabled",!0),$("#savePropertiesButton").addClass("button-close"),$("#savePropertiesButton").removeClass("button-success")},initAce:function(e){var t=this,i=document.getElementById("propertiesEditor"),n={onChange:function(){t.jsonContentChanged()},search:!0,mode:"code",modes:["tree","code"],ace:window.ace};this.editor=new JSONEditor(i,n),this.defaultMode&&this.editor.setMode(this.defaultMode)},getView:function(){var t=this;$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/view/"+encodeURIComponent(t.name)+"/properties"),contentType:"application/json",processData:!1,success:function(e){delete e.name,delete e.code,delete e.error,t.editor.set(e)},error:function(e){arangoHelper.arangoError("View",e.errorMessage)}})},patchView:function(){var e,t=this;try{e=t.editor.get()}catch(e){arangoHelper.arangoError("View",e)}e&&$.ajax({type:"PUT",cache:!1,url:arangoHelper.databaseUrl("/_api/view/"+encodeURIComponent(t.name)+"/properties"),contentType:"application/json",processData:!1,data:JSON.stringify(t.editor.get()),success:function(e){t.disableSaveButton(),t.editor.set(e),arangoHelper.arangoNotification("View","Saved properties.")},error:function(e){arangoHelper.arangoError("View",e.responseJSON.errorMessage)}})},deleteView:function(){var e=[],t=[];t.push(window.modalView.createReadOnlyEntry("view-delete-button","Delete","Really delete View?",void 0,void 0,!1,/[<>&'"]/)),e.push(window.modalView.createDeleteButton("Delete",this.deleteViewTrue.bind(this))),window.modalView.show("modalTable.ejs","Delete View",e,t)},deleteViewTrue:function(){$.ajax({type:"DELETE",cache:!1,url:arangoHelper.databaseUrl("/_api/view/"+encodeURIComponent(this.name)),contentType:"application/json",processData:!1,success:function(){window.modalView.hide(),window.App.navigate("#views",{trigger:!0})},error:function(e){window.modalView.hide(),arangoHelper.arangoError("View",e.responseJSON.errorMessage)}})},renameView:function(){var e=[],t=[];t.push(window.modalView.createTextEntry("editCurrentName","Name",this.name,!1,"Name",!1)),e.push(window.modalView.createSuccessButton("Rename",this.renameViewTrue.bind(this))),window.modalView.show("modalTable.ejs","Rename View",e,t)},renameViewTrue:function(){var t=this;$("#editCurrentName").val()?$.ajax({type:"PUT",cache:!1,url:arangoHelper.databaseUrl("/_api/view/"+encodeURIComponent(t.name)+"/rename"),contentType:"application/json",processData:!1,data:JSON.stringify({name:$("#editCurrentName").val()}),success:function(e){t.name=e.name,t.breadcrumb(),window.modalView.hide()},error:function(e){window.modalView.hide(),arangoHelper.arangoError("View",e.responseJSON.errorMessage)}}):arangoHelper.arangoError("View","Please fill in a view name.")},breadcrumb:function(){var e=this;window.App.naviView?$("#subNavigationBar .breadcrumb").html("View: "+this.name):window.setTimeout(function(){e.breadcrumb()},100)}})}(),function(){"use strict";window.Router=Backbone.Router.extend({toUpdate:[],dbServers:[],isCluster:void 0,lastRoute:void 0,routes:{"":"cluster",dashboard:"dashboard",replication:"replication","replication/applier/:endpoint/:database":"applier",collections:"collections",new:"newCollection",login:"login","collection/:colid/documents/:pageid":"documents","cIndices/:colname":"cIndices","cSettings/:colname":"cSettings","cInfo/:colname":"cInfo","collection/:colid/:docid":"document",shell:"shell",queries:"query",databases:"databases",settings:"databases",services:"applications","services/install":"installService","services/install/new":"installNewService","services/install/github":"installGitHubService","services/install/upload":"installUploadService","services/install/remote":"installUrlService","service/:mount":"applicationDetail","store/:name":"storeDetail",graphs:"graphManagement","graphs/:name":"showGraph",users:"userManagement","user/:name":"userView","user/:name/permission":"userPermission",userProfile:"userProfile",cluster:"cluster",nodes:"nodes",shards:"shards","node/:name":"node","nodeInfo/:id":"nodeInfo",logs:"logger",helpus:"helpUs",views:"views","view/:name":"view","graph/:name":"graph","graph/:name/settings":"graphSettings",support:"support"},execute:function(e,t){if("#queries"===this.lastRoute&&(this.queryView.removeInputEditors(),this.queryView.cleanupGraphs(),this.queryView.removeResults()),this.lastRoute){var i=this.lastRoute.split("/")[0],n=this.lastRoute.split("/")[1],o=this.lastRoute.split("/")[2];"#service"!==i&&(window.App.replaceApp?"install"!==n&&o&&(window.App.replaceApp=!1):window.App.replaceApp=!1),"#collection"===this.lastRoute.substr(0,11)&&3===this.lastRoute.split("/").length&&this.documentView.cleanupEditor(),"#dasboard"!==this.lastRoute&&"#node"!==window.location.hash.substr(0,5)||d3.selectAll("svg > *").remove(),"#logger"===this.lastRoute&&(this.loggerView.logLevelView&&this.loggerView.logLevelView.remove(),this.loggerView.logTopicView&&this.loggerView.logTopicView.remove())}this.lastRoute=window.location.hash,$("#subNavigationBar .breadcrumb").html(""),$("#subNavigationBar .bottom").html(""),$("#loadingScreen").hide(),$("#content").show(),e&&e.apply(this,t),"#services"===this.lastRoute&&(window.App.replaceApp=!1),this.graphViewer&&this.graphViewer.graphSettingsView&&this.graphViewer.graphSettingsView.hide(),this.queryView&&this.queryView.graphViewer&&this.queryView.graphViewer.graphSettingsView&&this.queryView.graphViewer.graphSettingsView.hide()},listenerFunctions:{},listener:function(i){_.each(window.App.listenerFunctions,function(e,t){e(i)})},checkUser:function(){var i=this;if("#login"!==window.location.hash){var n=function(){this.initOnce(),$(".bodyWrapper").show(),$(".navbar").show()}.bind(this),e=function(e,t){frontendConfig.authenticationEnabled?(i.currentUser=t,e||null===t?"#login"!==window.location.hash&&this.navigate("login",{trigger:!0}):n()):n()}.bind(this);frontendConfig.authenticationEnabled?this.userCollection.whoAmI(e):(this.initOnce(),$(".bodyWrapper").show(),$(".navbar").show())}},waitForInit:function(e,t,i){this.initFinished?(t||e(!0),t&&!i&&e(t,!0),t&&i&&e(t,i,!0)):setTimeout(function(){t||e(!1),t&&!i&&e(t,!1),t&&i&&e(t,i,!1)},350)},initFinished:!1,initialize:function(){!0===frontendConfig.isCluster&&(this.isCluster=!0),document.addEventListener("keyup",this.listener,!1),window.modalView=new window.ModalView,this.foxxList=new window.FoxxCollection,window.foxxInstallView=new window.FoxxInstallView({collection:this.foxxList}),this.foxxRepo=new window.FoxxRepository,this.foxxRepo.fetch({success:function(){i.serviceInstallView&&(i.serviceInstallView.collection=i.foxxRepo)}}),window.progressView=new window.ProgressView;var i=this;this.userCollection=new window.ArangoUsers,this.initOnce=function(){this.initOnce=function(){};var e=function(e,t){i=this,!0===t&&i.coordinatorCollection.fetch({success:function(){i.fetchDBS()}}),e&&console.log(e)}.bind(this);window.isCoordinator(e),!1===frontendConfig.isCluster&&(this.initFinished=!0),this.arangoDatabase=new window.ArangoDatabase,this.currentDB=new window.CurrentDatabase,this.arangoCollectionsStore=new window.ArangoCollections,this.arangoDocumentStore=new window.ArangoDocument,this.coordinatorCollection=new window.ClusterCoordinators,arangoHelper.setDocumentStore(this.arangoDocumentStore),this.arangoCollectionsStore.fetch({cache:!1}),window.spotlightView=new window.SpotlightView({collection:this.arangoCollectionsStore}),this.footerView=new window.FooterView({collection:i.coordinatorCollection}),this.notificationList=new window.NotificationCollection,this.currentDB.fetch({cache:!1,success:function(){i.naviView=new window.NavigationView({database:i.arangoDatabase,currentDB:i.currentDB,notificationCollection:i.notificationList,userCollection:i.userCollection,isCluster:i.isCluster}),i.naviView.render()}}),this.queryCollection=new window.ArangoQueries,this.footerView.render(),window.checkVersion(),this.userConfig=new window.UserConfig({ldapEnabled:frontendConfig.ldapEnabled}),this.userConfig.fetch(),this.documentsView=new window.DocumentsView({collection:new window.ArangoDocuments,documentStore:this.arangoDocumentStore,collectionsStore:this.arangoCollectionsStore}),arangoHelper.initSigma()}.bind(this),$(window).resize(function(){i.handleResize()}),$(window).scroll(function(){})},handleScroll:function(){50<$(window).scrollTop()?($(".navbar > .secondary").css("top",$(window).scrollTop()),$(".navbar > .secondary").css("position","absolute"),$(".navbar > .secondary").css("z-index","10"),$(".navbar > .secondary").css("width",$(window).width())):($(".navbar > .secondary").css("top","0"),$(".navbar > .secondary").css("position","relative"),$(".navbar > .secondary").css("width",""))},cluster:function(e){this.checkUser(),e?!1!==this.isCluster&&void 0!==this.isCluster?(this.clusterView||(this.clusterView=new window.ClusterView({coordinators:this.coordinatorCollection,dbServers:this.dbServers})),this.clusterView.render()):"_system"===this.currentDB.get("name")?(this.routes[""]="dashboard",this.navigate("#dashboard",{trigger:!0})):(this.routes[""]="collections",this.navigate("#collections",{trigger:!0})):this.waitForInit(this.cluster.bind(this))},node:function(e,t){if(this.checkUser(),t&&void 0!==this.isCluster){if(!1===this.isCluster)return this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0});this.nodeView&&this.nodeView.remove(),this.nodeView=new window.NodeView({coordid:e,coordinators:this.coordinatorCollection,dbServers:this.dbServers}),this.nodeView.render()}else this.waitForInit(this.node.bind(this),e)},nodeInfo:function(e,t){if(this.checkUser(),t&&void 0!==this.isCluster){if(!1===this.isCluster)return this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0});this.nodeInfoView&&this.nodeInfoView.remove(),this.nodeInfoView=new window.NodeInfoView({nodeId:e,coordinators:this.coordinatorCollection,dbServers:this.dbServers[0]}),this.nodeInfoView.render()}else this.waitForInit(this.nodeInfo.bind(this),e)},shards:function(e){if(this.checkUser(),e&&void 0!==this.isCluster){if(!1===this.isCluster)return this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0});this.shardsView&&this.shardsView.remove(),this.shardsView=new window.ShardsView({dbServers:this.dbServers}),this.shardsView.render()}else this.waitForInit(this.shards.bind(this))},nodes:function(e){if(this.checkUser(),e&&void 0!==this.isCluster){if(!1===this.isCluster)return this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0});this.nodesView&&this.nodesView.remove(),this.nodesView=new window.NodesView({}),this.nodesView.render()}else this.waitForInit(this.nodes.bind(this))},cNodes:function(e){if(this.checkUser(),e&&void 0!==this.isCluster){if(!1===this.isCluster)return this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0});this.nodesView=new window.NodesView({coordinators:this.coordinatorCollection,dbServers:this.dbServers[0],toRender:"coordinator"}),this.nodesView.render()}else this.waitForInit(this.cNodes.bind(this))},dNodes:function(e){if(this.checkUser(),e&&void 0!==this.isCluster)return!1===this.isCluster?(this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0})):void(0!==this.dbServers.length?(this.nodesView=new window.NodesView({coordinators:this.coordinatorCollection,dbServers:this.dbServers[0],toRender:"dbserver"}),this.nodesView.render()):this.navigate("#cNodes",{trigger:!0}));this.waitForInit(this.dNodes.bind(this))},sNodes:function(e){if(this.checkUser(),e&&void 0!==this.isCluster){if(!1===this.isCluster)return this.routes[""]="dashboard",void this.navigate("#dashboard",{trigger:!0});this.scaleView=new window.ScaleView({coordinators:this.coordinatorCollection,dbServers:this.dbServers[0]}),this.scaleView.render()}else this.waitForInit(this.sNodes.bind(this))},addAuth:function(e){var t=this.clusterPlan.get("user");if(!t)return e.abort(),void(this.isCheckingUser||this.requestAuth());var i=t.name,n=t.passwd,o=i.concat(":",n);e.setRequestHeader("Authorization","Basic "+btoa(o))},logger:function(e,t){if(this.checkUser(),t){if(!this.loggerView){var i=new window.ArangoLogs({upto:!0,loglevel:4});this.loggerView=new window.LoggerView({collection:i})}this.loggerView.render()}else this.waitForInit(this.logger.bind(this),e)},applicationDetail:function(e,t){if(this.checkUser(),t){var i=function(){this.hasOwnProperty("applicationDetailView")&&this.applicationDetailView.remove(),this.applicationDetailView=new window.ApplicationDetailView({model:this.foxxList.get(decodeURIComponent(e))}),this.applicationDetailView.model=this.foxxList.get(decodeURIComponent(e)),this.applicationDetailView.render("swagger")}.bind(this);0===this.foxxList.length?this.foxxList.fetch({cache:!1,success:function(){i()}}):i()}else this.waitForInit(this.applicationDetail.bind(this),e)},storeDetail:function(e,t){if(this.checkUser(),t){var i=function(){this.hasOwnProperty("storeDetailView")&&this.storeDetailView.remove(),this.storeDetailView=new window.StoreDetailView({model:this.foxxRepo.get(decodeURIComponent(e)),collection:this.foxxList}),this.storeDetailView.model=this.foxxRepo.get(decodeURIComponent(e)),this.storeDetailView.render()}.bind(this);0===this.foxxRepo.length?this.foxxRepo.fetch({cache:!1,success:function(){i()}}):i()}else this.waitForInit(this.storeDetail.bind(this),e)},login:function(){var e=function(e,t){this.loginView||(this.loginView=new window.LoginView({collection:this.userCollection})),e||null===t?this.loginView.render():this.loginView.render(!0)}.bind(this);this.userCollection.whoAmI(e)},collections:function(e){if(this.checkUser(),e){var t=this;this.collectionsView&&this.collectionsView.remove(),this.collectionsView=new window.CollectionsView({collection:this.arangoCollectionsStore}),this.arangoCollectionsStore.fetch({cache:!1,success:function(){t.collectionsView.render()}})}else this.waitForInit(this.collections.bind(this))},cIndices:function(e,t){var i=this;this.checkUser(),t?this.arangoCollectionsStore.fetch({cache:!1,success:function(){i.indicesView&&i.indicesView.remove(),i.indicesView=new window.IndicesView({collectionName:e,collection:i.arangoCollectionsStore.findWhere({name:e})}),i.indicesView.render()}}):this.waitForInit(this.cIndices.bind(this),e)},cSettings:function(e,t){var i=this;this.checkUser(),t?this.arangoCollectionsStore.fetch({cache:!1,success:function(){i.settingsView=new window.SettingsView({collectionName:e,collection:i.arangoCollectionsStore.findWhere({name:e})}),i.settingsView.render()}}):this.waitForInit(this.cSettings.bind(this),e)},cInfo:function(e,t){var i=this;this.checkUser(),t?this.arangoCollectionsStore.fetch({cache:!1,success:function(){i.infoView=new window.InfoView({collectionName:e,collection:i.arangoCollectionsStore.findWhere({name:e})}),i.infoView.render()}}):this.waitForInit(this.cInfo.bind(this),e)},documents:function(e,t,i){this.checkUser(),i?(this.documentsView&&this.documentsView.unbindEvents(),this.documentsView||(this.documentsView=new window.DocumentsView({collection:new window.ArangoDocuments,documentStore:this.arangoDocumentStore,collectionsStore:this.arangoCollectionsStore})),this.documentsView.setCollectionId(e,t),this.documentsView.render(),this.documentsView.delegateEvents()):this.waitForInit(this.documents.bind(this),e,t)},document:function(e,t,i){if(this.checkUser(),i){var n;this.documentView&&(this.documentView.defaultMode&&(n=this.documentView.defaultMode),this.documentView.remove()),this.documentView=new window.DocumentView({collection:this.arangoDocumentStore}),this.documentView.colid=e,this.documentView.defaultMode=n;var o=window.location.hash.split("/")[2],a=(o.split("%").length-1)%3;decodeURI(o)!==o&&0!==a&&(o=decodeURIComponent(o)),this.documentView.docid=o,this.documentView.render();var r=function(e,t){e?console.log("Error","Could not fetch collection type"):this.documentView.setType()}.bind(this);arangoHelper.collectionApiType(e,null,r)}else this.waitForInit(this.document.bind(this),e,t)},query:function(e){this.checkUser(),e?(this.queryView||(this.queryView=new window.QueryView({collection:this.queryCollection})),this.queryView.render()):this.waitForInit(this.query.bind(this))},graph:function(e,t){this.checkUser(),t?(this.graphViewer&&(this.graphViewer.graphSettingsView&&this.graphViewer.graphSettingsView.remove(),this.graphViewer.killCurrentGraph(),this.graphViewer.unbind(),this.graphViewer.remove()),this.graphViewer=new window.GraphViewer({name:e,documentStore:this.arangoDocumentStore,collection:new window.GraphCollection,userConfig:this.userConfig}),this.graphViewer.render()):this.waitForInit(this.graph.bind(this),e)},graphSettings:function(e,t){this.checkUser(),t?(this.graphSettingsView&&this.graphSettingsView.remove(),this.graphSettingsView=new window.GraphSettingsView({name:e,userConfig:this.userConfig}),this.graphSettingsView.render()):this.waitForInit(this.graphSettings.bind(this),e)},helpUs:function(e){this.checkUser(),e?(this.testView||(this.helpUsView=new window.HelpUsView({})),this.helpUsView.render()):this.waitForInit(this.helpUs.bind(this))},support:function(e){this.checkUser(),e?(this.testView||(this.supportView=new window.SupportView({})),this.supportView.render()):this.waitForInit(this.support.bind(this))},queryManagement:function(e){this.checkUser(),e?(this.queryManagementView&&this.queryManagementView.remove(),this.queryManagementView=new window.QueryManagementView({collection:void 0}),this.queryManagementView.render()):this.waitForInit(this.queryManagement.bind(this))},databases:function(e){if(this.checkUser(),e){var t=function(e){e?(arangoHelper.arangoError("DB","Could not get list of allowed databases"),this.navigate("#",{trigger:!0}),$("#databaseNavi").css("display","none"),$("#databaseNaviSelect").css("display","none")):(this.databaseView&&this.databaseView.remove(),this.databaseView=new window.DatabaseView({users:this.userCollection,collection:this.arangoDatabase}),this.databaseView.render())}.bind(this);arangoHelper.databaseAllowed(t)}else this.waitForInit(this.databases.bind(this))},dashboard:function(e){this.checkUser(),e?(void 0===this.dashboardView&&(this.dashboardView=new window.DashboardView({dygraphConfig:window.dygraphConfig,database:this.arangoDatabase})),this.dashboardView.render()):this.waitForInit(this.dashboard.bind(this))},replication:function(e){this.checkUser(),e?(this.replicationView||(this.replicationView=new window.ReplicationView({})),this.replicationView.render()):this.waitForInit(this.replication.bind(this))},applier:function(e,t,i){this.checkUser(),i?(void 0===this.applierView&&(this.applierView=new window.ApplierView({})),this.applierView.endpoint=atob(e),this.applierView.database=atob(t),this.applierView.render()):this.waitForInit(this.applier.bind(this),e,t)},graphManagement:function(e){this.checkUser(),e?(this.graphManagementView&&this.graphManagementView.undelegateEvents(),this.graphManagementView=new window.GraphManagementView({collection:new window.GraphCollection,collectionCollection:this.arangoCollectionsStore}),this.graphManagementView.render()):this.waitForInit(this.graphManagement.bind(this))},showGraph:function(e,t){this.checkUser(),t?this.graphManagementView?this.graphManagementView.loadGraphViewer(e):(this.graphManagementView=new window.GraphManagementView({collection:new window.GraphCollection,collectionCollection:this.arangoCollectionsStore}),this.graphManagementView.render(e,!0)):this.waitForInit(this.showGraph.bind(this),e)},applications:function(e){this.checkUser(),e?(void 0===this.applicationsView&&(this.applicationsView=new window.ApplicationsView({collection:this.foxxList})),this.applicationsView.reload()):this.waitForInit(this.applications.bind(this))},installService:function(e){this.checkUser(),e?(window.modalView.clearValidators(),this.serviceInstallView&&this.serviceInstallView.remove(),this.serviceInstallView=new window.ServiceInstallView({collection:this.foxxRepo,functionsCollection:this.foxxList}),this.serviceInstallView.render()):this.waitForInit(this.installService.bind(this))},installNewService:function(e){this.checkUser(),e?(window.modalView.clearValidators(),this.serviceNewView&&this.serviceNewView.remove(),this.serviceNewView=new window.ServiceInstallNewView({collection:this.foxxList}),this.serviceNewView.render()):this.waitForInit(this.installNewService.bind(this))},installGitHubService:function(e){this.checkUser(),e?(window.modalView.clearValidators(),this.serviceGitHubView&&this.serviceGitHubView.remove(),this.serviceGitHubView=new window.ServiceInstallGitHubView({collection:this.foxxList}),this.serviceGitHubView.render()):this.waitForInit(this.installGitHubService.bind(this))},installUrlService:function(e){this.checkUser(),e?(window.modalView.clearValidators(),this.serviceUrlView&&this.serviceUrlView.remove(),this.serviceUrlView=new window.ServiceInstallUrlView({collection:this.foxxList}),this.serviceUrlView.render()):this.waitForInit(this.installUrlService.bind(this))},installUploadService:function(e){this.checkUser(),e?(window.modalView.clearValidators(),this.serviceUploadView&&this.serviceUploadView.remove(),this.serviceUploadView=new window.ServiceInstallUploadView({collection:this.foxxList}),this.serviceUploadView.render()):this.waitForInit(this.installUploadService.bind(this))},handleSelectDatabase:function(e){this.checkUser(),e?this.naviView.handleSelectDatabase():this.waitForInit(this.handleSelectDatabase.bind(this))},handleResize:function(){this.dashboardView&&this.dashboardView.resize(),this.graphManagementView&&"graphs"===Backbone.history.getFragment()&&this.graphManagementView.handleResize($("#content").width()),this.queryView&&"queries"===Backbone.history.getFragment()&&this.queryView.resize(),this.naviView&&this.naviView.resize(),this.graphViewer&&-1<Backbone.history.getFragment().indexOf("graph")&&this.graphViewer.resize(),this.documentsView&&-1<Backbone.history.getFragment().indexOf("documents")&&this.documentsView.resize(),this.documentView&&-1<Backbone.history.getFragment().indexOf("collection")&&this.documentView.resize()},userPermission:function(e,t){this.checkUser(),t||null===t?(this.userPermissionView&&this.userPermissionView.remove(),this.userPermissionView=new window.UserPermissionView({collection:this.userCollection,databases:this.arangoDatabase,username:e}),this.userPermissionView.render()):!1===t&&this.waitForInit(this.userPermissionView.bind(this),e)},userView:function(e,t){this.checkUser(),t||null===t?(this.userView=new window.UserView({collection:this.userCollection,username:e}),this.userView.render()):!1===t&&this.waitForInit(this.userView.bind(this),e)},userManagement:function(e){this.checkUser(),e?(this.userManagementView&&this.userManagementView.remove(),this.userManagementView=new window.UserManagementView({collection:this.userCollection}),this.userManagementView.render()):this.waitForInit(this.userManagement.bind(this))},userProfile:function(e){this.checkUser(),e?(this.userManagementView||(this.userManagementView=new window.UserManagementView({collection:this.userCollection})),this.userManagementView.render(!0)):this.waitForInit(this.userProfile.bind(this))},view:function(e,t){this.checkUser(),t?(this.viewView&&this.viewView.remove(),this.viewView=new window.ViewView({name:e}),this.viewView.render()):this.waitForInit(this.view.bind(this),e)},views:function(e){this.checkUser(),e?(this.viewsView&&this.viewsView.remove(),this.viewsView=new window.ViewsView({}),this.viewsView.render()):this.waitForInit(this.views.bind(this))},fetchDBS:function(t){var i=this,n=!1;this.coordinatorCollection.each(function(e){i.dbServers.push(new window.ClusterServers([],{host:e.get("address")}))}),this.initFinished=!0,_.each(this.dbServers,function(e){e.fetch({success:function(){!1===n&&t&&(t(),n=!0)}})})},getNewRoute:function(e){return"http://"+e},registerForUpdate:function(e){this.toUpdate.push(e),e.updateUrl()}})}(),function(){"use strict";window.checkVersion=function(){$.ajax({type:"GET",cache:!1,url:arangoHelper.databaseUrl("/_api/version"),contentType:"application/json",processData:!1,async:!0,success:function(e){var t=window.versionHelper.fromString(e.version);$(".navbar #currentVersion").html(e.version+'<i class="fa fa-check-circle"></i>'),window.parseVersions=function(e){_.isEmpty(e)?$("#currentVersion").addClass("up-to-date"):($("#currentVersion").addClass("out-of-date"),$("#currentVersion .fa").removeClass("fa-check-circle").addClass("fa-exclamation-circle"),$("#currentVersion").click(function(){!function(e,t){var i=[];i.push(window.modalView.createSuccessButton("Download Page",function(){window.open("https://www.arangodb.com/download","_blank"),window.modalView.hide()}));var n=[],o=window.modalView.createReadOnlyEntry.bind(window.modalView);n.push(o("current","Current",e.toString())),t.major&&n.push(o("major","Major",t.major.version)),t.minor&&n.push(o("minor","Minor",t.minor.version)),t.bugfix&&n.push(o("bugfix","Bugfix",t.bugfix.version)),window.modalView.show("modalTable.ejs","New Version Available",i,n)}(t,e)}))},$.ajax({type:"GET",async:!0,crossDomain:!0,timeout:3e3,dataType:"jsonp",url:"https://www.arangodb.com/repositories/versions.php?jsonp=parseVersions&version="+encodeURIComponent(t.toString()),error:function(e){200===e.status?window.activeInternetConnection=!0:window.activeInternetConnection=!1},success:function(e){window.activeInternetConnection=!0}})}})}}(),function(){"use strict";window.hasOwnProperty("TEST_BUILD")||($(document).ajaxSend(function(e,t,i){var n=window.arangoHelper.getCurrentJwt();n&&t.setRequestHeader("Authorization","bearer "+n)}),$.ajaxSetup({error:function(e,t,i){401===e.status&&arangoHelper.checkJwt()}}),$(document).ready(function(){window.App=new window.Router,Backbone.history.start(),window.App.handleResize()}),$(document).click(function(e){e.stopPropagation(),$(e.target).hasClass("subBarDropdown")||$(e.target).hasClass("dropdown-header")||$(e.target).hasClass("dropdown-footer")||$(e.target).hasClass("toggle")||$("#userInfo").is(":visible")&&$(".subBarDropdown").hide()}),$("body").on("keyup",function(e){27===e.keyCode&&window.modalView&&window.modalView.hide()}))}();
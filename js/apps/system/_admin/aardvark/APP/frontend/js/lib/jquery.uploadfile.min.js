!function(e){var r={};r.fileapi=void 0!==e("<input type='file'/>").get(0).files,r.formdata=void 0!==window.FormData,e.fn.uploadFile=function(t){function o(){f.afterUploadAll&&!v&&(v=!0,function e(){0!=h.sCounter&&h.sCounter+h.fCounter==h.tCounter?(f.afterUploadAll(h),v=!1):window.setTimeout(e,100)}())}function a(r,t,o){o.on("dragenter",function(r){r.stopPropagation(),r.preventDefault(),e(this).css("border","2px solid #A5A5C7")}),o.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),o.on("drop",function(o){e(this).css("border","2px dotted #A5A5C7"),o.preventDefault(),r.errorLog.html("");var a=o.originalEvent.dataTransfer.files;return!t.multiple&&a.length>1?void(t.showError&&e("<div style='color:red;'>"+t.multiDragErrorStr+"</div>").appendTo(r.errorLog)):void(0!=t.onSelect(a)&&n(t,r,a))}),e(document).on("dragenter",function(e){e.stopPropagation(),e.preventDefault()}),e(document).on("dragover",function(e){e.stopPropagation(),e.preventDefault(),o.css("border","2px dotted #A5A5C7")}),e(document).on("drop",function(e){e.stopPropagation(),e.preventDefault(),o.css("border","2px dotted #A5A5C7")})}function i(e){var r="",t=e/1024;if(parseInt(t)>1024){var o=t/1024;r=o.toFixed(2)+" MB"}else r=t.toFixed(2)+" KB";return r}function s(r){var t=[];t="string"==jQuery.type(r)?r.split("&"):e.param(r).split("&");var o,a,i=t.length,s=[];for(o=0;i>o;o++)t[o]=t[o].replace(/\+/g," "),a=t[o].split("="),s.push([decodeURIComponent(a[0]),decodeURIComponent(a[1])]);return s}function n(r,t,o){for(var a=0;a<o.length;a++)if(l(t,r,o[a].name))if(-1!=r.maxFileSize&&o[a].size>r.maxFileSize)r.showError&&e("<div style='color:red;'><b>"+o[a].name+"</b> "+r.sizeErrorStr+i(r.maxFileSize)+"</div>").appendTo(t.errorLog);else{var n=r,d=new FormData,f=r.fileName.replace("[]","");d.append(f,o[a]);var c=r.formData;if(c)for(var h=s(c),m=0;m<h.length;m++)h[m]&&d.append(h[m][0],h[m][1]);n.fileData=d;var v=new p(t,r),b="";b=r.showFileCounter?t.fileCounter+r.fileCounterStyle+o[a].name:o[a].name,v.filename.html(b);var g=e("<form style='display:block; position:absolute;left: 150px;' class='"+t.formGroup+"' method='"+r.method+"' action='"+r.url+"' enctype='"+r.enctype+"'></form>");g.appendTo("body");var w=[];w.push(o[a].name),u(g,n,v,w,t),t.fileCounter++}else r.showError&&e("<div style='color:red;'><b>"+o[a].name+"</b> "+r.extErrorStr+r.allowedTypes+"</div>").appendTo(t.errorLog)}function l(e,r,t){var o=r.allowedTypes.toLowerCase().split(","),a=t.split(".").pop().toLowerCase();return"*"!=r.allowedTypes&&jQuery.inArray(a,o)<0?!1:!0}function d(t,o,a,i){var s="ajax-upload-id-"+(new Date).getTime(),f=e("<form method='"+a.method+"' action='"+a.url+"' enctype='"+a.enctype+"'></form>"),c="<input type='file' id='"+s+"' name='"+a.fileName+"'/>";a.multiple&&(a.fileName.indexOf("[]")!=a.fileName.length-2&&(a.fileName+="[]"),c="<input type='file' id='"+s+"' name='"+a.fileName+"' multiple/>");var h=e(c).appendTo(f);h.change(function(){t.errorLog.html("");var s=(a.allowedTypes.toLowerCase().split(","),[]);if(this.files){for(b=0;b<this.files.length;b++)s.push(this.files[b].name);if(0==a.onSelect(this.files))return}else{var c=e(this).val(),h=[];if(s.push(c),!l(t,a,c))return void(a.showError&&e("<div style='color:red;'><b>"+c+"</b> "+a.extErrorStr+a.allowedTypes+"</div>").appendTo(t.errorLog));if(h.push({name:c,size:"NA"}),0==a.onSelect(h))return}if(i.unbind("click"),f.hide(),d(t,o,a,i),f.addClass(o),r.fileapi&&r.formdata){f.removeClass(o);var m=this.files;n(a,t,m)}else{for(var v="",b=0;b<s.length;b++)v+=a.showFileCounter?t.fileCounter+a.fileCounterStyle+s[b]+"<br>":s[b]+"<br>",t.fileCounter++;var g=new p(t,a);g.filename.html(v),u(f,a,g,s,t)}}),f.css({margin:0,padding:0});var m=e(i).width()+10;10==m&&(m=120);var v=i.height()+10;10==v&&(v=35),i.css({position:"relative",overflow:"hidden",cursor:"default"}),h.css({position:"absolute",cursor:"pointer",top:"0px",width:m,height:v,left:"0px","z-index":"100",opacity:"0.0",filter:"alpha(opacity=0)","-ms-filter":"alpha(opacity=0)","-khtml-opacity":"0.0","-moz-opacity":"0.0"}),f.appendTo(i)}function p(r,t){return this.statusbar=e("<div class='ajax-file-upload-statusbar'></div>"),this.filename=e("<div class='ajax-file-upload-filename'></div>").appendTo(this.statusbar),this.progressDiv=e("<div class='ajax-file-upload-progress'>").appendTo(this.statusbar).hide(),this.progressbar=e("<div class='ajax-file-upload-bar "+r.formGroup+"'></div>").appendTo(this.progressDiv),this.abort=e("<div class='ajax-file-upload-red "+r.formGroup+"'>"+t.abortStr+"</div>").appendTo(this.statusbar).hide(),this.cancel=e("<div class='ajax-file-upload-red'>"+t.cancelStr+"</div>").appendTo(this.statusbar).hide(),this.done=e("<div class='ajax-file-upload-green'>"+t.doneStr+"</div>").appendTo(this.statusbar).hide(),this.del=e("<div class='ajax-file-upload-red'>"+t.deletelStr+"</div>").appendTo(this.statusbar).hide(),r.errorLog.after(this.statusbar),this}function u(e,t,a,i,n){var l={cache:!1,contentType:!1,processData:!1,forceSync:!1,data:t.formData,formData:t.fileData,dataType:t.returnType,beforeSubmit:function(r,l,d){if(0!=t.onSubmit.call(this,i)){var p=t.dynamicFormData();if(p){var u=s(p);if(u)for(var f=0;f<u.length;f++)u[f]&&(void 0!=t.fileData?d.formData.append(u[f][0],u[f][1]):d.data[u[f][0]]=u[f][1])}return n.tCounter+=i.length,o(),!0}return a.statusbar.append("<div style='color:red;'>"+t.uploadErrorStr+"</div>"),a.cancel.show(),e.remove(),a.cancel.click(function(){a.statusbar.remove()}),!1},beforeSend:function(e,o){a.progressDiv.show(),a.cancel.hide(),a.done.hide(),t.showAbort&&(a.abort.show(),a.abort.click(function(){e.abort()})),r.formdata?a.progressbar.width("1%"):a.progressbar.width("5%")},uploadProgress:function(e,r,o,i){i>98&&(i=98);var s=i+"%";i>1&&a.progressbar.width(s),t.showProgress&&(a.progressbar.html(s),a.progressbar.css("text-align","center"))},success:function(r,o,s){n.responses.push(r),a.progressbar.width("100%"),t.showProgress&&(a.progressbar.html("100%"),a.progressbar.css("text-align","center")),a.abort.hide(),t.onSuccess.call(this,i,r,s),t.showStatusAfterSuccess?(t.showDone?(a.done.show(),a.done.click(function(){a.statusbar.hide("slow"),a.statusbar.remove()})):a.done.hide(),t.showDelete?(a.del.show(),a.del.click(function(){t.deleteCallback&&t.deleteCallback.call(this,r,a)})):a.del.hide()):(a.statusbar.hide("slow"),a.statusbar.remove()),e.remove(),n.sCounter+=i.length},error:function(r,o,s){a.abort.hide(),"abort"==r.statusText?a.statusbar.hide("slow"):(t.onError.call(this,i,o,s),t.showStatusAfterError?(a.progressDiv.hide(),a.statusbar.append("<span style='color:red;'>ERROR: "+s+"</span>")):(a.statusbar.hide(),a.statusbar.remove())),e.remove(),n.fCounter+=i.length}};t.autoSubmit?e.ajaxSubmit(l):(t.showCancel&&(a.cancel.show(),a.cancel.click(function(){e.remove(),a.statusbar.remove()})),e.ajaxForm(l))}var f=e.extend({url:"",method:"POST",enctype:"multipart/form-data",formData:null,returnType:null,allowedTypes:"*",fileName:"file",formData:{},dynamicFormData:function(){return{}},maxFileSize:-1,multiple:!0,dragDrop:!0,autoSubmit:!0,showCancel:!0,showAbort:!0,showDone:!0,showDelete:!1,showError:!0,showStatusAfterSuccess:!0,showStatusAfterError:!0,showFileCounter:!0,fileCounterStyle:"). ",showProgress:!1,onSelect:function(e){return!0},onSubmit:function(e,r){},onSuccess:function(e,r,t){},onError:function(e,r,t){},deleteCallback:!1,afterUploadAll:!1,uploadButtonClass:"ajax-file-upload",dragDropStr:"<span><b>Drag &amp; Drop Files</b></span>",abortStr:"Abort",cancelStr:"Cancel",deletelStr:"Delete",doneStr:"Done",multiDragErrorStr:"Multiple File Drag &amp; Drop is not allowed.",extErrorStr:"is not allowed. Allowed extensions: ",sizeErrorStr:"is not allowed. Allowed Max size: ",uploadErrorStr:"Upload is not allowed"},t);this.fileCounter=1,this.fCounter=0,this.sCounter=0,this.tCounter=0;var c="ajax-file-upload-"+(new Date).getTime();this.formGroup=c,this.hide(),this.errorLog=e("<div></div>"),this.after(this.errorLog),this.responses=[],r.formdata||(f.dragDrop=!1);var h=this,m=e("<div>"+e(this).html()+"</div>");e(m).addClass(f.uploadButtonClass),function b(){if(e.fn.ajaxForm){if(f.dragDrop){var r=e('<div class="ajax-upload-dragdrop" style="vertical-align:top;"></div>');e(h).before(r),e(r).append(m),e(r).append(e(f.dragDropStr)),a(h,f,r)}else e(h).before(m);d(h,c,f,m)}else window.setTimeout(b,10)}(),this.startUpload=function(){e("."+this.formGroup).each(function(r,t){e(this).is("form")&&e(this).submit()})},this.stopUpload=function(){e(".ajax-file-upload-red").each(function(r,t){e(this).hasClass(h.formGroup)&&e(this).click()})},this.getResponses=function(){return this.responses};var v=!1;return this}}(jQuery);